{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/avatar.jpg","path":"img/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/mouse.css","path":"css/mouse.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/custom.css","path":"css/custom.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/progress_bar.css","path":"css/progress_bar.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/loading.css","path":"css/loading.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/card.css","path":"css/card.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/color.css","path":"css/color.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/meting2.min.js","path":"js/meting2.min.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/music.js","path":"js/music.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/music.css","path":"css/music.css","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/aplayer.js","path":"js/aplayer.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/countup.js","path":"js/countup.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/huge.png","path":"img/huge.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/map.png","path":"img/map.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/xiantiao.png","path":"img/xiantiao.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/zhuiju1.png","path":"img/zhuiju1.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/zhuiju2.png","path":"img/zhuiju2.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/Peach_blossom.jpg","path":"img/Peach_blossom.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/categories/index.md","hash":"59f856873d5abf294cee9788a851d8e69dfd710f","modified":1678168782744},{"_id":"source/link/index.md","hash":"15915a02805915592c0663d4c8de2cd4afca2088","modified":1674479394708},{"_id":"source/tags/index.md","hash":"73379b216a48e8db2f310ccd00a4be2432c9ce5c","modified":1678168825285},{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1674279863746},{"_id":"themes/butterfly/_config.yml","hash":"c3d74183fb20f72dc6c9ad54b27b0c4e25138f17","modified":1678284813964},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1674044851000},{"_id":"themes/butterfly/README.md","hash":"c34579d9d7239828ce7d8abc235521eaf4ea9e17","modified":1674044851000},{"_id":"themes/butterfly/plugins.yml","hash":"ee8d1240372fc90e2666759088ad0c5375666d74","modified":1674044851000},{"_id":"themes/butterfly/README_CN.md","hash":"25cfdbaf9883095322259c4f49bd08f0a7cffa0e","modified":1674044851000},{"_id":"themes/butterfly/package.json","hash":"22872294a98bf759db4cf8cb3d48dc2f811d3534","modified":1678167941016},{"_id":"themes/butterfly/languages/default.yml","hash":"9b9c5b8158d1296c64a354e57a3b0b809575a77d","modified":1674044851000},{"_id":"themes/butterfly/languages/en.yml","hash":"e0e52a7ba52fa70c3557f00ddf681f66098ac8b7","modified":1674044851000},{"_id":"themes/butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1674044851000},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1674044851000},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"5b9ce449bd4f7e3ba46131546e75976efe31a1f6","modified":1674044851000},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"0b994863599d62c56d2bc50d20b94332ed9d98cf","modified":1674044851000},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1674044851000},{"_id":"themes/butterfly/layout/page.pug","hash":"80c59074bf7bc56b4f638ac818c6f1ab013b2862","modified":1678272883833},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1674044851000},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1674044851000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":1674044851000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1674044851000},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"fc468a93a64c7a3e408fbac921c9f5a5a8f32027","modified":1674044851000},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"d1bf03af239d94a8f03e040ef4dd5ea6334a48fd","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"a8720f01c429c839149d7f5991c49541011f4796","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"65562d81d7db9324d0762af8269f9385ae34e968","modified":1678240220624},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"4c85de4dea4dca4e5088097a79bd6d7009cbf8ef","modified":1674044851000},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"83a1f2d31792206d432e8e2041e284d88327c02e","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"8d39473ed112d113674a0f689f63fae06c72abd2","modified":1674044851000},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"f5cbd41c6afb49639b59ab5ad659da0d3b7f25dd","modified":1674044851000},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1674044851000},{"_id":"themes/butterfly/scripts/events/init.js","hash":"3ace1139182d3d367149db138990891427f3356e","modified":1674044851000},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"5351e0bc09e6b5b3f6d30f333a2520626a28ca3a","modified":1674044851000},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1674044851000},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"8ad9911b755cba13dde2cc055c3f857a6b0dd20e","modified":1674044851000},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1674044851000},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1674044851000},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"d1a5b26c8239189493c1f7d8fd0b8f8ec3d11eaa","modified":1674044851000},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"9ea86bd7a3c3fca3324f70b1cd4d9e42f9efb08d","modified":1674044851000},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1674044851000},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"c2d4d0537f9aed4eba2bb3d093ad89ca9e80cff9","modified":1674044851000},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"5a60c732b17816040ecfdfa584ecb96836e7043f","modified":1678196322142},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"4677be4175da6800c0b3b8c1614e593f73df8831","modified":1674044851000},{"_id":"themes/butterfly/source/css/index.styl","hash":"3b2830d937d7e6b5dc1cd4d336b1f733a0f22699","modified":1678272977872},{"_id":"themes/butterfly/source/css/var.styl","hash":"e018dad9f674fc5564112b99032fe5fe8b2d195f","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"fc0b813452a705911af37b891513ae50a8795710","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1674044851000},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1674044851000},{"_id":"themes/butterfly/source/js/main.js","hash":"c0a3093c2485fa2121c10741e256170f211c7398","modified":1674044851000},{"_id":"themes/butterfly/source/js/utils.js","hash":"c9b4d8ec10a74f29cf1f9c4275f0cae3bd93b427","modified":1674044851000},{"_id":"themes/butterfly/source/img/favicon.png","hash":"b8ec91e5e07a20af9590cf6d50f6997811377908","modified":1675058139929},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"76d0c5c172cae44b34b0bd3125fd068b2c3cbd4a","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"8aa8d799aedbfd811195b84a451bc4b6e2647c12","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"67e1c3b48e4ca7ee0b2c76d3ca7476b9883cf105","modified":1674044851000},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"428e3c39053b44760463682848f2eae238ff9d64","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"a03b3ddc06e7aa9fd07eea0d5f97c8d5addd2315","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1674044851000},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"0c1551ef80bbece550fe520d91e21f083cbc14fe","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"c72be46dadef859681c87b9fca27590dee255594","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"ee15699e9fc948f14324cf2f7bb41c4dbd15d548","modified":1678198190752},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"f8614a2b0374a92fe3d731ae1e354646c96a5bf4","modified":1678198208964},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"3add78e9d985dff8bc22ed40db779ec448105e57","modified":1678197583632},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"90554c2ca5ba946f4c02e1bc5fe2859cef1b1594","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"294df7a74cf36af3a7030274d8b745979c1c8c70","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"a59bcfbb609a099c1bf5be40b7a94e7e2b06fc4a","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"e37468e63db2a0ac09b65d21b7de3e62425bb455","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"e5aac7b28ed4123d75797263c64e74ac547945bc","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"fc0b09068009edd4026d90a669608cbe211aeecf","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"35223531f8e086d57caec2d17d45ddbcb39deb74","modified":1674044851000},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"7fdfbe8f97b41588bbd5c6f27e7e85a881b28954","modified":1674044851000},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"336b7ac54b66a1d70baa9bde51d1a5aca92f451e","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"c9e98027f2dd730ce389c2047f62ebb748955fcf","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"bb470da1d2ba292cae0a30a252f82f37c4130d2d","modified":1674044851000},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"f69c52415a5201083b3811e9faf7de80476569d3","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"83553445fbc92cad4ad220fbd87b4c3db958c32a","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"449eac5d2030870fec818cce770c251d88682dd2","modified":1678198376272},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"45d71dbb2a61e30989851ba29bb8be7094574d14","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"23db4e3cab68fed78601fc8a9c39ff5753bcc716","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bbc884d6b2158a833b77a1bbc07248e17874b22e","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1674044851000},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"56389925671c7e8da0c033769421269e15e8f795","modified":1674044851000},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"a92984f566c97bb4179f34be79240af1552c6f17","modified":1674044851000},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"ffea9e7c1543edcf080381e7b99828954c2f2cef","modified":1674044851000},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"39d61cbe0c1e937f83ba3b147afaa29b4de2f87d","modified":1674044851000},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"86f3962a6ea11b2951b4ddb6424fda5e95ec962a","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"81ad85acf0e0fe7f9ee23c16a700e7154574d5dd","modified":1674044851000},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"7fdbe79b6c98157706be016f990ab3501bd796b1","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1674044851000},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1674044851000},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1674044851000},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"a38142aa105aa5da08d7cd9f3495b91e97b2f30b","modified":1678195935496},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"5f4294337c28324e088908ed0ceb237a2a360ae5","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"99d9b17668260b242749c16851d9ec1024d31899","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"b2aadea7351fae8382b8c2a3b9de810d922b0ec1","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"58406a7a3bf45815769f652bf3ef81e57dcd07eb","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"55acc455ca8e13211e3906cf78e487cc92accee5","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"0611d9216f4c128ebdea4cc21454c3dc4a6398d5","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"ccb7d8ce3ded7364f9a15334b68ad73869fca757","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"95738f110598f999d627234e78ff9e9decac1b9b","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"8ec24c1939895ac0db2b2e8700bc9307b4ceb53c","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"3ba842bf4801b2f115c2cfe5657f35a732ce589f","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"1c3a87393cb49915940c2dd206356c2a16549767","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"eefdaa94956adc7a3ca90dd8edcd70a7574b439c","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"351fe25fbf02635b1f9e86e5e244c7d61f69baa7","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"e9bdf80d6796afc04eb809dbbe780d97f22c7fcd","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"e18fbd88d8942e53e771f29b26209ab735c5c567","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"0a1b8fe95623b095eb7ede3f30ca327684d1e613","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"1c846c8d51649b8554d91536323eaeb20c8fc236","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"8e33aca36a4d3ae9e041ba05ced8eff56ae38f77","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"c12c898b35dd014780c1f3220ddbe12e7270983c","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"ab167c00da4506f591b96f0591bf5bd214a26d4b","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"233907dd7f5b5f33412701d2ccffbc0bbae8707b","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"441d87067d87d9996b53b25c05b8e620bd94b027","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"e8245d0b4933129bb1c485d8de11a9e52e676348","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"178c9cdcc4ce5a006885b24ce4a3d624e4734899","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1674044851000},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"c7dd2b2ae9b23aa0a60fffd7df9e9f76ef52033e","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1674044851000},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1674044851000},{"_id":"themes/butterfly/source/img/avatar.jpg","hash":"142511b15e3808b22b9ed8867ff6503412d9021d","modified":1674546304140},{"_id":"source/_posts/about.md","hash":"5b6209ff1f4a0451bd1e6e8bcdb0bffe6c708c9b","modified":1674550758935},{"_id":"source/_posts/messages.md","hash":"af870c2021087afe7d0908493ee4c16eb4178b1c","modified":1674550768248},{"_id":"source/_posts/photo.md","hash":"f174b0001946981acbad645aeace144662f91168","modified":1674550748281},{"_id":"public/atom.xml","hash":"d2226413ceb757e5ede2145d5704e13160ae2dd9","modified":1678167484538},{"_id":"public/search.xml","hash":"81982c2ba03425b6dd748cf270bf7b7b541d626b","modified":1678167484538},{"_id":"public/sitemap.xml","hash":"33b4df5a2361a018a456c9e5d5661bd8090514fb","modified":1678273299933},{"_id":"public/sitemap.txt","hash":"88b0b4100d8bc7262028a9d439f95cbf4a4c9b82","modified":1678273299933},{"_id":"public/404.html","hash":"bd4016dd44a9385e2fd3767f2a25adff0e8276c2","modified":1678286390949},{"_id":"public/link/index.html","hash":"f4e1c7953ec68088ffd0435561ed8d9a4a0f83b7","modified":1674552001277},{"_id":"public/categories/index.html","hash":"08a3ef1f9a9ce30924ea71d1c72991d87fdb7392","modified":1678286390949},{"_id":"public/tags/index.html","hash":"f8999a41222534d83d6ebadd4d0486e448c58c8e","modified":1678286390949},{"_id":"public/2023/01/24/messages/index.html","hash":"485b321746b1788d62fe745c18903b214728b644","modified":1674550795188},{"_id":"public/2023/01/24/about/index.html","hash":"4427074652459d9cfd4357a1cd7a360537593cad","modified":1674550795188},{"_id":"public/2023/01/24/photo/index.html","hash":"3f74fa3db46e6ca8d936e70ffbf0aff3457b017e","modified":1674550795188},{"_id":"public/2023/01/23/hello-world/index.html","hash":"51528403c8c73d93a5220c44f07b0e0a4fd099d2","modified":1674550795188},{"_id":"public/archives/index.html","hash":"08d52e06c408078f4fe45d555ef316ee4d290416","modified":1678286390949},{"_id":"public/archives/2023/index.html","hash":"571ea01eeceee848cfa4a52d8fb63215a4570ddd","modified":1678286390949},{"_id":"public/archives/2023/01/index.html","hash":"e2e18879160665a3814d3ec3a31d782f81aa13b6","modified":1678286390949},{"_id":"public/index.html","hash":"cb9669a3be88c3f4631741f9c63166aea8411c90","modified":1678286390949},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1674550795188},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1674550795188},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1674550795188},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1674550795188},{"_id":"public/js/utils.js","hash":"c9b4d8ec10a74f29cf1f9c4275f0cae3bd93b427","modified":1674550795188},{"_id":"public/js/search/algolia.js","hash":"5f4294337c28324e088908ed0ceb237a2a360ae5","modified":1674550795188},{"_id":"public/js/search/local-search.js","hash":"a38142aa105aa5da08d7cd9f3495b91e97b2f30b","modified":1678195944126},{"_id":"public/css/index.css","hash":"4800ad9daa3e827f8fb651de36ae7374995b654b","modified":1678273299933},{"_id":"public/js/main.js","hash":"c0a3093c2485fa2121c10741e256170f211c7398","modified":1674550795188},{"_id":"public/js/tw_cn.js","hash":"76d0c5c172cae44b34b0bd3125fd068b2c3cbd4a","modified":1674550795188},{"_id":"public/img/avatar.jpg","hash":"142511b15e3808b22b9ed8867ff6503412d9021d","modified":1674550795188},{"_id":"source/photo/index.md","hash":"f8b7cb47a03767454350ff7f9a15379c61bff865","modified":1678168801697},{"_id":"source/messages/index.md","hash":"6eb989a1b13e3b8426dabf17b712133e4b762852","modified":1675397274191},{"_id":"public/messages/index.html","hash":"6bbb18ad63cde1f2371f97f92924ed0dd78e59a9","modified":1678286390949},{"_id":"public/photo/index.html","hash":"572d28b1640c0991b9e2c72d0d68daf85fb1660c","modified":1678286390949},{"_id":"source/_posts/a.md","hash":"e4ea294c062c525643df036a35ca579b905fa400","modified":1674552091679},{"_id":"source/_posts/笔记.md","hash":"0d76935b743bb9be78545208fc0483114377c38a","modified":1674552389813},{"_id":"source/_data/valine.json","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1674610918000},{"_id":"source/_posts/vue3.md","hash":"742f7bd7660456fbfd2267ca068e6b667c562727","modified":1675749444837},{"_id":"source/photo/wallpaper/index.md","hash":"fd77dc1424edcf4d1849221beac0b6f0e9c8d260","modified":1678168817285},{"_id":"source/_posts/node笔记.md","hash":"14e8bbe0498ed36acdbd14610707bcc61ff1f782","modified":1677223661120},{"_id":"source/about/index.md","hash":"fe9516c0d6dfa9dab0892ea763866c7378efe360","modified":1678272372563},{"_id":"source/_posts/utools介绍.md","hash":"f770a180c204005f05ade080d3bc6ce61a7c7f26","modified":1675148711671},{"_id":"source/_posts/Typora.md","hash":"0d2e762e5bb1a721c2f5e217f7c096a0dafa074b","modified":1675149418472},{"_id":"source/photo/marvel/index.md","hash":"b1c10e31ee4d5758c36a16bdf6d0b794abafe49e","modified":1678168810305},{"_id":"themes/butterfly/source/css/mouse.css","hash":"9975b6f1bdb6cae5635d36d41f43c7e4aeddd764","modified":1675150204025},{"_id":"themes/butterfly/source/img/favicon.ico","hash":"fd6d7eb4af486b6a0d8113bf0c8423da7bf1343c","modified":1675055708282},{"_id":"public/photo/wallpaper/index.html","hash":"317b0ba9e4d9f69d89cef06f5282c6b07bff159a","modified":1678286390949},{"_id":"public/photo/marvel/index.html","hash":"0f2fabf0c65083a7f9c49b81813280c028117be2","modified":1678286390949},{"_id":"public/about/index.html","hash":"99de51af073e38ebcf9d3800f348eef79e615415","modified":1678286390949},{"_id":"public/2023/01/31/utools介绍/index.html","hash":"38754edb451013b0f568b1e2a1721bb1d0400e9d","modified":1678284827075},{"_id":"public/2023/01/28/Typora/index.html","hash":"acec755b9d0291210c1d3059c7479e0262436f06","modified":1678284827075},{"_id":"public/2023/01/25/vue3/index.html","hash":"04ee9335a23de8ad59a1993f81d290b97b21250a","modified":1678284827075},{"_id":"public/2023/01/25/node笔记/index.html","hash":"5770074c7a83dc5075887c3de593d6c8297b0346","modified":1678284827075},{"_id":"public/categories/web前端/index.html","hash":"6135cc00f36701f82ba027cf3d57fb129ce533c3","modified":1678286390949},{"_id":"public/categories/软件推荐/index.html","hash":"c20a165125a9edaf89773f7f472b17f089137c12","modified":1678286390949},{"_id":"public/tags/Vue3/index.html","hash":"33be1d08a1f848504d0e3acf6ea39703ad324f35","modified":1678286390949},{"_id":"public/tags/node/index.html","hash":"0be45ec5d5ec4d2d2176a4616c56da896d556f49","modified":1678286390949},{"_id":"public/tags/Typora/index.html","hash":"fa6f9e262ba0d9a02dedf482b164e4a7b763cbd6","modified":1678286390949},{"_id":"public/tags/快捷效率工具/index.html","hash":"77f94fb2fa7d88070df63c4eca3a0bf66479bb9e","modified":1678286390949},{"_id":"public/img/favicon.ico","hash":"fd6d7eb4af486b6a0d8113bf0c8423da7bf1343c","modified":1678167484538},{"_id":"public/css/mouse.css","hash":"9975b6f1bdb6cae5635d36d41f43c7e4aeddd764","modified":1678167484538},{"_id":"themes/butterfly/package-lock.json","hash":"195cba81ed2285b3449577e95f29bade2fb8fb58","modified":1678167941014},{"_id":"source/_data/cinemas.json","hash":"b41d79d9841b11415da9984d9ad4b52afb9ece8a","modified":1678168646634},{"_id":"source/move/index.md","hash":"f63255334d8c35fe3052c1a4d4d344004b2e01ce","modified":1678168738558},{"_id":"public/move/index.html","hash":"9b5734332c636365b929c0ebbe3b885a8d51d1b6","modified":1678286390949},{"_id":"public/live2dw/assets/koharu.model.json","hash":"ceccdefd776b7c9475a29cff0842796e4f58b7e9","modified":1678169313147},{"_id":"public/live2dw/assets/koharu.physics.json","hash":"2fbf886979212357ba293bd35884f2cb5b26b6a6","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/01.mtn","hash":"61d7d590d9feb71b32fd6bd142b59410d75bc1fa","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/04.mtn","hash":"32c888667455a3ff6f1b04f910c1a5cc4de30af0","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/03.mtn","hash":"a72b697a92a7cff40d15774b143b465b34cee5e6","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/02.mtn","hash":"efc99efdff39c93372cff0f6d62c4e748e1a5593","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/05.mtn","hash":"637e00442da4042cd4b0ed2cc62ffb1559881814","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/06.mtn","hash":"df10cc1d333c96da1296a4853c1ddbd44d8a11f3","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/07.mtn","hash":"d8c9410135c81604eba665b59808089808e0851a","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/08.mtn","hash":"9b95ef8548b979d1fca557c74f8d66fb15b34578","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/09.mtn","hash":"ecf1283b72e1c4b7e3a97343cd97726813f18790","modified":1678169313147},{"_id":"public/live2dw/assets/mtn/idle.mtn","hash":"058d4628ab04bf42c279501ba4fa37116d384e41","modified":1678169313147},{"_id":"public/live2dw/lib/L2Dwidget.min.js","hash":"5f1a807437cc723bcadc3791d37add5ceed566a2","modified":1678169313147},{"_id":"public/live2dw/lib/L2Dwidget.min.js.map","hash":"3290fe2df45f065b51a1cd7b24ec325cbf9bb5ce","modified":1678169313147},{"_id":"public/live2dw/lib/L2Dwidget.0.min.js","hash":"35bb5b588b6de25c9be2dd51d3fd331feafac02d","modified":1678169313147},{"_id":"public/live2dw/assets/moc/koharu.moc","hash":"5eec3fba21444dd6f774b913510b5955e2c0605b","modified":1678169313147},{"_id":"public/live2dw/assets/moc/koharu.2048/texture_00.png","hash":"0879b61b745084781722636bba9f278f31ce5fc1","modified":1678169313147},{"_id":"public/live2dw/lib/L2Dwidget.0.min.js.map","hash":"35e71cc2a130199efb167b9a06939576602f0d75","modified":1678169313147},{"_id":"themes/butterfly/source/css/custom.css","hash":"db46354b6f95d3b2317f9cb4077980ffc033fd27","modified":1678240694751},{"_id":"public/css/custom.css","hash":"34a6d054a1b9f6098c53ef01a9647765f288f536","modified":1678240700117},{"_id":"themes/butterfly/source/css/pace.css","hash":"64cc8ccaf7c798b7937680034da7a5c6ac6017b7","modified":1678197973819},{"_id":"public/css/pace.css","hash":"122e70655ee4e6317137363225a1ad95db8e0f63","modified":1678198054177},{"_id":"themes/butterfly/source/css/loading.css","hash":"b6c516235f622ec12c72c49a96b459abe97fb2c9","modified":1678198538225},{"_id":"themes/butterfly/source/css/progress_bar.css","hash":"5b2463e4034ff351d12f3be5ffbb50b5c149bc38","modified":1678198267284},{"_id":"public/css/progress_bar.css","hash":"ce1a2c7b71129aa204ea9cf4115277a0b28f8a8d","modified":1678198734815},{"_id":"public/css/loading.css","hash":"0065ac4b484a75cb0aa5fca9850edc23efdd0048","modified":1678198734815},{"_id":"themes/butterfly/source/css/card.css","hash":"a07d02ceb17afeec117b03cc99b7b51c3315ab7d","modified":1678198876648},{"_id":"public/css/card.css","hash":"895bf96f35e394ff801b67f2b411cc09dbb91112","modified":1678198893312},{"_id":"themes/butterfly/source/css/color.css","hash":"a5a3076b97509dd6019dfee2ae192bb10f84dc73","modified":1678241055599},{"_id":"public/css/color.css","hash":"0c4587ff751be23be3c5e0cc5450816ba3f081f6","modified":1678241200275},{"_id":"source/music/index.md","hash":"f73310b61a60b1d8bc7cf767c7391e1b176dccff","modified":1678239618600},{"_id":"themes/butterfly/source/css/music.css","hash":"fe9e19d788761422fa917216549f400ade0f51d3","modified":1678263919480},{"_id":"themes/butterfly/source/js/meting2.min.js","hash":"6708b4a8022158bdf8d83f3b1b9840fd6d1b7751","modified":1678253318995},{"_id":"themes/butterfly/source/js/music.js","hash":"fe414060f085677cdc6ca4d812ef99282d81a99c","modified":1678250727180},{"_id":"themes/butterfly/layout/includes/page/music.pug","hash":"2da8ca17bcd3ea6a7c4e5a06088905002ba892a9","modified":1678240551218},{"_id":"public/music/index.html","hash":"26a0f2917828ddac442236a20b4c0263e1754c79","modified":1678284827075},{"_id":"public/css/music.css","hash":"c9a08cbce1caab72959705db690a1d349c0ea11e","modified":1678264038379},{"_id":"public/js/meting2.min.js","hash":"c05145cda74934a318b2e77f292f575446c5fd90","modified":1678262965854},{"_id":"public/js/music.js","hash":"8db429a19322863106f5b08fc08973e6c091e17e","modified":1678251179364},{"_id":"themes/butterfly/source/js/aplayer.js","hash":"0c7ee3ab31ac7803f30ac933a3b34f793e59cc4b","modified":1678263991392},{"_id":"public/js/aplayer.js","hash":"ed887b9318e945fd5c02a7bfdc39af3b9dc9a017","modified":1678264038379},{"_id":"source/_data/creativity.yml","hash":"13860b068c3ea65c4530b7a8376b4ce846d9c55f","modified":1678273284891},{"_id":"themes/butterfly/layout/includes/page/about.pug","hash":"9917d77a28fc43e09c00c74f6fa7610308a98714","modified":1678286361101},{"_id":"themes/butterfly/source/js/countup.js","hash":"ddcbf0b3022b59b1f5c188a994b8d049b1230f74","modified":1678272819028},{"_id":"themes/butterfly/source/css/_custom/about.css","hash":"0babd75fec83488a2199343bd9c16e136aaa6c32","modified":1678282614424},{"_id":"themes/butterfly/source/css/_custom/genshinimpact.css","hash":"32506d09dbdb2f2b258b80a0f0b89152bf5b77ea","modified":1678273116589},{"_id":"themes/butterfly/source/css/_custom/hello-about.css","hash":"fcfd76203c9a9cbf9ae6cf9c8fad46cb03a14ace","modified":1678273141300},{"_id":"themes/butterfly/source/css/_custom/careers.css","hash":"a3c2d4b6aaf030772e9fc071be78ff42cc7a00a6","modified":1678273093210},{"_id":"themes/butterfly/source/css/_custom/site.css","hash":"9f157b7d3e3a62771e5ed977a2b28af01e423180","modified":1678273186906},{"_id":"themes/butterfly/source/css/_custom/skills.css","hash":"9dfaecf92f0050423ba1a07742e082f353f19751","modified":1678273161907},{"_id":"public/js/countup.js","hash":"89388b8b14405b13257da96356312a5f37f94841","modified":1678273299933},{"_id":"themes/butterfly/source/img/huge.png","hash":"e12a9765b9d0309f3b18e84a2cd6c0db80e1a1a5","modified":1678280252766},{"_id":"themes/butterfly/source/img/xiantiao.png","hash":"c0b960e72ca7969de7d301e7cd31f84e2665114c","modified":1678281839839},{"_id":"themes/butterfly/source/img/Peach blossom.jpg","hash":"19f60a1b5f953d7bc4088e2b7cf759c5f26c8a36","modified":1678276895851},{"_id":"themes/butterfly/source/img/map.png","hash":"af7b793aa190e04ec000b2b315bab8155ca9e5c6","modified":1678281810969},{"_id":"themes/butterfly/source/img/zhuiju1.png","hash":"145b32fa7b899745d18b3105bebd719fe4edf4e7","modified":1678277398233},{"_id":"themes/butterfly/source/img/zhuiju2.png","hash":"d26fc989d20a4e5982e79ba1855360c39c71857e","modified":1678277585174},{"_id":"public/img/xiantiao.png","hash":"c0b960e72ca7969de7d301e7cd31f84e2665114c","modified":1678281883078},{"_id":"public/img/huge.png","hash":"e12a9765b9d0309f3b18e84a2cd6c0db80e1a1a5","modified":1678281883078},{"_id":"public/img/Peach blossom.jpg","hash":"19f60a1b5f953d7bc4088e2b7cf759c5f26c8a36","modified":1678281883078},{"_id":"public/img/map.png","hash":"af7b793aa190e04ec000b2b315bab8155ca9e5c6","modified":1678281883078},{"_id":"public/img/zhuiju1.png","hash":"145b32fa7b899745d18b3105bebd719fe4edf4e7","modified":1678281883078},{"_id":"public/img/zhuiju2.png","hash":"d26fc989d20a4e5982e79ba1855360c39c71857e","modified":1678281883078},{"_id":"themes/butterfly/source/img/Peach_blossom.jpg","hash":"19f60a1b5f953d7bc4088e2b7cf759c5f26c8a36","modified":1678281983705},{"_id":"public/img/Peach_blossom.jpg","hash":"19f60a1b5f953d7bc4088e2b7cf759c5f26c8a36","modified":1678283228029},{"_id":"themes/butterfly/source/img/Peach_blossom.png","hash":"19f60a1b5f953d7bc4088e2b7cf759c5f26c8a36","modified":1678281983705},{"_id":"public/img/Peach_blossom.png","hash":"19f60a1b5f953d7bc4088e2b7cf759c5f26c8a36","modified":1678282828225}],"Category":[{"name":"web前端","_id":"cldgzp0l800037kuu39onhott"},{"name":"软件推荐","_id":"cldjztix60003a5w001cmc95o"}],"Data":[{"_id":"cinemas","data":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}},{"_id":"creativity","data":[{"class_name":"开启创造力","creativity_list":[{"name":"Vue","color":"#b8f0ae","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633001374747b.png"},{"name":"React","color":"#222","icon":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K"},{"name":"Docker","color":"#57b6e6","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/63300647df7fa.png"},{"name":"Photoshop","color":"#4082c3","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/63300647e1f10.png"},{"name":"Node","color":"#333","icon":"https://npm.elemecdn.com/anzhiyu-blog@2.1.1/img/svg/node-logo.svg"},{"name":"Webpack","color":"#2e3a41","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/26/6330ff27e5c9b.png"},{"name":"Pinia","color":"#fff","icon":"https://npm.elemecdn.com/anzhiyu-blog@2.0.8/img/svg/pinia-logo.svg"},{"name":"Python","color":"#fff","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/63300647dea51.png"},{"name":"Vite","color":"#937df7","icon":"https://npm.elemecdn.com/anzhiyu-blog@2.0.8/img/svg/vite-logo.svg"},{"name":"Flutter","color":"#4499e4","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633004063ff15.png"},{"name":"Java","color":"#fff","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633005bf0fd1e.jpg"},{"name":"CSS3","color":"#2c51db","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006cc55e07.png"},{"name":"JS","color":"#f7cb4f","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006eee047b.png"},{"name":"HTML","color":"#e9572b","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006f9ab27d.png"},{"name":"Git","color":"#df5b40","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006e37c7fd.webp"},{"name":"Apifox","color":"#e65164","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633007087a4dc.webp"}]}]}],"Page":[{"title":"分类","date":"2023-01-23T13:08:18.000Z","comments":0,"type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2023-01-23 21:08:18\ncomments: false\ntype: \"categories\"\n---\n","updated":"2023-03-07T05:59:42.744Z","path":"categories/index.html","_id":"clda08h8m00025ouu7krz5jar","layout":"page","content":"","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":""},{"title":"标签","date":"2023-01-23T13:07:37.000Z","comments":0,"type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2023-01-23 21:07:37\ncomments: false\ntype: \"tags\"\n---\n","updated":"2023-03-07T06:00:25.285Z","path":"tags/index.html","_id":"clda08h8n00035ouu3nbyg82v","layout":"page","content":"","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":""},{"title":"相册","comments":0,"date":"2023-01-24T09:06:20.000Z","_content":"\n{% galleryGroup '电脑壁纸' '收藏的一些壁纸' '/photo/wallpaper' https://i.loli.net/2019/11/10/T7Mu8Aod3egmC4Q.png %}\n{% galleryGroup '漫威' '关于漫威的图片' '/photo/marvel' https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg %}\n\n","source":"photo/index.md","raw":"---\ntitle: 相册\ncomments: false\ndate: 2023-01-24 17:06:20\n\n---\n\n{% galleryGroup '电脑壁纸' '收藏的一些壁纸' '/photo/wallpaper' https://i.loli.net/2019/11/10/T7Mu8Aod3egmC4Q.png %}\n{% galleryGroup '漫威' '关于漫威的图片' '/photo/marvel' https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg %}\n\n","updated":"2023-03-07T06:00:01.697Z","path":"photo/index.html","_id":"clda0jqhk0000b0uu9emt72tj","layout":"page","content":"\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img no-lightbox\" src='https://i.loli.net/2019/11/10/T7Mu8Aod3egmC4Q.png' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">电脑壁纸</div>\n  <p>收藏的一些壁纸</p>\n  <a href='/photo/wallpaper'></a>\n  </figcaption>\n  </figure>\n  \n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img no-lightbox\" src='https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">漫威</div>\n  <p>关于漫威的图片</p>\n  <a href='/photo/marvel'></a>\n  </figcaption>\n  </figure>\n  \n\n","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":"\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img no-lightbox\" src='https://i.loli.net/2019/11/10/T7Mu8Aod3egmC4Q.png' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">电脑壁纸</div>\n  <p>收藏的一些壁纸</p>\n  <a href='/photo/wallpaper'></a>\n  </figcaption>\n  </figure>\n  \n\n  <figure class=\"gallery-group\">\n  <img class=\"gallery-group-img no-lightbox\" src='https://i.loli.net/2019/12/25/8t97aVlp4hgyBGu.jpg' alt=\"Group Image Gallery\">\n  <figcaption>\n  <div class=\"gallery-group-name\">漫威</div>\n  <p>关于漫威的图片</p>\n  <a href='/photo/marvel'></a>\n  </figcaption>\n  </figure>\n  \n\n"},{"title":"留言板","date":"2023-01-24T09:11:55.000Z","_content":"","source":"messages/index.md","raw":"---\ntitle: 留言板\ndate: 2023-01-24 17:11:55\n---\n","updated":"2023-02-03T04:07:54.191Z","path":"messages/index.html","_id":"clda0s1oa0000q0uu6ysx30uy","comments":1,"layout":"page","content":"","site":{"data":{}},"cover":false,"excerpt":"","more":""},{"title":"电脑壁纸","comments":0,"date":"2023-01-24T09:06:20.000Z","_content":"\n{% gallery %}\n![](https://ts1.cn.mm.bing.net/th/id/R-C.24ebc28272ab0356797d0518be6479f0?rik=OaFiGYll%2bsBezQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f82245910%2f20150411110517533.jpg&ehk=x%2fzulEeS6gfr3Y5oABokpNVE9KHNlvX5kTnRlFhdic0%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.782dad49effd85eee671458891bb77b1?rik=1I7bFi%2fPSk5UOg&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f97530185%2f201306191017.jpg&ehk=OIJEUGMFnRXqOKDWZzKOr62%2bU8EIhwscVnoHaEqtv0Y%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.15e970cd0765096178a6da16993cfbb1?rik=IT5KfevidZcTig&riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1210%2f22%2fc0%2f14558824_1350879506501.jpg&ehk=X9ro%2fg%2fGTmsglVrbV%2bmy8c3wsAvcHseqcEhsf80RMWA%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.70a9938f5212c1c8a0476f0f075a082e?rik=1AmXu0NsLO1HPA&riu=http%3a%2f%2fimg2.a0bi.com%2fupload%2fttq%2f20150713%2f1436756859971.jpg&ehk=zJstTyGvgXtffTkMuvh0RqRjZO4qQUJ064Yg1lms0aw%3d&risl=&pid=ImgRaw&r=0)\n![](https://www.todaybing.com/pimg/cb81d8c686ca9735c3d3332391ffc127.jpg)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.37f7ba4b6705855cd70a4184602ab3bd?rik=VYsH3dmxloJ9zA&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f05816294%2f201306041636.jpg&ehk=2pHo1Jg2tTI4e4Rg4eq9%2bnirKov4XhZmLF9pCUvcmIg%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.01b5ce347d20cbe9eea0d7ea395cfcd8?rik=93zJ8JR4yehwNQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f31629658%2fdn201308051006.jpg&ehk=FEOihHjgIav9kXNRaV2azrn2JqZn6J57wmE3goOadRM%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.100617f9f10f35e7b15b203e5fb2a41e?rik=7HFTOqCCqBM8ew&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f92610935%2f1423462346978.jpg&ehk=X7RnFjBS%2bsKoQIR9qiFARrVxKYzqdHvYXuAsbJBqB7c%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.a34d14b2206629d719ba7cc5ae0bd841?rik=Z9HWPp31bQenKQ&riu=http%3a%2f%2fres.allmacwallpaper.com%2fget%2fRetina-MacBook-Pro-15-inch-wallpapers%2fNature-View-2880x1800%2f16965-8.jpg&ehk=aNsoqrsfFSfggxwB7gln%2bDi4emNZpcyIhoa2LbBG428%3d&risl=&pid=ImgRaw&r=0)\n{% endgallery %}\n\n","source":"photo/wallpaper/index.md","raw":"---\ntitle: 电脑壁纸\ncomments: false\ndate: 2023-01-24 17:06:20\n\n---\n\n{% gallery %}\n![](https://ts1.cn.mm.bing.net/th/id/R-C.24ebc28272ab0356797d0518be6479f0?rik=OaFiGYll%2bsBezQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f82245910%2f20150411110517533.jpg&ehk=x%2fzulEeS6gfr3Y5oABokpNVE9KHNlvX5kTnRlFhdic0%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.782dad49effd85eee671458891bb77b1?rik=1I7bFi%2fPSk5UOg&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f97530185%2f201306191017.jpg&ehk=OIJEUGMFnRXqOKDWZzKOr62%2bU8EIhwscVnoHaEqtv0Y%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.15e970cd0765096178a6da16993cfbb1?rik=IT5KfevidZcTig&riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1210%2f22%2fc0%2f14558824_1350879506501.jpg&ehk=X9ro%2fg%2fGTmsglVrbV%2bmy8c3wsAvcHseqcEhsf80RMWA%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.70a9938f5212c1c8a0476f0f075a082e?rik=1AmXu0NsLO1HPA&riu=http%3a%2f%2fimg2.a0bi.com%2fupload%2fttq%2f20150713%2f1436756859971.jpg&ehk=zJstTyGvgXtffTkMuvh0RqRjZO4qQUJ064Yg1lms0aw%3d&risl=&pid=ImgRaw&r=0)\n![](https://www.todaybing.com/pimg/cb81d8c686ca9735c3d3332391ffc127.jpg)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.37f7ba4b6705855cd70a4184602ab3bd?rik=VYsH3dmxloJ9zA&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f05816294%2f201306041636.jpg&ehk=2pHo1Jg2tTI4e4Rg4eq9%2bnirKov4XhZmLF9pCUvcmIg%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.01b5ce347d20cbe9eea0d7ea395cfcd8?rik=93zJ8JR4yehwNQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f31629658%2fdn201308051006.jpg&ehk=FEOihHjgIav9kXNRaV2azrn2JqZn6J57wmE3goOadRM%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.100617f9f10f35e7b15b203e5fb2a41e?rik=7HFTOqCCqBM8ew&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f92610935%2f1423462346978.jpg&ehk=X7RnFjBS%2bsKoQIR9qiFARrVxKYzqdHvYXuAsbJBqB7c%3d&risl=&pid=ImgRaw&r=0)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.a34d14b2206629d719ba7cc5ae0bd841?rik=Z9HWPp31bQenKQ&riu=http%3a%2f%2fres.allmacwallpaper.com%2fget%2fRetina-MacBook-Pro-15-inch-wallpapers%2fNature-View-2880x1800%2f16965-8.jpg&ehk=aNsoqrsfFSfggxwB7gln%2bDi4emNZpcyIhoa2LbBG428%3d&risl=&pid=ImgRaw&r=0)\n{% endgallery %}\n\n","updated":"2023-03-07T06:00:17.285Z","path":"photo/wallpaper/index.html","_id":"cldgzp0l200007kuuc5oq9ah9","layout":"page","content":"<div class=\"gallery\">\n    <div class=\"fj-gallery \" data-rowHeight=\"220\" data-limit=\"10\">\n    <span class=\"gallery-data\">[{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.24ebc28272ab0356797d0518be6479f0?rik=OaFiGYll%2bsBezQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f82245910%2f20150411110517533.jpg&ehk=x%2fzulEeS6gfr3Y5oABokpNVE9KHNlvX5kTnRlFhdic0%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.782dad49effd85eee671458891bb77b1?rik=1I7bFi%2fPSk5UOg&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f97530185%2f201306191017.jpg&ehk=OIJEUGMFnRXqOKDWZzKOr62%2bU8EIhwscVnoHaEqtv0Y%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.15e970cd0765096178a6da16993cfbb1?rik=IT5KfevidZcTig&riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1210%2f22%2fc0%2f14558824_1350879506501.jpg&ehk=X9ro%2fg%2fGTmsglVrbV%2bmy8c3wsAvcHseqcEhsf80RMWA%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.70a9938f5212c1c8a0476f0f075a082e?rik=1AmXu0NsLO1HPA&riu=http%3a%2f%2fimg2.a0bi.com%2fupload%2fttq%2f20150713%2f1436756859971.jpg&ehk=zJstTyGvgXtffTkMuvh0RqRjZO4qQUJ064Yg1lms0aw%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://www.todaybing.com/pimg/cb81d8c686ca9735c3d3332391ffc127.jpg\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.37f7ba4b6705855cd70a4184602ab3bd?rik=VYsH3dmxloJ9zA&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f05816294%2f201306041636.jpg&ehk=2pHo1Jg2tTI4e4Rg4eq9%2bnirKov4XhZmLF9pCUvcmIg%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.01b5ce347d20cbe9eea0d7ea395cfcd8?rik=93zJ8JR4yehwNQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f31629658%2fdn201308051006.jpg&ehk=FEOihHjgIav9kXNRaV2azrn2JqZn6J57wmE3goOadRM%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.100617f9f10f35e7b15b203e5fb2a41e?rik=7HFTOqCCqBM8ew&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f92610935%2f1423462346978.jpg&ehk=X7RnFjBS%2bsKoQIR9qiFARrVxKYzqdHvYXuAsbJBqB7c%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.a34d14b2206629d719ba7cc5ae0bd841?rik=Z9HWPp31bQenKQ&riu=http%3a%2f%2fres.allmacwallpaper.com%2fget%2fRetina-MacBook-Pro-15-inch-wallpapers%2fNature-View-2880x1800%2f16965-8.jpg&ehk=aNsoqrsfFSfggxwB7gln%2bDi4emNZpcyIhoa2LbBG428%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"}]</span>\n    </div>\n    <button class=\"gallery-load-more\"><span>加载更多</span><i class=\"fa-solid fa-arrow-down\"></i></button>\n    </div>\n\n","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":"<div class=\"gallery\">\n    <div class=\"fj-gallery \" data-rowHeight=\"220\" data-limit=\"10\">\n    <span class=\"gallery-data\">[{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.24ebc28272ab0356797d0518be6479f0?rik=OaFiGYll%2bsBezQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f82245910%2f20150411110517533.jpg&ehk=x%2fzulEeS6gfr3Y5oABokpNVE9KHNlvX5kTnRlFhdic0%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.782dad49effd85eee671458891bb77b1?rik=1I7bFi%2fPSk5UOg&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f97530185%2f201306191017.jpg&ehk=OIJEUGMFnRXqOKDWZzKOr62%2bU8EIhwscVnoHaEqtv0Y%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.15e970cd0765096178a6da16993cfbb1?rik=IT5KfevidZcTig&riu=http%3a%2f%2fimg.pconline.com.cn%2fimages%2fupload%2fupc%2ftx%2fwallpaper%2f1210%2f22%2fc0%2f14558824_1350879506501.jpg&ehk=X9ro%2fg%2fGTmsglVrbV%2bmy8c3wsAvcHseqcEhsf80RMWA%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.70a9938f5212c1c8a0476f0f075a082e?rik=1AmXu0NsLO1HPA&riu=http%3a%2f%2fimg2.a0bi.com%2fupload%2fttq%2f20150713%2f1436756859971.jpg&ehk=zJstTyGvgXtffTkMuvh0RqRjZO4qQUJ064Yg1lms0aw%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://www.todaybing.com/pimg/cb81d8c686ca9735c3d3332391ffc127.jpg\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.37f7ba4b6705855cd70a4184602ab3bd?rik=VYsH3dmxloJ9zA&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f05816294%2f201306041636.jpg&ehk=2pHo1Jg2tTI4e4Rg4eq9%2bnirKov4XhZmLF9pCUvcmIg%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.01b5ce347d20cbe9eea0d7ea395cfcd8?rik=93zJ8JR4yehwNQ&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f31629658%2fdn201308051006.jpg&ehk=FEOihHjgIav9kXNRaV2azrn2JqZn6J57wmE3goOadRM%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.100617f9f10f35e7b15b203e5fb2a41e?rik=7HFTOqCCqBM8ew&riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f92610935%2f1423462346978.jpg&ehk=X7RnFjBS%2bsKoQIR9qiFARrVxKYzqdHvYXuAsbJBqB7c%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.a34d14b2206629d719ba7cc5ae0bd841?rik=Z9HWPp31bQenKQ&riu=http%3a%2f%2fres.allmacwallpaper.com%2fget%2fRetina-MacBook-Pro-15-inch-wallpapers%2fNature-View-2880x1800%2f16965-8.jpg&ehk=aNsoqrsfFSfggxwB7gln%2bDi4emNZpcyIhoa2LbBG428%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"}]</span>\n    </div>\n    <button class=\"gallery-load-more\"><span>加载更多</span><i class=\"fa-solid fa-arrow-down\"></i></button>\n    </div>\n\n"},{"title":"关于","type":"about","date":"2023-01-23T13:07:37.000Z","aside":false,"top_img":false,"background":"#f8f9fe","comments":0,"_content":"","source":"about/index.md","raw":"---\ntitle: 关于\ntype: about\ndate: 2023-01-23 21:07:37\naside: false\ntop_img: false\nbackground: \"#f8f9fe\"\ncomments: false\n---\n","updated":"2023-03-08T10:46:12.563Z","path":"about/index.html","_id":"cldjztiw40000a5w05c326dmv","layout":"page","content":"","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]},"creativity":[{"class_name":"开启创造力","creativity_list":[{"name":"Vue","color":"#b8f0ae","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633001374747b.png"},{"name":"React","color":"#222","icon":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K"},{"name":"Docker","color":"#57b6e6","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/63300647df7fa.png"},{"name":"Photoshop","color":"#4082c3","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/63300647e1f10.png"},{"name":"Node","color":"#333","icon":"https://npm.elemecdn.com/anzhiyu-blog@2.1.1/img/svg/node-logo.svg"},{"name":"Webpack","color":"#2e3a41","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/26/6330ff27e5c9b.png"},{"name":"Pinia","color":"#fff","icon":"https://npm.elemecdn.com/anzhiyu-blog@2.0.8/img/svg/pinia-logo.svg"},{"name":"Python","color":"#fff","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/63300647dea51.png"},{"name":"Vite","color":"#937df7","icon":"https://npm.elemecdn.com/anzhiyu-blog@2.0.8/img/svg/vite-logo.svg"},{"name":"Flutter","color":"#4499e4","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633004063ff15.png"},{"name":"Java","color":"#fff","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633005bf0fd1e.jpg"},{"name":"CSS3","color":"#2c51db","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006cc55e07.png"},{"name":"JS","color":"#f7cb4f","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006eee047b.png"},{"name":"HTML","color":"#e9572b","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006f9ab27d.png"},{"name":"Git","color":"#df5b40","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633006e37c7fd.webp"},{"name":"Apifox","color":"#e65164","icon":"https://img02.anzhiy.cn/adminuploads/1/2022/09/25/633007087a4dc.webp"}]}]}},"cover":false,"excerpt":"","more":""},{"title":"漫威","comments":0,"date":"2023-01-24T09:06:20.000Z","_content":"{% gallery %}\n![](https://img.zcool.cn/community/0153ac5cd542c3a801208f8bd7119c.jpg@1280w_1l_2o_100sh.jpg)\n![](https://img.zcool.cn/community/0130215bf57cb3a80121ab5db623c5.jpg@2o.jpg)\n![](https://img.zcool.cn/community/01c5655cd3ea46a801208f8b245d9b.jpg@1280w_1l_2o_100sh.jpg)\n![](https://img.zcool.cn/community/018c195a17ff3aa80120908dec9886.jpg@2o.jpg)\n![](https://img.zcool.cn/community/01029f5d19c4a2a8012155296607e9.jpg@1280w_1l_2o_100sh.jpg)\n![](https://pic4.zhimg.com/v2-d8163c3ed119814f8ff0845fc44eefb7_r.jpg?source=1940ef5c)\n![](https://pic2.zhimg.com/v2-9e9494fd72af94e2521c788dce26784f_r.jpg)\n![](https://pic2.zhimg.com/v2-cb592e5b1072397119b957975e5e7ba5_r.jpg?source=1940ef5c)\n![](https://pic1.zhimg.com/v2-25316451c3635f0b483da1c3d047d245_r.jpg?source=1940ef5c)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.447f26a2f486d8ebfa9a25c769841562?rik=WSy48a6O0cuHqA&riu=http%3a%2f%2fk2.jsqq.net%2fuploads%2fallimg%2f1709%2f17_170915092707_1.jpg&ehk=j7281PTfExKT5lloFYwIBCgezWEhk%2bTcgjb1gswF2qM%3d&risl=&pid=ImgRaw&r=0)\n{% endgallery %}","source":"photo/marvel/index.md","raw":"title: 漫威\n\ncomments: false\n\ndate: 2023-01-24 17:06:20\n---\n{% gallery %}\n![](https://img.zcool.cn/community/0153ac5cd542c3a801208f8bd7119c.jpg@1280w_1l_2o_100sh.jpg)\n![](https://img.zcool.cn/community/0130215bf57cb3a80121ab5db623c5.jpg@2o.jpg)\n![](https://img.zcool.cn/community/01c5655cd3ea46a801208f8b245d9b.jpg@1280w_1l_2o_100sh.jpg)\n![](https://img.zcool.cn/community/018c195a17ff3aa80120908dec9886.jpg@2o.jpg)\n![](https://img.zcool.cn/community/01029f5d19c4a2a8012155296607e9.jpg@1280w_1l_2o_100sh.jpg)\n![](https://pic4.zhimg.com/v2-d8163c3ed119814f8ff0845fc44eefb7_r.jpg?source=1940ef5c)\n![](https://pic2.zhimg.com/v2-9e9494fd72af94e2521c788dce26784f_r.jpg)\n![](https://pic2.zhimg.com/v2-cb592e5b1072397119b957975e5e7ba5_r.jpg?source=1940ef5c)\n![](https://pic1.zhimg.com/v2-25316451c3635f0b483da1c3d047d245_r.jpg?source=1940ef5c)\n![](https://ts1.cn.mm.bing.net/th/id/R-C.447f26a2f486d8ebfa9a25c769841562?rik=WSy48a6O0cuHqA&riu=http%3a%2f%2fk2.jsqq.net%2fuploads%2fallimg%2f1709%2f17_170915092707_1.jpg&ehk=j7281PTfExKT5lloFYwIBCgezWEhk%2bTcgjb1gswF2qM%3d&risl=&pid=ImgRaw&r=0)\n{% endgallery %}","updated":"2023-03-07T06:00:10.305Z","path":"photo/marvel/index.html","_id":"cldjztixe0005a5w0glfk1f13","layout":"page","content":"<div class=\"gallery\">\n    <div class=\"fj-gallery \" data-rowHeight=\"220\" data-limit=\"10\">\n    <span class=\"gallery-data\">[{\"url\":\"https://img.zcool.cn/community/0153ac5cd542c3a801208f8bd7119c.jpg@1280w_1l_2o_100sh.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/0130215bf57cb3a80121ab5db623c5.jpg@2o.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/01c5655cd3ea46a801208f8b245d9b.jpg@1280w_1l_2o_100sh.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/018c195a17ff3aa80120908dec9886.jpg@2o.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/01029f5d19c4a2a8012155296607e9.jpg@1280w_1l_2o_100sh.jpg\",\"alt\":\"\"},{\"url\":\"https://pic4.zhimg.com/v2-d8163c3ed119814f8ff0845fc44eefb7_r.jpg?source=1940ef5c\",\"alt\":\"\"},{\"url\":\"https://pic2.zhimg.com/v2-9e9494fd72af94e2521c788dce26784f_r.jpg\",\"alt\":\"\"},{\"url\":\"https://pic2.zhimg.com/v2-cb592e5b1072397119b957975e5e7ba5_r.jpg?source=1940ef5c\",\"alt\":\"\"},{\"url\":\"https://pic1.zhimg.com/v2-25316451c3635f0b483da1c3d047d245_r.jpg?source=1940ef5c\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.447f26a2f486d8ebfa9a25c769841562?rik=WSy48a6O0cuHqA&riu=http%3a%2f%2fk2.jsqq.net%2fuploads%2fallimg%2f1709%2f17_170915092707_1.jpg&ehk=j7281PTfExKT5lloFYwIBCgezWEhk%2bTcgjb1gswF2qM%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"}]</span>\n    </div>\n    <button class=\"gallery-load-more\"><span>加载更多</span><i class=\"fa-solid fa-arrow-down\"></i></button>\n    </div>","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":"<div class=\"gallery\">\n    <div class=\"fj-gallery \" data-rowHeight=\"220\" data-limit=\"10\">\n    <span class=\"gallery-data\">[{\"url\":\"https://img.zcool.cn/community/0153ac5cd542c3a801208f8bd7119c.jpg@1280w_1l_2o_100sh.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/0130215bf57cb3a80121ab5db623c5.jpg@2o.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/01c5655cd3ea46a801208f8b245d9b.jpg@1280w_1l_2o_100sh.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/018c195a17ff3aa80120908dec9886.jpg@2o.jpg\",\"alt\":\"\"},{\"url\":\"https://img.zcool.cn/community/01029f5d19c4a2a8012155296607e9.jpg@1280w_1l_2o_100sh.jpg\",\"alt\":\"\"},{\"url\":\"https://pic4.zhimg.com/v2-d8163c3ed119814f8ff0845fc44eefb7_r.jpg?source=1940ef5c\",\"alt\":\"\"},{\"url\":\"https://pic2.zhimg.com/v2-9e9494fd72af94e2521c788dce26784f_r.jpg\",\"alt\":\"\"},{\"url\":\"https://pic2.zhimg.com/v2-cb592e5b1072397119b957975e5e7ba5_r.jpg?source=1940ef5c\",\"alt\":\"\"},{\"url\":\"https://pic1.zhimg.com/v2-25316451c3635f0b483da1c3d047d245_r.jpg?source=1940ef5c\",\"alt\":\"\"},{\"url\":\"https://ts1.cn.mm.bing.net/th/id/R-C.447f26a2f486d8ebfa9a25c769841562?rik=WSy48a6O0cuHqA&riu=http%3a%2f%2fk2.jsqq.net%2fuploads%2fallimg%2f1709%2f17_170915092707_1.jpg&ehk=j7281PTfExKT5lloFYwIBCgezWEhk%2bTcgjb1gswF2qM%3d&risl=&pid=ImgRaw&r=0\",\"alt\":\"\"}]</span>\n    </div>\n    <button class=\"gallery-load-more\"><span>加载更多</span><i class=\"fa-solid fa-arrow-down\"></i></button>\n    </div>"},{"title":"move","comments":0,"date":"2023-03-07T05:58:19.000Z","_content":"","source":"move/index.md","raw":"---\ntitle: move\ncomments: false\ndate: 2023-03-07 13:58:19\n---\n","updated":"2023-03-07T05:58:58.558Z","path":"move/index.html","_id":"clexubbsk00000cuubzmo5mo4","layout":"page","content":"","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":""},{"title":"音乐馆","date":"2023-03-08T01:39:41.000Z","type":"music","aplayer":true,"top_img":false,"comments":0,"aside":false,"_content":"","source":"music/index.md","raw":"---\ntitle: 音乐馆\ndate: 2023-03-08 09:39:41\ntype: music\naplayer: true\ntop_img: false\ncomments: false\naside: false\n---\n","updated":"2023-03-08T01:40:18.600Z","path":"music/index.html","_id":"clez0iko60000iouu10lsfqlv","layout":"page","content":"","site":{"data":{"cinemas":{"wantWatch":[{"title":"街头狂飙 第一季","type":"纪录片","area":"美国","cover":"https://i0.hdslb.com/bfs/bangumi/8547d8c6482e979e625eed59cb8008449cba688c.png","totalCount":"全7集","id":133912,"follow":8053,"view":"47.2 万","danmaku":1510,"coin":610,"score":"-","des":"本节目将从司机视角带您进入非法街头赛车。第一季我们来到号称拥有“美国最快街头赛车”的俄克拉荷马州。参赛车辆涵盖从1969年产的雪佛兰诺瓦，到名不见经传却跃跃欲试的农用卡车等各色车辆，这些街头车手“可不..."}],"watching":[{"title":"扬名立万","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/59d1bd956f1f63dd6fe7da5782da1f158ed192bc.png","totalCount":"全1集","id":28235586,"follow":"89.5 万","view":"8036.7 万","danmaku":"24.4 万","coin":"31.2 万","score":9.6,"des":"月黑风高之夜，一群电影人被秘密召集到一起，欲将轰动一时的血案翻拍成电影，借此扬名立万。殊不知他们正身处案发现场，并步步陷入一个巨大迷局之中，而凶手就在他们中间……伴随着利欲熏天的创作风暴，案件背后的故..."}],"watched":[{"title":"三国演义","type":"电视剧","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/image/1d2eb8d863e3d0aa9d6557ae5b32764159953d8b.jpg","totalCount":"全84集","id":28229055,"follow":"156.2 万","view":"3.5 亿","danmaku":"672.3 万","coin":"103.0 万","score":9.9,"des":"东汉末年，山河动荡，刘汉王朝气数将尽。内有十常侍颠倒黑白，祸乱朝纲。外有张氏兄弟高呼“苍天已死，黄巾当立”的口号，掀起浩大的农民起义。一时间狼烟四起，刘家朝廷宛如大厦将倾，岌岌可危。\n正所谓乱世出英雄..."},{"title":"让子弹飞","type":"电影","area":"中国大陆","cover":"https://i0.hdslb.com/bfs/bangumi/371e9be67b2ae3938a8bafa2b80b466268f34b9d.jpg","totalCount":"全1集","id":80952,"follow":"184.7 万","view":"1.4 亿","danmaku":"104.1 万","coin":"110.5 万","score":9.9,"des":"民国年间，花钱捐得县长的马邦德（葛优 饰）走马上任，遭劫匪张麻子（姜文 饰）一伙伏击。马为保命，谎称自己是县长的汤师爷。为汤师爷许下的财富所动，张麻子摇身一变，化身县长，带着手下上任。鹅城地处偏僻，一..."}]}}},"cover":false,"excerpt":"","more":""}],"Post":[{"title":"Vue3新特性","type":"tags","description":"Vue3新特性","keywords":"框架 笔记","top_img":"https://pic4.zhimg.com/v2-76b555abeb6aeb3b2eac3974ed1c24a0_b.jpg","cover":"https://pic4.zhimg.com/v2-76b555abeb6aeb3b2eac3974ed1c24a0_b.jpg","date":"2023-01-24T16:00:00.000Z","updated":"2023-02-07T05:57:24.837Z","_content":"## 1.Vue3简介\n\n- 2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）\n- 耗时2年多、[2600+次提交](https://github.com/vuejs/vue-next/graphs/commit-activity)、[30+个RFC](https://github.com/vuejs/rfcs/tree/master/active-rfcs)、[600+次PR](https://github.com/vuejs/vue-next/pulls?q=is%3Apr+is%3Amerged+-author%3Aapp%2Fdependabot-preview+)、[99位贡献者](https://github.com/vuejs/vue-next/graphs/contributors)\n- github上的tags地址：https://github.com/vuejs/vue-next/releases/tag/v3.0.0\n\n## 2.Vue3带来了什么\n\n### 1.性能的提升\n\n- 打包大小减少41%\n\n- 初次渲染快55%, 更新渲染快133%\n\n- 内存减少54%\n\n  ......\n\n### 2.源码的升级\n\n- 使用Proxy代替defineProperty实现响应式\n\n- 重写虚拟DOM的实现和Tree-Shaking\n\n  ......\n\n### 3.拥抱TypeScript\n\n- Vue3可以更好的支持TypeScript\n\n### 4.新的特性\n\n1. Composition API（组合API）\n\n    - setup配置\n    - ref与reactive\n    - watch与watchEffect\n    - provide与inject\n    - ......\n2. 新的内置组件\n    - Fragment\n    - Teleport\n    - Suspense\n3. 其他改变\n\n    - 新的生命周期钩子\n    - data 选项应始终被声明为一个函数\n    - 移除keyCode支持作为 v-on 的修饰符\n    - ......\n\n# 一、创建Vue3.0工程\n\n## 1.使用 vue-cli 创建\n\n官方文档：https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create\n\n```bash\n## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上\nvue --version\n## 安装或者升级你的@vue/cli\nnpm install -g @vue/cli\n## 创建\nvue create vue_test\n## 启动\ncd vue_test\nnpm run serve\n```\n\n## 2.使用 vite 创建\n\n官方文档：https://v3.cn.vuejs.org/guide/installation.html#vite\n\nvite官网：https://vitejs.cn\n\n- 什么是vite？—— 新一代前端构建工具。\n- 优势如下：\n   - 开发环境中，无需打包操作，可快速的冷启动。\n   - 轻量快速的热重载（HMR）。\n   - 真正的按需编译，不再等待整个应用编译完成。\n- 传统构建 与 vite构建对比图\n\n<img src=\"https://cn.vitejs.dev/assets/bundler.37740380.png\" style=\"width:500px;height:280px;float:left\" /><img src=\"https://cn.vitejs.dev/assets/esm.3070012d.png\" style=\"width:480px;height:280px\" />\n\n```bash\n## 创建工程\nnpm init vite-app <project-name>\n## 进入工程目录\ncd <project-name>\n## 安装依赖\nnpm install\n## 运行\nnpm run dev\n```\n\n\n# 二、常用 Composition API\n\n官方文档: https://v3.cn.vuejs.org/guide/composition-api-introduction.html\n\n## 1.拉开序幕的setup\n\n1. 理解：Vue3.0中一个新的配置项，值为一个函数。\n2. setup是所有<strong style=\"color:#DD5145\">Composition API（组合API）</strong><i style=\"color:gray;font-weight:bold\">“ 表演的舞台 ”</i>。\n4. 组件中所用到的：数据、方法等等，均要配置在setup中。\n5. setup函数的两种返回值：\n    1. 若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）\n    2. <span style=\"color:#aad\">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span>\n6. 注意点：\n    1. 尽量不要与Vue2.x配置混用\n        - Vue2.x配置（data、methos、computed...）中<strong style=\"color:#DD5145\">可以访问到</strong>setup中的属性、方法。\n        - 但在setup中<strong style=\"color:#DD5145\">不能访问到</strong>Vue2.x配置（data、methos、computed...）。\n        - 如果有重名, setup优先。\n    2. setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）\n\n\n##  2.ref函数\n\n- 作用: 定义一个响应式的数据\n- 语法: ```const xxx = ref(initValue)```\n    - 创建一个包含响应式数据的<strong style=\"color:#DD5145\">引用对象（reference对象，简称ref对象）</strong>。\n    - JS中操作数据： ```xxx.value```\n    - 模板中读取数据: 不需要.value，直接：```<div>{{xxx}}</div>```\n- 备注：\n    - 接收的数据可以是：基本类型、也可以是对象类型。\n    - 基本类型的数据：响应式依然是靠``Object.defineProperty()``的```get```与```set```完成的。\n    - 对象类型的数据：内部 <i style=\"color:gray;font-weight:bold\">“ 求助 ”</i> 了Vue3.0中的一个新函数—— ```reactive```函数。\n\n\n\n## 3.reactive函数\n\n- 作用: 定义一个<strong style=\"color:#DD5145\">对象类型</strong>的响应式数据（基本类型不要用它，要用```ref```函数）\n- 语法：```const 代理对象= reactive(源对象)```接收一个对象（或数组），返回一个<strong style=\"color:#DD5145\">代理对象（Proxy的实例对象，简称proxy对象）</strong>\n- reactive定义的响应式数据是“深层次的”。\n- 内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。\n\n\n## 4.Vue3.0中的响应式原理\n\n### vue2.x的响应式\n\n- 实现原理：\n    - 对象类型：通过```Object.defineProperty()```对属性的读取、修改进行拦截（数据劫持）。\n\n    - 数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。\n\n      ```js\n      Object.defineProperty(data, 'count', {\n          get () {}, \n          set () {}\n      })\n      ```\n\n- 存在问题：\n    - 新增属性、删除属性, 界面不会更新。\n    - 直接通过下标修改数组, 界面不会自动更新。\n\n### Vue3.0的响应式\n\n- 实现原理:\n    - 通过Proxy（代理）:  拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。\n    - 通过Reflect（反射）:  对源对象的属性进行操作。\n    - MDN文档中描述的Proxy与Reflect：\n        - Proxy：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy\n\n        - Reflect：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect\n\n          ```js\n          new Proxy(data, {\n              // 拦截读取属性值\n              get (target, prop) {\n                  return Reflect.get(target, prop)\n              },\n              // 拦截设置属性值或添加新属性\n              set (target, prop, value) {\n                  return Reflect.set(target, prop, value)\n              },\n              // 拦截删除属性\n              deleteProperty (target, prop) {\n                  return Reflect.deleteProperty(target, prop)\n              }\n          })\n          \n          proxy.name = 'tom'   \n          ```\n\n## 5.reactive对比ref\n\n-  从定义数据角度对比：\n    -  ref用来定义：<strong style=\"color:#DD5145\">基本类型数据</strong>。\n    -  reactive用来定义：<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>。\n    -  备注：ref也可以用来定义<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>, 它内部会自动通过```reactive```转为<strong style=\"color:#DD5145\">代理对象</strong>。\n-  从原理角度对比：\n    -  ref通过``Object.defineProperty()``的```get```与```set```来实现响应式（数据劫持）。\n    -  reactive通过使用<strong style=\"color:#DD5145\">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style=\"color:#DD5145\">Reflect</strong>操作<strong style=\"color:orange\">源对象</strong>内部的数据。\n-  从使用角度对比：\n    -  ref定义的数据：操作数据<strong style=\"color:#DD5145\">需要</strong>```.value```，读取数据时模板中直接读取<strong style=\"color:#DD5145\">不需要</strong>```.value```。\n    -  reactive定义的数据：操作数据与读取数据：<strong style=\"color:#DD5145\">均不需要</strong>```.value```。\n\n## 6.setup的两个注意点\n\n- setup执行的时机\n    - 在beforeCreate之前执行一次，this是undefined。\n\n- setup的参数\n    - props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。\n    - context：上下文对象\n        - attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 ```this.$attrs```。\n        - slots: 收到的插槽内容, 相当于 ```this.$slots```。\n        - emit: 分发自定义事件的函数, 相当于 ```this.$emit```。\n\n\n## 7.计算属性与监视\n\n### 1.computed函数\n\n- 与Vue2.x中computed配置功能一致\n\n- 写法\n\n  ```js\n  import {computed} from 'vue'\n  \n  setup(){\n      ...\n  \t//计算属性——简写\n      let fullName = computed(()=>{\n          return person.firstName + '-' + person.lastName\n      })\n      //计算属性——完整\n      let fullName = computed({\n          get(){\n              return person.firstName + '-' + person.lastName\n          },\n          set(value){\n              const nameArr = value.split('-')\n              person.firstName = nameArr[0]\n              person.lastName = nameArr[1]\n          }\n      })\n  }\n  ```\n\n### 2.watch函数\n\n- 与Vue2.x中watch配置功能一致\n\n- 两个小“坑”：\n\n    - 监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。\n    - 监视reactive定义的响应式数据中某个属性时：deep配置有效。\n\n  ```js\n  //情况一：监视ref定义的响应式数据\n  watch(sum,(newValue,oldValue)=>{\n  \tconsole.log('sum变化了',newValue,oldValue)\n  },{immediate:true})\n  \n  //情况二：监视多个ref定义的响应式数据\n  watch([sum,msg],(newValue,oldValue)=>{\n  \tconsole.log('sum或msg变化了',newValue,oldValue)\n  }) \n  \n  /* 情况三：监视reactive定义的响应式数据\n  \t\t\t若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！\n  \t\t\t若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 \n  */\n  watch(person,(newValue,oldValue)=>{\n  \tconsole.log('person变化了',newValue,oldValue)\n  },{immediate:true,deep:false}) //此处的deep配置不再奏效\n  \n  //情况四：监视reactive定义的响应式数据中的某个属性\n  watch(()=>person.job,(newValue,oldValue)=>{\n  \tconsole.log('person的job变化了',newValue,oldValue)\n  },{immediate:true,deep:true}) \n  \n  //情况五：监视reactive定义的响应式数据中的某些属性\n  watch([()=>person.job,()=>person.name],(newValue,oldValue)=>{\n  \tconsole.log('person的job变化了',newValue,oldValue)\n  },{immediate:true,deep:true})\n  \n  //特殊情况\n  watch(()=>person.job,(newValue,oldValue)=>{\n      console.log('person的job变化了',newValue,oldValue)\n  },{deep:true}) //此处由于监视的是reactive素定义的对象中的某个属性，所以deep配置有效\n  ```\n\n### 3.watchEffect函数\n\n- watch的套路是：既要指明监视的属性，也要指明监视的回调。\n\n- watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。\n\n- watchEffect有点像computed：\n\n    - 但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。\n    - 而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。\n\n  ```js\n  //watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。\n  watchEffect(()=>{\n      const x1 = sum.value\n      const x2 = person.age\n      console.log('watchEffect配置的回调执行了')\n  })\n  ```\n## 8.生命周期\n\n<div style=\"border:1px solid black;width:380px;float:left;margin-right:20px;\"><strong>vue2.x的生命周期</strong><img src=\"https://cn.vuejs.org/images/lifecycle.png\" alt=\"lifecycle_2\" style=\"zoom:33%;width:1200px\" /></div><div style=\"border:1px solid black;width:510px;height:985px;float:left\"><strong>vue3.0的生命周期</strong><img src=\"https://v3.cn.vuejs.org/images/lifecycle.svg\" alt=\"lifecycle_2\" style=\"zoom:33%;width:2500px\" /></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1\n\n- Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：\n    - ```beforeDestroy```改名为 ```beforeUnmount```\n    - ```destroyed```改名为 ```unmounted```\n- Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：\n    - `beforeCreate`===>`setup()`\n    - `created`=======>`setup()`\n    - `beforeMount` ===>`onBeforeMount`\n    - `mounted`=======>`onMounted`\n    - `beforeUpdate`===>`onBeforeUpdate`\n    - `updated` =======>`onUpdated`\n    - `beforeUnmount` ==>`onBeforeUnmount`\n    - `unmounted` =====>`onUnmounted`\n\n\n## 9.自定义hook函数\n\n- 什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。\n\n- 类似于vue2.x中的mixin。\n\n- 自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。\n\n\n## 10.toRef\n\n- 作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。\n- 语法：```const name = toRef(person,'name')```\n- 应用:   要将响应式对象中的某个属性单独提供给外部使用时。\n\n\n- 扩展：```toRefs``` 与```toRef```功能一致，但可以批量创建多个 ref 对象，语法：```toRefs(person)```\n\n\n# 三、其它 Composition API\n\n## 1.shallowReactive 与 shallowRef\n\n- shallowReactive：只处理对象最外层属性的响应式（浅响应式）。\n- shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。\n\n- 什么时候使用?\n    -  如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===> shallowReactive。\n    -  如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 ===> shallowRef。\n\n\n## 2.readonly 与 shallowReadonly\n\n- readonly: 让一个响应式数据变为只读的（深只读）。\n- shallowReadonly：让一个响应式数据变为只读的（浅只读）。\n- 应用场景: 不希望数据(尤其是这个数据是来自与其他组件时)被修改时。\n\n\n## 3.toRaw 与 markRaw\n\n- toRaw：\n    - 作用：将一个由```reactive```生成的<strong style=\"color:orange\">响应式对象</strong>转为<strong style=\"color:orange\">普通对象</strong>。\n    - 使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。\n- markRaw：\n    - 作用：标记一个对象，使其永远不会再成为响应式对象。\n    - 应用场景:\n        1. 有些值不应被设置为响应式的，例如复杂的第三方类库等。\n        2. 当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。\n\n\n\n## 4.customRef\n\n- 作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。\n\n- 实现防抖效果：\n\n  ```vue\n  <template>\n  \t<input type=\"text\" v-model=\"keyword\">\n  \t<h3>{{keyword}}</h3>\n  </template>\n  \n  <script>\n  \timport {ref,customRef} from 'vue'\n  \texport default {\n  \t\tname:'Demo',\n  \t\tsetup(){\n  \t\t\t// let keyword = ref('hello') //使用Vue准备好的内置ref\n  \t\t\t//自定义一个myRef\n  \t\t\tfunction myRef(value,delay){\n  \t\t\t\tlet timer\n  \t\t\t\t//通过customRef去实现自定义\n  \t\t\t\treturn customRef((track,trigger)=>{\n  \t\t\t\t\treturn{\n  \t\t\t\t\t\tget(){\n  \t\t\t\t\t\t\ttrack() //告诉Vue这个value值是需要被“追踪”的\n  \t\t\t\t\t\t\treturn value\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tset(newValue){\n  \t\t\t\t\t\t\tclearTimeout(timer)\n  \t\t\t\t\t\t\ttimer = setTimeout(()=>{\n  \t\t\t\t\t\t\t\tvalue = newValue\n  \t\t\t\t\t\t\t\ttrigger() //告诉Vue去更新界面\n  \t\t\t\t\t\t\t},delay)\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t})\n  \t\t\t}\n  \t\t\tlet keyword = myRef('hello',500) //使用程序员自定义的ref\n  \t\t\treturn {\n  \t\t\t\tkeyword\n  \t\t\t}\n  \t\t}\n  \t}\n  </script>\n  ```\n\n## 5.provide 与 inject\n\n<img src=\"https://v3.cn.vuejs.org/images/components_provide.png\" style=\"width:300px\" />\n\n- 作用：实现<strong style=\"color:#DD5145\">祖与后代组件间</strong>通信\n\n- 套路：父组件有一个 `provide` 选项来提供数据，后代组件有一个 `inject` 选项来开始使用这些数据\n\n- 具体写法：\n\n    1. 祖组件中：\n\n       ```js\n       setup(){\n           ......\n           let car = reactive({name:'奔驰',price:'40万'})\n           provide('car',car)\n           ......\n       }\n       ```\n\n    2. 后代组件中：\n\n       ```js\n       setup(props,context){\n           ......\n           const car = inject('car')\n           return {car}\n           ......\n       }\n       ```\n## 6.响应式数据的判断\n\n- isRef: 检查一个值是否为一个 ref 对象\n- isReactive: 检查一个对象是否是由 `reactive` 创建的响应式代理\n- isReadonly: 检查一个对象是否是由 `readonly` 创建的只读代理\n- isProxy: 检查一个对象是否是由 `reactive` 或者 `readonly` 方法创建的代理  \n\n\n# 四、Composition API 的优势\n\n## 1.Options API 存在的问题\n\n使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。\n\n<div style=\"width:600px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image\" style=\"width:600px;float:left\" />\n</div>\n<div style=\"width:300px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image\" style=\"zoom:50%;width:560px;left\" /> \n</div>\n\n\n\n\n\n\n\n\n\n\n\n## 2.Composition API 的优势\n\n我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。\n\n<div style=\"width:500px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n<div style=\"width:430px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n\n\n\n\n# 五、新的组件\n\n## 1.Fragment\n\n- 在Vue2中: 组件必须有一个根标签\n- 在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中\n- 好处: 减少标签层级, 减小内存占用\n\n## 2.Teleport\n\n- 什么是Teleport？—— `Teleport` 是一种能够将我们的<strong style=\"color:#DD5145\">组件html结构</strong>移动到指定位置的技术。\n\n  ```vue\n  <teleport to=\"移动位置\">\n  \t<div v-if=\"isShow\" class=\"mask\">\n  \t\t<div class=\"dialog\">\n  \t\t\t<h3>我是一个弹窗</h3>\n  \t\t\t<button @click=\"isShow = false\">关闭弹窗</button>\n  \t\t</div>\n  \t</div>\n  </teleport>\n  ```\n\n## 3.Suspense\n- 等待异步组件时渲染一些额外内容，让应用有更好的用户体验\n\n- 使用步骤：\n\n    - 异步引入组件\n\n      ```js\n      import {defineAsyncComponent} from 'vue'\n      const Child = defineAsyncComponent(()=>import('./components/Child.vue'))\n      ```\n\n    - 使用```Suspense```包裹组件，并配置好```default``` 与 ```fallback```\n\n      ```vue\n      <template>\n          <div class=\"app\">\n              <h3>我是App组件</h3>\n              <Suspense>\n                  <template v-slot:default>\n                      <Child/>\n                  </template>\n                  <template v-slot:fallback>\n                      <h3>加载中.....</h3>\n                  </template>\n              </Suspense>\n          </div>\n      </template>\n      ```\n\n\n\n\n# 六、其他\n\n## 1.全局API的转移\n\n- Vue 2.x 有许多全局 API 和配置。\n\n    - 例如：注册全局组件、注册全局指令等。\n\n      ```js\n      //注册全局组件\n      Vue.component('MyButton', {\n        data: () => ({\n          count: 0\n        }),\n        template: '<button @click=\"count++\">Clicked {{ count }} times.</button>'\n      })\n      \n      //注册全局指令\n      Vue.directive('focus', {\n        inserted: el => el.focus()\n      }\n      ```\n\n- Vue3.0中对这些API做出了调整：\n\n    - 将全局的API，即：```Vue.xxx```调整到应用实例（```app```）上\n\n      | 2.x 全局 API（```Vue```） | 3.x 实例 API (`app`)                        |\n                | ------------------------- | ------------------------------------------- |\n      | Vue.config.xxxx           | app.config.xxxx                             |\n      | Vue.config.productionTip  | <strong style=\"color:#DD5145\">移除</strong> |\n      | Vue.component             | app.component                               |\n      | Vue.directive             | app.directive                               |\n      | Vue.mixin                 | app.mixin                                   |\n      | Vue.use                   | app.use                                     |\n      | Vue.prototype             | app.config.globalProperties                 |\n\n## 2.其他改变\n\n- data选项应始终被声明为一个函数。\n\n- 过度类名的更改：\n\n    - Vue2.x写法\n\n      ```css\n      .v-enter,\n      .v-leave-to {\n        opacity: 0;\n      }\n      .v-leave,\n      .v-enter-to {\n        opacity: 1;\n      }\n      ```\n\n    - Vue3.x写法\n\n      ```css\n      .v-enter-from,\n      .v-leave-to {\n        opacity: 0;\n      }\n      \n      .v-leave-from,\n      .v-enter-to {\n        opacity: 1;\n      }\n      ```\n\n- <strong style=\"color:#DD5145\">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持```config.keyCodes```\n\n- <strong style=\"color:#DD5145\">移除</strong>```v-on.native```修饰符\n\n    - 父组件中绑定事件\n\n      ```vue\n      <my-component\n        v-on:close=\"handleComponentEvent\"\n        v-on:click=\"handleNativeClickEvent\"\n      />\n      ```\n\n    - 子组件中声明自定义事件\n\n      ```vue\n      <script>\n        export default {\n          emits: ['close']\n        }\n      </script>\n      ```\n\n- <strong style=\"color:#DD5145\">移除</strong>过滤器（filter）\n\n  > 过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。\n\n- ......\n\n\n\n\n","source":"_posts/vue3.md","raw":"title: Vue3新特性\ntype: tags\ndescription: Vue3新特性\nkeywords: 框架 笔记\ntop_img: 'https://pic4.zhimg.com/v2-76b555abeb6aeb3b2eac3974ed1c24a0_b.jpg'\ntags:\n  - Vue3\ncategories:\n  - web前端\ncover: 'https://pic4.zhimg.com/v2-76b555abeb6aeb3b2eac3974ed1c24a0_b.jpg'\ndate: 2023-01-25 00:00:00\nupdated:\n---\n## 1.Vue3简介\n\n- 2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）\n- 耗时2年多、[2600+次提交](https://github.com/vuejs/vue-next/graphs/commit-activity)、[30+个RFC](https://github.com/vuejs/rfcs/tree/master/active-rfcs)、[600+次PR](https://github.com/vuejs/vue-next/pulls?q=is%3Apr+is%3Amerged+-author%3Aapp%2Fdependabot-preview+)、[99位贡献者](https://github.com/vuejs/vue-next/graphs/contributors)\n- github上的tags地址：https://github.com/vuejs/vue-next/releases/tag/v3.0.0\n\n## 2.Vue3带来了什么\n\n### 1.性能的提升\n\n- 打包大小减少41%\n\n- 初次渲染快55%, 更新渲染快133%\n\n- 内存减少54%\n\n  ......\n\n### 2.源码的升级\n\n- 使用Proxy代替defineProperty实现响应式\n\n- 重写虚拟DOM的实现和Tree-Shaking\n\n  ......\n\n### 3.拥抱TypeScript\n\n- Vue3可以更好的支持TypeScript\n\n### 4.新的特性\n\n1. Composition API（组合API）\n\n    - setup配置\n    - ref与reactive\n    - watch与watchEffect\n    - provide与inject\n    - ......\n2. 新的内置组件\n    - Fragment\n    - Teleport\n    - Suspense\n3. 其他改变\n\n    - 新的生命周期钩子\n    - data 选项应始终被声明为一个函数\n    - 移除keyCode支持作为 v-on 的修饰符\n    - ......\n\n# 一、创建Vue3.0工程\n\n## 1.使用 vue-cli 创建\n\n官方文档：https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create\n\n```bash\n## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上\nvue --version\n## 安装或者升级你的@vue/cli\nnpm install -g @vue/cli\n## 创建\nvue create vue_test\n## 启动\ncd vue_test\nnpm run serve\n```\n\n## 2.使用 vite 创建\n\n官方文档：https://v3.cn.vuejs.org/guide/installation.html#vite\n\nvite官网：https://vitejs.cn\n\n- 什么是vite？—— 新一代前端构建工具。\n- 优势如下：\n   - 开发环境中，无需打包操作，可快速的冷启动。\n   - 轻量快速的热重载（HMR）。\n   - 真正的按需编译，不再等待整个应用编译完成。\n- 传统构建 与 vite构建对比图\n\n<img src=\"https://cn.vitejs.dev/assets/bundler.37740380.png\" style=\"width:500px;height:280px;float:left\" /><img src=\"https://cn.vitejs.dev/assets/esm.3070012d.png\" style=\"width:480px;height:280px\" />\n\n```bash\n## 创建工程\nnpm init vite-app <project-name>\n## 进入工程目录\ncd <project-name>\n## 安装依赖\nnpm install\n## 运行\nnpm run dev\n```\n\n\n# 二、常用 Composition API\n\n官方文档: https://v3.cn.vuejs.org/guide/composition-api-introduction.html\n\n## 1.拉开序幕的setup\n\n1. 理解：Vue3.0中一个新的配置项，值为一个函数。\n2. setup是所有<strong style=\"color:#DD5145\">Composition API（组合API）</strong><i style=\"color:gray;font-weight:bold\">“ 表演的舞台 ”</i>。\n4. 组件中所用到的：数据、方法等等，均要配置在setup中。\n5. setup函数的两种返回值：\n    1. 若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）\n    2. <span style=\"color:#aad\">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span>\n6. 注意点：\n    1. 尽量不要与Vue2.x配置混用\n        - Vue2.x配置（data、methos、computed...）中<strong style=\"color:#DD5145\">可以访问到</strong>setup中的属性、方法。\n        - 但在setup中<strong style=\"color:#DD5145\">不能访问到</strong>Vue2.x配置（data、methos、computed...）。\n        - 如果有重名, setup优先。\n    2. setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）\n\n\n##  2.ref函数\n\n- 作用: 定义一个响应式的数据\n- 语法: ```const xxx = ref(initValue)```\n    - 创建一个包含响应式数据的<strong style=\"color:#DD5145\">引用对象（reference对象，简称ref对象）</strong>。\n    - JS中操作数据： ```xxx.value```\n    - 模板中读取数据: 不需要.value，直接：```<div>{{xxx}}</div>```\n- 备注：\n    - 接收的数据可以是：基本类型、也可以是对象类型。\n    - 基本类型的数据：响应式依然是靠``Object.defineProperty()``的```get```与```set```完成的。\n    - 对象类型的数据：内部 <i style=\"color:gray;font-weight:bold\">“ 求助 ”</i> 了Vue3.0中的一个新函数—— ```reactive```函数。\n\n\n\n## 3.reactive函数\n\n- 作用: 定义一个<strong style=\"color:#DD5145\">对象类型</strong>的响应式数据（基本类型不要用它，要用```ref```函数）\n- 语法：```const 代理对象= reactive(源对象)```接收一个对象（或数组），返回一个<strong style=\"color:#DD5145\">代理对象（Proxy的实例对象，简称proxy对象）</strong>\n- reactive定义的响应式数据是“深层次的”。\n- 内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。\n\n\n## 4.Vue3.0中的响应式原理\n\n### vue2.x的响应式\n\n- 实现原理：\n    - 对象类型：通过```Object.defineProperty()```对属性的读取、修改进行拦截（数据劫持）。\n\n    - 数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。\n\n      ```js\n      Object.defineProperty(data, 'count', {\n          get () {}, \n          set () {}\n      })\n      ```\n\n- 存在问题：\n    - 新增属性、删除属性, 界面不会更新。\n    - 直接通过下标修改数组, 界面不会自动更新。\n\n### Vue3.0的响应式\n\n- 实现原理:\n    - 通过Proxy（代理）:  拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。\n    - 通过Reflect（反射）:  对源对象的属性进行操作。\n    - MDN文档中描述的Proxy与Reflect：\n        - Proxy：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy\n\n        - Reflect：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect\n\n          ```js\n          new Proxy(data, {\n              // 拦截读取属性值\n              get (target, prop) {\n                  return Reflect.get(target, prop)\n              },\n              // 拦截设置属性值或添加新属性\n              set (target, prop, value) {\n                  return Reflect.set(target, prop, value)\n              },\n              // 拦截删除属性\n              deleteProperty (target, prop) {\n                  return Reflect.deleteProperty(target, prop)\n              }\n          })\n          \n          proxy.name = 'tom'   \n          ```\n\n## 5.reactive对比ref\n\n-  从定义数据角度对比：\n    -  ref用来定义：<strong style=\"color:#DD5145\">基本类型数据</strong>。\n    -  reactive用来定义：<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>。\n    -  备注：ref也可以用来定义<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>, 它内部会自动通过```reactive```转为<strong style=\"color:#DD5145\">代理对象</strong>。\n-  从原理角度对比：\n    -  ref通过``Object.defineProperty()``的```get```与```set```来实现响应式（数据劫持）。\n    -  reactive通过使用<strong style=\"color:#DD5145\">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style=\"color:#DD5145\">Reflect</strong>操作<strong style=\"color:orange\">源对象</strong>内部的数据。\n-  从使用角度对比：\n    -  ref定义的数据：操作数据<strong style=\"color:#DD5145\">需要</strong>```.value```，读取数据时模板中直接读取<strong style=\"color:#DD5145\">不需要</strong>```.value```。\n    -  reactive定义的数据：操作数据与读取数据：<strong style=\"color:#DD5145\">均不需要</strong>```.value```。\n\n## 6.setup的两个注意点\n\n- setup执行的时机\n    - 在beforeCreate之前执行一次，this是undefined。\n\n- setup的参数\n    - props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。\n    - context：上下文对象\n        - attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 ```this.$attrs```。\n        - slots: 收到的插槽内容, 相当于 ```this.$slots```。\n        - emit: 分发自定义事件的函数, 相当于 ```this.$emit```。\n\n\n## 7.计算属性与监视\n\n### 1.computed函数\n\n- 与Vue2.x中computed配置功能一致\n\n- 写法\n\n  ```js\n  import {computed} from 'vue'\n  \n  setup(){\n      ...\n  \t//计算属性——简写\n      let fullName = computed(()=>{\n          return person.firstName + '-' + person.lastName\n      })\n      //计算属性——完整\n      let fullName = computed({\n          get(){\n              return person.firstName + '-' + person.lastName\n          },\n          set(value){\n              const nameArr = value.split('-')\n              person.firstName = nameArr[0]\n              person.lastName = nameArr[1]\n          }\n      })\n  }\n  ```\n\n### 2.watch函数\n\n- 与Vue2.x中watch配置功能一致\n\n- 两个小“坑”：\n\n    - 监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。\n    - 监视reactive定义的响应式数据中某个属性时：deep配置有效。\n\n  ```js\n  //情况一：监视ref定义的响应式数据\n  watch(sum,(newValue,oldValue)=>{\n  \tconsole.log('sum变化了',newValue,oldValue)\n  },{immediate:true})\n  \n  //情况二：监视多个ref定义的响应式数据\n  watch([sum,msg],(newValue,oldValue)=>{\n  \tconsole.log('sum或msg变化了',newValue,oldValue)\n  }) \n  \n  /* 情况三：监视reactive定义的响应式数据\n  \t\t\t若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！\n  \t\t\t若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 \n  */\n  watch(person,(newValue,oldValue)=>{\n  \tconsole.log('person变化了',newValue,oldValue)\n  },{immediate:true,deep:false}) //此处的deep配置不再奏效\n  \n  //情况四：监视reactive定义的响应式数据中的某个属性\n  watch(()=>person.job,(newValue,oldValue)=>{\n  \tconsole.log('person的job变化了',newValue,oldValue)\n  },{immediate:true,deep:true}) \n  \n  //情况五：监视reactive定义的响应式数据中的某些属性\n  watch([()=>person.job,()=>person.name],(newValue,oldValue)=>{\n  \tconsole.log('person的job变化了',newValue,oldValue)\n  },{immediate:true,deep:true})\n  \n  //特殊情况\n  watch(()=>person.job,(newValue,oldValue)=>{\n      console.log('person的job变化了',newValue,oldValue)\n  },{deep:true}) //此处由于监视的是reactive素定义的对象中的某个属性，所以deep配置有效\n  ```\n\n### 3.watchEffect函数\n\n- watch的套路是：既要指明监视的属性，也要指明监视的回调。\n\n- watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。\n\n- watchEffect有点像computed：\n\n    - 但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。\n    - 而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。\n\n  ```js\n  //watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。\n  watchEffect(()=>{\n      const x1 = sum.value\n      const x2 = person.age\n      console.log('watchEffect配置的回调执行了')\n  })\n  ```\n## 8.生命周期\n\n<div style=\"border:1px solid black;width:380px;float:left;margin-right:20px;\"><strong>vue2.x的生命周期</strong><img src=\"https://cn.vuejs.org/images/lifecycle.png\" alt=\"lifecycle_2\" style=\"zoom:33%;width:1200px\" /></div><div style=\"border:1px solid black;width:510px;height:985px;float:left\"><strong>vue3.0的生命周期</strong><img src=\"https://v3.cn.vuejs.org/images/lifecycle.svg\" alt=\"lifecycle_2\" style=\"zoom:33%;width:2500px\" /></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1\n\n- Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：\n    - ```beforeDestroy```改名为 ```beforeUnmount```\n    - ```destroyed```改名为 ```unmounted```\n- Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：\n    - `beforeCreate`===>`setup()`\n    - `created`=======>`setup()`\n    - `beforeMount` ===>`onBeforeMount`\n    - `mounted`=======>`onMounted`\n    - `beforeUpdate`===>`onBeforeUpdate`\n    - `updated` =======>`onUpdated`\n    - `beforeUnmount` ==>`onBeforeUnmount`\n    - `unmounted` =====>`onUnmounted`\n\n\n## 9.自定义hook函数\n\n- 什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。\n\n- 类似于vue2.x中的mixin。\n\n- 自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。\n\n\n## 10.toRef\n\n- 作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。\n- 语法：```const name = toRef(person,'name')```\n- 应用:   要将响应式对象中的某个属性单独提供给外部使用时。\n\n\n- 扩展：```toRefs``` 与```toRef```功能一致，但可以批量创建多个 ref 对象，语法：```toRefs(person)```\n\n\n# 三、其它 Composition API\n\n## 1.shallowReactive 与 shallowRef\n\n- shallowReactive：只处理对象最外层属性的响应式（浅响应式）。\n- shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。\n\n- 什么时候使用?\n    -  如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===> shallowReactive。\n    -  如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 ===> shallowRef。\n\n\n## 2.readonly 与 shallowReadonly\n\n- readonly: 让一个响应式数据变为只读的（深只读）。\n- shallowReadonly：让一个响应式数据变为只读的（浅只读）。\n- 应用场景: 不希望数据(尤其是这个数据是来自与其他组件时)被修改时。\n\n\n## 3.toRaw 与 markRaw\n\n- toRaw：\n    - 作用：将一个由```reactive```生成的<strong style=\"color:orange\">响应式对象</strong>转为<strong style=\"color:orange\">普通对象</strong>。\n    - 使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。\n- markRaw：\n    - 作用：标记一个对象，使其永远不会再成为响应式对象。\n    - 应用场景:\n        1. 有些值不应被设置为响应式的，例如复杂的第三方类库等。\n        2. 当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。\n\n\n\n## 4.customRef\n\n- 作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。\n\n- 实现防抖效果：\n\n  ```vue\n  <template>\n  \t<input type=\"text\" v-model=\"keyword\">\n  \t<h3>{{keyword}}</h3>\n  </template>\n  \n  <script>\n  \timport {ref,customRef} from 'vue'\n  \texport default {\n  \t\tname:'Demo',\n  \t\tsetup(){\n  \t\t\t// let keyword = ref('hello') //使用Vue准备好的内置ref\n  \t\t\t//自定义一个myRef\n  \t\t\tfunction myRef(value,delay){\n  \t\t\t\tlet timer\n  \t\t\t\t//通过customRef去实现自定义\n  \t\t\t\treturn customRef((track,trigger)=>{\n  \t\t\t\t\treturn{\n  \t\t\t\t\t\tget(){\n  \t\t\t\t\t\t\ttrack() //告诉Vue这个value值是需要被“追踪”的\n  \t\t\t\t\t\t\treturn value\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tset(newValue){\n  \t\t\t\t\t\t\tclearTimeout(timer)\n  \t\t\t\t\t\t\ttimer = setTimeout(()=>{\n  \t\t\t\t\t\t\t\tvalue = newValue\n  \t\t\t\t\t\t\t\ttrigger() //告诉Vue去更新界面\n  \t\t\t\t\t\t\t},delay)\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t})\n  \t\t\t}\n  \t\t\tlet keyword = myRef('hello',500) //使用程序员自定义的ref\n  \t\t\treturn {\n  \t\t\t\tkeyword\n  \t\t\t}\n  \t\t}\n  \t}\n  </script>\n  ```\n\n## 5.provide 与 inject\n\n<img src=\"https://v3.cn.vuejs.org/images/components_provide.png\" style=\"width:300px\" />\n\n- 作用：实现<strong style=\"color:#DD5145\">祖与后代组件间</strong>通信\n\n- 套路：父组件有一个 `provide` 选项来提供数据，后代组件有一个 `inject` 选项来开始使用这些数据\n\n- 具体写法：\n\n    1. 祖组件中：\n\n       ```js\n       setup(){\n           ......\n           let car = reactive({name:'奔驰',price:'40万'})\n           provide('car',car)\n           ......\n       }\n       ```\n\n    2. 后代组件中：\n\n       ```js\n       setup(props,context){\n           ......\n           const car = inject('car')\n           return {car}\n           ......\n       }\n       ```\n## 6.响应式数据的判断\n\n- isRef: 检查一个值是否为一个 ref 对象\n- isReactive: 检查一个对象是否是由 `reactive` 创建的响应式代理\n- isReadonly: 检查一个对象是否是由 `readonly` 创建的只读代理\n- isProxy: 检查一个对象是否是由 `reactive` 或者 `readonly` 方法创建的代理  \n\n\n# 四、Composition API 的优势\n\n## 1.Options API 存在的问题\n\n使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。\n\n<div style=\"width:600px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image\" style=\"width:600px;float:left\" />\n</div>\n<div style=\"width:300px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image\" style=\"zoom:50%;width:560px;left\" /> \n</div>\n\n\n\n\n\n\n\n\n\n\n\n## 2.Composition API 的优势\n\n我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。\n\n<div style=\"width:500px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n<div style=\"width:430px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n\n\n\n\n# 五、新的组件\n\n## 1.Fragment\n\n- 在Vue2中: 组件必须有一个根标签\n- 在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中\n- 好处: 减少标签层级, 减小内存占用\n\n## 2.Teleport\n\n- 什么是Teleport？—— `Teleport` 是一种能够将我们的<strong style=\"color:#DD5145\">组件html结构</strong>移动到指定位置的技术。\n\n  ```vue\n  <teleport to=\"移动位置\">\n  \t<div v-if=\"isShow\" class=\"mask\">\n  \t\t<div class=\"dialog\">\n  \t\t\t<h3>我是一个弹窗</h3>\n  \t\t\t<button @click=\"isShow = false\">关闭弹窗</button>\n  \t\t</div>\n  \t</div>\n  </teleport>\n  ```\n\n## 3.Suspense\n- 等待异步组件时渲染一些额外内容，让应用有更好的用户体验\n\n- 使用步骤：\n\n    - 异步引入组件\n\n      ```js\n      import {defineAsyncComponent} from 'vue'\n      const Child = defineAsyncComponent(()=>import('./components/Child.vue'))\n      ```\n\n    - 使用```Suspense```包裹组件，并配置好```default``` 与 ```fallback```\n\n      ```vue\n      <template>\n          <div class=\"app\">\n              <h3>我是App组件</h3>\n              <Suspense>\n                  <template v-slot:default>\n                      <Child/>\n                  </template>\n                  <template v-slot:fallback>\n                      <h3>加载中.....</h3>\n                  </template>\n              </Suspense>\n          </div>\n      </template>\n      ```\n\n\n\n\n# 六、其他\n\n## 1.全局API的转移\n\n- Vue 2.x 有许多全局 API 和配置。\n\n    - 例如：注册全局组件、注册全局指令等。\n\n      ```js\n      //注册全局组件\n      Vue.component('MyButton', {\n        data: () => ({\n          count: 0\n        }),\n        template: '<button @click=\"count++\">Clicked {{ count }} times.</button>'\n      })\n      \n      //注册全局指令\n      Vue.directive('focus', {\n        inserted: el => el.focus()\n      }\n      ```\n\n- Vue3.0中对这些API做出了调整：\n\n    - 将全局的API，即：```Vue.xxx```调整到应用实例（```app```）上\n\n      | 2.x 全局 API（```Vue```） | 3.x 实例 API (`app`)                        |\n                | ------------------------- | ------------------------------------------- |\n      | Vue.config.xxxx           | app.config.xxxx                             |\n      | Vue.config.productionTip  | <strong style=\"color:#DD5145\">移除</strong> |\n      | Vue.component             | app.component                               |\n      | Vue.directive             | app.directive                               |\n      | Vue.mixin                 | app.mixin                                   |\n      | Vue.use                   | app.use                                     |\n      | Vue.prototype             | app.config.globalProperties                 |\n\n## 2.其他改变\n\n- data选项应始终被声明为一个函数。\n\n- 过度类名的更改：\n\n    - Vue2.x写法\n\n      ```css\n      .v-enter,\n      .v-leave-to {\n        opacity: 0;\n      }\n      .v-leave,\n      .v-enter-to {\n        opacity: 1;\n      }\n      ```\n\n    - Vue3.x写法\n\n      ```css\n      .v-enter-from,\n      .v-leave-to {\n        opacity: 0;\n      }\n      \n      .v-leave-from,\n      .v-enter-to {\n        opacity: 1;\n      }\n      ```\n\n- <strong style=\"color:#DD5145\">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持```config.keyCodes```\n\n- <strong style=\"color:#DD5145\">移除</strong>```v-on.native```修饰符\n\n    - 父组件中绑定事件\n\n      ```vue\n      <my-component\n        v-on:close=\"handleComponentEvent\"\n        v-on:click=\"handleNativeClickEvent\"\n      />\n      ```\n\n    - 子组件中声明自定义事件\n\n      ```vue\n      <script>\n        export default {\n          emits: ['close']\n        }\n      </script>\n      ```\n\n- <strong style=\"color:#DD5145\">移除</strong>过滤器（filter）\n\n  > 过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。\n\n- ......\n\n\n\n\n","slug":"vue3","published":1,"_id":"cldgzp0l400017kuuawu7e7hw","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"1-Vue3简介\"><a href=\"#1-Vue3简介\" class=\"headerlink\" title=\"1.Vue3简介\"></a>1.Vue3简介</h2><ul>\n<li>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</li>\n<li>耗时2年多、<a href=\"https://github.com/vuejs/vue-next/graphs/commit-activity\">2600+次提交</a>、<a href=\"https://github.com/vuejs/rfcs/tree/master/active-rfcs\">30+个RFC</a>、<a href=\"https://github.com/vuejs/vue-next/pulls?q=is:pr+is:merged+-author:app/dependabot-preview+\">600+次PR</a>、<a href=\"https://github.com/vuejs/vue-next/graphs/contributors\">99位贡献者</a></li>\n<li>github上的tags地址：<a href=\"https://github.com/vuejs/vue-next/releases/tag/v3.0.0\">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a></li>\n</ul>\n<h2 id=\"2-Vue3带来了什么\"><a href=\"#2-Vue3带来了什么\" class=\"headerlink\" title=\"2.Vue3带来了什么\"></a>2.Vue3带来了什么</h2><h3 id=\"1-性能的提升\"><a href=\"#1-性能的提升\" class=\"headerlink\" title=\"1.性能的提升\"></a>1.性能的提升</h3><ul>\n<li><p>打包大小减少41%</p>\n</li>\n<li><p>初次渲染快55%, 更新渲染快133%</p>\n</li>\n<li><p>内存减少54%</p>\n<p>……</p>\n</li>\n</ul>\n<h3 id=\"2-源码的升级\"><a href=\"#2-源码的升级\" class=\"headerlink\" title=\"2.源码的升级\"></a>2.源码的升级</h3><ul>\n<li><p>使用Proxy代替defineProperty实现响应式</p>\n</li>\n<li><p>重写虚拟DOM的实现和Tree-Shaking</p>\n<p>……</p>\n</li>\n</ul>\n<h3 id=\"3-拥抱TypeScript\"><a href=\"#3-拥抱TypeScript\" class=\"headerlink\" title=\"3.拥抱TypeScript\"></a>3.拥抱TypeScript</h3><ul>\n<li>Vue3可以更好的支持TypeScript</li>\n</ul>\n<h3 id=\"4-新的特性\"><a href=\"#4-新的特性\" class=\"headerlink\" title=\"4.新的特性\"></a>4.新的特性</h3><ol>\n<li><p>Composition API（组合API）</p>\n<ul>\n<li>setup配置</li>\n<li>ref与reactive</li>\n<li>watch与watchEffect</li>\n<li>provide与inject</li>\n<li>……</li>\n</ul>\n</li>\n<li><p>新的内置组件</p>\n<ul>\n<li>Fragment</li>\n<li>Teleport</li>\n<li>Suspense</li>\n</ul>\n</li>\n<li><p>其他改变</p>\n<ul>\n<li>新的生命周期钩子</li>\n<li>data 选项应始终被声明为一个函数</li>\n<li>移除keyCode支持作为 v-on 的修饰符</li>\n<li>……</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"一、创建Vue3-0工程\"><a href=\"#一、创建Vue3-0工程\" class=\"headerlink\" title=\"一、创建Vue3.0工程\"></a>一、创建Vue3.0工程</h1><h2 id=\"1-使用-vue-cli-创建\"><a href=\"#1-使用-vue-cli-创建\" class=\"headerlink\" title=\"1.使用 vue-cli 创建\"></a>1.使用 vue-cli 创建</h2><p>官方文档：<a href=\"https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create\">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span></span><br><span class=\"line\">vue --version</span><br><span class=\"line\"><span class=\"comment\">## 安装或者升级你的@vue/cli</span></span><br><span class=\"line\">npm install -g @vue/cli</span><br><span class=\"line\"><span class=\"comment\">## 创建</span></span><br><span class=\"line\">vue create vue_test</span><br><span class=\"line\"><span class=\"comment\">## 启动</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> vue_test</span><br><span class=\"line\">npm run serve</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-使用-vite-创建\"><a href=\"#2-使用-vite-创建\" class=\"headerlink\" title=\"2.使用 vite 创建\"></a>2.使用 vite 创建</h2><p>官方文档：<a href=\"https://v3.cn.vuejs.org/guide/installation.html#vite\">https://v3.cn.vuejs.org/guide/installation.html#vite</a></p>\n<p>vite官网：<a href=\"https://vitejs.cn/\">https://vitejs.cn</a></p>\n<ul>\n<li>什么是vite？—— 新一代前端构建工具。</li>\n<li>优势如下：<ul>\n<li>开发环境中，无需打包操作，可快速的冷启动。</li>\n<li>轻量快速的热重载（HMR）。</li>\n<li>真正的按需编译，不再等待整个应用编译完成。</li>\n</ul>\n</li>\n<li>传统构建 与 vite构建对比图</li>\n</ul>\n<p><img src=\"https://cn.vitejs.dev/assets/bundler.37740380.png\" style=\"width:500px;height:280px;float:left\" /><img src=\"https://cn.vitejs.dev/assets/esm.3070012d.png\" style=\"width:480px;height:280px\" /></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 创建工程</span></span><br><span class=\"line\">npm init vite-app &lt;project-name&gt;</span><br><span class=\"line\"><span class=\"comment\">## 进入工程目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> &lt;project-name&gt;</span><br><span class=\"line\"><span class=\"comment\">## 安装依赖</span></span><br><span class=\"line\">npm install</span><br><span class=\"line\"><span class=\"comment\">## 运行</span></span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"二、常用-Composition-API\"><a href=\"#二、常用-Composition-API\" class=\"headerlink\" title=\"二、常用 Composition API\"></a>二、常用 Composition API</h1><p>官方文档: <a href=\"https://v3.cn.vuejs.org/guide/composition-api-introduction.html\">https://v3.cn.vuejs.org/guide/composition-api-introduction.html</a></p>\n<h2 id=\"1-拉开序幕的setup\"><a href=\"#1-拉开序幕的setup\" class=\"headerlink\" title=\"1.拉开序幕的setup\"></a>1.拉开序幕的setup</h2><ol>\n<li>理解：Vue3.0中一个新的配置项，值为一个函数。</li>\n<li>setup是所有<strong style=\"color:#DD5145\">Composition API（组合API）</strong><i style=\"color:gray;font-weight:bold\">“ 表演的舞台 ”</i>。</li>\n<li>组件中所用到的：数据、方法等等，均要配置在setup中。</li>\n<li>setup函数的两种返回值：<ol>\n<li>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</li>\n<li><span style=\"color:#aad\">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span></li>\n</ol>\n</li>\n<li>注意点：<ol>\n<li>尽量不要与Vue2.x配置混用<ul>\n<li>Vue2.x配置（data、methos、computed…）中<strong style=\"color:#DD5145\">可以访问到</strong>setup中的属性、方法。</li>\n<li>但在setup中<strong style=\"color:#DD5145\">不能访问到</strong>Vue2.x配置（data、methos、computed…）。</li>\n<li>如果有重名, setup优先。</li>\n</ul>\n</li>\n<li>setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"2-ref函数\"><a href=\"#2-ref函数\" class=\"headerlink\" title=\"2.ref函数\"></a>2.ref函数</h2><ul>\n<li>作用: 定义一个响应式的数据</li>\n<li>语法: <code>const xxx = ref(initValue)</code><ul>\n<li>创建一个包含响应式数据的<strong style=\"color:#DD5145\">引用对象（reference对象，简称ref对象）</strong>。</li>\n<li>JS中操作数据： <code>xxx.value</code></li>\n<li>模板中读取数据: 不需要.value，直接：<code>&lt;div&gt;&#123;&#123;xxx&#125;&#125;&lt;/div&gt;</code></li>\n</ul>\n</li>\n<li>备注：<ul>\n<li>接收的数据可以是：基本类型、也可以是对象类型。</li>\n<li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>完成的。</li>\n<li>对象类型的数据：内部 <i style=\"color:gray;font-weight:bold\">“ 求助 ”</i> 了Vue3.0中的一个新函数—— <code>reactive</code>函数。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-reactive函数\"><a href=\"#3-reactive函数\" class=\"headerlink\" title=\"3.reactive函数\"></a>3.reactive函数</h2><ul>\n<li>作用: 定义一个<strong style=\"color:#DD5145\">对象类型</strong>的响应式数据（基本类型不要用它，要用<code>ref</code>函数）</li>\n<li>语法：<code>const 代理对象= reactive(源对象)</code>接收一个对象（或数组），返回一个<strong style=\"color:#DD5145\">代理对象（Proxy的实例对象，简称proxy对象）</strong></li>\n<li>reactive定义的响应式数据是“深层次的”。</li>\n<li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。</li>\n</ul>\n<h2 id=\"4-Vue3-0中的响应式原理\"><a href=\"#4-Vue3-0中的响应式原理\" class=\"headerlink\" title=\"4.Vue3.0中的响应式原理\"></a>4.Vue3.0中的响应式原理</h2><h3 id=\"vue2-x的响应式\"><a href=\"#vue2-x的响应式\" class=\"headerlink\" title=\"vue2.x的响应式\"></a>vue2.x的响应式</h3><ul>\n<li><p>实现原理：</p>\n<ul>\n<li><p>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）。</p>\n</li>\n<li><p>数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(data, <span class=\"string\">&#x27;count&#x27;</span>, &#123;</span><br><span class=\"line\">    get () &#123;&#125;, </span><br><span class=\"line\">    set () &#123;&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>存在问题：</p>\n<ul>\n<li>新增属性、删除属性, 界面不会更新。</li>\n<li>直接通过下标修改数组, 界面不会自动更新。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Vue3-0的响应式\"><a href=\"#Vue3-0的响应式\" class=\"headerlink\" title=\"Vue3.0的响应式\"></a>Vue3.0的响应式</h3><ul>\n<li><p>实现原理:</p>\n<ul>\n<li><p>通过Proxy（代理）:  拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。</p>\n</li>\n<li><p>通过Reflect（反射）:  对源对象的属性进行操作。</p>\n</li>\n<li><p>MDN文档中描述的Proxy与Reflect：</p>\n<ul>\n<li><p>Proxy：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></p>\n</li>\n<li><p>Reflect：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title class_\">Proxy</span>(data, &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 拦截读取属性值</span></span><br><span class=\"line\">    get (target, prop) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Reflect</span>.<span class=\"title function_\">get</span>(target, prop)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 拦截设置属性值或添加新属性</span></span><br><span class=\"line\">    set (target, prop, value) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Reflect</span>.<span class=\"title function_\">set</span>(target, prop, value)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 拦截删除属性</span></span><br><span class=\"line\">    deleteProperty (target, prop) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Reflect</span>.<span class=\"title function_\">deleteProperty</span>(target, prop)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">proxy.<span class=\"property\">name</span> = <span class=\"string\">&#x27;tom&#x27;</span>   </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"5-reactive对比ref\"><a href=\"#5-reactive对比ref\" class=\"headerlink\" title=\"5.reactive对比ref\"></a>5.reactive对比ref</h2><ul>\n<li>从定义数据角度对比：<ul>\n<li> ref用来定义：<strong style=\"color:#DD5145\">基本类型数据</strong>。</li>\n<li> reactive用来定义：<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>。</li>\n<li> 备注：ref也可以用来定义<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>, 它内部会自动通过<code>reactive</code>转为<strong style=\"color:#DD5145\">代理对象</strong>。</li>\n</ul>\n</li>\n<li>从原理角度对比：<ul>\n<li> ref通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li>\n<li> reactive通过使用<strong style=\"color:#DD5145\">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style=\"color:#DD5145\">Reflect</strong>操作<strong style=\"color:orange\">源对象</strong>内部的数据。</li>\n</ul>\n</li>\n<li>从使用角度对比：<ul>\n<li> ref定义的数据：操作数据<strong style=\"color:#DD5145\">需要</strong><code>.value</code>，读取数据时模板中直接读取<strong style=\"color:#DD5145\">不需要</strong><code>.value</code>。</li>\n<li> reactive定义的数据：操作数据与读取数据：<strong style=\"color:#DD5145\">均不需要</strong><code>.value</code>。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"6-setup的两个注意点\"><a href=\"#6-setup的两个注意点\" class=\"headerlink\" title=\"6.setup的两个注意点\"></a>6.setup的两个注意点</h2><ul>\n<li><p>setup执行的时机</p>\n<ul>\n<li>在beforeCreate之前执行一次，this是undefined。</li>\n</ul>\n</li>\n<li><p>setup的参数</p>\n<ul>\n<li>props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。</li>\n<li>context：上下文对象<ul>\n<li>attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 <code>this.$attrs</code>。</li>\n<li>slots: 收到的插槽内容, 相当于 <code>this.$slots</code>。</li>\n<li>emit: 分发自定义事件的函数, 相当于 <code>this.$emit</code>。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"7-计算属性与监视\"><a href=\"#7-计算属性与监视\" class=\"headerlink\" title=\"7.计算属性与监视\"></a>7.计算属性与监视</h2><h3 id=\"1-computed函数\"><a href=\"#1-computed函数\" class=\"headerlink\" title=\"1.computed函数\"></a>1.computed函数</h3><ul>\n<li><p>与Vue2.x中computed配置功能一致</p>\n</li>\n<li><p>写法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;computed&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setup</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">\t<span class=\"comment\">//计算属性——简写</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> fullName = <span class=\"title function_\">computed</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> person.<span class=\"property\">firstName</span> + <span class=\"string\">&#x27;-&#x27;</span> + person.<span class=\"property\">lastName</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//计算属性——完整</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> fullName = <span class=\"title function_\">computed</span>(&#123;</span><br><span class=\"line\">        <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> person.<span class=\"property\">firstName</span> + <span class=\"string\">&#x27;-&#x27;</span> + person.<span class=\"property\">lastName</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">set</span>(<span class=\"params\">value</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> nameArr = value.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;-&#x27;</span>)</span><br><span class=\"line\">            person.<span class=\"property\">firstName</span> = nameArr[<span class=\"number\">0</span>]</span><br><span class=\"line\">            person.<span class=\"property\">lastName</span> = nameArr[<span class=\"number\">1</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"2-watch函数\"><a href=\"#2-watch函数\" class=\"headerlink\" title=\"2.watch函数\"></a>2.watch函数</h3><ul>\n<li><p>与Vue2.x中watch配置功能一致</p>\n</li>\n<li><p>两个小“坑”：</p>\n<ul>\n<li>监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。</li>\n<li>监视reactive定义的响应式数据中某个属性时：deep配置有效。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//情况一：监视ref定义的响应式数据</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(sum,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;sum变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//情况二：监视多个ref定义的响应式数据</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>([sum,msg],<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;sum或msg变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 情况三：监视reactive定义的响应式数据</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(person,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>,<span class=\"attr\">deep</span>:<span class=\"literal\">false</span>&#125;) <span class=\"comment\">//此处的deep配置不再奏效</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//情况四：监视reactive定义的响应式数据中的某个属性</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(<span class=\"function\">()=&gt;</span>person.<span class=\"property\">job</span>,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>,<span class=\"attr\">deep</span>:<span class=\"literal\">true</span>&#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//情况五：监视reactive定义的响应式数据中的某些属性</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>([<span class=\"function\">()=&gt;</span>person.<span class=\"property\">job</span>,<span class=\"function\">()=&gt;</span>person.<span class=\"property\">name</span>],<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>,<span class=\"attr\">deep</span>:<span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//特殊情况</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(<span class=\"function\">()=&gt;</span>person.<span class=\"property\">job</span>,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">deep</span>:<span class=\"literal\">true</span>&#125;) <span class=\"comment\">//此处由于监视的是reactive素定义的对象中的某个属性，所以deep配置有效</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"3-watchEffect函数\"><a href=\"#3-watchEffect函数\" class=\"headerlink\" title=\"3.watchEffect函数\"></a>3.watchEffect函数</h3><ul>\n<li><p>watch的套路是：既要指明监视的属性，也要指明监视的回调。</p>\n</li>\n<li><p>watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。</p>\n</li>\n<li><p>watchEffect有点像computed：</p>\n<ul>\n<li>但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li>\n<li>而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span></span><br><span class=\"line\"><span class=\"title function_\">watchEffect</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> x1 = sum.<span class=\"property\">value</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> x2 = person.<span class=\"property\">age</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;watchEffect配置的回调执行了&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"8-生命周期\"><a href=\"#8-生命周期\" class=\"headerlink\" title=\"8.生命周期\"></a>8.生命周期</h2></li>\n</ul>\n<div style=\"border:1px solid black;width:380px;float:left;margin-right:20px;\"><strong>vue2.x的生命周期</strong><img src=\"https://cn.vuejs.org/images/lifecycle.png\" alt=\"lifecycle_2\" style=\"zoom:33%;width:1200px\" /></div><div style=\"border:1px solid black;width:510px;height:985px;float:left\"><strong>vue3.0的生命周期</strong><img src=\"https://v3.cn.vuejs.org/images/lifecycle.svg\" alt=\"lifecycle_2\" style=\"zoom:33%;width:2500px\" /></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<p>1</p>\n<ul>\n<li>Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：<ul>\n<li><code>beforeDestroy</code>改名为 <code>beforeUnmount</code></li>\n<li><code>destroyed</code>改名为 <code>unmounted</code></li>\n</ul>\n</li>\n<li>Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：<ul>\n<li><code>beforeCreate</code>===&gt;<code>setup()</code></li>\n<li><code>created</code>=======&gt;<code>setup()</code></li>\n<li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li>\n<li><code>mounted</code>=======&gt;<code>onMounted</code></li>\n<li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li>\n<li><code>updated</code> =======&gt;<code>onUpdated</code></li>\n<li><code>beforeUnmount</code> ==&gt;<code>onBeforeUnmount</code></li>\n<li><code>unmounted</code> =====&gt;<code>onUnmounted</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"9-自定义hook函数\"><a href=\"#9-自定义hook函数\" class=\"headerlink\" title=\"9.自定义hook函数\"></a>9.自定义hook函数</h2><ul>\n<li><p>什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。</p>\n</li>\n<li><p>类似于vue2.x中的mixin。</p>\n</li>\n<li><p>自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。</p>\n</li>\n</ul>\n<h2 id=\"10-toRef\"><a href=\"#10-toRef\" class=\"headerlink\" title=\"10.toRef\"></a>10.toRef</h2><ul>\n<li>作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。</li>\n<li>语法：<code>const name = toRef(person,&#39;name&#39;)</code></li>\n<li>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</li>\n</ul>\n<ul>\n<li>扩展：<code>toRefs</code> 与<code>toRef</code>功能一致，但可以批量创建多个 ref 对象，语法：<code>toRefs(person)</code></li>\n</ul>\n<h1 id=\"三、其它-Composition-API\"><a href=\"#三、其它-Composition-API\" class=\"headerlink\" title=\"三、其它 Composition API\"></a>三、其它 Composition API</h1><h2 id=\"1-shallowReactive-与-shallowRef\"><a href=\"#1-shallowReactive-与-shallowRef\" class=\"headerlink\" title=\"1.shallowReactive 与 shallowRef\"></a>1.shallowReactive 与 shallowRef</h2><ul>\n<li><p>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</p>\n</li>\n<li><p>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</p>\n</li>\n<li><p>什么时候使用?</p>\n<ul>\n<li> 如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive。</li>\n<li> 如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 ===&gt; shallowRef。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-readonly-与-shallowReadonly\"><a href=\"#2-readonly-与-shallowReadonly\" class=\"headerlink\" title=\"2.readonly 与 shallowReadonly\"></a>2.readonly 与 shallowReadonly</h2><ul>\n<li>readonly: 让一个响应式数据变为只读的（深只读）。</li>\n<li>shallowReadonly：让一个响应式数据变为只读的（浅只读）。</li>\n<li>应用场景: 不希望数据(尤其是这个数据是来自与其他组件时)被修改时。</li>\n</ul>\n<h2 id=\"3-toRaw-与-markRaw\"><a href=\"#3-toRaw-与-markRaw\" class=\"headerlink\" title=\"3.toRaw 与 markRaw\"></a>3.toRaw 与 markRaw</h2><ul>\n<li>toRaw：<ul>\n<li>作用：将一个由<code>reactive</code>生成的<strong style=\"color:orange\">响应式对象</strong>转为<strong style=\"color:orange\">普通对象</strong>。</li>\n<li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li>\n</ul>\n</li>\n<li>markRaw：<ul>\n<li>作用：标记一个对象，使其永远不会再成为响应式对象。</li>\n<li>应用场景:<ol>\n<li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li>\n<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-customRef\"><a href=\"#4-customRef\" class=\"headerlink\" title=\"4.customRef\"></a>4.customRef</h2><ul>\n<li><p>作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p>\n</li>\n<li><p>实现防抖效果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">\t&lt;input type=&quot;text&quot; v-model=&quot;keyword&quot;&gt;</span><br><span class=\"line\">\t&lt;h3&gt;&#123;&#123;keyword&#125;&#125;&lt;/h3&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">\timport &#123;ref,customRef&#125; from &#x27;vue&#x27;</span><br><span class=\"line\">\texport default &#123;</span><br><span class=\"line\">\t\tname:&#x27;Demo&#x27;,</span><br><span class=\"line\">\t\tsetup()&#123;</span><br><span class=\"line\">\t\t\t// let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref</span><br><span class=\"line\">\t\t\t//自定义一个myRef</span><br><span class=\"line\">\t\t\tfunction myRef(value,delay)&#123;</span><br><span class=\"line\">\t\t\t\tlet timer</span><br><span class=\"line\">\t\t\t\t//通过customRef去实现自定义</span><br><span class=\"line\">\t\t\t\treturn customRef((track,trigger)=&gt;&#123;</span><br><span class=\"line\">\t\t\t\t\treturn&#123;</span><br><span class=\"line\">\t\t\t\t\t\tget()&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\ttrack() //告诉Vue这个value值是需要被“追踪”的</span><br><span class=\"line\">\t\t\t\t\t\t\treturn value</span><br><span class=\"line\">\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\tset(newValue)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tclearTimeout(timer)</span><br><span class=\"line\">\t\t\t\t\t\t\ttimer = setTimeout(()=&gt;&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tvalue = newValue</span><br><span class=\"line\">\t\t\t\t\t\t\t\ttrigger() //告诉Vue去更新界面</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,delay)</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tlet keyword = myRef(&#x27;hello&#x27;,500) //使用程序员自定义的ref</span><br><span class=\"line\">\t\t\treturn &#123;</span><br><span class=\"line\">\t\t\t\tkeyword</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"5-provide-与-inject\"><a href=\"#5-provide-与-inject\" class=\"headerlink\" title=\"5.provide 与 inject\"></a>5.provide 与 inject</h2><img src=\"https://v3.cn.vuejs.org/images/components_provide.png\" style=\"width:300px\" />\n\n<ul>\n<li><p>作用：实现<strong style=\"color:#DD5145\">祖与后代组件间</strong>通信</p>\n</li>\n<li><p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p>\n</li>\n<li><p>具体写法：</p>\n<ol>\n<li><p>祖组件中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">setup</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">    <span class=\"keyword\">let</span> car = <span class=\"title function_\">reactive</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;奔驰&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"string\">&#x27;40万&#x27;</span>&#125;)</span><br><span class=\"line\">    <span class=\"title function_\">provide</span>(<span class=\"string\">&#x27;car&#x27;</span>,car)</span><br><span class=\"line\">    ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>后代组件中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">setup</span>(<span class=\"params\">props,context</span>)&#123;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">    <span class=\"keyword\">const</span> car = <span class=\"title function_\">inject</span>(<span class=\"string\">&#x27;car&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;car&#125;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"6-响应式数据的判断\"><a href=\"#6-响应式数据的判断\" class=\"headerlink\" title=\"6.响应式数据的判断\"></a>6.响应式数据的判断</h2></li>\n</ol>\n</li>\n<li><p>isRef: 检查一个值是否为一个 ref 对象</p>\n</li>\n<li><p>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</p>\n</li>\n<li><p>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</p>\n</li>\n<li><p>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理  </p>\n</li>\n</ul>\n<h1 id=\"四、Composition-API-的优势\"><a href=\"#四、Composition-API-的优势\" class=\"headerlink\" title=\"四、Composition API 的优势\"></a>四、Composition API 的优势</h1><h2 id=\"1-Options-API-存在的问题\"><a href=\"#1-Options-API-存在的问题\" class=\"headerlink\" title=\"1.Options API 存在的问题\"></a>1.Options API 存在的问题</h2><p>使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。</p>\n<div style=\"width:600px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image\" style=\"width:600px;float:left\" />\n</div>\n<div style=\"width:300px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image\" style=\"zoom:50%;width:560px;left\" /> \n</div>\n\n\n\n\n\n\n\n\n\n\n\n<h2 id=\"2-Composition-API-的优势\"><a href=\"#2-Composition-API-的优势\" class=\"headerlink\" title=\"2.Composition API 的优势\"></a>2.Composition API 的优势</h2><p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。</p>\n<div style=\"width:500px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n<div style=\"width:430px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n\n\n\n\n<h1 id=\"五、新的组件\"><a href=\"#五、新的组件\" class=\"headerlink\" title=\"五、新的组件\"></a>五、新的组件</h1><h2 id=\"1-Fragment\"><a href=\"#1-Fragment\" class=\"headerlink\" title=\"1.Fragment\"></a>1.Fragment</h2><ul>\n<li>在Vue2中: 组件必须有一个根标签</li>\n<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>\n<li>好处: 减少标签层级, 减小内存占用</li>\n</ul>\n<h2 id=\"2-Teleport\"><a href=\"#2-Teleport\" class=\"headerlink\" title=\"2.Teleport\"></a>2.Teleport</h2><ul>\n<li><p>什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style=\"color:#DD5145\">组件html结构</strong>移动到指定位置的技术。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;teleport to=&quot;移动位置&quot;&gt;</span><br><span class=\"line\">\t&lt;div v-if=&quot;isShow&quot; class=&quot;mask&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class=&quot;dialog&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;h3&gt;我是一个弹窗&lt;/h3&gt;</span><br><span class=\"line\">\t\t\t&lt;button @click=&quot;isShow = false&quot;&gt;关闭弹窗&lt;/button&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t&lt;/div&gt;</span><br><span class=\"line\">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"3-Suspense\"><a href=\"#3-Suspense\" class=\"headerlink\" title=\"3.Suspense\"></a>3.Suspense</h2><ul>\n<li><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p>\n</li>\n<li><p>使用步骤：</p>\n<ul>\n<li><p>异步引入组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;defineAsyncComponent&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Child</span> = <span class=\"title function_\">defineAsyncComponent</span>(<span class=\"function\">()=&gt;</span><span class=\"keyword\">import</span>(<span class=\"string\">&#x27;./components/Child.vue&#x27;</span>))</span><br></pre></td></tr></table></figure></li>\n<li><p>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    &lt;div class=&quot;app&quot;&gt;</span><br><span class=\"line\">        &lt;h3&gt;我是App组件&lt;/h3&gt;</span><br><span class=\"line\">        &lt;Suspense&gt;</span><br><span class=\"line\">            &lt;template v-slot:default&gt;</span><br><span class=\"line\">                &lt;Child/&gt;</span><br><span class=\"line\">            &lt;/template&gt;</span><br><span class=\"line\">            &lt;template v-slot:fallback&gt;</span><br><span class=\"line\">                &lt;h3&gt;加载中.....&lt;/h3&gt;</span><br><span class=\"line\">            &lt;/template&gt;</span><br><span class=\"line\">        &lt;/Suspense&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"六、其他\"><a href=\"#六、其他\" class=\"headerlink\" title=\"六、其他\"></a>六、其他</h1><h2 id=\"1-全局API的转移\"><a href=\"#1-全局API的转移\" class=\"headerlink\" title=\"1.全局API的转移\"></a>1.全局API的转移</h2><ul>\n<li><p>Vue 2.x 有许多全局 API 和配置。</p>\n<ul>\n<li><p>例如：注册全局组件、注册全局指令等。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//注册全局组件</span></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">data</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">template</span>: <span class=\"string\">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//注册全局指令</span></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"title function_\">directive</span>(<span class=\"string\">&#x27;focus&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">inserted</span>: <span class=\"function\"><span class=\"params\">el</span> =&gt;</span> el.<span class=\"title function_\">focus</span>()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Vue3.0中对这些API做出了调整：</p>\n<ul>\n<li><p>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</p>\n<p>| 2.x 全局 API（<code>Vue</code>） | 3.x 实例 API (<code>app</code>)                        |</p>\n<pre><code>      | ------------------------- | ------------------------------------------- |\n</code></pre>\n<p>| Vue.config.xxxx           | app.config.xxxx                             |<br>| Vue.config.productionTip  | <strong style=\"color:#DD5145\">移除</strong> |<br>| Vue.component             | app.component                               |<br>| Vue.directive             | app.directive                               |<br>| Vue.mixin                 | app.mixin                                   |<br>| Vue.use                   | app.use                                     |<br>| Vue.prototype             | app.config.globalProperties                 |</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-其他改变\"><a href=\"#2-其他改变\" class=\"headerlink\" title=\"2.其他改变\"></a>2.其他改变</h2><ul>\n<li><p>data选项应始终被声明为一个函数。</p>\n</li>\n<li><p>过度类名的更改：</p>\n<ul>\n<li><p>Vue2.x写法</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.v-enter</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-leave-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.v-leave</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-enter-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>Vue3.x写法</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.v-enter-from</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-leave-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.v-leave-from</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-enter-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong style=\"color:#DD5145\">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p>\n</li>\n<li><p><strong style=\"color:#DD5145\">移除</strong><code>v-on.native</code>修饰符</p>\n<ul>\n<li><p>父组件中绑定事件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;my-component</span><br><span class=\"line\">  v-on:close=&quot;handleComponentEvent&quot;</span><br><span class=\"line\">  v-on:click=&quot;handleNativeClickEvent&quot;</span><br><span class=\"line\">/&gt;</span><br></pre></td></tr></table></figure></li>\n<li><p>子组件中声明自定义事件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  export default &#123;</span><br><span class=\"line\">    emits: [&#x27;close&#x27;]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong style=\"color:#DD5145\">移除</strong>过滤器（filter）</p>\n<blockquote>\n<p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p>\n</blockquote>\n</li>\n<li><p>……</p>\n</li>\n</ul>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h2 id=\"1-Vue3简介\"><a href=\"#1-Vue3简介\" class=\"headerlink\" title=\"1.Vue3简介\"></a>1.Vue3简介</h2><ul>\n<li>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</li>\n<li>耗时2年多、<a href=\"https://github.com/vuejs/vue-next/graphs/commit-activity\">2600+次提交</a>、<a href=\"https://github.com/vuejs/rfcs/tree/master/active-rfcs\">30+个RFC</a>、<a href=\"https://github.com/vuejs/vue-next/pulls?q=is:pr+is:merged+-author:app/dependabot-preview+\">600+次PR</a>、<a href=\"https://github.com/vuejs/vue-next/graphs/contributors\">99位贡献者</a></li>\n<li>github上的tags地址：<a href=\"https://github.com/vuejs/vue-next/releases/tag/v3.0.0\">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a></li>\n</ul>\n<h2 id=\"2-Vue3带来了什么\"><a href=\"#2-Vue3带来了什么\" class=\"headerlink\" title=\"2.Vue3带来了什么\"></a>2.Vue3带来了什么</h2><h3 id=\"1-性能的提升\"><a href=\"#1-性能的提升\" class=\"headerlink\" title=\"1.性能的提升\"></a>1.性能的提升</h3><ul>\n<li><p>打包大小减少41%</p>\n</li>\n<li><p>初次渲染快55%, 更新渲染快133%</p>\n</li>\n<li><p>内存减少54%</p>\n<p>……</p>\n</li>\n</ul>\n<h3 id=\"2-源码的升级\"><a href=\"#2-源码的升级\" class=\"headerlink\" title=\"2.源码的升级\"></a>2.源码的升级</h3><ul>\n<li><p>使用Proxy代替defineProperty实现响应式</p>\n</li>\n<li><p>重写虚拟DOM的实现和Tree-Shaking</p>\n<p>……</p>\n</li>\n</ul>\n<h3 id=\"3-拥抱TypeScript\"><a href=\"#3-拥抱TypeScript\" class=\"headerlink\" title=\"3.拥抱TypeScript\"></a>3.拥抱TypeScript</h3><ul>\n<li>Vue3可以更好的支持TypeScript</li>\n</ul>\n<h3 id=\"4-新的特性\"><a href=\"#4-新的特性\" class=\"headerlink\" title=\"4.新的特性\"></a>4.新的特性</h3><ol>\n<li><p>Composition API（组合API）</p>\n<ul>\n<li>setup配置</li>\n<li>ref与reactive</li>\n<li>watch与watchEffect</li>\n<li>provide与inject</li>\n<li>……</li>\n</ul>\n</li>\n<li><p>新的内置组件</p>\n<ul>\n<li>Fragment</li>\n<li>Teleport</li>\n<li>Suspense</li>\n</ul>\n</li>\n<li><p>其他改变</p>\n<ul>\n<li>新的生命周期钩子</li>\n<li>data 选项应始终被声明为一个函数</li>\n<li>移除keyCode支持作为 v-on 的修饰符</li>\n<li>……</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"一、创建Vue3-0工程\"><a href=\"#一、创建Vue3-0工程\" class=\"headerlink\" title=\"一、创建Vue3.0工程\"></a>一、创建Vue3.0工程</h1><h2 id=\"1-使用-vue-cli-创建\"><a href=\"#1-使用-vue-cli-创建\" class=\"headerlink\" title=\"1.使用 vue-cli 创建\"></a>1.使用 vue-cli 创建</h2><p>官方文档：<a href=\"https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create\">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span></span><br><span class=\"line\">vue --version</span><br><span class=\"line\"><span class=\"comment\">## 安装或者升级你的@vue/cli</span></span><br><span class=\"line\">npm install -g @vue/cli</span><br><span class=\"line\"><span class=\"comment\">## 创建</span></span><br><span class=\"line\">vue create vue_test</span><br><span class=\"line\"><span class=\"comment\">## 启动</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> vue_test</span><br><span class=\"line\">npm run serve</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-使用-vite-创建\"><a href=\"#2-使用-vite-创建\" class=\"headerlink\" title=\"2.使用 vite 创建\"></a>2.使用 vite 创建</h2><p>官方文档：<a href=\"https://v3.cn.vuejs.org/guide/installation.html#vite\">https://v3.cn.vuejs.org/guide/installation.html#vite</a></p>\n<p>vite官网：<a href=\"https://vitejs.cn/\">https://vitejs.cn</a></p>\n<ul>\n<li>什么是vite？—— 新一代前端构建工具。</li>\n<li>优势如下：<ul>\n<li>开发环境中，无需打包操作，可快速的冷启动。</li>\n<li>轻量快速的热重载（HMR）。</li>\n<li>真正的按需编译，不再等待整个应用编译完成。</li>\n</ul>\n</li>\n<li>传统构建 与 vite构建对比图</li>\n</ul>\n<p><img src=\"https://cn.vitejs.dev/assets/bundler.37740380.png\" style=\"width:500px;height:280px;float:left\" /><img src=\"https://cn.vitejs.dev/assets/esm.3070012d.png\" style=\"width:480px;height:280px\" /></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 创建工程</span></span><br><span class=\"line\">npm init vite-app &lt;project-name&gt;</span><br><span class=\"line\"><span class=\"comment\">## 进入工程目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> &lt;project-name&gt;</span><br><span class=\"line\"><span class=\"comment\">## 安装依赖</span></span><br><span class=\"line\">npm install</span><br><span class=\"line\"><span class=\"comment\">## 运行</span></span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"二、常用-Composition-API\"><a href=\"#二、常用-Composition-API\" class=\"headerlink\" title=\"二、常用 Composition API\"></a>二、常用 Composition API</h1><p>官方文档: <a href=\"https://v3.cn.vuejs.org/guide/composition-api-introduction.html\">https://v3.cn.vuejs.org/guide/composition-api-introduction.html</a></p>\n<h2 id=\"1-拉开序幕的setup\"><a href=\"#1-拉开序幕的setup\" class=\"headerlink\" title=\"1.拉开序幕的setup\"></a>1.拉开序幕的setup</h2><ol>\n<li>理解：Vue3.0中一个新的配置项，值为一个函数。</li>\n<li>setup是所有<strong style=\"color:#DD5145\">Composition API（组合API）</strong><i style=\"color:gray;font-weight:bold\">“ 表演的舞台 ”</i>。</li>\n<li>组件中所用到的：数据、方法等等，均要配置在setup中。</li>\n<li>setup函数的两种返回值：<ol>\n<li>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</li>\n<li><span style=\"color:#aad\">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span></li>\n</ol>\n</li>\n<li>注意点：<ol>\n<li>尽量不要与Vue2.x配置混用<ul>\n<li>Vue2.x配置（data、methos、computed…）中<strong style=\"color:#DD5145\">可以访问到</strong>setup中的属性、方法。</li>\n<li>但在setup中<strong style=\"color:#DD5145\">不能访问到</strong>Vue2.x配置（data、methos、computed…）。</li>\n<li>如果有重名, setup优先。</li>\n</ul>\n</li>\n<li>setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"2-ref函数\"><a href=\"#2-ref函数\" class=\"headerlink\" title=\"2.ref函数\"></a>2.ref函数</h2><ul>\n<li>作用: 定义一个响应式的数据</li>\n<li>语法: <code>const xxx = ref(initValue)</code><ul>\n<li>创建一个包含响应式数据的<strong style=\"color:#DD5145\">引用对象（reference对象，简称ref对象）</strong>。</li>\n<li>JS中操作数据： <code>xxx.value</code></li>\n<li>模板中读取数据: 不需要.value，直接：<code>&lt;div&gt;&#123;&#123;xxx&#125;&#125;&lt;/div&gt;</code></li>\n</ul>\n</li>\n<li>备注：<ul>\n<li>接收的数据可以是：基本类型、也可以是对象类型。</li>\n<li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>完成的。</li>\n<li>对象类型的数据：内部 <i style=\"color:gray;font-weight:bold\">“ 求助 ”</i> 了Vue3.0中的一个新函数—— <code>reactive</code>函数。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-reactive函数\"><a href=\"#3-reactive函数\" class=\"headerlink\" title=\"3.reactive函数\"></a>3.reactive函数</h2><ul>\n<li>作用: 定义一个<strong style=\"color:#DD5145\">对象类型</strong>的响应式数据（基本类型不要用它，要用<code>ref</code>函数）</li>\n<li>语法：<code>const 代理对象= reactive(源对象)</code>接收一个对象（或数组），返回一个<strong style=\"color:#DD5145\">代理对象（Proxy的实例对象，简称proxy对象）</strong></li>\n<li>reactive定义的响应式数据是“深层次的”。</li>\n<li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。</li>\n</ul>\n<h2 id=\"4-Vue3-0中的响应式原理\"><a href=\"#4-Vue3-0中的响应式原理\" class=\"headerlink\" title=\"4.Vue3.0中的响应式原理\"></a>4.Vue3.0中的响应式原理</h2><h3 id=\"vue2-x的响应式\"><a href=\"#vue2-x的响应式\" class=\"headerlink\" title=\"vue2.x的响应式\"></a>vue2.x的响应式</h3><ul>\n<li><p>实现原理：</p>\n<ul>\n<li><p>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）。</p>\n</li>\n<li><p>数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(data, <span class=\"string\">&#x27;count&#x27;</span>, &#123;</span><br><span class=\"line\">    get () &#123;&#125;, </span><br><span class=\"line\">    set () &#123;&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>存在问题：</p>\n<ul>\n<li>新增属性、删除属性, 界面不会更新。</li>\n<li>直接通过下标修改数组, 界面不会自动更新。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Vue3-0的响应式\"><a href=\"#Vue3-0的响应式\" class=\"headerlink\" title=\"Vue3.0的响应式\"></a>Vue3.0的响应式</h3><ul>\n<li><p>实现原理:</p>\n<ul>\n<li><p>通过Proxy（代理）:  拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。</p>\n</li>\n<li><p>通过Reflect（反射）:  对源对象的属性进行操作。</p>\n</li>\n<li><p>MDN文档中描述的Proxy与Reflect：</p>\n<ul>\n<li><p>Proxy：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></p>\n</li>\n<li><p>Reflect：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title class_\">Proxy</span>(data, &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 拦截读取属性值</span></span><br><span class=\"line\">    get (target, prop) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Reflect</span>.<span class=\"title function_\">get</span>(target, prop)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 拦截设置属性值或添加新属性</span></span><br><span class=\"line\">    set (target, prop, value) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Reflect</span>.<span class=\"title function_\">set</span>(target, prop, value)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 拦截删除属性</span></span><br><span class=\"line\">    deleteProperty (target, prop) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title class_\">Reflect</span>.<span class=\"title function_\">deleteProperty</span>(target, prop)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">proxy.<span class=\"property\">name</span> = <span class=\"string\">&#x27;tom&#x27;</span>   </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"5-reactive对比ref\"><a href=\"#5-reactive对比ref\" class=\"headerlink\" title=\"5.reactive对比ref\"></a>5.reactive对比ref</h2><ul>\n<li>从定义数据角度对比：<ul>\n<li> ref用来定义：<strong style=\"color:#DD5145\">基本类型数据</strong>。</li>\n<li> reactive用来定义：<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>。</li>\n<li> 备注：ref也可以用来定义<strong style=\"color:#DD5145\">对象（或数组）类型数据</strong>, 它内部会自动通过<code>reactive</code>转为<strong style=\"color:#DD5145\">代理对象</strong>。</li>\n</ul>\n</li>\n<li>从原理角度对比：<ul>\n<li> ref通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li>\n<li> reactive通过使用<strong style=\"color:#DD5145\">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style=\"color:#DD5145\">Reflect</strong>操作<strong style=\"color:orange\">源对象</strong>内部的数据。</li>\n</ul>\n</li>\n<li>从使用角度对比：<ul>\n<li> ref定义的数据：操作数据<strong style=\"color:#DD5145\">需要</strong><code>.value</code>，读取数据时模板中直接读取<strong style=\"color:#DD5145\">不需要</strong><code>.value</code>。</li>\n<li> reactive定义的数据：操作数据与读取数据：<strong style=\"color:#DD5145\">均不需要</strong><code>.value</code>。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"6-setup的两个注意点\"><a href=\"#6-setup的两个注意点\" class=\"headerlink\" title=\"6.setup的两个注意点\"></a>6.setup的两个注意点</h2><ul>\n<li><p>setup执行的时机</p>\n<ul>\n<li>在beforeCreate之前执行一次，this是undefined。</li>\n</ul>\n</li>\n<li><p>setup的参数</p>\n<ul>\n<li>props：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。</li>\n<li>context：上下文对象<ul>\n<li>attrs: 值为对象，包含：组件外部传递过来，但没有在props配置中声明的属性, 相当于 <code>this.$attrs</code>。</li>\n<li>slots: 收到的插槽内容, 相当于 <code>this.$slots</code>。</li>\n<li>emit: 分发自定义事件的函数, 相当于 <code>this.$emit</code>。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"7-计算属性与监视\"><a href=\"#7-计算属性与监视\" class=\"headerlink\" title=\"7.计算属性与监视\"></a>7.计算属性与监视</h2><h3 id=\"1-computed函数\"><a href=\"#1-computed函数\" class=\"headerlink\" title=\"1.computed函数\"></a>1.computed函数</h3><ul>\n<li><p>与Vue2.x中computed配置功能一致</p>\n</li>\n<li><p>写法</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;computed&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">setup</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">\t<span class=\"comment\">//计算属性——简写</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> fullName = <span class=\"title function_\">computed</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> person.<span class=\"property\">firstName</span> + <span class=\"string\">&#x27;-&#x27;</span> + person.<span class=\"property\">lastName</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//计算属性——完整</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> fullName = <span class=\"title function_\">computed</span>(&#123;</span><br><span class=\"line\">        <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> person.<span class=\"property\">firstName</span> + <span class=\"string\">&#x27;-&#x27;</span> + person.<span class=\"property\">lastName</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">set</span>(<span class=\"params\">value</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> nameArr = value.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;-&#x27;</span>)</span><br><span class=\"line\">            person.<span class=\"property\">firstName</span> = nameArr[<span class=\"number\">0</span>]</span><br><span class=\"line\">            person.<span class=\"property\">lastName</span> = nameArr[<span class=\"number\">1</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"2-watch函数\"><a href=\"#2-watch函数\" class=\"headerlink\" title=\"2.watch函数\"></a>2.watch函数</h3><ul>\n<li><p>与Vue2.x中watch配置功能一致</p>\n</li>\n<li><p>两个小“坑”：</p>\n<ul>\n<li>监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。</li>\n<li>监视reactive定义的响应式数据中某个属性时：deep配置有效。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//情况一：监视ref定义的响应式数据</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(sum,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;sum变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//情况二：监视多个ref定义的响应式数据</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>([sum,msg],<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;sum或msg变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 情况三：监视reactive定义的响应式数据</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 </span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(person,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>,<span class=\"attr\">deep</span>:<span class=\"literal\">false</span>&#125;) <span class=\"comment\">//此处的deep配置不再奏效</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//情况四：监视reactive定义的响应式数据中的某个属性</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(<span class=\"function\">()=&gt;</span>person.<span class=\"property\">job</span>,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>,<span class=\"attr\">deep</span>:<span class=\"literal\">true</span>&#125;) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//情况五：监视reactive定义的响应式数据中的某些属性</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>([<span class=\"function\">()=&gt;</span>person.<span class=\"property\">job</span>,<span class=\"function\">()=&gt;</span>person.<span class=\"property\">name</span>],<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">immediate</span>:<span class=\"literal\">true</span>,<span class=\"attr\">deep</span>:<span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//特殊情况</span></span><br><span class=\"line\"><span class=\"title function_\">watch</span>(<span class=\"function\">()=&gt;</span>person.<span class=\"property\">job</span>,<span class=\"function\">(<span class=\"params\">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class=\"line\">&#125;,&#123;<span class=\"attr\">deep</span>:<span class=\"literal\">true</span>&#125;) <span class=\"comment\">//此处由于监视的是reactive素定义的对象中的某个属性，所以deep配置有效</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"3-watchEffect函数\"><a href=\"#3-watchEffect函数\" class=\"headerlink\" title=\"3.watchEffect函数\"></a>3.watchEffect函数</h3><ul>\n<li><p>watch的套路是：既要指明监视的属性，也要指明监视的回调。</p>\n</li>\n<li><p>watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。</p>\n</li>\n<li><p>watchEffect有点像computed：</p>\n<ul>\n<li>但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li>\n<li>而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span></span><br><span class=\"line\"><span class=\"title function_\">watchEffect</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> x1 = sum.<span class=\"property\">value</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> x2 = person.<span class=\"property\">age</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;watchEffect配置的回调执行了&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"8-生命周期\"><a href=\"#8-生命周期\" class=\"headerlink\" title=\"8.生命周期\"></a>8.生命周期</h2></li>\n</ul>\n<div style=\"border:1px solid black;width:380px;float:left;margin-right:20px;\"><strong>vue2.x的生命周期</strong><img src=\"https://cn.vuejs.org/images/lifecycle.png\" alt=\"lifecycle_2\" style=\"zoom:33%;width:1200px\" /></div><div style=\"border:1px solid black;width:510px;height:985px;float:left\"><strong>vue3.0的生命周期</strong><img src=\"https://v3.cn.vuejs.org/images/lifecycle.svg\" alt=\"lifecycle_2\" style=\"zoom:33%;width:2500px\" /></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<p>1</p>\n<ul>\n<li>Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：<ul>\n<li><code>beforeDestroy</code>改名为 <code>beforeUnmount</code></li>\n<li><code>destroyed</code>改名为 <code>unmounted</code></li>\n</ul>\n</li>\n<li>Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：<ul>\n<li><code>beforeCreate</code>===&gt;<code>setup()</code></li>\n<li><code>created</code>=======&gt;<code>setup()</code></li>\n<li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li>\n<li><code>mounted</code>=======&gt;<code>onMounted</code></li>\n<li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li>\n<li><code>updated</code> =======&gt;<code>onUpdated</code></li>\n<li><code>beforeUnmount</code> ==&gt;<code>onBeforeUnmount</code></li>\n<li><code>unmounted</code> =====&gt;<code>onUnmounted</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"9-自定义hook函数\"><a href=\"#9-自定义hook函数\" class=\"headerlink\" title=\"9.自定义hook函数\"></a>9.自定义hook函数</h2><ul>\n<li><p>什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。</p>\n</li>\n<li><p>类似于vue2.x中的mixin。</p>\n</li>\n<li><p>自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。</p>\n</li>\n</ul>\n<h2 id=\"10-toRef\"><a href=\"#10-toRef\" class=\"headerlink\" title=\"10.toRef\"></a>10.toRef</h2><ul>\n<li>作用：创建一个 ref 对象，其value值指向另一个对象中的某个属性。</li>\n<li>语法：<code>const name = toRef(person,&#39;name&#39;)</code></li>\n<li>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</li>\n</ul>\n<ul>\n<li>扩展：<code>toRefs</code> 与<code>toRef</code>功能一致，但可以批量创建多个 ref 对象，语法：<code>toRefs(person)</code></li>\n</ul>\n<h1 id=\"三、其它-Composition-API\"><a href=\"#三、其它-Composition-API\" class=\"headerlink\" title=\"三、其它 Composition API\"></a>三、其它 Composition API</h1><h2 id=\"1-shallowReactive-与-shallowRef\"><a href=\"#1-shallowReactive-与-shallowRef\" class=\"headerlink\" title=\"1.shallowReactive 与 shallowRef\"></a>1.shallowReactive 与 shallowRef</h2><ul>\n<li><p>shallowReactive：只处理对象最外层属性的响应式（浅响应式）。</p>\n</li>\n<li><p>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</p>\n</li>\n<li><p>什么时候使用?</p>\n<ul>\n<li> 如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive。</li>\n<li> 如果有一个对象数据，后续功能不会修改该对象中的属性，而是生新的对象来替换 ===&gt; shallowRef。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-readonly-与-shallowReadonly\"><a href=\"#2-readonly-与-shallowReadonly\" class=\"headerlink\" title=\"2.readonly 与 shallowReadonly\"></a>2.readonly 与 shallowReadonly</h2><ul>\n<li>readonly: 让一个响应式数据变为只读的（深只读）。</li>\n<li>shallowReadonly：让一个响应式数据变为只读的（浅只读）。</li>\n<li>应用场景: 不希望数据(尤其是这个数据是来自与其他组件时)被修改时。</li>\n</ul>\n<h2 id=\"3-toRaw-与-markRaw\"><a href=\"#3-toRaw-与-markRaw\" class=\"headerlink\" title=\"3.toRaw 与 markRaw\"></a>3.toRaw 与 markRaw</h2><ul>\n<li>toRaw：<ul>\n<li>作用：将一个由<code>reactive</code>生成的<strong style=\"color:orange\">响应式对象</strong>转为<strong style=\"color:orange\">普通对象</strong>。</li>\n<li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li>\n</ul>\n</li>\n<li>markRaw：<ul>\n<li>作用：标记一个对象，使其永远不会再成为响应式对象。</li>\n<li>应用场景:<ol>\n<li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li>\n<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-customRef\"><a href=\"#4-customRef\" class=\"headerlink\" title=\"4.customRef\"></a>4.customRef</h2><ul>\n<li><p>作用：创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制。</p>\n</li>\n<li><p>实现防抖效果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">\t&lt;input type=&quot;text&quot; v-model=&quot;keyword&quot;&gt;</span><br><span class=\"line\">\t&lt;h3&gt;&#123;&#123;keyword&#125;&#125;&lt;/h3&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">\timport &#123;ref,customRef&#125; from &#x27;vue&#x27;</span><br><span class=\"line\">\texport default &#123;</span><br><span class=\"line\">\t\tname:&#x27;Demo&#x27;,</span><br><span class=\"line\">\t\tsetup()&#123;</span><br><span class=\"line\">\t\t\t// let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref</span><br><span class=\"line\">\t\t\t//自定义一个myRef</span><br><span class=\"line\">\t\t\tfunction myRef(value,delay)&#123;</span><br><span class=\"line\">\t\t\t\tlet timer</span><br><span class=\"line\">\t\t\t\t//通过customRef去实现自定义</span><br><span class=\"line\">\t\t\t\treturn customRef((track,trigger)=&gt;&#123;</span><br><span class=\"line\">\t\t\t\t\treturn&#123;</span><br><span class=\"line\">\t\t\t\t\t\tget()&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\ttrack() //告诉Vue这个value值是需要被“追踪”的</span><br><span class=\"line\">\t\t\t\t\t\t\treturn value</span><br><span class=\"line\">\t\t\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t\t\tset(newValue)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tclearTimeout(timer)</span><br><span class=\"line\">\t\t\t\t\t\t\ttimer = setTimeout(()=&gt;&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\tvalue = newValue</span><br><span class=\"line\">\t\t\t\t\t\t\t\ttrigger() //告诉Vue去更新界面</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;,delay)</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tlet keyword = myRef(&#x27;hello&#x27;,500) //使用程序员自定义的ref</span><br><span class=\"line\">\t\t\treturn &#123;</span><br><span class=\"line\">\t\t\t\tkeyword</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"5-provide-与-inject\"><a href=\"#5-provide-与-inject\" class=\"headerlink\" title=\"5.provide 与 inject\"></a>5.provide 与 inject</h2><img src=\"https://v3.cn.vuejs.org/images/components_provide.png\" style=\"width:300px\" />\n\n<ul>\n<li><p>作用：实现<strong style=\"color:#DD5145\">祖与后代组件间</strong>通信</p>\n</li>\n<li><p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p>\n</li>\n<li><p>具体写法：</p>\n<ol>\n<li><p>祖组件中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">setup</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">    <span class=\"keyword\">let</span> car = <span class=\"title function_\">reactive</span>(&#123;<span class=\"attr\">name</span>:<span class=\"string\">&#x27;奔驰&#x27;</span>,<span class=\"attr\">price</span>:<span class=\"string\">&#x27;40万&#x27;</span>&#125;)</span><br><span class=\"line\">    <span class=\"title function_\">provide</span>(<span class=\"string\">&#x27;car&#x27;</span>,car)</span><br><span class=\"line\">    ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>后代组件中：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">setup</span>(<span class=\"params\">props,context</span>)&#123;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">    <span class=\"keyword\">const</span> car = <span class=\"title function_\">inject</span>(<span class=\"string\">&#x27;car&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;car&#125;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"6-响应式数据的判断\"><a href=\"#6-响应式数据的判断\" class=\"headerlink\" title=\"6.响应式数据的判断\"></a>6.响应式数据的判断</h2></li>\n</ol>\n</li>\n<li><p>isRef: 检查一个值是否为一个 ref 对象</p>\n</li>\n<li><p>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</p>\n</li>\n<li><p>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</p>\n</li>\n<li><p>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理  </p>\n</li>\n</ul>\n<h1 id=\"四、Composition-API-的优势\"><a href=\"#四、Composition-API-的优势\" class=\"headerlink\" title=\"四、Composition API 的优势\"></a>四、Composition API 的优势</h1><h2 id=\"1-Options-API-存在的问题\"><a href=\"#1-Options-API-存在的问题\" class=\"headerlink\" title=\"1.Options API 存在的问题\"></a>1.Options API 存在的问题</h2><p>使用传统OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 。</p>\n<div style=\"width:600px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image\" style=\"width:600px;float:left\" />\n</div>\n<div style=\"width:300px;height:370px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image\" style=\"zoom:50%;width:560px;left\" /> \n</div>\n\n\n\n\n\n\n\n\n\n\n\n<h2 id=\"2-Composition-API-的优势\"><a href=\"#2-Composition-API-的优势\" class=\"headerlink\" title=\"2.Composition API 的优势\"></a>2.Composition API 的优势</h2><p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。</p>\n<div style=\"width:500px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n<div style=\"width:430px;height:340px;overflow:hidden;float:left\">\n    <img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image\"style=\"height:360px\"/>\n</div>\n\n\n\n\n<h1 id=\"五、新的组件\"><a href=\"#五、新的组件\" class=\"headerlink\" title=\"五、新的组件\"></a>五、新的组件</h1><h2 id=\"1-Fragment\"><a href=\"#1-Fragment\" class=\"headerlink\" title=\"1.Fragment\"></a>1.Fragment</h2><ul>\n<li>在Vue2中: 组件必须有一个根标签</li>\n<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>\n<li>好处: 减少标签层级, 减小内存占用</li>\n</ul>\n<h2 id=\"2-Teleport\"><a href=\"#2-Teleport\" class=\"headerlink\" title=\"2.Teleport\"></a>2.Teleport</h2><ul>\n<li><p>什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style=\"color:#DD5145\">组件html结构</strong>移动到指定位置的技术。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;teleport to=&quot;移动位置&quot;&gt;</span><br><span class=\"line\">\t&lt;div v-if=&quot;isShow&quot; class=&quot;mask&quot;&gt;</span><br><span class=\"line\">\t\t&lt;div class=&quot;dialog&quot;&gt;</span><br><span class=\"line\">\t\t\t&lt;h3&gt;我是一个弹窗&lt;/h3&gt;</span><br><span class=\"line\">\t\t\t&lt;button @click=&quot;isShow = false&quot;&gt;关闭弹窗&lt;/button&gt;</span><br><span class=\"line\">\t\t&lt;/div&gt;</span><br><span class=\"line\">\t&lt;/div&gt;</span><br><span class=\"line\">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"3-Suspense\"><a href=\"#3-Suspense\" class=\"headerlink\" title=\"3.Suspense\"></a>3.Suspense</h2><ul>\n<li><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p>\n</li>\n<li><p>使用步骤：</p>\n<ul>\n<li><p>异步引入组件</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;defineAsyncComponent&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Child</span> = <span class=\"title function_\">defineAsyncComponent</span>(<span class=\"function\">()=&gt;</span><span class=\"keyword\">import</span>(<span class=\"string\">&#x27;./components/Child.vue&#x27;</span>))</span><br></pre></td></tr></table></figure></li>\n<li><p>使用<code>Suspense</code>包裹组件，并配置好<code>default</code> 与 <code>fallback</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">    &lt;div class=&quot;app&quot;&gt;</span><br><span class=\"line\">        &lt;h3&gt;我是App组件&lt;/h3&gt;</span><br><span class=\"line\">        &lt;Suspense&gt;</span><br><span class=\"line\">            &lt;template v-slot:default&gt;</span><br><span class=\"line\">                &lt;Child/&gt;</span><br><span class=\"line\">            &lt;/template&gt;</span><br><span class=\"line\">            &lt;template v-slot:fallback&gt;</span><br><span class=\"line\">                &lt;h3&gt;加载中.....&lt;/h3&gt;</span><br><span class=\"line\">            &lt;/template&gt;</span><br><span class=\"line\">        &lt;/Suspense&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"六、其他\"><a href=\"#六、其他\" class=\"headerlink\" title=\"六、其他\"></a>六、其他</h1><h2 id=\"1-全局API的转移\"><a href=\"#1-全局API的转移\" class=\"headerlink\" title=\"1.全局API的转移\"></a>1.全局API的转移</h2><ul>\n<li><p>Vue 2.x 有许多全局 API 和配置。</p>\n<ul>\n<li><p>例如：注册全局组件、注册全局指令等。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//注册全局组件</span></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"title function_\">component</span>(<span class=\"string\">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">data</span>: <span class=\"function\">() =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"attr\">template</span>: <span class=\"string\">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//注册全局指令</span></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"title function_\">directive</span>(<span class=\"string\">&#x27;focus&#x27;</span>, &#123;</span><br><span class=\"line\">  <span class=\"attr\">inserted</span>: <span class=\"function\"><span class=\"params\">el</span> =&gt;</span> el.<span class=\"title function_\">focus</span>()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Vue3.0中对这些API做出了调整：</p>\n<ul>\n<li><p>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</p>\n<p>| 2.x 全局 API（<code>Vue</code>） | 3.x 实例 API (<code>app</code>)                        |</p>\n<pre><code>      | ------------------------- | ------------------------------------------- |\n</code></pre>\n<p>| Vue.config.xxxx           | app.config.xxxx                             |<br>| Vue.config.productionTip  | <strong style=\"color:#DD5145\">移除</strong> |<br>| Vue.component             | app.component                               |<br>| Vue.directive             | app.directive                               |<br>| Vue.mixin                 | app.mixin                                   |<br>| Vue.use                   | app.use                                     |<br>| Vue.prototype             | app.config.globalProperties                 |</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-其他改变\"><a href=\"#2-其他改变\" class=\"headerlink\" title=\"2.其他改变\"></a>2.其他改变</h2><ul>\n<li><p>data选项应始终被声明为一个函数。</p>\n</li>\n<li><p>过度类名的更改：</p>\n<ul>\n<li><p>Vue2.x写法</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.v-enter</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-leave-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.v-leave</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-enter-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>Vue3.x写法</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.v-enter-from</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-leave-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.v-leave-from</span>,</span><br><span class=\"line\"><span class=\"selector-class\">.v-enter-to</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong style=\"color:#DD5145\">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p>\n</li>\n<li><p><strong style=\"color:#DD5145\">移除</strong><code>v-on.native</code>修饰符</p>\n<ul>\n<li><p>父组件中绑定事件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;my-component</span><br><span class=\"line\">  v-on:close=&quot;handleComponentEvent&quot;</span><br><span class=\"line\">  v-on:click=&quot;handleNativeClickEvent&quot;</span><br><span class=\"line\">/&gt;</span><br></pre></td></tr></table></figure></li>\n<li><p>子组件中声明自定义事件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  export default &#123;</span><br><span class=\"line\">    emits: [&#x27;close&#x27;]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong style=\"color:#DD5145\">移除</strong>过滤器（filter）</p>\n<blockquote>\n<p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p>\n</blockquote>\n</li>\n<li><p>……</p>\n</li>\n</ul>\n"},{"title":"Node.js笔记","type":"tags","description":"Node.js （最全）基础+全栈项目","keywords":"后端 笔记","top_img":"https://colorlib.com/wp/wp-content/uploads/sites/2/node.js-logo.png","cover":"https://innovationyourself.com/wp-content/uploads/2020/08/nodejs-logo.png","date":"2023-01-24T16:00:00.000Z","updated":"2023-02-24T07:27:41.120Z","_content":"#### 一、Node.js基础\n\n##### 1.  认识Node.js\n\n> Node.js是一个javascript运行环境。它让javascript可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与PHP、Java、Python、.NET、Ruby等后端语言平起平坐。\n>\n> Nodejs是基于V8引擎，V8是Google发布的开源JavaScript引擎，本身就是用于Chrome浏览器的js解释部分，但是Ryan Dahl 这哥们，鬼才般的，把这个V8搬到了服务器上，用于做服务器的软件。\n\n###### 01 nodejs的特性\n\n- Nodejs语法完全是js语法，只要你懂js基础就可以学会Nodejs后端开发\n- NodeJs超强的高并发能力,实现高性能服务器\n- 开发周期短、开发成本低、学习成本低\n\n###### 02 使用 Node.js 需要了解多少 JavaScript\n\n> http://nodejs.cn/learn/how-much-javascript-do-you-need-to-know-to-use-nodejs\n\n###### 03 浏览器环境vs node环境\n\nNode.js 可以解析JS代码（没有浏览器安全级别的限制）提供很多系统级别的API，如：\n\n- 文件的读写 (File System)\n\n  ```js\n  const fs = require('fs')\n  \n  fs.readFile('./ajax.png', 'utf-8', (err, content) => {\n    console.log(content)\n  })\n  ```\n\n- 进程的管理 (Process)\n\n  ```js\n  function main(argv) {\n    console.log(argv)\n  }\n  \n  main(process.argv.slice(2))\n  \n  ```\n\n  \n\n- 网络通信 (HTTP/HTTPS)\n\n  ```js\n  const http = require(\"http\")\n  \n  http.createServer((req,res) => {\n    res.writeHead(200, {\n      \"content-type\": \"text/plain\"\n    })\n    res.write(\"hello nodejs\")\n    res.end()\n  }).listen(3000)\n  \n  ```\n\n##### 2.  开发环境搭建\n\n> http://nodejs.cn/download/\n\n![image-20220210095903409](%E7%AC%94%E8%AE%B0.assets/image-20220210095903409.png)\n\n##### 3.  模块、包、commonJS\n\n​\t\t\t![image-20220210100015768](%E7%AC%94%E8%AE%B0.assets/image-20220210100015768.png)\n\n###### 02 CommonJS规范\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101652166.png\" alt=\"image-20220210101652166\" style=\"zoom: 67%; float: left;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101720533.png\" alt=\"image-20220210101720533\" style=\"zoom: 67%; float: left;\" />\n\n###### 03 modules模块化规范写法\n\n我们可以把公共的功能 抽离成为一个单独的 js 文件 作为一个模块，默认情况下面这个模块里面的方法或者属性，外面是没法访问的。如果要让外部可以访问模块里面的方法或者属性，就必须在模块里面通过 exports 或者 module.exports 暴露属性或者方法。\n\nm1.js：\n\n```js\nconst name = 'gp19'\n\nconst sayName = () => {\n  console.log(name)\n}\n\nconsole.log('module 1')\n\n// 接口暴露方法一：\nmodule.exports = {\n  say: sayName\n}\n\n// 接口暴露方法二：\nexports.say = sayName\n\n// 错误！\nexports = {\n  say: sayName\n}\n```\n\nmain.js：\n\n```js\nconst m1 = require('./m1')\nm1.say()\n```\n\n##### 4.  Npm&Yarn\n\n###### 01 npm的使用\n\n```js\nnpm init\nnpm install 包名 –g  （uninstall,update）\nnpm install 包名 --save-dev (uninstall,update)\nnpm list -g (不加-g，列举当前目录下的安装包)\nnpm info 包名（详细信息） npm info 包名 version(获取最新版本)\nnpm install md5@1（安装指定版本）\nnpm outdated(  检查包是否已经过时)\n\n\n\t\"dependencies\": {    \"md5\": \"^2.1.0\"  }  ^ 表示 如果 直接npm install 将会 安md5\n    2.*.*  \t最新版本\n\n\t\"dependencies\": {    \"md5\": \"~2.1.0\"  }  ~ 表示 如果 直接npm install 将会 安装md5 2.1.*  最新版本\n\n\t\"dependencies\": {    \"md5\": \"*\"  }  * 表示 如果 直接npm install 将会 安装 md5  最新版本\n```\n\n###### 02 全局安装 nrm  \n\n> NRM (npm registry manager)是npm的镜像源管理工具，有时候国外资源太慢，使用这个就可以快速地在 npm 源间切换。\n\n`手动切换方法： npm config set registry https://registry.npm.taobao.org`\n\n**安装 nrm**\n\n在命令行执行命令，npm install -g nrm，全局安装nrm。\n\n**使用 nrm**\n\n执行命令 nrm ls 查看可选的源。 其中，带*的是当前使用的源，上面的输出表明当前源是官方源。\n\n**切换 nrm**\n\n如果要切换到taobao源，执行命令nrm use taobao。\n\n**测试速度**\n\n你还可以通过 nrm test 测试相应源的响应时间。\n\n```\nnrm test\n```\n\n>  扩展：\n\n> ![image-20220210114017616](%E7%AC%94%E8%AE%B0.assets/image-20220210114017616.png)\n\n ```bash\n npm install -g cnpm --registry=https://registry.npmmirror.com\n ```\n\n\n\n###### 03 yarn使用\n\n```\nnpm install -g yarn\n```\n\n```js\n对比npm:\n\t速度超快: Yarn 缓存了每个下载过的包，所以再次使用时无需重复下载。 同时利用并行下载以最大化资源利用率，因此安装速度更快。\n    超级安全: 在执行代码之前，Yarn 会通过算法校验每个安装包的完整性。\n\n开始新项目\n\tyarn init \n添加依赖包\n\tyarn add [package] \n\tyarn add [package]@[version] \n\tyarn add [package] --dev \n升级依赖包\n\t yarn upgrade [package]@[version] \n移除依赖包\n\t yarn remove [package]\n\t \n安装项目的全部依赖\n\t yarn install \n```\n\n\n\n##### 5.  内置模块\n\n###### 01  http模块\n\n> 要使用 HTTP 服务器和客户端，则必须 `require('http')`。\n\n```js\nconst http = require('http');\n\n// 创建本地服务器来从其接收数据\nconst server = http.createServer((req, res) => {\n  res.writeHead(200, { 'Content-Type': 'application/json' });\n  res.end(JSON.stringify({\n    data: 'Hello World!'\n  }));\n});\n\nserver.listen(8000);\n\n```\n\n```js\nconst http = require('http');\n\n// 创建本地服务器来从其接收数据\nconst server = http.createServer();\n\n// 监听请求事件\nserver.on('request', (request, res) => {\n  res.writeHead(200, { 'Content-Type': 'application/json' });\n  res.end(JSON.stringify({\n    data: 'Hello World!'\n  }));\n});\n\nserver.listen(8000);\n```\n\n###### \t02   url模块\n\n**02.1 parse**\n\n```js\nconst url = require('url')\nconst urlString = 'https://www.baidu.com:443/ad/index.html?id=8&name=mouse#tag=110'\nconst parsedStr = url.parse(urlString)\nconsole.log(parsedStr)\n```\n\n**02.2 format**\n\n```js\nconst url = require('url')\nconst urlObject = {\n  protocol: 'https:',\n  slashes: true,\n  auth: null,\n  host: 'www.baidu.com:443',\n  port: '443',\n  hostname: 'www.baidu.com',\n  hash: '#tag=110',\n  search: '?id=8&name=mouse',\n  query: { id: '8', name: 'mouse' },\n  pathname: '/ad/index.html',\n  path: '/ad/index.html?id=8&name=mouse'\n}\nconst parsedObj = url.format(urlObject)\nconsole.log(parsedObj)\n\n```\n\n\n\n**02.3 resolve**\n\n```js\nconst url = require('url')\nvar a = url.resolve('/one/two/three', 'four')  ( 注意最后加/ ，不加/的区别 )\nvar b = url.resolve('http://example.com/', '/one')\nvar c = url.resolve('http://example.com/one', '/two')\nconsole.log(a + \",\" + b + \",\" + c)\n```\n\n\n\n###### \t03  querystring模块\n\n**03.1 parse**\n\n```js\nconst querystring = require('querystring')\nvar qs = 'x=3&y=4'\nvar parsed = querystring.parse(qs)\nconsole.log(parsed)\n\n```\n\n**03.2 stringify**\n\n```js\nconst querystring = require('querystring')\nvar qo = {\n  x: 3,\n  y: 4\n}\nvar parsed = querystring.stringify(qo)\nconsole.log(parsed)\n\n```\n\n**03.3 escape/unescape**\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211406894.png\" alt=\"image-20220213211406894\" style=\"zoom:67%;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211423142.png\" alt=\"image-20220213211423142\" style=\"zoom:67%;\" />\n\n```js\nconst querystring = require('querystring')\nvar str = 'id=3&city=北京&url=https://www.baidu.com'\nvar escaped = querystring.escape(str)\nconsole.log(escaped)\n\n```\n\n```js\nconst querystring = require('querystring')\nvar str = 'id%3D3%26city%3D%E5%8C%97%E4%BA%AC%26url%3Dhttps%3A%2F%2Fwww.baidu.com'\nvar unescaped = querystring.unescape(str)\nconsole.log(unescaped)\n```\n\n###### \t04  http模块补充\n\n**04.1 接口：jsonp**\n\n```js\nconst http = require('http')\nconst url = require('url')\n\nconst app = http.createServer((req, res) => {\n  let urlObj = url.parse(req.url, true)\n\n  switch (urlObj.pathname) {\n    case '/api/user':\n      res.end(`${urlObj.query.cb}({\"name\": \"gp145\"})`)\n      break\n    default:\n      res.end('404.')\n      break\n  }\n})\n\napp.listen(8080, () => {\n  console.log('localhost:8080')\n})\n```\n\n**04.2 跨域：CORS**\n\n```js\nconst http = require('http')\nconst url = require('url')\nconst querystring = require('querystring')\n\nconst app = http.createServer((req, res) => {\n  let data = ''\n  let urlObj = url.parse(req.url, true)\n\n  res.writeHead(200, {\n    'content-type': 'application/json;charset=utf-8',\n    'Access-Control-Allow-Origin': '*'\n  })\n\n  req.on('data', (chunk) => {\n    data += chunk\n  })\n\n  req.on('end', () => {\n    responseResult(querystring.parse(data))\n  })\n\n  function responseResult(data) {\n    switch (urlObj.pathname) {\n      case '/api/login':\n        res.end(JSON.stringify({\n          message: data\n        }))\n        break\n      default:\n        res.end('404.')\n        break\n    }\n  }\n})\n\napp.listen(8080, () => {\n  console.log('localhost:8080')\n})\n```\n**04.3 模拟get**\n\n```js\nvar http = require('http')\nvar https = require('https')\n\n// 1、接口 2、跨域\nconst server = http.createServer((request, response) => {\n  var url = request.url.substr(1)\n\n  var data = ''\n\n  response.writeHeader(200, {\n    'content-type': 'application/json;charset=utf-8',\n    'Access-Control-Allow-Origin': '*'\n  })\n\n  https.get(`https://m.lagou.com/listmore.json${url}`, (res) => {\n\n    res.on('data', (chunk) => {\n      data += chunk\n    })\n\n    res.on('end', () => {\n      response.end(JSON.stringify({\n        ret: true,\n        data\n      }))\n    })\n  })\n\n})\n\nserver.listen(8080, () => {\n  console.log('localhost:8080')\n})\n```\n\n**04.4 模拟post：服务器提交（攻击）**\n\n```js\nconst https = require('https')\nconst querystring = require('querystring')\n\nconst postData = querystring.stringify({\n  province: '上海',\n  city: '上海',\n  district: '宝山区',\n  address: '同济支路199号智慧七立方3号楼2-4层',\n  latitude: 43.0,\n  longitude: 160.0,\n  message: '求购一条小鱼',\n  contact: '13666666',\n  type: 'sell',\n  time: 1571217561\n})\n\nconst options = {\n  protocol: 'https:',\n  hostname: 'ik9hkddr.qcloud.la',\n  method: 'POST',\n  port: 443,\n  path: '/index.php/trade/add_item',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Content-Length': Buffer.byteLength(postData)\n  }\n}\n\nfunction doPost() {\n  let data\n\n  let req = https.request(options, (res) => {\n    res.on('data', chunk => data += chunk)\n    res.on('end', () => {\n      console.log(data)\n    })\n  })\n\n  req.write(postData)\n  req.end()\n}\n\n// setInterval(() => {\n//   doPost()\n// }, 1000)\n```\n\n\n\n**04.5 爬虫**\n\n```js\nconst https = require('https')\nconst http = require('http')\nconst cheerio = require('cheerio')\n\nhttp.createServer((request, response) => {\n  response.writeHead(200, {\n    'content-type': 'application/json;charset=utf-8'\n  })\n\n  const options = {\n    // protocol: 'https:',\n    hostname: 'i.maoyan.com',\n    port: 443,\n    path: '/',\n    method: 'GET'\n  }\n\n  const req = https.request(options, (res) => {\n    let data = ''\n    res.on('data', (chunk) => {\n      data += chunk\n    })\n\n    res.on('end', () => {\n      filterData(data)\n    })\n  })\n\n  function filterData(data) {\n    //   console.log(data)\n    let $ = cheerio.load(data)\n    let $movieList = $('.column.content')\n    console.log($movieList)\n    let movies = []\n    $movieList.each((index, value) => {\n      movies.push({\n        title: $(value).find('.movie-title .title').text(),\n        detail: $(value).find('.detail .actor').text(),\n      })\n    })\n\n    response.end(JSON.stringify(movies))\n  }\n\n  req.end()\n}).listen(3000)\n```\n\n###### \t05  event模块\n\n```js\nconst EventEmitter = require('events')\n\nclass MyEventEmitter extends EventEmitter {}\n\nconst event = new MyEventEmitter()\n\nevent.on('play', (movie) => {\n  console.log(movie)\n})\n\nevent.emit('play', '我和我的祖国')\nevent.emit('play', '中国机长')\n```\n\n###### \t06  fs文件操作模块\n\n```js\nconst fs = require('fs')\n\n// 创建文件夹\nfs.mkdir('./logs', (err) => {\n  console.log('done.')\n})\n\n// 文件夹改名\nfs.rename('./logs', './log', () => {\n  console.log('done')\n})\n\n// 删除文件夹\nfs.rmdir('./log', () => {\n  console.log('done.')\n})\n\n// 写内容到文件里\nfs.writeFile(\n  './logs/log1.txt',\n  'hello',\n  // 错误优先的回调函数\n  (err) => {\n    if (err) {\n      console.log(err.message)\n    } else {\n      console.log('文件创建成功')\n    }\n  }\n)\n\n// 给文件追加内容\nfs.appendFile('./logs/log1.txt', '\\nworld', () => {\n  console.log('done.')\n})\n\n// 读取文件内容\nfs.readFile('./logs/log1.txt', 'utf-8', (err, data) => {\n  console.log(data)\n})\n\n// 删除文件\nfs.unlink('./logs/log1.txt', (err) => {\n  console.log('done.')\n})\n\n// 批量写文件\nfor (var i = 0; i < 10; i++) {\n  fs.writeFile(`./logs/log-${i}.txt`, `log-${i}`, (err) => {\n    console.log('done.')\n  })\n}\n\n// 读取文件/目录信息\nfs.readdir('./', (err, data) => {\n  data.forEach((value, index) => {\n    fs.stat(`./${value}`, (err, stats) => {\n      // console.log(value + ':' + stats.size)\n      console.log(value + ' is ' + (stats.isDirectory() ? 'directory' : 'file'))\n    })\n  })\n})\n\n// 同步读取文件\ntry {\n  const content = fs.readFileSync('./logs/log-1.txt', 'utf-8')\n  console.log(content)\n  console.log(0)\n} catch (e) {\n  console.log(e.message)\n}\n\n// 异步读取文件：方法一\nfs.readFile('./logs/log-0.txt', 'utf-8', (err, content) => {\n  console.log(content)\n  console.log(0)\n})\nconsole.log(1)\n\n// 异步读取文件：方法二\nconst fs = require(\"fs\").promises\nfs.readFile('./logs/log-0.txt', 'utf-8').then(result => {\n  console.log(result)\n})\n\n```\n\n在`fs`模块中，提供同步方法是为了方便使用。那我们到底是应该用异步方法还是同步方法呢？\n\n由于Node环境执行的JavaScript代码是服务器端代码，所以，绝大部分需要在服务器运行期反复执行业务逻辑的代码，*必须使用异步代码*，否则，同步代码在执行时期，服务器将停止响应，因为JavaScript只有一个执行线程。\n\n服务器启动时如果需要读取配置文件，或者结束时需要写入到状态文件时，可以使用同步代码，因为这些代码只在启动和结束时执行一次，不影响服务器正常运行时的异步执行。\n\n###### \t07  stream流模块\n\n`stream`是Node.js提供的又一个仅在服务区端可用的模块，目的是支持“流”这种数据结构。\n\n什么是流？流是一种抽象的数据结构。想象水流，当在水管中流动时，就可以从某个地方（例如自来水厂）源源不断地到达另一个地方（比如你家的洗手池）。我们也可以把数据看成是数据流，比如你敲键盘的时候，就可以把每个字符依次连起来，看成字符流。这个流是从键盘输入到应用程序，实际上它还对应着一个名字：标准输入流（stdin）。\n\n![image-20220407085931744](%E7%AC%94%E8%AE%B0.assets/image-20220407085931744.png)\n\n如果应用程序把字符一个一个输出到显示器上，这也可以看成是一个流，这个流也有名字：标准输出流（stdout）。流的特点是数据是有序的，而且必须依次读取，或者依次写入，不能像Array那样随机定位。\n\n有些流用来读取数据，比如从文件读取数据时，可以打开一个文件流，然后从文件流中不断地读取数据。有些流用来写入数据，比如向文件写入数据时，只需要把数据不断地往文件流中写进去就可以了。\n\n在Node.js中，流也是一个对象，我们只需要响应流的事件就可以了：`data`事件表示流的数据已经可以读取了，`end`事件表示这个流已经到末尾了，没有数据可以读取了，`error`事件表示出错了。\n\n```js\nvar fs = require('fs');\n\n// 打开一个流:\nvar rs = fs.createReadStream('sample.txt', 'utf-8');\n\nrs.on('data', function (chunk) {\n    console.log('DATA:')\n    console.log(chunk);\n});\n\nrs.on('end', function () {\n    console.log('END');\n});\n\nrs.on('error', function (err) {\n    console.log('ERROR: ' + err);\n});\n\n```\n\n要注意，`data`事件可能会有多次，每次传递的`chunk`是流的一部分数据。\n\n要以流的形式写入文件，只需要不断调用`write()`方法，最后以`end()`结束：\n\n\n\n```js\nvar fs = require('fs');\n\nvar ws1 = fs.createWriteStream('output1.txt', 'utf-8');\nws1.write('使用Stream写入文本数据...\\n');\nws1.write('END.');\nws1.end();\n\n```\n\n`pipe` 就像可以把两个水管串成一个更长的水管一样，两个流也可以串起来。一个`Readable`流和一个`Writable`流串起来后，所有的数据自动从`Readable`流进入`Writable`流，这种操作叫`pipe`。\n\n在Node.js中，`Readable`流有一个`pipe()`方法，就是用来干这件事的。\n\n让我们用`pipe()`把一个文件流和另一个文件流串起来，这样源文件的所有数据就自动写入到目标文件里了，所以，这实际上是一个复制文件的程序：\n\n```js\nconst fs = require('fs')\n\nconst readstream = fs.createReadStream('./1.txt')\nconst writestream = fs.createWriteStream('./2.txt')\n\nreadstream.pipe(writestream)\n```\n\n###### 08 zlib\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220407105916114.png\" alt=\"image-20220407105916114\" style=\"zoom:50%;\" />\n\n```js\nconst fs = require('fs')\nconst zlib = require('zlib')\n\nconst gzip = zlib.createGzip()\n\nconst readstream = fs.createReadStream('./note.txt')\nconst writestream = fs.createWriteStream('./note2.txt')\n\nreadstream\n  .pipe(gzip)\n  .pipe(writestream)\n\n```\n\n###### 09 crypto\n\ncrypto模块的目的是为了提供通用的加密和哈希算法。用纯JavaScript代码实现这些功能不是不可能，但速度会非常慢。Nodejs用C/C++实现这些算法后，通过cypto这个模块暴露为JavaScript接口，这样用起来方便，运行速度也快。\n\nMD5是一种常用的哈希算法，用于给任意数据一个“签名”。这个签名通常用一个十六进制的字符串表示：\n\n```js\nconst crypto = require('crypto');\n\nconst hash = crypto.createHash('md5');\n\n// 可任意多次调用update():\nhash.update('Hello, world!');\nhash.update('Hello, nodejs!');\n\nconsole.log(hash.digest('hex')); \n\n```\n\n`update()`方法默认字符串编码为`UTF-8`，也可以传入Buffer。\n\n如果要计算SHA1，只需要把`'md5'`改成`'sha1'`，就可以得到SHA1的结果`1f32b9c9932c02227819a4151feed43e131aca40`。\n\nHmac算法也是一种哈希算法，它可以利用MD5或SHA1等哈希算法。不同的是，Hmac还需要一个密钥：\n\n```\nconst crypto = require('crypto');\n\nconst hmac = crypto.createHmac('sha256', 'secret-key');\n\nhmac.update('Hello, world!');\nhmac.update('Hello, nodejs!');\n\nconsole.log(hmac.digest('hex')); // 80f7e22570...\n\n```\n\n只要密钥发生了变化，那么同样的输入数据也会得到不同的签名，因此，可以把Hmac理解为用随机数“增强”的哈希算法。\n\n\n\nAES是一种常用的对称加密算法，加解密都用同一个密钥。crypto模块提供了AES支持，但是需要自己封装好函数，便于使用：\n\n```js\nconst crypto = require(\"crypto\");\n\nfunction encrypt (key, iv, data) {\n    let decipher = crypto.createCipheriv('aes-128-cbc', key, iv);\n    // decipher.setAutoPadding(true);\n    return decipher.update(data, 'binary', 'hex') + decipher.final('hex');\n}\n\nfunction decrypt (key, iv, crypted) {\n     crypted = Buffer.from(crypted, 'hex').toString('binary');\n     let decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n     return decipher.update(crypted, 'binary', 'utf8') + decipher.final('utf8');\n}\nkey,iv必须是16个字节\n\n```\n\n可以看出，加密后的字符串通过解密又得到了原始内容。\n\n##### 6.   路由\n\n###### \t01   基础\n\n```js\n/*\n * @作者: kerwin\n * @公众号: 大前端私房菜\n */\nvar fs = require(\"fs\")\nvar path = require(\"path\")\n\nfunction render(res, path) {\n    res.writeHead(200, { \"Content-Type\": \"text/html;charset=utf8\" })\n    res.write(fs.readFileSync(path, \"utf8\"))\n    res.end()\n}\n\n\nconst route = {\n    \"/login\": (req, res) => {\n        render(res, \"./static/login.html\")\n    },\n\n    \"/home\": (req, res) => {\n        render(res, \"./static/home.html\")\n    },\n    \"/404\": (req, res) => {\n        res.writeHead(404, { \"Content-Type\": \"text/html;charset=utf8\" })\n        res.write(fs.readFileSync(\"./static/404.html\", \"utf8\"))\n    }\n}\n\n\n```\n\n###### 02   获取参数\n\nget请求\n\n```js\n    \"/api/login\":(req,res)=>{\n        const myURL = new URL(req.url, 'http://127.0.0.1:3000');\n        console.log(myURL.searchParams.get(\"username\"))   \n        render(res,`{ok:1}`)\n    }\n```\n\npost请求\n\n```js\n\"/api/login\": (req, res) => {\n        var post = '';\n        // 通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中\n        req.on('data', function (chunk) {\n            post += chunk;\n        });\n\n        // 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。\n        req.on('end', function () {\n            post = JSON.parse(post);\n            render(res, `{ok:1}`)\n        });\n    }\n```\n\n\n\n###### 03   静态资源处理\n\n```js\nfunction readStaticFile(req, res) {\n    const myURL = new URL(req.url, 'http://127.0.0.1:3000')\n    var filePathname = path.join(__dirname, \"/static\", myURL.pathname);\n\n    if (fs.existsSync(filePathname)) {\n        // console.log(1111)\n        res.writeHead(200, { \"Content-Type\": `${mime.getType(myURL.pathname.split(\".\")[1])};charset=utf8` })\n        res.write(fs.readFileSync(filePathname, \"utf8\"))\n        res.end()\n        return true\n    } else {\n        return false\n    }\n}\n```\n\n#### 二、Express\n\n> https://www.expressjs.com.cn/\n\n基于 Node.js 平台，快速、开放、极简的 web 开发框架。\n\n##### 1.特色\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220411103139587.png\" alt=\"image-20220411103139587\" style=\"zoom: 50%;float:left;\" />\n\n##### 2.安装\n\n```js\n$ npm install express --save\n```\n\n##### 3.路由\n\n路由是指如何定义应用的端点（URIs）以及如何响应客户端的请求。\n\n路由是由一个 URI、HTTP 请求（GET、POST等）和若干个句柄组成，它的结构如下： app.METHOD(path, [callback...], callback)， app 是 express 对象的一个实例， METHOD 是一个 HTTP 请求方法， path 是服务器上的路径， callback 是当路由匹配时要执行的函数。\n\n下面是一个基本的路由示例：\n\n```js\nvar express = require('express');\nvar app = express();\n\n// respond with \"hello world\" when a GET request is made to the homepage\napp.get('/', function(req, res) {\n  res.send('hello world');\n});\n```\n\n路由路径和请求方法一起定义了请求的端点，它可以是字符串、字符串模式或者正则表达式。\n\n```js\n// 匹配根路径的请求\napp.get('/', function (req, res) {\n  res.send('root');\n});\n\n// 匹配 /about 路径的请求\napp.get('/about', function (req, res) {\n  res.send('about');\n});\n\n// 匹配 /random.text 路径的请求\napp.get('/random.text', function (req, res) {\n  res.send('random.text');\n});\n```\n\n使用字符串模式的路由路径示例：\n\n```js\n// 匹配 acd 和 abcd\napp.get('/ab?cd', function(req, res) {\n  res.send('ab?cd');\n});\n\n// 匹配 /ab/******\napp.get('/ab/:id', function(req, res) {\n  res.send('aaaaaaa');\n});\n\n// 匹配 abcd、abbcd、abbbcd等\napp.get('/ab+cd', function(req, res) {\n  res.send('ab+cd');\n});\n\n// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等\napp.get('/ab*cd', function(req, res) {\n  res.send('ab*cd');\n});\n\n// 匹配 /abe 和 /abcde\napp.get('/ab(cd)?e', function(req, res) {\n res.send('ab(cd)?e');\n});\n```\n\n使用正则表达式的路由路径示例：\n\n```js\n// 匹配任何路径中含有 a 的路径：\napp.get(/a/, function(req, res) {\n  res.send('/a/');\n});\n\n// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等\napp.get(/.*fly$/, function(req, res) {\n  res.send('/.*fly$/');\n});\n```\n\n可以为请求处理提供多个回调函数，其行为类似 中间件。唯一的区别是这些回调函数有可能调用 next('route') 方法而略过其他路由回调函数。可以利用该机制为路由定义前提条件，如果在现有路径上继续执行没有意义，则可将控制权交给剩下的路径。\n\n```js\napp.get('/example/a', function (req, res) {\n  res.send('Hello from A!');\n});\n```\n\n使用多个回调函数处理路由（记得指定 next 对象）：\n\n```js\napp.get('/example/b', function (req, res, next) {\n  console.log('response will be sent by the next function ...');\n  next();\n}, function (req, res) {\n  res.send('Hello from B!');\n});\n```\n\n\n\n使用回调函数数组处理路由：\n\n```js\nvar cb0 = function (req, res, next) {\n  console.log('CB0')\n  next()\n}\n\nvar cb1 = function (req, res, next) {\n  console.log('CB1')\n  next()\n}\n\nvar cb2 = function (req, res) {\n  res.send('Hello from C!')\n}\n\napp.get('/example/c', [cb0, cb1, cb2])\n```\n\n混合使用函数和函数数组处理路由：\n\n```js\nvar cb0 = function (req, res, next) {\n  console.log('CB0')\n  next()\n}\n\nvar cb1 = function (req, res, next) {\n  console.log('CB1')\n  next()\n}\n\napp.get('/example/d', [cb0, cb1], function (req, res, next) {\n  console.log('response will be sent by the next function ...')\n  next()\n}, function (req, res) {\n  res.send('Hello from D!')\n})\n```\n\n##### 4.中间件\n\nExpress 是一个自身功能极简，完全是由路由和中间件构成一个的 web 开发框架：从本质上来说，一个 Express 应用就是在调用各种中间件。\n\n中间件（Middleware） 是一个函数，它可以访问请求对象（request object (req)）, 响应对象（response object (res)）, 和 web 应用中处于请求-响应循环流程中的中间件，一般被命名为 next 的变量。\n\n中间件的功能包括：\n\n- 执行任何代码。\n- 修改请求和响应对象。\n- 终结请求-响应循环。\n- 调用堆栈中的下一个中间件。\n\n如果当前中间件没有终结请求-响应循环，则必须调用 next() 方法将控制权交给下一个中间件，否则请求就会挂起。\n\nExpress 应用可使用如下几种中间件：\n\n- 应用级中间件\n- 路由级中间件\n- 错误处理中间件\n- 内置中间件\n- 第三方中间件\n\n使用可选则挂载路径，可在应用级别或路由级别装载中间件。另外，你还可以同时装在一系列中间件函数，从而在一个挂载点上创建一个子中间件栈。\n\n###### （1）应用级中间件\n\n应用级中间件绑定到 app 对象 使用 app.use() 和 app.METHOD()， 其中， METHOD 是需要处理的 HTTP 请求的方法，例如 GET, PUT, POST 等等，全部小写。例如：\n\n```js\nvar app = express()\n\n// 没有挂载路径的中间件，应用的每个请求都会执行该中间件\napp.use(function (req, res, next) {\n  console.log('Time:', Date.now())\n  next()\n})\n\n```\n\n###### （2）路由级中间件\n\n路由级中间件和应用级中间件一样，只是它绑定的对象为 express.Router()。\n\n```js\nvar router = express.Router()\n```\n\n```js\nvar app = express()\nvar router = express.Router()\n\n// 没有挂载路径的中间件，通过该路由的每个请求都会执行该中间件\nrouter.use(function (req, res, next) {\n  console.log('Time:', Date.now())\n  next()\n})\n\n// 一个中间件栈，显示任何指向 /user/:id 的 HTTP 请求的信息\nrouter.use('/user/:id', function(req, res, next) {\n  console.log('Request URL:', req.originalUrl)\n  next()\n}, function (req, res, next) {\n  console.log('Request Type:', req.method)\n  next()\n})\n\n// 一个中间件栈，处理指向 /user/:id 的 GET 请求\nrouter.get('/user/:id', function (req, res, next) {\n  // 如果 user id 为 0, 跳到下一个路由\n  if (req.params.id == 0) next('route')\n  // 负责将控制权交给栈中下一个中间件\n  else next() //\n}, function (req, res, next) {\n  // 渲染常规页面\n  res.render('regular')\n})\n\n// 处理 /user/:id， 渲染一个特殊页面\nrouter.get('/user/:id', function (req, res, next) {\n  console.log(req.params.id)\n  res.render('special')\n})\n\n// 将路由挂载至应用\napp.use('/', router)\n```\n\n###### （3）错误处理中间件\n\n错误处理中间件和其他中间件定义类似，只是要使用 4 个参数，而不是 3 个，其签名如下： (err, req, res, next)。\n\n```js\napp.use(function(err, req, res, next) {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n```\n\n###### （4）内置的中间件\n\nexpress.static 是 Express 唯一内置的中间件。它基于 serve-static，负责在 Express 应用中提托管静态资源。每个应用可有多个静态目录。\n\n```js\napp.use(express.static('public'))\napp.use(express.static('uploads'))\napp.use(express.static('files'))\n```\n\n###### （5）第三方中间件\n\n安装所需功能的 node 模块，并在应用中加载，可以在应用级加载，也可以在路由级加载。\n\n下面的例子安装并加载了一个解析 cookie 的中间件： cookie-parser\n\n```\n$ npm install cookie-parser\n```\n\n```js\nvar express = require('express')\nvar app = express()\nvar cookieParser = require('cookie-parser')\n\n// 加载用于解析 cookie 的中间件\napp.use(cookieParser())\n```\n\n\n\n##### 5. 获取请求参数\n\nget\n\n```js\nreq.query\n```\n\npost\n\n```js\napp.use(express.urlencoded({extended:false}))\napp.use(express.json())\nreq.body\n```\n\n\n\n##### 6.利用 Express 托管静态文件\n\n通过 Express 内置的 express.static 可以方便地托管静态文件，例如图片、CSS、JavaScript 文件等。\n\n将静态资源文件所在的目录作为参数传递给 express.static 中间件就可以提供静态资源文件的访问了。例如，假设在 public 目录放置了图片、CSS 和 JavaScript 文件，你就可以：\n\n```js\napp.use(express.static('public'))\n```\n\n现在，public 目录下面的文件就可以访问了。\n\n```js\nhttp://localhost:3000/images/kitten.jpg\nhttp://localhost:3000/css/style.css\nhttp://localhost:3000/js/app.js\nhttp://localhost:3000/images/bg.png\nhttp://localhost:3000/hello.html\n```\n\n> 所有文件的路径都是相对于存放目录的，因此，存放静态文件的目录名不会出现在 URL 中。\n\n如果你的静态资源存放在多个目录下面，你可以多次调用 express.static 中间件：\n\n```js\napp.use(express.static('public'))\napp.use(express.static('files'))\n```\n\n访问静态资源文件时，express.static 中间件会根据目录添加的顺序查找所需的文件。\n\n如果你希望所有通过 express.static 访问的文件都存放在一个“虚拟（virtual）”目录（即目录根本不存在）下面，可以通过为静态资源目录指定一个挂载路径的方式来实现，如下所示：\n\n```\napp.use('/static', express.static('public'))\n```\n\n现在，你就可以通过带有 “/static” 前缀的地址来访问 public 目录下面的文件了。\n\n```js\nhttp://localhost:3000/static/images/kitten.jpg\nhttp://localhost:3000/static/css/style.css\nhttp://localhost:3000/static/js/app.js\nhttp://localhost:3000/static/images/bg.png\nhttp://localhost:3000/static/hello.html\n```\n\n##### 7.服务端渲染（模板引擎）\n\n```js\nnpm i ejs\n```\n\n需要在应用中进行如下设置才能让 Express 渲染模板文件：\n\n- views, 放模板文件的目录，比如： app.set('views', './views')\n- view engine, 模板引擎，比如： app.set('view engine', 'ejs')\n\n<b>ejs模板用法</b>\n- <%  %> 流程控制标签（写的是if else ，for）\n- <%= %> 输出标签（原文输出HTML标签）\n- <%- %> 输出标签（HTML会被浏览器解析）\n- <%# %> 注释标签\n- <%- include('user/show',{user:user}) %> 导入公共的模板内容\n\n##### 8.express项目生成器\n- 下载依赖项目：```$ npm i express-generator -g ```\n- 创建项目：```$ express [项目名] --view=[视图类型] ```\n- 下载依赖：```$ npm i ```\n- 内部代码解读： \n```\n1.bin/www :该文件为启动目录\n2.app.js文件解读：\n      var createError = require('http-errors');//错误信息提示\n      var cookieParser = require('cookie-parser');//后端获取设置cookie值\n      var logger = require('morgan'); //后端终端显示端口等日志\n ```\n#### 三、MongoDB\n\n##### 1.MongoDB数据库\n简单介绍一下MongoDB：\n传统的关系数据库（如mysql）一般由数据库（database）、表（table）、记录（record）三个层次概念组成，\nMongoDB是由数据库（database）、集合（collection）、文档对象（document）三个层次组成。\nMongoDB稳定\nMongoDB支持索引，索引放在内存中，能够提升随机读写的性能。如果索引不能完全放在内存，一旦出现随机读写比较高的时候，就会频繁地进行磁盘交换，MongoDB的性能就会急剧下降\nMongoDB占用的空间很大，因为它属于典型空间换时间原则的类型。那么它的磁盘空间比普通数据库会浪费一些\n\n##### 2.安装数据库\n\nhttps://docs.mongodb.com/manual/administration/install-community/\n\n##### 3.启动数据库\n\n###### （1）windows\n\n```s\nmongod --dbpath d:/data/db\nmongo\n```\n\n###### （2）mac\n\n```s\nmongod --config /usr/local/etc/mongod.conf\nmongo\n```\n\n##### 4.在命令行中操作数据库\n```\n//常规数据库操作\n(1)Help查看命令提示 \n\thelp    db.help()  db.test.help()  db.test.find().help()\n(2)创建/切换数据库\n\tuse music \n(3)查询数据库\n\tshow dbs\n(4)查看当前使用的数据库\n\tdb/db.getName()\n(5)显示当前DB状态\n\tdb.stats()\n(6)查看当前DB版本\n\tdb.version()\n(7)查看当前DB的链接机器地址\n\tdb.getMongo()\n(8)删除数据库\n\tdb.dropDatabase()\n//常规集合操作\n(1)创建一个集合\n\tdb.createCollection(\"collName\",{size:xx,capped:true,max:xx})\n // collName:名称 size:集合大小 capped:固定大小 max:最大存储空间\n(2)得到指定名称的集合\n\tdb.getCollection(\"account\")\n(3)得到当前所有的集合\n\tdb.getCollectionNames()\n(4)显示当前db所有集合的状态\n\tdb.printCollectionStats()\n(5)删除集合\n\tdb.users(集合名称).drop() \n//集合增删改查(以users集合为例)\n(1)添加\n\tdb.users.save([{name:'pan',age:21},name:'zhang',age:20])\n(2)删除\n\tdb.users.remove({age:20}) //删除一条带有age:20的数据\n\tdb.users.remove({}) //删除所有数据\n(3)修改\n\tdb.users.update({name:'pan'},{age:29})\n \t//找到一条是name:pan的数据将这一条数据替换成age:29\n\tdb.users.update({name:'pan'},{$set:{age:29}})\n \t//找到一条是name:pan的数据将这一条数据中age替换成29\n \tdb.users.update({name:'pan'},{$inc:{age:29}})\n \t//找到一条是name:pan的数据将这一条数据中age增加29(数据可为负数)\n(4)查询\n\t- 查询所有记录\n    db.users.find()\n   - 查询age=29的数据\n    db.users.find({age:29})\n   - 查询age>29的数据\n    db.users.find(age:{$gt:29})\n   - 查询age>=29的数据\n    db.users.find(age:{$gte:29})\n   - 查询age<30的数据\n    db.users.find(age:{$lt:30})\n   - 查询age<=30的数据\n    db.users.find(age:{$lte:30})\n   - 查询29<=age<=30的数据\n    db.users.find(age:{$gle:29,$lte:30})\n   - 模糊查询\n    db.users.find(name:/pan/) //注：name后面参数为正则\n   - 查询指定数据\n    db.users.find({},{name:1,age:1,_id:0})\n    //第一个参数表示查询条件\n    //第二个参数中1表示显示，0表示不显示\n   -按照年龄排序\n   \t db.users.find({}).sort({age:1})\n    // 1表示升序，-1表示降序\n   - 查询第n页m条数据\n   \t db.users.find({}).skip((n-1)*m).limit(m)\n   - 或者条件查询\n    db.users.find({$or:[{age:12},{age:20}]})\n    // 查询age:12或者age:20的所有每条数据\n   - 查询第一条数据\n   db.users.findOne()\n   - 查询某个结果记录条数\n   db.users.find().count()\n```\n\n##### 5.可视化工具进行增删改查\n\nRobomongo Robo3T adminMongo\n\n![image-20220413091031852](%E7%AC%94%E8%AE%B0.assets/image-20220413091031852.png)\n\n##### 6.nodejs连接操作数据库\n\n连接数据库\n\n```js\nconst mongoose = require(\"mongoose\")\n\nmongoose.connect(\"mongodb://127.0.0.1:27017/company-system\")\n```\n\n创建模型\n\n```js\nconst mongoose = require(\"mongoose\")\n\nconst Schema = mongoose.Schema\n\nconst UserType = {\n    username:String,\n    password:String,\n    gender:Number,\n    introduction:String,\n    avatar:String,\n    role:Number\n}\nconst UserModel = mongoose.model(\"user\",new Schema(UserType))\nmodule.exports  = UserModel \n```\n\n增加数据\n\n```js\nUserModel.create({\n    introduction,username,gender,avatar,password,role\n})\n```\n\n查询数据\n\n```js\nUserModel.find({username:\"kerwin\"},[\"username\",\"role\",\"introduction\",\"password\"]).sort({createTime:-1}).skip(10).limit(10)\n```\n\n更新数据\n\n```js\nUserModel.updateOne({\n    _id\n},{\n    introduction,username,gender,avatar\n})\n```\n\n删除数据\n\n```js\nUserModel.deleteOne({_id})\n```\n\n#### 四、接口规范与业务分层\n\n##### 1.接口规范\n###### RESTful架构\n> 服务器上每一种资源，比如一个文件，一张图片，一部电影，都有对应的地址，如果我们的客户端需要对服务器上的这个资源进行操作，就需要通过http西医执行相应的动作来操作它，比如进行获取、更新、删除\n\n简单来说就是**url中只包含名词表示资源，使用http动词表示动作进行操作资源**，举个例子左边错误，右边正确\n```\nGET /blog/getname --> GET /blog/name 获取所有文章\nGET /blog/addname --> POST /blog/name 添加一篇文章\nGET /blog/editname --> PUT /blog/name 添加一篇文章\nGET /blog/delname?id=1 --> DELETE /blog/name/1 删除一篇文章\n```\n> 使用方式\n```\nGET http://xxx/api/user    #获取列表\nPOST http://xxx/api/user   #创建列表\nPUT http://xxx/api/user/{id}    #修改用户信息\nDELETE http://xxx/api/user/{id}  #删除用户信息\n```\n> 过滤信息\n```\n用于补充规范一些通用字段\n?limit=10 #指定返回记录的数量\n?offset=10 #指定烦货柜记录的开始位置\n?page=2&per_page=100 #指定第几页，以及每页的记录数\n?sortby=name&order=asc #指定返回结果按照那个属性排序，以及排序顺序\n?state=close #指定筛选条件\n```\n##### 2.业务分层\n```\nrouter.js:负责请求分发给C层\ncontroller.js:C层负责处理业务逻辑（V与M之间的沟通）\nviews:V层:负责展示页面\nmodel:M层:负责处理数据（增删改查）\n```\n\n\n#### 五、登录鉴权\n\n##### 1. Cookie&Session\n\n「HTTP 无状态」**我们知道，HTTP 是无状态的。也就是说，HTTP 请求方和响应方间无法维护状态，都是一次性的，它不知道前后的请求都发生了什么。但有的场景下，我们需要维护状态。最典型的，一个用户登陆微博，发布、关注、评论，都应是在登录后的用户状态下的。**「标记」那解决办法是什么呢？!\n\n\n\n```js\nconst express = require(\"express\");\nconst session = require(\"express-session\");\nconst MongoStore = require(\"connect-mongo\");\nconst app = express();\n\n\napp.use(\n  session({\n    secret: \"this is session\", // 服务器生成 session 的签名\n    resave: true, \n    saveUninitialized: true, //强制将为初始化的 session 存储\n    cookie: {\n      maxAge: 1000 * 60 * 10,// 过期时间\n      secure: false, // 为 true 时候表示只有 https 协议才能访问cookie\n    },\n    rolling: true, //为 true 表示 超时前刷新，cookie 会重新计时； 为 false 表示在超时前刷新多少次，都是按照第一次刷新开始计时。\n    store: MongoStore.create({\n      mongoUrl: 'mongodb://127.0.0.1:27017/kerwin_session',\n      ttl: 1000 * 60 * 10 // 过期时间\n  }),\n\n  })\n);\n\napp.use((req,res,next)=>{\n  if(req.url===\"/login\"){\n    next()\n    return;\n  }\n  if(req.session.user){\n      req.session.garbage = Date();\n      next();\n  }else{\n   \t  res.redirect(\"/login\")   \n  }\n})\n\n```\n\n\n\n##### 2. JSON Web Token (JWT) \n\n###### （1）介绍\n\n\n\n我为什么要保存这可恶的session呢， 只让每个客户端去保存该多好？\n\n\n\n当然， 如果一个人的token 被别人偷走了， 那我也没办法， 我也会认为小偷就是合法用户， 这其实和一个人的session id 被别人偷走是一样的。\n\n这样一来， 我就不保存session id 了， 我只是生成token , 然后验证token ， 我用我的CPU计算时间获取了我的session 存储空间 ！\n\n解除了session id这个负担， 可以说是无事一身轻， 我的机器集群现在可以轻松地做水平扩展， 用户访问量增大， 直接加机器就行。 这种无状态的感觉实在是太好了！\n\n缺点：\n\n> 1. 占带宽，正常情况下要比 session_id 更大，需要消耗更多流量，挤占更多带宽，假如你的网站每月有 10 万次的浏览器，就意味着要多开销几十兆的流量。听起来并不多，但日积月累也是不小一笔开销。实际上，许多人会在 JWT 中存储的信息会更多；\n> 2. 无法在服务端注销，那么久很难解决劫持问题；\n> 3. 性能问题，JWT 的卖点之一就是加密签名，由于这个特性，接收方得以验证 JWT 是否有效且被信任。对于有着严格性能要求的 Web 应用，这并不理想，尤其对于单线程环境。\n\n注意：\n\n> CSRF攻击的原因是浏览器会自动带上cookie，而不会带上token；\n>\n> 以CSRF攻击为例：\n>\n> cookie：用户点击了链接，cookie未失效，导致发起请求后后端以为是用户正常操作，于是进行扣款操作；\n> token：用户点击链接，由于浏览器不会自动带上token，所以即使发了请求，后端的token验证不会通过，所以不会进行扣款操作；\n\n###### （2）实现\n\n```js\n//jsonwebtoken 封装\nconst jsonwebtoken = require(\"jsonwebtoken\")\nconst secret = \"kerwin\"\nconst JWT = {\n    generate(value,exprires){\n        return jsonwebtoken.sign(value,secret,{expiresIn:exprires})\n    },\n    verify(token){\n        try{\n            return jsonwebtoken.verify(token,secret)\n        }catch(e){\n            return false\n        }\n    }\n}\n\nmodule.exports = JWT\n```\n\n\n\n```js\n//node中间件校验\napp.use((req,res,next)=>{\n  // 如果token有效 ,next() \n  // 如果token过期了, 返回401错误\n  if(req.url===\"/login\"){\n    next()\n    return;\n  }\n\n  const token = req.headers[\"authorization\"].split(\" \")[1]\n  if(token){\n    var payload = JWT.verify(token)\n    // console.log(payload)\n    if(payload){\n      const newToken = JWT.generate({\n        _id:payload._id,\n        username:payload.username\n      },\"1d\")\n      res.header(\"Authorization\",newToken)\n      next()\n    }else{\n      res.status(401).send({errCode:\"-1\",errorInfo:\"token过期\"})\n    }\n  }\n})\n\n```\n\n```js\n //生成token\nconst token = JWT.generate({\n    _id: result[0]._id,\n    username: result[0].username\n}, \"1d\")\n\nres.header(\"Authorization\", token)\n```\n\n```js\n//前端拦截\n/*\n * @作者: kerwin\n * @公众号: 大前端私房菜\n */\nimport axios from 'axios'\n// Add a request interceptor\naxios.interceptors.request.use(function (config) {\n    const token = localStorage.getItem(\"token\")\n    config.headers.Authorization = `Bearer ${token}`\n\n    return config;\n  }, function (error) {\n    return Promise.reject(error);\n  });\n\n// Add a response interceptor\naxios.interceptors.response.use(function (response) {\n\n    const {authorization } = response.headers\n    authorization && localStorage.setItem(\"token\",authorization)\n    return response;\n  }, function (error) {\n\n    const {status} = error.response\n    if(status===401){\n        localStorage.removeItem(\"token\")\n        window.location.href=\"/login\"\n    }\n    return Promise.reject(error);\n  });\n\n```\n\n#### 六、文件上传管理\n\nMulter 是一个 node.js 中间件，用于处理 `multipart/form-data` 类型的表单数据，它主要用于上传文件。\n\n**注意**: Multer 不会处理任何非 `multipart/form-data` 类型的表单数据。\n\n```\nnpm install --save multer\n```\n\n```js\n//前后端分离-前端\n\nconst params = new FormData()\nparams.append('kerwinfile', file.file)\nparams.append('username', this.username)\nconst config = {\n\theaders: {\n\t\t\"Content-Type\":\"multipart/form-data\"\n\t}\n}\nhttp.post('/api/upload', params, config).then(res => {\n\tthis.imgpath = 'http://localhost:3000' + res.data\n})\t\n```\n\nMulter 会添加一个 `body` 对象 以及 `file` 或 `files` 对象 到 express 的 `request` 对象中。 `body` 对象包含表单的文本域信息，`file` 或 `files` 对象包含对象表单上传的文件信息。\n\n```js\n\n//前后端分离-后端\nrouter.post('/upload', upload.single('kerwinfile'),function(req, res, next) {\n\tconsole.log(req.file)\n})\n```\n\n#### 七、APIDOC - API 文档生成工具\n\napidoc 是一个简单的 RESTful API 文档生成工具，它从代码注释中提取特定格式的内容生成文档。支持诸如 Go、Java、C++、Rust 等大部分开发语言，具体可使用 `apidoc lang` 命令行查看所有的支持列表。\n\napidoc 拥有以下特点：\n\n1. 跨平台，linux、windows、macOS 等都支持；\n2. 支持语言广泛，即使是不支持，也很方便扩展；\n3. 支持多个不同语言的多个项目生成一份文档；\n4. 输出模板可自定义；\n5. 根据文档生成 mock 数据；\n\n```\nnpm install -g apidoc\n```\n\n\n注意：\n\n(1) 在当前文件夹下 apidoc.json\n\n```json\n{\n\t\"name\": \"****接口文档\",\n\t\"version\": \"1.0.0\",\n\t\"description\": \"关于****的接口文档描述\",\n\t\"title\": \"****\"\n}\n```\n\n（2）可以利用vscode apidoc snippets 插件创建api\n#### 八、Koa2\n\n\n##### 1.简介\n\nkoa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。使用 koa 编写 web 应用，通过组合不同的 generator，可以免除重复繁琐的回调函数嵌套，并极大地提升错误处理的效率。koa 不在内核方法中绑定任何中间件，它仅仅提供了一个轻量优雅的函数库，使得编写 Web 应用变得得心应手。\n\n##### 2. 快速开始\n\n###### 2.1 安装koa2\n\n```s\n# 初始化package.json\nnpm init\n\n# 安装koa2 \nnpm install koa\n```\n\n###### 2.2 hello world 代码\n\n```js\nconst Koa = require('koa')\nconst app = new Koa()\n\napp.use( async ( ctx ) => {\n  ctx.body = 'hello koa2' //json数据\n})\n\napp.listen(3000)\n\n```\n```\nctx.req\nNode 的 request对象.\nctx.res\nNode的 response对象.\n绕过Koa的response 处理是不被支持的.应避免使用以下node 属性:\nres.statusCode()\nres.WiiteHead()\nres.Write()\nres.end()\n\n\nctx.request\nkoa的 Request对象.\nctx.response\nkoa的 Response对象.\n以下访问器和Request别名等效:\nctx. header\nctx. headers\nctx.method\n ctx. method=\nctx.url\n ctx.url=\nctx. originalUrl\nctx.origin\nctx. href\n ctx. path\nctx. path=\n ctx. query\nctx. query=\nctx. querystring\n ctx. querystring=\nctx. host\nct.x.hostname\n以下访问器和Response 别名等效:\nctx.body\nctx.body=\nctx.status\nctx.status=\nctx.message\nctx.message=\nctx.length=\nctx.length\nctx.type=\nctx.type\nctx.headerSent\nctx.redirect()\nctx.attachment()\nctx.set()\nctx.append ()\nctx.remove ()\nctx.lastModified=\nctx.etag=\n```\n\n\n###### 2.3 启动demo\n\n```s\nnode index.js\n```\n\n##### 3. koa vs express\n\n通常都会说 Koa 是洋葱模型，这重点在于中间件的设计。但是按照上面的分析，会发现 Express 也是类似的，不同的是Express 中间件机制使用了 Callback 实现，这样如果出现异步则可能会使你在执行顺序上感到困惑，因此如果我们想做接口耗时统计、错误处理 Koa 的这种中间件模式处理起来更方便些。最后一点响应机制也很重要，Koa 不是立即响应，是整个中间件处理完成在最外层进行了响应，而 Express 则是立即响应。\n\n###### 3.1更轻量\n\n- koa 不提供内置的中间件；\n- koa 不提供路由，而是把路由这个库分离出来了（koa/router）\n\n###### 3.2 Context对象\n\nkoa增加了一个Context的对象，作为这次请求的上下文对象（在koa2中作为中间件的第一个参数传入）。同时Context上也挂载了Request和Response两个对象。和Express类似，这两个对象都提供了大量的便捷方法辅助开发, 这样的话对于在保存一些公有的参数的话变得更加合情合理\n\n###### 3.3 异步流程控制\n\n​    express采用callback来处理异步，    koa v1采用generator，koa v2 采用async/await。\n\n​\tgenerator和async/await使用同步的写法来处理异步，明显好于callback和promise，\n\n###### 3.4 中间件模型\n\n​\texpress基于connect中间件，线性模型；\n\n​     koa中间件采用洋葱模型（对于每个中间件，在完成了一些事情后，可以非常优雅的将控制权传递给下一个中间件，并能够等待它完成，当后续的中间件完成处理后，控制权又回到了自己）\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417083817823.png\" alt=\"image-20220417083817823\" style=\"zoom:50%;float:left;\" />\n\n   ![image-20220417085913567](%E7%AC%94%E8%AE%B0.assets/image-20220417085913567.png)\n\n```js\n//同步\nvar express = require(\"express\")\nvar app = express()\n\napp.use((req,res,next)=>{\n    console.log(1)\n    next()\n    console.log(4)\n    res.send(\"hello\")\n})\napp.use(()=>{\n    console.log(3)\n})\n\napp.listen(3000)\n//异步\nvar express = require(\"express\")\nvar app = express()\n\napp.use(async (req,res,next)=>{\n    console.log(1)\n    await next()\n    console.log(4)\n    res.send(\"hello\")\n})\napp.use(async ()=>{\n    console.log(2)\n    await delay(1)\n    console.log(3)\n})\n\nfunction delay(time){\n return new Promise((resolve,reject)=>{\n    setTimeout(resolve,1000)\n })\n}\n```\n\n```js\n//同步\nvar koa = require(\"koa\")\nvar app = new koa()\n\napp.use((ctx,next)=>{\n    console.log(1)\n    next()\n    console.log(4)\n    ctx.body=\"hello\"\n})\napp.use(()=>{\n    console.log(3)\n})\n\napp.listen(3000)\n\n//异步\nvar koa = require(\"koa\")\nvar app = new koa()\n\napp.use(async (ctx,next)=>{\n    console.log(1)\n    await next()\n    console.log(4)\n    ctx.body=\"hello\"\n}) \napp.use(async ()=>{\n    console.log(2)\n    await delay(1)\n    console.log(3)\n})\n\nfunction delay(time){\n return new Promise((resolve,reject)=>{\n    setTimeout(resolve,1000)\n })\n}\n\napp.listen(3000)\n```\n\n ##### 4. 路由\n\n###### 4.1基本用发\n\n```js\nvar Koa = require(\"koa\")\nvar Router = require(\"koa-router\")\n\nvar app = new Koa()\nvar router = new Router()\n\nrouter.post(\"/list\",(ctx)=>{\n    ctx.body=[\"111\",\"222\",\"333\"]\n})\napp.use(router.routes()).use(router.allowedMethods())\napp.listen(3000)\n```\n\n\n\n###### 4.2 router.allowedMethods作用\n\n![image-20220417102845079](%E7%AC%94%E8%AE%B0.assets/image-20220417102845079.png)\n\n###### 4.3 请求方式\n\nKoa-router 请求方式： `get` 、 `put` 、 `post` 、 `patch` 、 `delete` 、 `del`  ，而使用方法就是 `router.方式()`  ，比如 `router.get()` 和 `router.post()` 。而 `router.all()` 会匹配所有的请求方法。\n\n```js\nvar Koa = require(\"koa\")\nvar Router = require(\"koa-router\")\n\nvar app = new Koa()\nvar router = new Router()\n\nrouter.get(\"/user\",(ctx)=>{\n    ctx.body=[\"aaa\",\"bbb\",\"ccc\"]\n})\n.put(\"/user/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"user update\"}\n})\n.post(\"/user\",(ctx)=>{\n    ctx.body={ok:1,info:\"user post\"}\n})\n.del(\"/user/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"user del\"}\n})\n\n\napp.use(router.routes()).use(router.allowedMethods())\napp.listen(3000)\n```\n\n###### 4.4 拆分路由\n\nlist.js\n\n```js\nvar Router = require(\"koa-router\")\nvar router = new Router()\nrouter.get(\"/\",(ctx)=>{\n    ctx.body=[\"111\",\"222\",\"333\"]\n})\n.put(\"/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"list update\"}\n})\n.post(\"/\",(ctx)=>{\n    ctx.body={ok:1,info:\"list post\"}\n})\n.del(\"/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"list del\"}\n})\nmodule.exports = router\n```\n\nindex.js\n\n```js\nvar Router = require(\"koa-router\")\nvar router = new Router()\nvar user = require(\"./user\")\nvar list = require(\"./list\")\nrouter.use('/user', user.routes(), user.allowedMethods())\nrouter.use('/list', list.routes(), list.allowedMethods())\n\nmodule.exports = router\n```\n\nentry入口\n\n```js\nvar Koa = require(\"koa\")\nvar router = require(\"./router/index\")\n\nvar app = new Koa()\napp.use(router.routes()).use(router.allowedMethods())\napp.listen(3000)\n```\n\n\n\n###### 4.5 路由前缀\n\n```js\nrouter.prefix('/api')\n```\n\n\n\n###### 4.6 路由重定向\n\n```js\nrouter.get(\"/home\",(ctx)=>{\n    ctx.body=\"home页面\"\n})\n//写法1 \nrouter.redirect('/', '/home');\n//写法2\nrouter.get(\"/\",(ctx)=>{\n    ctx.redirect(\"/home\")\n})\n```\n\n##### 5.  静态资源\n\n```js\nconst Koa = require('koa')\nconst path = require('path')\nconst static = require('koa-static')\n\nconst app = new Koa()\n\napp.use(static(\n  path.join( __dirname,  \"public\")\n))\n\n\napp.use( async ( ctx ) => {\n  ctx.body = 'hello world'\n})\n\napp.listen(3000, () => {\n  console.log('[demo] static-use-middleware is starting at port 3000')\n})\n\n```\n\n\n\n##### 6.  获取请求参数\n\n###### 6.1get参数\n\n在koa中，获取GET请求数据源头是koa中request对象中的query方法或querystring方法，query返回是格式化好的参数对象，querystring返回的是请求字符串，由于ctx对request的API有直接引用的方式，所以获取GET请求数据有两个途径。\n\n- 是从上下文中直接获取 请求对象ctx.query，返回如 { a:1, b:2 } 请求字符串 ctx.querystring，返回如 a=1&b=2\n- 是从上下文的request对象中获取 请求对象ctx.request.query，返回如 { a:1, b:2 } 请求字符串 ctx.request.querystring，返回如 a=1&b=2\n\n###### 6.2post参数\n\n对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文的formData数据解析到ctx.request.body中\n\n```js\nconst bodyParser = require('koa-bodyparser')\n\n// 使用ctx.body解析中间件\napp.use(bodyParser())\n\n```\n\n\n\n##### 7. ejs模板\n\n###### 7.1 安装模块\n\n```js\n# 安装koa模板使用中间件\nnpm install --save koa-views\n\n# 安装ejs模板引擎\nnpm install --save ejs\n\n```\n\n###### 7.2 使用模板引擎\n\n**文件目录**\n\n```\n├── package.json\n├── index.js\n└── view\n    └── index.ejs\n```\n\n**./index.js文件**\n\n```js\nconst Koa = require('koa')\nconst views = require('koa-views')\nconst path = require('path')\nconst app = new Koa()\n\n// 加载模板引擎\napp.use(views(path.join(__dirname, './view'), {\n  extension: 'ejs'\n}))\n\napp.use( async ( ctx ) => {\n  let title = 'hello koa2'\n  await ctx.render('index', {\n    title,\n  })\n})\n\napp.listen(3000)\n```\n\n**./view/index.ejs 模板**\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title><%= title %></title>\n</head>\n<body>\n    <h1><%= title %></h1>\n    <p>EJS Welcome to <%= title %></p>\n</body>\n</html>\n```\n\n\n\n##### 8. cookie&session\n\n###### 8.1 cookie\n\nkoa提供了从上下文直接读取、写入cookie的方法\n\n- ctx.cookies.get(name, [options]) 读取上下文请求中的cookie\n- ctx.cookies.set(name, value, [options]) 在上下文中写入cookie\n\n###### 8.2 session\n\n- koa-session-minimal 适用于koa2 的session中间件，提供存储介质的读写接口 。\n\n   ```js\n   const session = require('koa-session-minimal')\n   app.use(session({\n       key: 'SESSION_ID',\n       cookie: {\n           maxAge:1000*60\n       }\n   }))\n   ```\n\n   \n\n   ```js\n   app.use(async (ctx, next) => {\n       //排除login相关的路由和接口\n       if (ctx.url.includes(\"login\")) {\n           await next()\n           return\n       }\n   \n       if (ctx.session.user) {\n           //重新设置以下sesssion\n           ctx.session.mydate = Date.now()\n           await next()\n       } else {\n   \n           ctx.redirect(\"/login\")\n       }\n   })\n   ```\n##### 9. JWT\n\n   ```js\napp.use(async(ctx, next) => {\n    //排除login相关的路由和接口\n    if (ctx.url.includes(\"login\")) {\n        await next()\n        return\n    }\n    const token = ctx.headers[\"authorization\"]?.split(\" \")[1]\n    // console.log(req.headers[\"authorization\"])\n    if(token){\n        const payload=  JWT.verify(token)\n        if(payload){\n            //重新计算token过期时间\n            const newToken = JWT.generate({\n                _id:payload._id,\n                username:payload.username\n            },\"10s\")\n\n            ctx.set(\"Authorization\",newToken)\n            await next()\n        }else{\n            ctx.status = 401\n            ctx.body = {errCode:-1,errInfo:\"token过期\"}\n        }\n    }else{\n        await next()\n    }\n})\n   ```\n\n#####    \n\n##### 10.上传文件\n\n> https://www.npmjs.com/package/@koa/multer\n\n```js\nnpm install --save @koa/multer multer\n```\n\n```js\nconst multer = require('@koa/multer');\nconst upload = multer({ dest: 'public/uploads/' })\n\nrouter.post(\"/\",upload.single('avatar'),\n(ctx,next)=>{\n    console.log(ctx.request.body,ctx.file)\n    ctx.body={\n        ok:1,\n        info:\"add user success\"\n    }\n})\n\n```\n\n##### 11.操作MongoDB\n\n```js\nconst mongoose = require(\"mongoose\")\n\nmongoose.connect(\"mongodb://127.0.0.1:27017/kerwin_project\")\n//插入集合和数据,数据库kerwin_project会自动创建\n```\n\n\n\n```js\nconst mongoose = require(\"mongoose\")\nconst Schema = mongoose.Schema\nconst UserType = {\n    username:String,\n    password:String,\n    age:Number,\n    avatar:String\n}\n\nconst UserModel = mongoose.model(\"user\",new Schema(UserType))\n// 模型user 将会对应 users 集合, \nmodule.exports = UserModel\n```\n\n\n\n#### 九、MySQL\n\n##### 1.介绍\n\n付费的商用数据库：\n\n- Oracle，典型的高富帅；\n- SQL Server，微软自家产品，Windows定制专款；\n- DB2，IBM的产品，听起来挺高端；\n- Sybase，曾经跟微软是好基友，后来关系破裂，现在家境惨淡。\n\n这些数据库都是不开源而且付费的，最大的好处是花了钱出了问题可以找厂家解决，不过在Web的世界里，常常需要部署成千上万的数据库服务器，当然不能把大把大把的银子扔给厂家，所以，无论是Google、Facebook，还是国内的BAT，无一例外都选择了免费的开源数据库：\n\n- MySQL，大家都在用，一般错不了；\n- PostgreSQL，学术气息有点重，其实挺不错，但知名度没有MySQL高；\n- sqlite，嵌入式数据库，适合桌面和移动应用。\n\n作为一个JavaScript全栈工程师，选择哪个免费数据库呢？当然是MySQL。因为MySQL普及率最高，出了错，可以很容易找到解决方法。而且，围绕MySQL有一大堆监控和运维的工具，安装和使用很方便。\n\n![image-20220420083146539](%E7%AC%94%E8%AE%B0.assets/image-20220420083146539.png)\n\n\n\n##### 2.与非关系数据库区别\n\n关系型和非关系型数据库的主要差异是数据存储的方式。关系型数据天然就是表格式的，因此存储在数据表的行和列中。数据表可以彼此关联协作存储，也很容易提取数据。\n\n与其相反，非关系型数据不适合存储在数据表的行和列中，而是大块组合在一起。非关系型数据通常存储在数据集中，就像文档、键值对或者图结构。你的数据及其特性是选择数据存储和提取方式的首要影响因素。\n\n**关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织**\n优点：\n1、易于维护：都是使用表结构，格式一致；\n2、使用方便：SQL语言通用，可用于复杂查询；\n3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。\n缺点：\n1、读写性能比较差，尤其是海量数据的高效率读写；\n2、固定的表结构，灵活度稍欠；\n3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈。\n\n**非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。**\n\n优点：\n\n1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。\n2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；\n3、高扩展性；\n4、成本低：nosql数据库部署简单，基本都是开源软件。\n\n缺点：\n\n1、不提供sql支持；\n2、无事务处理；\n3、数据结构相对复杂，复杂查询方面稍欠。\n\n##### 3.sql语句\n\n![image-20220420092527846](%E7%AC%94%E8%AE%B0.assets/image-20220420092527846.png)\n\n插入：\n\n```sql\nINSERT INTO `students`(`id`, `name`, `score`, `gender`) VALUES (null,'kerwin',100,1)\n//可以不设置id,create_time\n```\n更新：\n```sql\nUPDATE `students` SET `name`='tiechui',`score`=20,`gender`=0 WHERE id=2;\n```\n删除：\n```sql\nDELETE FROM `students` WHERE id=2;\n```\n查询：\n```sql\n查所有的数据所有的字段\nSELECT * FROM `students` WHERE 1;\n\n查所有的数据某个字段\nSELECT `id`, `name`, `score`, `gender` FROM `students` WHERE 1;\n\n条件查询\nSELECT * FROM `students` WHERE score>=80;\nSELECT * FROM `students` where score>=80 AND gender=1\n\n模糊查询\nSELECT * FROM `students` where name like '%k%'\n\n排序\nSELECT id, name, gender, score FROM students ORDER BY score;\nSELECT id, name, gender, score FROM students ORDER BY score DESC;\n\n分页查询\nSELECT id, name, gender, score FROM students LIMIT 50 OFFSET 0\n\n记录条数\nSELECT COUNT(*) FROM students;\nSELECT COUNT(*) kerwinnum FROM students;\n\n多表查询\n\nSELECT * FROM students, classes;（这种多表查询又称笛卡尔查询，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有100行记录的表进行笛卡尔查询将返回1万条记录，对两个各自有1万行记录的表进行笛卡尔查询将返回1亿条记录）\nSELECT\n    students.id sid,\n    students.name,\n    students.gender,\n    students.score,\n    classes.id cid,\n    classes.name cname\nFROM students, classes; （要使用表名.列名这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。）\n\nSELECT\n    s.id sid,\n    s.name,\n    s.gender,\n    s.score,\n    c.id cid,\n    c.name cname\nFROM students s, classes c; （SQL还允许给表设置一个别名）\n\n\n联表查询\nSELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score\nFROM students s\nINNER JOIN classes c\nON s.class_id = c.id; （连接查询对多个表进行JOIN运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。）\n\n\n```\n\n![image-20220420090841742](%E7%AC%94%E8%AE%B0.assets/image-20220420090841742.png)\n\n注意：\n\n> 1. InnoDB 支持事务，MyISAM 不支持事务。这是 MySQL 将默认存储引擎从 MyISAM 变成 InnoDB 的重要原因之一；\n> 2. InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MYISAM 会失败；\n\n**外键约束**\n\nCASCADE\n在父表上update/delete记录时，同步update/delete掉子表的匹配记录 \n\nSET NULL\n在父表上update/delete记录时，将子表上匹配记录的列设为null (要注意子表的外键列不能为not null)  \n\nNO ACTION\n如果子表中有匹配的记录,则不允许对父表对应候选键进行update/delete操作 \n\nRESTRICT\n同no action, 都是立即检查外键约束\n\n##### 4.nodejs 操作数据库\n\n```js\nconst express = require('express')\nconst app = express()\nconst mysql2 = require('mysql2')\nconst port = 9000\n\napp.get('/',async (req, res) => {\n  const config = getDBConfig()\n  const promisePool = mysql2.createPool(config).promise();\n  // console.log(promisePool)\n      let user = await promisePool.query('select * from students');\n\n      console.log(user)\n      if (user[0].length) {\n          //存在用户\n          res.send(user[0])\n      } else {\n          //不存在\n          res.send( {\n              code: -2,\n              msg: 'user not exsit',\n          })\n      }      \n})\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`)\n})\n\n\nfunction getDBConfig() {\n  return {\n    host: '127.0.0.1',\n    user: 'root',\n    port: 3306,\n    password: '',\n    database: 'kerwin_test',\n    connectionLimit: 1 //创建一个连接池\n  }\n}\n```\n\n```js\n查询：\npromisePool.query('select * from users');\n\n插入：\npromisePool.query('INSERT INTO `users`(`id`,`name`,`age`, `password`) VALUES (?,?,?,?)',[null,\"kerwin\",100,\"123456\"]);\n\n更新：\npromisePool.query(`UPDATE users SET name = ? ,age=? WHERE id = ?`,[\"xiaoming2\",20,1])\n\n删除：\npromisePool.query(`delete from users where id=?`,[1])\n\n```\n\n\n\n#### 十、Socket编程\n\n##### 1.websocket介绍\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220421084242097.png\" alt=\"image-20220421084242097\" style=\"zoom:50%;\" />\n\n**应用场景：**\n\n- 弹幕\n\n- 媒体聊天\n\n- 协同编辑\n\n- 基于位置的应用\n\n- 体育实况更新\n\n- 股票基金报价实时更新\n\n\n\nWebSocket并不是全新的协议，而是利用了HTTP协议来建立连接。我们来看看WebSocket连接是如何创建的。\n\n首先，WebSocket连接必须由浏览器发起，因为请求协议是一个标准的HTTP请求，格式如下：\n\n```js\nGET ws://localhost:3000/ws/chat HTTP/1.1\nHost: localhost\nUpgrade: websocket\nConnection: Upgrade\nOrigin: http://localhost:3000\nSec-WebSocket-Key: client-random-string\nSec-WebSocket-Version: 13\n```\n\n该请求和普通的HTTP请求有几点不同：\n\n1. GET请求的地址不是类似`/path/`，而是以`ws://`开头的地址；\n2. 请求头`Upgrade: websocket`和`Connection: Upgrade`表示这个连接将要被转换为WebSocket连接；\n3. `Sec-WebSocket-Key`是用于标识这个连接，并非用于加密数据；\n4. `Sec-WebSocket-Version`指定了WebSocket的协议版本。\n\n随后，服务器如果接受该请求，就会返回如下响应：\n\n```\nHTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: server-random-string\n```\n\n该响应代码`101`表示本次连接的HTTP协议即将被更改，更改后的协议就是`Upgrade: websocket`指定的WebSocket协议。\n\n版本号和子协议规定了双方能理解的数据格式，以及是否支持压缩等等。如果仅使用WebSocket的API，就不需要关心这些。\n\n现在，一个WebSocket连接就建立成功，浏览器和服务器就可以随时主动发送消息给对方。消息有两种，一种是文本，一种是二进制数据。通常，我们可以发送JSON格式的文本，这样，在浏览器处理起来就十分容易。\n\n为什么WebSocket连接可以实现全双工通信而HTTP连接不行呢？实际上HTTP协议是建立在TCP协议之上的，TCP协议本身就实现了全双工通信，但是HTTP协议的请求－应答机制限制了全双工通信。WebSocket连接建立以后，其实只是简单规定了一下：接下来，咱们通信就不使用HTTP协议了，直接互相发数据吧。\n\n安全的WebSocket连接机制和HTTPS类似。首先，浏览器用`wss://xxx`创建WebSocket连接时，会先通过HTTPS创建安全的连接，然后，该HTTPS连接升级为WebSocket连接，底层通信走的仍然是安全的SSL/TLS协议。\n\n**浏览器支持**\n\n很显然，要支持WebSocket通信，浏览器得支持这个协议，这样才能发出`ws://xxx`的请求。目前，支持WebSocket的主流浏览器如下：\n\n- Chrome\n- Firefox\n- IE >= 10\n- Sarafi >= 6\n- Android >= 4.4\n- iOS >= 8\n\n**服务器支持**\n\n由于WebSocket是一个协议，服务器具体怎么实现，取决于所用编程语言和框架本身。Node.js本身支持的协议包括TCP协议和HTTP协议，要支持WebSocket协议，需要对Node.js提供的HTTPServer做额外的开发。已经有若干基于Node.js的稳定可靠的WebSocket实现，我们直接用npm安装使用即可。\n\n##### 2.ws模块\n\n服务器：\n\n```js\nconst  WebSocket = require(\"ws\")\nWebSocketServer = WebSocket.WebSocketServer\nconst wss = new WebSocketServer({ port: 8080 });\nwss.on('connection', function connection(ws) {\n    ws.on('message', function message(data, isBinary) {\n        wss.clients.forEach(function each(client) {\n            if (client !== ws && client.readyState === WebSocket.OPEN) {\n                client.send(data, { binary: isBinary });\n            }\n        });\n\n    });\n\n    ws.send('欢迎加入聊天室');\n});\n```\n\n客户端：\n\n```js\nvar ws = new WebSocket(\"ws://localhost:8080\")\nws.onopen = ()=>{\n    console.log(\"open\")\n}\nws.onmessage = (evt)=>{\n    console.log(evt.data)\n}\n```\n\n授权验证：\n\n\n\n```js\n//前端\nvar ws = new WebSocket(`ws://localhost:8080?token=${localStorage.getItem(\"token\")}`)\nws.onopen = () => {\n      console.log(\"open\")\n      ws.send(JSON.stringify({\n        type: WebSocketType.GroupList\n      }))\n    }\nws.onmessage = (evt) => {\n    console.log(evt.data)\n}\n//后端\nconst WebSocket = require(\"ws\");\nconst JWT = require('../util/JWT');\nWebSocketServer = WebSocket.WebSocketServer\nconst wss = new WebSocketServer({ port: 8080 });\nwss.on('connection', function connection(ws, req) {\n  const myURL = new URL(req.url, 'http://127.0.0.1:3000');\n  const payload = JWT.verify(myURL.searchParams.get(\"token\"))\n  if (payload) {\n    ws.user = payload\n    ws.send(createMessage(WebSocketType.GroupChat, ws.user, \"欢迎来到聊天室\"))\n\n    sendBroadList() //发送好友列表\n  } else {\n    ws.send(createMessage(WebSocketType.Error, null, \"token过期\"))\n  }\n  // console.log(3333,url)\n  ws.on('message', function message(data, isBinary) {\n    const messageObj = JSON.parse(data)\n    switch (messageObj.type) {\n      case WebSocketType.GroupList:\n        ws.send(createMessage(WebSocketType.GroupList, ws.user, JSON.stringify(Array.from(wss.clients).map(item => item.user))))\n        break;\n      case WebSocketType.GroupChat:\n        wss.clients.forEach(function each(client) {\n          if (client !== ws && client.readyState === WebSocket.OPEN) {\n            client.send(createMessage(WebSocketType.GroupChat, ws.user, messageObj.data));\n          }\n        });\n        break;\n      case WebSocketType.SingleChat:\n        wss.clients.forEach(function each(client) {\n          if (client.user.username === messageObj.to && client.readyState === WebSocket.OPEN) {\n            client.send(createMessage(WebSocketType.SingleChat, ws.user, messageObj.data));\n          }\n        });\n        break;\n    }\n\n    ws.on(\"close\",function(){\n      //删除当前用户\n      wss.clients.delete(ws.user)\n      sendBroadList() //发送好用列表\n    })\n  });\n\n});\nconst WebSocketType = {\n  Error: 0, //错误\n  GroupList: 1,//群列表\n  GroupChat: 2,//群聊\n  SingleChat: 3//私聊\n}\nfunction createMessage(type, user, data) {\n  return JSON.stringify({\n    type: type,\n    user: user,\n    data: data\n  });\n}\n\nfunction sendBroadList(){\n  wss.clients.forEach(function each(client) {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(createMessage(WebSocketType.GroupList, client.user, JSON.stringify(Array.from(wss.clients).map(item => item.user))))\n    }\n  });\n}\n```\n\n\n\n##### 3.socket.io模块\n\n服务端：\n\n```js\nconst io = require('socket.io')(server);\nio.on('connection', (socket) => {\n\n  const payload = JWT.verify(socket.handshake.query.token)\n  if (payload) {\n    socket.user = payload\n    socket.emit(WebSocketType.GroupChat, createMessage(socket.user, \"欢迎来到聊天室\"))\n    sendBroadList() //发送好友列表\n  } else {\n    socket.emit(WebSocketType.Error, createMessage(null, \"token过期\"))\n  }\n\n\n  socket.on(WebSocketType.GroupList, () => {\n    socket.emit(WebSocketType.GroupList, createMessage(null, Array.from(io.sockets.sockets).map(item => item[1].user).filter(item=>item)));\n  })\n\n  socket.on(WebSocketType.GroupChat, (messageObj) => {\n    socket.broadcast.emit(WebSocketType.GroupChat, createMessage(socket.user, messageObj.data));\n  })\n\n  socket.on(WebSocketType.SingleChat, (messageObj) => {\n    Array.from(io.sockets.sockets).forEach(function (socket) {\n      if (socket[1].user.username === messageObj.to) {\n        socket[1].emit(WebSocketType.SingleChat, createMessage(socket[1].user, messageObj.data));\n      }\n    })\n  })\n\n  socket.on('disconnect', reason => {\n     \n     sendBroadList() //发送好用列表\n  });\n\n});\n\nfunction sendBroadList() {\n  io.sockets.emit(WebSocketType.GroupList, createMessage(null, Array.from(io.sockets.sockets).map(item => item[1].user).filter(item=>item)))\n}\n//最后filter，是因为 有可能存在null的值\n\n```\n\n客户端：\n\n```js\nconst WebSocketType = {\n    Error: 0, //错误\n    GroupList: 1, //群列表\n    GroupChat: 2, //群聊\n    SingleChat: 3 //私聊\n}\n\n\nconst socket = io(`ws://localhost:3000?token=${localStorage.getItem(\"token\")}`);\nsocket.on(\"connect\",()=>{\n\tsocket.emit(WebSocketType.GroupList)\n})\nsocket.on(WebSocketType.GroupList, (messageObj) => {\n    select.innerHTML = \"\"\n    select.innerHTML = `<option value=\"all\">all</option>` + messageObj.data.map(item => `\n    <option value=\"${item.username}\">${item.username}</option>`).join(\"\")\n})\n\nsocket.on(WebSocketType.GroupChat, (msg) => {\n\tconsole.log(msg)\n})\n\nsocket.on(WebSocketType.SingleChat, (msg) => {\n\tconsole.log(msg)\n})\n\nsocket.on(WebSocketType.Error, (msg) => {\n    localStorage.removeItem(\"token\")\n    location.href = \"/login\"\n})\n\nsend.onclick = () => {\n    if (select.value === \"all\") {\n        socket.emit(WebSocketType.GroupChat,{\n            data: text.value\n        })\n    } else {\n        socket.emit(WebSocketType.SingleChat,{\n            data: text.value,\n            to:select.value\n        })\n    }\n}\n```\n\n\n\n#### 十一、mocha\n\n单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。\n\n比如对函数abs()，我们可以编写出以下几个测试用例：\n\n输入正数，比如1、1.2、0.99，期待返回值与输入相同；\n\n输入负数，比如-1、-1.2、-0.99，期待返回值与输入相反；\n\n输入0，期待返回0；\n\n输入非数值类型，比如null、[]、{}，期待抛出Error。\n\n把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。\n\n如果单元测试通过，说明我们测试的这个函数能够正常工作。如果单元测试不通过，要么函数有bug，要么测试条件输入不正确，总之，需要修复使单元测试能够通过。\n\n单元测试通过后有什么意义呢？如果我们对abs()函数代码做了修改，只需要再跑一遍单元测试，如果通过，说明我们的修改不会对abs()函数原有的行为造成影响，如果测试不通过，说明我们的修改与原有行为不一致，要么修改代码，要么修改测试。\n\n这种以测试为驱动的开发模式最大的好处就是确保一个程序模块的行为符合我们设计的测试用例。在将来修改的时候，可以极大程度地保证该模块行为仍然是正确的。\n\nmocha是JavaScript的一种单元测试框架，既可以在浏览器环境下运行，也可以在Node.js环境下运行。\n\n使用mocha，我们就只需要专注于编写单元测试本身，然后，让mocha去自动运行所有的测试，并给出测试结果。\n\nmocha的特点主要有：\n\n1. 既可以测试简单的JavaScript函数，又可以测试异步代码，因为异步是JavaScript的特性之一；\n2. 可以自动运行所有测试，也可以只运行特定的测试；\n3. 可以支持before、after、beforeEach和afterEach来编写初始化代码。\n\n##### 1.编写测试\n\n```js\nconst assert = require('assert');\nconst sum = require('../test');\ndescribe('#hello.js', () => {\n\n    describe('#sum()', () => {\n        it('sum() should return 0', () => {\n            assert.strictEqual(sum(), 0);\n        });\n\n        it('sum(1) should return 1', () => {\n            assert.strictEqual(sum(1), 1);\n        });\n\n        it('sum(1, 2) should return 3', () => {\n            assert.strictEqual(sum(1, 2), 3);\n        });\n\n        it('sum(1, 2, 3) should return 6', () => {\n            assert.strictEqual(sum(1, 2, 3), 6);\n        });\n    });\n});\n```\n\n\n\n##### 2.chai断言库\n\n\n\n![image-20220505113605440](%E7%AC%94%E8%AE%B0.assets/image-20220505113605440.png)\n\n```js\nvar chai = require('chai')\nvar assert = chai.assert;\n\ndescribe('assert Demo', function () {\n    it('use assert lib', function () {\n        var value = \"hello\";\n        assert.typeOf(value, 'string')\n        assert.equal(value, 'hello')\n        assert.lengthOf(value, 5)\n    })\n})\n\n```\n\n```js\nvar chai = require('chai');\nchai.should();\n\ndescribe('should Demo', function(){\n    it('use should lib', function () {\n        var value = 'hello'\n        value.should.exist.and.equal('hello').and.have.length(5).and.be.a('string')\n        // value.should.be.a('string')\n        // value.should.equal('hello')\n        // value.should.not.equal('hello2')\n        // value.should.have.length(5);\n    })\n});\n\n```\n\n```js\nvar chai = require('chai');\nvar expect = chai.expect;\n\ndescribe('expect Demo', function() {\n    it('use expect lib', function () {\n        var value = 'hello'\n        var number = 3\n\n        expect(number).to.be.at.most(5)\n        expect(number).to.be.at.least(3)\n        expect(number).to.be.within(1, 4)\n\n        expect(value).to.exist\n        expect(value).to.be.a('string')\n        expect(value).to.equal('hello')\n        expect(value).to.not.equal('您好')\n        expect(value).to.have.length(5)\n    })\n});\n\n```\n\n\n\n##### 3.异步测试\n\n```js\nvar fs =require(\"fs\").promises\nvar chai = require('chai');\nvar expect = chai.expect;\nit('test async function',async function () {\n    const data =await fs.readFile('./1.txt',\"utf8\");\n    expect(data).to.equal('hello')\n});\n```\n\n\n\n##### 4.http测试\n\n```js\nconst request = require('supertest')\nconst app = require('../app');\n\ndescribe('#test koa app', () => {\n    let server = app.listen(3000);\n    describe('#test server', () => {\n        it('#test GET /', async () => {\n            await request(server)\n                .get('/')\n                .expect('Content-Type', /text\\/html/)\n                .expect(200, '<h1>hello world</h1>');\n        });\n\n        after(function () {\n            server.close()\n        });\n    });\n});\n```\n\n\n\n##### 5.钩子函数\n\n```js\ndescribe('#hello.js', () => {\n    describe('#sum()', () => {\n        before(function () {\n            console.log('before:');\n        });\n\n        after(function () {\n            console.log('after.');\n        });\n\n        beforeEach(function () {\n            console.log('  beforeEach:');\n        });\n\n        afterEach(function () {\n            console.log('  afterEach.');\n        });\n    });\n});\n```","source":"_posts/node笔记.md","raw":"title: Node.js笔记\ntype: tags\ndescription: Node.js （最全）基础+全栈项目\nkeywords: 后端 笔记\ntop_img: 'https://colorlib.com/wp/wp-content/uploads/sites/2/node.js-logo.png'\ntags:\n  - node\ncategories:\n  - web前端\ncover: 'https://innovationyourself.com/wp-content/uploads/2020/08/nodejs-logo.png'\ndate: 2023-01-25 00:00:00\nupdated:\n---\n#### 一、Node.js基础\n\n##### 1.  认识Node.js\n\n> Node.js是一个javascript运行环境。它让javascript可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与PHP、Java、Python、.NET、Ruby等后端语言平起平坐。\n>\n> Nodejs是基于V8引擎，V8是Google发布的开源JavaScript引擎，本身就是用于Chrome浏览器的js解释部分，但是Ryan Dahl 这哥们，鬼才般的，把这个V8搬到了服务器上，用于做服务器的软件。\n\n###### 01 nodejs的特性\n\n- Nodejs语法完全是js语法，只要你懂js基础就可以学会Nodejs后端开发\n- NodeJs超强的高并发能力,实现高性能服务器\n- 开发周期短、开发成本低、学习成本低\n\n###### 02 使用 Node.js 需要了解多少 JavaScript\n\n> http://nodejs.cn/learn/how-much-javascript-do-you-need-to-know-to-use-nodejs\n\n###### 03 浏览器环境vs node环境\n\nNode.js 可以解析JS代码（没有浏览器安全级别的限制）提供很多系统级别的API，如：\n\n- 文件的读写 (File System)\n\n  ```js\n  const fs = require('fs')\n  \n  fs.readFile('./ajax.png', 'utf-8', (err, content) => {\n    console.log(content)\n  })\n  ```\n\n- 进程的管理 (Process)\n\n  ```js\n  function main(argv) {\n    console.log(argv)\n  }\n  \n  main(process.argv.slice(2))\n  \n  ```\n\n  \n\n- 网络通信 (HTTP/HTTPS)\n\n  ```js\n  const http = require(\"http\")\n  \n  http.createServer((req,res) => {\n    res.writeHead(200, {\n      \"content-type\": \"text/plain\"\n    })\n    res.write(\"hello nodejs\")\n    res.end()\n  }).listen(3000)\n  \n  ```\n\n##### 2.  开发环境搭建\n\n> http://nodejs.cn/download/\n\n![image-20220210095903409](%E7%AC%94%E8%AE%B0.assets/image-20220210095903409.png)\n\n##### 3.  模块、包、commonJS\n\n​\t\t\t![image-20220210100015768](%E7%AC%94%E8%AE%B0.assets/image-20220210100015768.png)\n\n###### 02 CommonJS规范\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101652166.png\" alt=\"image-20220210101652166\" style=\"zoom: 67%; float: left;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101720533.png\" alt=\"image-20220210101720533\" style=\"zoom: 67%; float: left;\" />\n\n###### 03 modules模块化规范写法\n\n我们可以把公共的功能 抽离成为一个单独的 js 文件 作为一个模块，默认情况下面这个模块里面的方法或者属性，外面是没法访问的。如果要让外部可以访问模块里面的方法或者属性，就必须在模块里面通过 exports 或者 module.exports 暴露属性或者方法。\n\nm1.js：\n\n```js\nconst name = 'gp19'\n\nconst sayName = () => {\n  console.log(name)\n}\n\nconsole.log('module 1')\n\n// 接口暴露方法一：\nmodule.exports = {\n  say: sayName\n}\n\n// 接口暴露方法二：\nexports.say = sayName\n\n// 错误！\nexports = {\n  say: sayName\n}\n```\n\nmain.js：\n\n```js\nconst m1 = require('./m1')\nm1.say()\n```\n\n##### 4.  Npm&Yarn\n\n###### 01 npm的使用\n\n```js\nnpm init\nnpm install 包名 –g  （uninstall,update）\nnpm install 包名 --save-dev (uninstall,update)\nnpm list -g (不加-g，列举当前目录下的安装包)\nnpm info 包名（详细信息） npm info 包名 version(获取最新版本)\nnpm install md5@1（安装指定版本）\nnpm outdated(  检查包是否已经过时)\n\n\n\t\"dependencies\": {    \"md5\": \"^2.1.0\"  }  ^ 表示 如果 直接npm install 将会 安md5\n    2.*.*  \t最新版本\n\n\t\"dependencies\": {    \"md5\": \"~2.1.0\"  }  ~ 表示 如果 直接npm install 将会 安装md5 2.1.*  最新版本\n\n\t\"dependencies\": {    \"md5\": \"*\"  }  * 表示 如果 直接npm install 将会 安装 md5  最新版本\n```\n\n###### 02 全局安装 nrm  \n\n> NRM (npm registry manager)是npm的镜像源管理工具，有时候国外资源太慢，使用这个就可以快速地在 npm 源间切换。\n\n`手动切换方法： npm config set registry https://registry.npm.taobao.org`\n\n**安装 nrm**\n\n在命令行执行命令，npm install -g nrm，全局安装nrm。\n\n**使用 nrm**\n\n执行命令 nrm ls 查看可选的源。 其中，带*的是当前使用的源，上面的输出表明当前源是官方源。\n\n**切换 nrm**\n\n如果要切换到taobao源，执行命令nrm use taobao。\n\n**测试速度**\n\n你还可以通过 nrm test 测试相应源的响应时间。\n\n```\nnrm test\n```\n\n>  扩展：\n\n> ![image-20220210114017616](%E7%AC%94%E8%AE%B0.assets/image-20220210114017616.png)\n\n ```bash\n npm install -g cnpm --registry=https://registry.npmmirror.com\n ```\n\n\n\n###### 03 yarn使用\n\n```\nnpm install -g yarn\n```\n\n```js\n对比npm:\n\t速度超快: Yarn 缓存了每个下载过的包，所以再次使用时无需重复下载。 同时利用并行下载以最大化资源利用率，因此安装速度更快。\n    超级安全: 在执行代码之前，Yarn 会通过算法校验每个安装包的完整性。\n\n开始新项目\n\tyarn init \n添加依赖包\n\tyarn add [package] \n\tyarn add [package]@[version] \n\tyarn add [package] --dev \n升级依赖包\n\t yarn upgrade [package]@[version] \n移除依赖包\n\t yarn remove [package]\n\t \n安装项目的全部依赖\n\t yarn install \n```\n\n\n\n##### 5.  内置模块\n\n###### 01  http模块\n\n> 要使用 HTTP 服务器和客户端，则必须 `require('http')`。\n\n```js\nconst http = require('http');\n\n// 创建本地服务器来从其接收数据\nconst server = http.createServer((req, res) => {\n  res.writeHead(200, { 'Content-Type': 'application/json' });\n  res.end(JSON.stringify({\n    data: 'Hello World!'\n  }));\n});\n\nserver.listen(8000);\n\n```\n\n```js\nconst http = require('http');\n\n// 创建本地服务器来从其接收数据\nconst server = http.createServer();\n\n// 监听请求事件\nserver.on('request', (request, res) => {\n  res.writeHead(200, { 'Content-Type': 'application/json' });\n  res.end(JSON.stringify({\n    data: 'Hello World!'\n  }));\n});\n\nserver.listen(8000);\n```\n\n###### \t02   url模块\n\n**02.1 parse**\n\n```js\nconst url = require('url')\nconst urlString = 'https://www.baidu.com:443/ad/index.html?id=8&name=mouse#tag=110'\nconst parsedStr = url.parse(urlString)\nconsole.log(parsedStr)\n```\n\n**02.2 format**\n\n```js\nconst url = require('url')\nconst urlObject = {\n  protocol: 'https:',\n  slashes: true,\n  auth: null,\n  host: 'www.baidu.com:443',\n  port: '443',\n  hostname: 'www.baidu.com',\n  hash: '#tag=110',\n  search: '?id=8&name=mouse',\n  query: { id: '8', name: 'mouse' },\n  pathname: '/ad/index.html',\n  path: '/ad/index.html?id=8&name=mouse'\n}\nconst parsedObj = url.format(urlObject)\nconsole.log(parsedObj)\n\n```\n\n\n\n**02.3 resolve**\n\n```js\nconst url = require('url')\nvar a = url.resolve('/one/two/three', 'four')  ( 注意最后加/ ，不加/的区别 )\nvar b = url.resolve('http://example.com/', '/one')\nvar c = url.resolve('http://example.com/one', '/two')\nconsole.log(a + \",\" + b + \",\" + c)\n```\n\n\n\n###### \t03  querystring模块\n\n**03.1 parse**\n\n```js\nconst querystring = require('querystring')\nvar qs = 'x=3&y=4'\nvar parsed = querystring.parse(qs)\nconsole.log(parsed)\n\n```\n\n**03.2 stringify**\n\n```js\nconst querystring = require('querystring')\nvar qo = {\n  x: 3,\n  y: 4\n}\nvar parsed = querystring.stringify(qo)\nconsole.log(parsed)\n\n```\n\n**03.3 escape/unescape**\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211406894.png\" alt=\"image-20220213211406894\" style=\"zoom:67%;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211423142.png\" alt=\"image-20220213211423142\" style=\"zoom:67%;\" />\n\n```js\nconst querystring = require('querystring')\nvar str = 'id=3&city=北京&url=https://www.baidu.com'\nvar escaped = querystring.escape(str)\nconsole.log(escaped)\n\n```\n\n```js\nconst querystring = require('querystring')\nvar str = 'id%3D3%26city%3D%E5%8C%97%E4%BA%AC%26url%3Dhttps%3A%2F%2Fwww.baidu.com'\nvar unescaped = querystring.unescape(str)\nconsole.log(unescaped)\n```\n\n###### \t04  http模块补充\n\n**04.1 接口：jsonp**\n\n```js\nconst http = require('http')\nconst url = require('url')\n\nconst app = http.createServer((req, res) => {\n  let urlObj = url.parse(req.url, true)\n\n  switch (urlObj.pathname) {\n    case '/api/user':\n      res.end(`${urlObj.query.cb}({\"name\": \"gp145\"})`)\n      break\n    default:\n      res.end('404.')\n      break\n  }\n})\n\napp.listen(8080, () => {\n  console.log('localhost:8080')\n})\n```\n\n**04.2 跨域：CORS**\n\n```js\nconst http = require('http')\nconst url = require('url')\nconst querystring = require('querystring')\n\nconst app = http.createServer((req, res) => {\n  let data = ''\n  let urlObj = url.parse(req.url, true)\n\n  res.writeHead(200, {\n    'content-type': 'application/json;charset=utf-8',\n    'Access-Control-Allow-Origin': '*'\n  })\n\n  req.on('data', (chunk) => {\n    data += chunk\n  })\n\n  req.on('end', () => {\n    responseResult(querystring.parse(data))\n  })\n\n  function responseResult(data) {\n    switch (urlObj.pathname) {\n      case '/api/login':\n        res.end(JSON.stringify({\n          message: data\n        }))\n        break\n      default:\n        res.end('404.')\n        break\n    }\n  }\n})\n\napp.listen(8080, () => {\n  console.log('localhost:8080')\n})\n```\n**04.3 模拟get**\n\n```js\nvar http = require('http')\nvar https = require('https')\n\n// 1、接口 2、跨域\nconst server = http.createServer((request, response) => {\n  var url = request.url.substr(1)\n\n  var data = ''\n\n  response.writeHeader(200, {\n    'content-type': 'application/json;charset=utf-8',\n    'Access-Control-Allow-Origin': '*'\n  })\n\n  https.get(`https://m.lagou.com/listmore.json${url}`, (res) => {\n\n    res.on('data', (chunk) => {\n      data += chunk\n    })\n\n    res.on('end', () => {\n      response.end(JSON.stringify({\n        ret: true,\n        data\n      }))\n    })\n  })\n\n})\n\nserver.listen(8080, () => {\n  console.log('localhost:8080')\n})\n```\n\n**04.4 模拟post：服务器提交（攻击）**\n\n```js\nconst https = require('https')\nconst querystring = require('querystring')\n\nconst postData = querystring.stringify({\n  province: '上海',\n  city: '上海',\n  district: '宝山区',\n  address: '同济支路199号智慧七立方3号楼2-4层',\n  latitude: 43.0,\n  longitude: 160.0,\n  message: '求购一条小鱼',\n  contact: '13666666',\n  type: 'sell',\n  time: 1571217561\n})\n\nconst options = {\n  protocol: 'https:',\n  hostname: 'ik9hkddr.qcloud.la',\n  method: 'POST',\n  port: 443,\n  path: '/index.php/trade/add_item',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Content-Length': Buffer.byteLength(postData)\n  }\n}\n\nfunction doPost() {\n  let data\n\n  let req = https.request(options, (res) => {\n    res.on('data', chunk => data += chunk)\n    res.on('end', () => {\n      console.log(data)\n    })\n  })\n\n  req.write(postData)\n  req.end()\n}\n\n// setInterval(() => {\n//   doPost()\n// }, 1000)\n```\n\n\n\n**04.5 爬虫**\n\n```js\nconst https = require('https')\nconst http = require('http')\nconst cheerio = require('cheerio')\n\nhttp.createServer((request, response) => {\n  response.writeHead(200, {\n    'content-type': 'application/json;charset=utf-8'\n  })\n\n  const options = {\n    // protocol: 'https:',\n    hostname: 'i.maoyan.com',\n    port: 443,\n    path: '/',\n    method: 'GET'\n  }\n\n  const req = https.request(options, (res) => {\n    let data = ''\n    res.on('data', (chunk) => {\n      data += chunk\n    })\n\n    res.on('end', () => {\n      filterData(data)\n    })\n  })\n\n  function filterData(data) {\n    //   console.log(data)\n    let $ = cheerio.load(data)\n    let $movieList = $('.column.content')\n    console.log($movieList)\n    let movies = []\n    $movieList.each((index, value) => {\n      movies.push({\n        title: $(value).find('.movie-title .title').text(),\n        detail: $(value).find('.detail .actor').text(),\n      })\n    })\n\n    response.end(JSON.stringify(movies))\n  }\n\n  req.end()\n}).listen(3000)\n```\n\n###### \t05  event模块\n\n```js\nconst EventEmitter = require('events')\n\nclass MyEventEmitter extends EventEmitter {}\n\nconst event = new MyEventEmitter()\n\nevent.on('play', (movie) => {\n  console.log(movie)\n})\n\nevent.emit('play', '我和我的祖国')\nevent.emit('play', '中国机长')\n```\n\n###### \t06  fs文件操作模块\n\n```js\nconst fs = require('fs')\n\n// 创建文件夹\nfs.mkdir('./logs', (err) => {\n  console.log('done.')\n})\n\n// 文件夹改名\nfs.rename('./logs', './log', () => {\n  console.log('done')\n})\n\n// 删除文件夹\nfs.rmdir('./log', () => {\n  console.log('done.')\n})\n\n// 写内容到文件里\nfs.writeFile(\n  './logs/log1.txt',\n  'hello',\n  // 错误优先的回调函数\n  (err) => {\n    if (err) {\n      console.log(err.message)\n    } else {\n      console.log('文件创建成功')\n    }\n  }\n)\n\n// 给文件追加内容\nfs.appendFile('./logs/log1.txt', '\\nworld', () => {\n  console.log('done.')\n})\n\n// 读取文件内容\nfs.readFile('./logs/log1.txt', 'utf-8', (err, data) => {\n  console.log(data)\n})\n\n// 删除文件\nfs.unlink('./logs/log1.txt', (err) => {\n  console.log('done.')\n})\n\n// 批量写文件\nfor (var i = 0; i < 10; i++) {\n  fs.writeFile(`./logs/log-${i}.txt`, `log-${i}`, (err) => {\n    console.log('done.')\n  })\n}\n\n// 读取文件/目录信息\nfs.readdir('./', (err, data) => {\n  data.forEach((value, index) => {\n    fs.stat(`./${value}`, (err, stats) => {\n      // console.log(value + ':' + stats.size)\n      console.log(value + ' is ' + (stats.isDirectory() ? 'directory' : 'file'))\n    })\n  })\n})\n\n// 同步读取文件\ntry {\n  const content = fs.readFileSync('./logs/log-1.txt', 'utf-8')\n  console.log(content)\n  console.log(0)\n} catch (e) {\n  console.log(e.message)\n}\n\n// 异步读取文件：方法一\nfs.readFile('./logs/log-0.txt', 'utf-8', (err, content) => {\n  console.log(content)\n  console.log(0)\n})\nconsole.log(1)\n\n// 异步读取文件：方法二\nconst fs = require(\"fs\").promises\nfs.readFile('./logs/log-0.txt', 'utf-8').then(result => {\n  console.log(result)\n})\n\n```\n\n在`fs`模块中，提供同步方法是为了方便使用。那我们到底是应该用异步方法还是同步方法呢？\n\n由于Node环境执行的JavaScript代码是服务器端代码，所以，绝大部分需要在服务器运行期反复执行业务逻辑的代码，*必须使用异步代码*，否则，同步代码在执行时期，服务器将停止响应，因为JavaScript只有一个执行线程。\n\n服务器启动时如果需要读取配置文件，或者结束时需要写入到状态文件时，可以使用同步代码，因为这些代码只在启动和结束时执行一次，不影响服务器正常运行时的异步执行。\n\n###### \t07  stream流模块\n\n`stream`是Node.js提供的又一个仅在服务区端可用的模块，目的是支持“流”这种数据结构。\n\n什么是流？流是一种抽象的数据结构。想象水流，当在水管中流动时，就可以从某个地方（例如自来水厂）源源不断地到达另一个地方（比如你家的洗手池）。我们也可以把数据看成是数据流，比如你敲键盘的时候，就可以把每个字符依次连起来，看成字符流。这个流是从键盘输入到应用程序，实际上它还对应着一个名字：标准输入流（stdin）。\n\n![image-20220407085931744](%E7%AC%94%E8%AE%B0.assets/image-20220407085931744.png)\n\n如果应用程序把字符一个一个输出到显示器上，这也可以看成是一个流，这个流也有名字：标准输出流（stdout）。流的特点是数据是有序的，而且必须依次读取，或者依次写入，不能像Array那样随机定位。\n\n有些流用来读取数据，比如从文件读取数据时，可以打开一个文件流，然后从文件流中不断地读取数据。有些流用来写入数据，比如向文件写入数据时，只需要把数据不断地往文件流中写进去就可以了。\n\n在Node.js中，流也是一个对象，我们只需要响应流的事件就可以了：`data`事件表示流的数据已经可以读取了，`end`事件表示这个流已经到末尾了，没有数据可以读取了，`error`事件表示出错了。\n\n```js\nvar fs = require('fs');\n\n// 打开一个流:\nvar rs = fs.createReadStream('sample.txt', 'utf-8');\n\nrs.on('data', function (chunk) {\n    console.log('DATA:')\n    console.log(chunk);\n});\n\nrs.on('end', function () {\n    console.log('END');\n});\n\nrs.on('error', function (err) {\n    console.log('ERROR: ' + err);\n});\n\n```\n\n要注意，`data`事件可能会有多次，每次传递的`chunk`是流的一部分数据。\n\n要以流的形式写入文件，只需要不断调用`write()`方法，最后以`end()`结束：\n\n\n\n```js\nvar fs = require('fs');\n\nvar ws1 = fs.createWriteStream('output1.txt', 'utf-8');\nws1.write('使用Stream写入文本数据...\\n');\nws1.write('END.');\nws1.end();\n\n```\n\n`pipe` 就像可以把两个水管串成一个更长的水管一样，两个流也可以串起来。一个`Readable`流和一个`Writable`流串起来后，所有的数据自动从`Readable`流进入`Writable`流，这种操作叫`pipe`。\n\n在Node.js中，`Readable`流有一个`pipe()`方法，就是用来干这件事的。\n\n让我们用`pipe()`把一个文件流和另一个文件流串起来，这样源文件的所有数据就自动写入到目标文件里了，所以，这实际上是一个复制文件的程序：\n\n```js\nconst fs = require('fs')\n\nconst readstream = fs.createReadStream('./1.txt')\nconst writestream = fs.createWriteStream('./2.txt')\n\nreadstream.pipe(writestream)\n```\n\n###### 08 zlib\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220407105916114.png\" alt=\"image-20220407105916114\" style=\"zoom:50%;\" />\n\n```js\nconst fs = require('fs')\nconst zlib = require('zlib')\n\nconst gzip = zlib.createGzip()\n\nconst readstream = fs.createReadStream('./note.txt')\nconst writestream = fs.createWriteStream('./note2.txt')\n\nreadstream\n  .pipe(gzip)\n  .pipe(writestream)\n\n```\n\n###### 09 crypto\n\ncrypto模块的目的是为了提供通用的加密和哈希算法。用纯JavaScript代码实现这些功能不是不可能，但速度会非常慢。Nodejs用C/C++实现这些算法后，通过cypto这个模块暴露为JavaScript接口，这样用起来方便，运行速度也快。\n\nMD5是一种常用的哈希算法，用于给任意数据一个“签名”。这个签名通常用一个十六进制的字符串表示：\n\n```js\nconst crypto = require('crypto');\n\nconst hash = crypto.createHash('md5');\n\n// 可任意多次调用update():\nhash.update('Hello, world!');\nhash.update('Hello, nodejs!');\n\nconsole.log(hash.digest('hex')); \n\n```\n\n`update()`方法默认字符串编码为`UTF-8`，也可以传入Buffer。\n\n如果要计算SHA1，只需要把`'md5'`改成`'sha1'`，就可以得到SHA1的结果`1f32b9c9932c02227819a4151feed43e131aca40`。\n\nHmac算法也是一种哈希算法，它可以利用MD5或SHA1等哈希算法。不同的是，Hmac还需要一个密钥：\n\n```\nconst crypto = require('crypto');\n\nconst hmac = crypto.createHmac('sha256', 'secret-key');\n\nhmac.update('Hello, world!');\nhmac.update('Hello, nodejs!');\n\nconsole.log(hmac.digest('hex')); // 80f7e22570...\n\n```\n\n只要密钥发生了变化，那么同样的输入数据也会得到不同的签名，因此，可以把Hmac理解为用随机数“增强”的哈希算法。\n\n\n\nAES是一种常用的对称加密算法，加解密都用同一个密钥。crypto模块提供了AES支持，但是需要自己封装好函数，便于使用：\n\n```js\nconst crypto = require(\"crypto\");\n\nfunction encrypt (key, iv, data) {\n    let decipher = crypto.createCipheriv('aes-128-cbc', key, iv);\n    // decipher.setAutoPadding(true);\n    return decipher.update(data, 'binary', 'hex') + decipher.final('hex');\n}\n\nfunction decrypt (key, iv, crypted) {\n     crypted = Buffer.from(crypted, 'hex').toString('binary');\n     let decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n     return decipher.update(crypted, 'binary', 'utf8') + decipher.final('utf8');\n}\nkey,iv必须是16个字节\n\n```\n\n可以看出，加密后的字符串通过解密又得到了原始内容。\n\n##### 6.   路由\n\n###### \t01   基础\n\n```js\n/*\n * @作者: kerwin\n * @公众号: 大前端私房菜\n */\nvar fs = require(\"fs\")\nvar path = require(\"path\")\n\nfunction render(res, path) {\n    res.writeHead(200, { \"Content-Type\": \"text/html;charset=utf8\" })\n    res.write(fs.readFileSync(path, \"utf8\"))\n    res.end()\n}\n\n\nconst route = {\n    \"/login\": (req, res) => {\n        render(res, \"./static/login.html\")\n    },\n\n    \"/home\": (req, res) => {\n        render(res, \"./static/home.html\")\n    },\n    \"/404\": (req, res) => {\n        res.writeHead(404, { \"Content-Type\": \"text/html;charset=utf8\" })\n        res.write(fs.readFileSync(\"./static/404.html\", \"utf8\"))\n    }\n}\n\n\n```\n\n###### 02   获取参数\n\nget请求\n\n```js\n    \"/api/login\":(req,res)=>{\n        const myURL = new URL(req.url, 'http://127.0.0.1:3000');\n        console.log(myURL.searchParams.get(\"username\"))   \n        render(res,`{ok:1}`)\n    }\n```\n\npost请求\n\n```js\n\"/api/login\": (req, res) => {\n        var post = '';\n        // 通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中\n        req.on('data', function (chunk) {\n            post += chunk;\n        });\n\n        // 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。\n        req.on('end', function () {\n            post = JSON.parse(post);\n            render(res, `{ok:1}`)\n        });\n    }\n```\n\n\n\n###### 03   静态资源处理\n\n```js\nfunction readStaticFile(req, res) {\n    const myURL = new URL(req.url, 'http://127.0.0.1:3000')\n    var filePathname = path.join(__dirname, \"/static\", myURL.pathname);\n\n    if (fs.existsSync(filePathname)) {\n        // console.log(1111)\n        res.writeHead(200, { \"Content-Type\": `${mime.getType(myURL.pathname.split(\".\")[1])};charset=utf8` })\n        res.write(fs.readFileSync(filePathname, \"utf8\"))\n        res.end()\n        return true\n    } else {\n        return false\n    }\n}\n```\n\n#### 二、Express\n\n> https://www.expressjs.com.cn/\n\n基于 Node.js 平台，快速、开放、极简的 web 开发框架。\n\n##### 1.特色\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220411103139587.png\" alt=\"image-20220411103139587\" style=\"zoom: 50%;float:left;\" />\n\n##### 2.安装\n\n```js\n$ npm install express --save\n```\n\n##### 3.路由\n\n路由是指如何定义应用的端点（URIs）以及如何响应客户端的请求。\n\n路由是由一个 URI、HTTP 请求（GET、POST等）和若干个句柄组成，它的结构如下： app.METHOD(path, [callback...], callback)， app 是 express 对象的一个实例， METHOD 是一个 HTTP 请求方法， path 是服务器上的路径， callback 是当路由匹配时要执行的函数。\n\n下面是一个基本的路由示例：\n\n```js\nvar express = require('express');\nvar app = express();\n\n// respond with \"hello world\" when a GET request is made to the homepage\napp.get('/', function(req, res) {\n  res.send('hello world');\n});\n```\n\n路由路径和请求方法一起定义了请求的端点，它可以是字符串、字符串模式或者正则表达式。\n\n```js\n// 匹配根路径的请求\napp.get('/', function (req, res) {\n  res.send('root');\n});\n\n// 匹配 /about 路径的请求\napp.get('/about', function (req, res) {\n  res.send('about');\n});\n\n// 匹配 /random.text 路径的请求\napp.get('/random.text', function (req, res) {\n  res.send('random.text');\n});\n```\n\n使用字符串模式的路由路径示例：\n\n```js\n// 匹配 acd 和 abcd\napp.get('/ab?cd', function(req, res) {\n  res.send('ab?cd');\n});\n\n// 匹配 /ab/******\napp.get('/ab/:id', function(req, res) {\n  res.send('aaaaaaa');\n});\n\n// 匹配 abcd、abbcd、abbbcd等\napp.get('/ab+cd', function(req, res) {\n  res.send('ab+cd');\n});\n\n// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等\napp.get('/ab*cd', function(req, res) {\n  res.send('ab*cd');\n});\n\n// 匹配 /abe 和 /abcde\napp.get('/ab(cd)?e', function(req, res) {\n res.send('ab(cd)?e');\n});\n```\n\n使用正则表达式的路由路径示例：\n\n```js\n// 匹配任何路径中含有 a 的路径：\napp.get(/a/, function(req, res) {\n  res.send('/a/');\n});\n\n// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等\napp.get(/.*fly$/, function(req, res) {\n  res.send('/.*fly$/');\n});\n```\n\n可以为请求处理提供多个回调函数，其行为类似 中间件。唯一的区别是这些回调函数有可能调用 next('route') 方法而略过其他路由回调函数。可以利用该机制为路由定义前提条件，如果在现有路径上继续执行没有意义，则可将控制权交给剩下的路径。\n\n```js\napp.get('/example/a', function (req, res) {\n  res.send('Hello from A!');\n});\n```\n\n使用多个回调函数处理路由（记得指定 next 对象）：\n\n```js\napp.get('/example/b', function (req, res, next) {\n  console.log('response will be sent by the next function ...');\n  next();\n}, function (req, res) {\n  res.send('Hello from B!');\n});\n```\n\n\n\n使用回调函数数组处理路由：\n\n```js\nvar cb0 = function (req, res, next) {\n  console.log('CB0')\n  next()\n}\n\nvar cb1 = function (req, res, next) {\n  console.log('CB1')\n  next()\n}\n\nvar cb2 = function (req, res) {\n  res.send('Hello from C!')\n}\n\napp.get('/example/c', [cb0, cb1, cb2])\n```\n\n混合使用函数和函数数组处理路由：\n\n```js\nvar cb0 = function (req, res, next) {\n  console.log('CB0')\n  next()\n}\n\nvar cb1 = function (req, res, next) {\n  console.log('CB1')\n  next()\n}\n\napp.get('/example/d', [cb0, cb1], function (req, res, next) {\n  console.log('response will be sent by the next function ...')\n  next()\n}, function (req, res) {\n  res.send('Hello from D!')\n})\n```\n\n##### 4.中间件\n\nExpress 是一个自身功能极简，完全是由路由和中间件构成一个的 web 开发框架：从本质上来说，一个 Express 应用就是在调用各种中间件。\n\n中间件（Middleware） 是一个函数，它可以访问请求对象（request object (req)）, 响应对象（response object (res)）, 和 web 应用中处于请求-响应循环流程中的中间件，一般被命名为 next 的变量。\n\n中间件的功能包括：\n\n- 执行任何代码。\n- 修改请求和响应对象。\n- 终结请求-响应循环。\n- 调用堆栈中的下一个中间件。\n\n如果当前中间件没有终结请求-响应循环，则必须调用 next() 方法将控制权交给下一个中间件，否则请求就会挂起。\n\nExpress 应用可使用如下几种中间件：\n\n- 应用级中间件\n- 路由级中间件\n- 错误处理中间件\n- 内置中间件\n- 第三方中间件\n\n使用可选则挂载路径，可在应用级别或路由级别装载中间件。另外，你还可以同时装在一系列中间件函数，从而在一个挂载点上创建一个子中间件栈。\n\n###### （1）应用级中间件\n\n应用级中间件绑定到 app 对象 使用 app.use() 和 app.METHOD()， 其中， METHOD 是需要处理的 HTTP 请求的方法，例如 GET, PUT, POST 等等，全部小写。例如：\n\n```js\nvar app = express()\n\n// 没有挂载路径的中间件，应用的每个请求都会执行该中间件\napp.use(function (req, res, next) {\n  console.log('Time:', Date.now())\n  next()\n})\n\n```\n\n###### （2）路由级中间件\n\n路由级中间件和应用级中间件一样，只是它绑定的对象为 express.Router()。\n\n```js\nvar router = express.Router()\n```\n\n```js\nvar app = express()\nvar router = express.Router()\n\n// 没有挂载路径的中间件，通过该路由的每个请求都会执行该中间件\nrouter.use(function (req, res, next) {\n  console.log('Time:', Date.now())\n  next()\n})\n\n// 一个中间件栈，显示任何指向 /user/:id 的 HTTP 请求的信息\nrouter.use('/user/:id', function(req, res, next) {\n  console.log('Request URL:', req.originalUrl)\n  next()\n}, function (req, res, next) {\n  console.log('Request Type:', req.method)\n  next()\n})\n\n// 一个中间件栈，处理指向 /user/:id 的 GET 请求\nrouter.get('/user/:id', function (req, res, next) {\n  // 如果 user id 为 0, 跳到下一个路由\n  if (req.params.id == 0) next('route')\n  // 负责将控制权交给栈中下一个中间件\n  else next() //\n}, function (req, res, next) {\n  // 渲染常规页面\n  res.render('regular')\n})\n\n// 处理 /user/:id， 渲染一个特殊页面\nrouter.get('/user/:id', function (req, res, next) {\n  console.log(req.params.id)\n  res.render('special')\n})\n\n// 将路由挂载至应用\napp.use('/', router)\n```\n\n###### （3）错误处理中间件\n\n错误处理中间件和其他中间件定义类似，只是要使用 4 个参数，而不是 3 个，其签名如下： (err, req, res, next)。\n\n```js\napp.use(function(err, req, res, next) {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n```\n\n###### （4）内置的中间件\n\nexpress.static 是 Express 唯一内置的中间件。它基于 serve-static，负责在 Express 应用中提托管静态资源。每个应用可有多个静态目录。\n\n```js\napp.use(express.static('public'))\napp.use(express.static('uploads'))\napp.use(express.static('files'))\n```\n\n###### （5）第三方中间件\n\n安装所需功能的 node 模块，并在应用中加载，可以在应用级加载，也可以在路由级加载。\n\n下面的例子安装并加载了一个解析 cookie 的中间件： cookie-parser\n\n```\n$ npm install cookie-parser\n```\n\n```js\nvar express = require('express')\nvar app = express()\nvar cookieParser = require('cookie-parser')\n\n// 加载用于解析 cookie 的中间件\napp.use(cookieParser())\n```\n\n\n\n##### 5. 获取请求参数\n\nget\n\n```js\nreq.query\n```\n\npost\n\n```js\napp.use(express.urlencoded({extended:false}))\napp.use(express.json())\nreq.body\n```\n\n\n\n##### 6.利用 Express 托管静态文件\n\n通过 Express 内置的 express.static 可以方便地托管静态文件，例如图片、CSS、JavaScript 文件等。\n\n将静态资源文件所在的目录作为参数传递给 express.static 中间件就可以提供静态资源文件的访问了。例如，假设在 public 目录放置了图片、CSS 和 JavaScript 文件，你就可以：\n\n```js\napp.use(express.static('public'))\n```\n\n现在，public 目录下面的文件就可以访问了。\n\n```js\nhttp://localhost:3000/images/kitten.jpg\nhttp://localhost:3000/css/style.css\nhttp://localhost:3000/js/app.js\nhttp://localhost:3000/images/bg.png\nhttp://localhost:3000/hello.html\n```\n\n> 所有文件的路径都是相对于存放目录的，因此，存放静态文件的目录名不会出现在 URL 中。\n\n如果你的静态资源存放在多个目录下面，你可以多次调用 express.static 中间件：\n\n```js\napp.use(express.static('public'))\napp.use(express.static('files'))\n```\n\n访问静态资源文件时，express.static 中间件会根据目录添加的顺序查找所需的文件。\n\n如果你希望所有通过 express.static 访问的文件都存放在一个“虚拟（virtual）”目录（即目录根本不存在）下面，可以通过为静态资源目录指定一个挂载路径的方式来实现，如下所示：\n\n```\napp.use('/static', express.static('public'))\n```\n\n现在，你就可以通过带有 “/static” 前缀的地址来访问 public 目录下面的文件了。\n\n```js\nhttp://localhost:3000/static/images/kitten.jpg\nhttp://localhost:3000/static/css/style.css\nhttp://localhost:3000/static/js/app.js\nhttp://localhost:3000/static/images/bg.png\nhttp://localhost:3000/static/hello.html\n```\n\n##### 7.服务端渲染（模板引擎）\n\n```js\nnpm i ejs\n```\n\n需要在应用中进行如下设置才能让 Express 渲染模板文件：\n\n- views, 放模板文件的目录，比如： app.set('views', './views')\n- view engine, 模板引擎，比如： app.set('view engine', 'ejs')\n\n<b>ejs模板用法</b>\n- <%  %> 流程控制标签（写的是if else ，for）\n- <%= %> 输出标签（原文输出HTML标签）\n- <%- %> 输出标签（HTML会被浏览器解析）\n- <%# %> 注释标签\n- <%- include('user/show',{user:user}) %> 导入公共的模板内容\n\n##### 8.express项目生成器\n- 下载依赖项目：```$ npm i express-generator -g ```\n- 创建项目：```$ express [项目名] --view=[视图类型] ```\n- 下载依赖：```$ npm i ```\n- 内部代码解读： \n```\n1.bin/www :该文件为启动目录\n2.app.js文件解读：\n      var createError = require('http-errors');//错误信息提示\n      var cookieParser = require('cookie-parser');//后端获取设置cookie值\n      var logger = require('morgan'); //后端终端显示端口等日志\n ```\n#### 三、MongoDB\n\n##### 1.MongoDB数据库\n简单介绍一下MongoDB：\n传统的关系数据库（如mysql）一般由数据库（database）、表（table）、记录（record）三个层次概念组成，\nMongoDB是由数据库（database）、集合（collection）、文档对象（document）三个层次组成。\nMongoDB稳定\nMongoDB支持索引，索引放在内存中，能够提升随机读写的性能。如果索引不能完全放在内存，一旦出现随机读写比较高的时候，就会频繁地进行磁盘交换，MongoDB的性能就会急剧下降\nMongoDB占用的空间很大，因为它属于典型空间换时间原则的类型。那么它的磁盘空间比普通数据库会浪费一些\n\n##### 2.安装数据库\n\nhttps://docs.mongodb.com/manual/administration/install-community/\n\n##### 3.启动数据库\n\n###### （1）windows\n\n```s\nmongod --dbpath d:/data/db\nmongo\n```\n\n###### （2）mac\n\n```s\nmongod --config /usr/local/etc/mongod.conf\nmongo\n```\n\n##### 4.在命令行中操作数据库\n```\n//常规数据库操作\n(1)Help查看命令提示 \n\thelp    db.help()  db.test.help()  db.test.find().help()\n(2)创建/切换数据库\n\tuse music \n(3)查询数据库\n\tshow dbs\n(4)查看当前使用的数据库\n\tdb/db.getName()\n(5)显示当前DB状态\n\tdb.stats()\n(6)查看当前DB版本\n\tdb.version()\n(7)查看当前DB的链接机器地址\n\tdb.getMongo()\n(8)删除数据库\n\tdb.dropDatabase()\n//常规集合操作\n(1)创建一个集合\n\tdb.createCollection(\"collName\",{size:xx,capped:true,max:xx})\n // collName:名称 size:集合大小 capped:固定大小 max:最大存储空间\n(2)得到指定名称的集合\n\tdb.getCollection(\"account\")\n(3)得到当前所有的集合\n\tdb.getCollectionNames()\n(4)显示当前db所有集合的状态\n\tdb.printCollectionStats()\n(5)删除集合\n\tdb.users(集合名称).drop() \n//集合增删改查(以users集合为例)\n(1)添加\n\tdb.users.save([{name:'pan',age:21},name:'zhang',age:20])\n(2)删除\n\tdb.users.remove({age:20}) //删除一条带有age:20的数据\n\tdb.users.remove({}) //删除所有数据\n(3)修改\n\tdb.users.update({name:'pan'},{age:29})\n \t//找到一条是name:pan的数据将这一条数据替换成age:29\n\tdb.users.update({name:'pan'},{$set:{age:29}})\n \t//找到一条是name:pan的数据将这一条数据中age替换成29\n \tdb.users.update({name:'pan'},{$inc:{age:29}})\n \t//找到一条是name:pan的数据将这一条数据中age增加29(数据可为负数)\n(4)查询\n\t- 查询所有记录\n    db.users.find()\n   - 查询age=29的数据\n    db.users.find({age:29})\n   - 查询age>29的数据\n    db.users.find(age:{$gt:29})\n   - 查询age>=29的数据\n    db.users.find(age:{$gte:29})\n   - 查询age<30的数据\n    db.users.find(age:{$lt:30})\n   - 查询age<=30的数据\n    db.users.find(age:{$lte:30})\n   - 查询29<=age<=30的数据\n    db.users.find(age:{$gle:29,$lte:30})\n   - 模糊查询\n    db.users.find(name:/pan/) //注：name后面参数为正则\n   - 查询指定数据\n    db.users.find({},{name:1,age:1,_id:0})\n    //第一个参数表示查询条件\n    //第二个参数中1表示显示，0表示不显示\n   -按照年龄排序\n   \t db.users.find({}).sort({age:1})\n    // 1表示升序，-1表示降序\n   - 查询第n页m条数据\n   \t db.users.find({}).skip((n-1)*m).limit(m)\n   - 或者条件查询\n    db.users.find({$or:[{age:12},{age:20}]})\n    // 查询age:12或者age:20的所有每条数据\n   - 查询第一条数据\n   db.users.findOne()\n   - 查询某个结果记录条数\n   db.users.find().count()\n```\n\n##### 5.可视化工具进行增删改查\n\nRobomongo Robo3T adminMongo\n\n![image-20220413091031852](%E7%AC%94%E8%AE%B0.assets/image-20220413091031852.png)\n\n##### 6.nodejs连接操作数据库\n\n连接数据库\n\n```js\nconst mongoose = require(\"mongoose\")\n\nmongoose.connect(\"mongodb://127.0.0.1:27017/company-system\")\n```\n\n创建模型\n\n```js\nconst mongoose = require(\"mongoose\")\n\nconst Schema = mongoose.Schema\n\nconst UserType = {\n    username:String,\n    password:String,\n    gender:Number,\n    introduction:String,\n    avatar:String,\n    role:Number\n}\nconst UserModel = mongoose.model(\"user\",new Schema(UserType))\nmodule.exports  = UserModel \n```\n\n增加数据\n\n```js\nUserModel.create({\n    introduction,username,gender,avatar,password,role\n})\n```\n\n查询数据\n\n```js\nUserModel.find({username:\"kerwin\"},[\"username\",\"role\",\"introduction\",\"password\"]).sort({createTime:-1}).skip(10).limit(10)\n```\n\n更新数据\n\n```js\nUserModel.updateOne({\n    _id\n},{\n    introduction,username,gender,avatar\n})\n```\n\n删除数据\n\n```js\nUserModel.deleteOne({_id})\n```\n\n#### 四、接口规范与业务分层\n\n##### 1.接口规范\n###### RESTful架构\n> 服务器上每一种资源，比如一个文件，一张图片，一部电影，都有对应的地址，如果我们的客户端需要对服务器上的这个资源进行操作，就需要通过http西医执行相应的动作来操作它，比如进行获取、更新、删除\n\n简单来说就是**url中只包含名词表示资源，使用http动词表示动作进行操作资源**，举个例子左边错误，右边正确\n```\nGET /blog/getname --> GET /blog/name 获取所有文章\nGET /blog/addname --> POST /blog/name 添加一篇文章\nGET /blog/editname --> PUT /blog/name 添加一篇文章\nGET /blog/delname?id=1 --> DELETE /blog/name/1 删除一篇文章\n```\n> 使用方式\n```\nGET http://xxx/api/user    #获取列表\nPOST http://xxx/api/user   #创建列表\nPUT http://xxx/api/user/{id}    #修改用户信息\nDELETE http://xxx/api/user/{id}  #删除用户信息\n```\n> 过滤信息\n```\n用于补充规范一些通用字段\n?limit=10 #指定返回记录的数量\n?offset=10 #指定烦货柜记录的开始位置\n?page=2&per_page=100 #指定第几页，以及每页的记录数\n?sortby=name&order=asc #指定返回结果按照那个属性排序，以及排序顺序\n?state=close #指定筛选条件\n```\n##### 2.业务分层\n```\nrouter.js:负责请求分发给C层\ncontroller.js:C层负责处理业务逻辑（V与M之间的沟通）\nviews:V层:负责展示页面\nmodel:M层:负责处理数据（增删改查）\n```\n\n\n#### 五、登录鉴权\n\n##### 1. Cookie&Session\n\n「HTTP 无状态」**我们知道，HTTP 是无状态的。也就是说，HTTP 请求方和响应方间无法维护状态，都是一次性的，它不知道前后的请求都发生了什么。但有的场景下，我们需要维护状态。最典型的，一个用户登陆微博，发布、关注、评论，都应是在登录后的用户状态下的。**「标记」那解决办法是什么呢？!\n\n\n\n```js\nconst express = require(\"express\");\nconst session = require(\"express-session\");\nconst MongoStore = require(\"connect-mongo\");\nconst app = express();\n\n\napp.use(\n  session({\n    secret: \"this is session\", // 服务器生成 session 的签名\n    resave: true, \n    saveUninitialized: true, //强制将为初始化的 session 存储\n    cookie: {\n      maxAge: 1000 * 60 * 10,// 过期时间\n      secure: false, // 为 true 时候表示只有 https 协议才能访问cookie\n    },\n    rolling: true, //为 true 表示 超时前刷新，cookie 会重新计时； 为 false 表示在超时前刷新多少次，都是按照第一次刷新开始计时。\n    store: MongoStore.create({\n      mongoUrl: 'mongodb://127.0.0.1:27017/kerwin_session',\n      ttl: 1000 * 60 * 10 // 过期时间\n  }),\n\n  })\n);\n\napp.use((req,res,next)=>{\n  if(req.url===\"/login\"){\n    next()\n    return;\n  }\n  if(req.session.user){\n      req.session.garbage = Date();\n      next();\n  }else{\n   \t  res.redirect(\"/login\")   \n  }\n})\n\n```\n\n\n\n##### 2. JSON Web Token (JWT) \n\n###### （1）介绍\n\n\n\n我为什么要保存这可恶的session呢， 只让每个客户端去保存该多好？\n\n\n\n当然， 如果一个人的token 被别人偷走了， 那我也没办法， 我也会认为小偷就是合法用户， 这其实和一个人的session id 被别人偷走是一样的。\n\n这样一来， 我就不保存session id 了， 我只是生成token , 然后验证token ， 我用我的CPU计算时间获取了我的session 存储空间 ！\n\n解除了session id这个负担， 可以说是无事一身轻， 我的机器集群现在可以轻松地做水平扩展， 用户访问量增大， 直接加机器就行。 这种无状态的感觉实在是太好了！\n\n缺点：\n\n> 1. 占带宽，正常情况下要比 session_id 更大，需要消耗更多流量，挤占更多带宽，假如你的网站每月有 10 万次的浏览器，就意味着要多开销几十兆的流量。听起来并不多，但日积月累也是不小一笔开销。实际上，许多人会在 JWT 中存储的信息会更多；\n> 2. 无法在服务端注销，那么久很难解决劫持问题；\n> 3. 性能问题，JWT 的卖点之一就是加密签名，由于这个特性，接收方得以验证 JWT 是否有效且被信任。对于有着严格性能要求的 Web 应用，这并不理想，尤其对于单线程环境。\n\n注意：\n\n> CSRF攻击的原因是浏览器会自动带上cookie，而不会带上token；\n>\n> 以CSRF攻击为例：\n>\n> cookie：用户点击了链接，cookie未失效，导致发起请求后后端以为是用户正常操作，于是进行扣款操作；\n> token：用户点击链接，由于浏览器不会自动带上token，所以即使发了请求，后端的token验证不会通过，所以不会进行扣款操作；\n\n###### （2）实现\n\n```js\n//jsonwebtoken 封装\nconst jsonwebtoken = require(\"jsonwebtoken\")\nconst secret = \"kerwin\"\nconst JWT = {\n    generate(value,exprires){\n        return jsonwebtoken.sign(value,secret,{expiresIn:exprires})\n    },\n    verify(token){\n        try{\n            return jsonwebtoken.verify(token,secret)\n        }catch(e){\n            return false\n        }\n    }\n}\n\nmodule.exports = JWT\n```\n\n\n\n```js\n//node中间件校验\napp.use((req,res,next)=>{\n  // 如果token有效 ,next() \n  // 如果token过期了, 返回401错误\n  if(req.url===\"/login\"){\n    next()\n    return;\n  }\n\n  const token = req.headers[\"authorization\"].split(\" \")[1]\n  if(token){\n    var payload = JWT.verify(token)\n    // console.log(payload)\n    if(payload){\n      const newToken = JWT.generate({\n        _id:payload._id,\n        username:payload.username\n      },\"1d\")\n      res.header(\"Authorization\",newToken)\n      next()\n    }else{\n      res.status(401).send({errCode:\"-1\",errorInfo:\"token过期\"})\n    }\n  }\n})\n\n```\n\n```js\n //生成token\nconst token = JWT.generate({\n    _id: result[0]._id,\n    username: result[0].username\n}, \"1d\")\n\nres.header(\"Authorization\", token)\n```\n\n```js\n//前端拦截\n/*\n * @作者: kerwin\n * @公众号: 大前端私房菜\n */\nimport axios from 'axios'\n// Add a request interceptor\naxios.interceptors.request.use(function (config) {\n    const token = localStorage.getItem(\"token\")\n    config.headers.Authorization = `Bearer ${token}`\n\n    return config;\n  }, function (error) {\n    return Promise.reject(error);\n  });\n\n// Add a response interceptor\naxios.interceptors.response.use(function (response) {\n\n    const {authorization } = response.headers\n    authorization && localStorage.setItem(\"token\",authorization)\n    return response;\n  }, function (error) {\n\n    const {status} = error.response\n    if(status===401){\n        localStorage.removeItem(\"token\")\n        window.location.href=\"/login\"\n    }\n    return Promise.reject(error);\n  });\n\n```\n\n#### 六、文件上传管理\n\nMulter 是一个 node.js 中间件，用于处理 `multipart/form-data` 类型的表单数据，它主要用于上传文件。\n\n**注意**: Multer 不会处理任何非 `multipart/form-data` 类型的表单数据。\n\n```\nnpm install --save multer\n```\n\n```js\n//前后端分离-前端\n\nconst params = new FormData()\nparams.append('kerwinfile', file.file)\nparams.append('username', this.username)\nconst config = {\n\theaders: {\n\t\t\"Content-Type\":\"multipart/form-data\"\n\t}\n}\nhttp.post('/api/upload', params, config).then(res => {\n\tthis.imgpath = 'http://localhost:3000' + res.data\n})\t\n```\n\nMulter 会添加一个 `body` 对象 以及 `file` 或 `files` 对象 到 express 的 `request` 对象中。 `body` 对象包含表单的文本域信息，`file` 或 `files` 对象包含对象表单上传的文件信息。\n\n```js\n\n//前后端分离-后端\nrouter.post('/upload', upload.single('kerwinfile'),function(req, res, next) {\n\tconsole.log(req.file)\n})\n```\n\n#### 七、APIDOC - API 文档生成工具\n\napidoc 是一个简单的 RESTful API 文档生成工具，它从代码注释中提取特定格式的内容生成文档。支持诸如 Go、Java、C++、Rust 等大部分开发语言，具体可使用 `apidoc lang` 命令行查看所有的支持列表。\n\napidoc 拥有以下特点：\n\n1. 跨平台，linux、windows、macOS 等都支持；\n2. 支持语言广泛，即使是不支持，也很方便扩展；\n3. 支持多个不同语言的多个项目生成一份文档；\n4. 输出模板可自定义；\n5. 根据文档生成 mock 数据；\n\n```\nnpm install -g apidoc\n```\n\n\n注意：\n\n(1) 在当前文件夹下 apidoc.json\n\n```json\n{\n\t\"name\": \"****接口文档\",\n\t\"version\": \"1.0.0\",\n\t\"description\": \"关于****的接口文档描述\",\n\t\"title\": \"****\"\n}\n```\n\n（2）可以利用vscode apidoc snippets 插件创建api\n#### 八、Koa2\n\n\n##### 1.简介\n\nkoa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。使用 koa 编写 web 应用，通过组合不同的 generator，可以免除重复繁琐的回调函数嵌套，并极大地提升错误处理的效率。koa 不在内核方法中绑定任何中间件，它仅仅提供了一个轻量优雅的函数库，使得编写 Web 应用变得得心应手。\n\n##### 2. 快速开始\n\n###### 2.1 安装koa2\n\n```s\n# 初始化package.json\nnpm init\n\n# 安装koa2 \nnpm install koa\n```\n\n###### 2.2 hello world 代码\n\n```js\nconst Koa = require('koa')\nconst app = new Koa()\n\napp.use( async ( ctx ) => {\n  ctx.body = 'hello koa2' //json数据\n})\n\napp.listen(3000)\n\n```\n```\nctx.req\nNode 的 request对象.\nctx.res\nNode的 response对象.\n绕过Koa的response 处理是不被支持的.应避免使用以下node 属性:\nres.statusCode()\nres.WiiteHead()\nres.Write()\nres.end()\n\n\nctx.request\nkoa的 Request对象.\nctx.response\nkoa的 Response对象.\n以下访问器和Request别名等效:\nctx. header\nctx. headers\nctx.method\n ctx. method=\nctx.url\n ctx.url=\nctx. originalUrl\nctx.origin\nctx. href\n ctx. path\nctx. path=\n ctx. query\nctx. query=\nctx. querystring\n ctx. querystring=\nctx. host\nct.x.hostname\n以下访问器和Response 别名等效:\nctx.body\nctx.body=\nctx.status\nctx.status=\nctx.message\nctx.message=\nctx.length=\nctx.length\nctx.type=\nctx.type\nctx.headerSent\nctx.redirect()\nctx.attachment()\nctx.set()\nctx.append ()\nctx.remove ()\nctx.lastModified=\nctx.etag=\n```\n\n\n###### 2.3 启动demo\n\n```s\nnode index.js\n```\n\n##### 3. koa vs express\n\n通常都会说 Koa 是洋葱模型，这重点在于中间件的设计。但是按照上面的分析，会发现 Express 也是类似的，不同的是Express 中间件机制使用了 Callback 实现，这样如果出现异步则可能会使你在执行顺序上感到困惑，因此如果我们想做接口耗时统计、错误处理 Koa 的这种中间件模式处理起来更方便些。最后一点响应机制也很重要，Koa 不是立即响应，是整个中间件处理完成在最外层进行了响应，而 Express 则是立即响应。\n\n###### 3.1更轻量\n\n- koa 不提供内置的中间件；\n- koa 不提供路由，而是把路由这个库分离出来了（koa/router）\n\n###### 3.2 Context对象\n\nkoa增加了一个Context的对象，作为这次请求的上下文对象（在koa2中作为中间件的第一个参数传入）。同时Context上也挂载了Request和Response两个对象。和Express类似，这两个对象都提供了大量的便捷方法辅助开发, 这样的话对于在保存一些公有的参数的话变得更加合情合理\n\n###### 3.3 异步流程控制\n\n​    express采用callback来处理异步，    koa v1采用generator，koa v2 采用async/await。\n\n​\tgenerator和async/await使用同步的写法来处理异步，明显好于callback和promise，\n\n###### 3.4 中间件模型\n\n​\texpress基于connect中间件，线性模型；\n\n​     koa中间件采用洋葱模型（对于每个中间件，在完成了一些事情后，可以非常优雅的将控制权传递给下一个中间件，并能够等待它完成，当后续的中间件完成处理后，控制权又回到了自己）\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417083817823.png\" alt=\"image-20220417083817823\" style=\"zoom:50%;float:left;\" />\n\n   ![image-20220417085913567](%E7%AC%94%E8%AE%B0.assets/image-20220417085913567.png)\n\n```js\n//同步\nvar express = require(\"express\")\nvar app = express()\n\napp.use((req,res,next)=>{\n    console.log(1)\n    next()\n    console.log(4)\n    res.send(\"hello\")\n})\napp.use(()=>{\n    console.log(3)\n})\n\napp.listen(3000)\n//异步\nvar express = require(\"express\")\nvar app = express()\n\napp.use(async (req,res,next)=>{\n    console.log(1)\n    await next()\n    console.log(4)\n    res.send(\"hello\")\n})\napp.use(async ()=>{\n    console.log(2)\n    await delay(1)\n    console.log(3)\n})\n\nfunction delay(time){\n return new Promise((resolve,reject)=>{\n    setTimeout(resolve,1000)\n })\n}\n```\n\n```js\n//同步\nvar koa = require(\"koa\")\nvar app = new koa()\n\napp.use((ctx,next)=>{\n    console.log(1)\n    next()\n    console.log(4)\n    ctx.body=\"hello\"\n})\napp.use(()=>{\n    console.log(3)\n})\n\napp.listen(3000)\n\n//异步\nvar koa = require(\"koa\")\nvar app = new koa()\n\napp.use(async (ctx,next)=>{\n    console.log(1)\n    await next()\n    console.log(4)\n    ctx.body=\"hello\"\n}) \napp.use(async ()=>{\n    console.log(2)\n    await delay(1)\n    console.log(3)\n})\n\nfunction delay(time){\n return new Promise((resolve,reject)=>{\n    setTimeout(resolve,1000)\n })\n}\n\napp.listen(3000)\n```\n\n ##### 4. 路由\n\n###### 4.1基本用发\n\n```js\nvar Koa = require(\"koa\")\nvar Router = require(\"koa-router\")\n\nvar app = new Koa()\nvar router = new Router()\n\nrouter.post(\"/list\",(ctx)=>{\n    ctx.body=[\"111\",\"222\",\"333\"]\n})\napp.use(router.routes()).use(router.allowedMethods())\napp.listen(3000)\n```\n\n\n\n###### 4.2 router.allowedMethods作用\n\n![image-20220417102845079](%E7%AC%94%E8%AE%B0.assets/image-20220417102845079.png)\n\n###### 4.3 请求方式\n\nKoa-router 请求方式： `get` 、 `put` 、 `post` 、 `patch` 、 `delete` 、 `del`  ，而使用方法就是 `router.方式()`  ，比如 `router.get()` 和 `router.post()` 。而 `router.all()` 会匹配所有的请求方法。\n\n```js\nvar Koa = require(\"koa\")\nvar Router = require(\"koa-router\")\n\nvar app = new Koa()\nvar router = new Router()\n\nrouter.get(\"/user\",(ctx)=>{\n    ctx.body=[\"aaa\",\"bbb\",\"ccc\"]\n})\n.put(\"/user/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"user update\"}\n})\n.post(\"/user\",(ctx)=>{\n    ctx.body={ok:1,info:\"user post\"}\n})\n.del(\"/user/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"user del\"}\n})\n\n\napp.use(router.routes()).use(router.allowedMethods())\napp.listen(3000)\n```\n\n###### 4.4 拆分路由\n\nlist.js\n\n```js\nvar Router = require(\"koa-router\")\nvar router = new Router()\nrouter.get(\"/\",(ctx)=>{\n    ctx.body=[\"111\",\"222\",\"333\"]\n})\n.put(\"/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"list update\"}\n})\n.post(\"/\",(ctx)=>{\n    ctx.body={ok:1,info:\"list post\"}\n})\n.del(\"/:id\",(ctx)=>{\n    ctx.body={ok:1,info:\"list del\"}\n})\nmodule.exports = router\n```\n\nindex.js\n\n```js\nvar Router = require(\"koa-router\")\nvar router = new Router()\nvar user = require(\"./user\")\nvar list = require(\"./list\")\nrouter.use('/user', user.routes(), user.allowedMethods())\nrouter.use('/list', list.routes(), list.allowedMethods())\n\nmodule.exports = router\n```\n\nentry入口\n\n```js\nvar Koa = require(\"koa\")\nvar router = require(\"./router/index\")\n\nvar app = new Koa()\napp.use(router.routes()).use(router.allowedMethods())\napp.listen(3000)\n```\n\n\n\n###### 4.5 路由前缀\n\n```js\nrouter.prefix('/api')\n```\n\n\n\n###### 4.6 路由重定向\n\n```js\nrouter.get(\"/home\",(ctx)=>{\n    ctx.body=\"home页面\"\n})\n//写法1 \nrouter.redirect('/', '/home');\n//写法2\nrouter.get(\"/\",(ctx)=>{\n    ctx.redirect(\"/home\")\n})\n```\n\n##### 5.  静态资源\n\n```js\nconst Koa = require('koa')\nconst path = require('path')\nconst static = require('koa-static')\n\nconst app = new Koa()\n\napp.use(static(\n  path.join( __dirname,  \"public\")\n))\n\n\napp.use( async ( ctx ) => {\n  ctx.body = 'hello world'\n})\n\napp.listen(3000, () => {\n  console.log('[demo] static-use-middleware is starting at port 3000')\n})\n\n```\n\n\n\n##### 6.  获取请求参数\n\n###### 6.1get参数\n\n在koa中，获取GET请求数据源头是koa中request对象中的query方法或querystring方法，query返回是格式化好的参数对象，querystring返回的是请求字符串，由于ctx对request的API有直接引用的方式，所以获取GET请求数据有两个途径。\n\n- 是从上下文中直接获取 请求对象ctx.query，返回如 { a:1, b:2 } 请求字符串 ctx.querystring，返回如 a=1&b=2\n- 是从上下文的request对象中获取 请求对象ctx.request.query，返回如 { a:1, b:2 } 请求字符串 ctx.request.querystring，返回如 a=1&b=2\n\n###### 6.2post参数\n\n对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文的formData数据解析到ctx.request.body中\n\n```js\nconst bodyParser = require('koa-bodyparser')\n\n// 使用ctx.body解析中间件\napp.use(bodyParser())\n\n```\n\n\n\n##### 7. ejs模板\n\n###### 7.1 安装模块\n\n```js\n# 安装koa模板使用中间件\nnpm install --save koa-views\n\n# 安装ejs模板引擎\nnpm install --save ejs\n\n```\n\n###### 7.2 使用模板引擎\n\n**文件目录**\n\n```\n├── package.json\n├── index.js\n└── view\n    └── index.ejs\n```\n\n**./index.js文件**\n\n```js\nconst Koa = require('koa')\nconst views = require('koa-views')\nconst path = require('path')\nconst app = new Koa()\n\n// 加载模板引擎\napp.use(views(path.join(__dirname, './view'), {\n  extension: 'ejs'\n}))\n\napp.use( async ( ctx ) => {\n  let title = 'hello koa2'\n  await ctx.render('index', {\n    title,\n  })\n})\n\napp.listen(3000)\n```\n\n**./view/index.ejs 模板**\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title><%= title %></title>\n</head>\n<body>\n    <h1><%= title %></h1>\n    <p>EJS Welcome to <%= title %></p>\n</body>\n</html>\n```\n\n\n\n##### 8. cookie&session\n\n###### 8.1 cookie\n\nkoa提供了从上下文直接读取、写入cookie的方法\n\n- ctx.cookies.get(name, [options]) 读取上下文请求中的cookie\n- ctx.cookies.set(name, value, [options]) 在上下文中写入cookie\n\n###### 8.2 session\n\n- koa-session-minimal 适用于koa2 的session中间件，提供存储介质的读写接口 。\n\n   ```js\n   const session = require('koa-session-minimal')\n   app.use(session({\n       key: 'SESSION_ID',\n       cookie: {\n           maxAge:1000*60\n       }\n   }))\n   ```\n\n   \n\n   ```js\n   app.use(async (ctx, next) => {\n       //排除login相关的路由和接口\n       if (ctx.url.includes(\"login\")) {\n           await next()\n           return\n       }\n   \n       if (ctx.session.user) {\n           //重新设置以下sesssion\n           ctx.session.mydate = Date.now()\n           await next()\n       } else {\n   \n           ctx.redirect(\"/login\")\n       }\n   })\n   ```\n##### 9. JWT\n\n   ```js\napp.use(async(ctx, next) => {\n    //排除login相关的路由和接口\n    if (ctx.url.includes(\"login\")) {\n        await next()\n        return\n    }\n    const token = ctx.headers[\"authorization\"]?.split(\" \")[1]\n    // console.log(req.headers[\"authorization\"])\n    if(token){\n        const payload=  JWT.verify(token)\n        if(payload){\n            //重新计算token过期时间\n            const newToken = JWT.generate({\n                _id:payload._id,\n                username:payload.username\n            },\"10s\")\n\n            ctx.set(\"Authorization\",newToken)\n            await next()\n        }else{\n            ctx.status = 401\n            ctx.body = {errCode:-1,errInfo:\"token过期\"}\n        }\n    }else{\n        await next()\n    }\n})\n   ```\n\n#####    \n\n##### 10.上传文件\n\n> https://www.npmjs.com/package/@koa/multer\n\n```js\nnpm install --save @koa/multer multer\n```\n\n```js\nconst multer = require('@koa/multer');\nconst upload = multer({ dest: 'public/uploads/' })\n\nrouter.post(\"/\",upload.single('avatar'),\n(ctx,next)=>{\n    console.log(ctx.request.body,ctx.file)\n    ctx.body={\n        ok:1,\n        info:\"add user success\"\n    }\n})\n\n```\n\n##### 11.操作MongoDB\n\n```js\nconst mongoose = require(\"mongoose\")\n\nmongoose.connect(\"mongodb://127.0.0.1:27017/kerwin_project\")\n//插入集合和数据,数据库kerwin_project会自动创建\n```\n\n\n\n```js\nconst mongoose = require(\"mongoose\")\nconst Schema = mongoose.Schema\nconst UserType = {\n    username:String,\n    password:String,\n    age:Number,\n    avatar:String\n}\n\nconst UserModel = mongoose.model(\"user\",new Schema(UserType))\n// 模型user 将会对应 users 集合, \nmodule.exports = UserModel\n```\n\n\n\n#### 九、MySQL\n\n##### 1.介绍\n\n付费的商用数据库：\n\n- Oracle，典型的高富帅；\n- SQL Server，微软自家产品，Windows定制专款；\n- DB2，IBM的产品，听起来挺高端；\n- Sybase，曾经跟微软是好基友，后来关系破裂，现在家境惨淡。\n\n这些数据库都是不开源而且付费的，最大的好处是花了钱出了问题可以找厂家解决，不过在Web的世界里，常常需要部署成千上万的数据库服务器，当然不能把大把大把的银子扔给厂家，所以，无论是Google、Facebook，还是国内的BAT，无一例外都选择了免费的开源数据库：\n\n- MySQL，大家都在用，一般错不了；\n- PostgreSQL，学术气息有点重，其实挺不错，但知名度没有MySQL高；\n- sqlite，嵌入式数据库，适合桌面和移动应用。\n\n作为一个JavaScript全栈工程师，选择哪个免费数据库呢？当然是MySQL。因为MySQL普及率最高，出了错，可以很容易找到解决方法。而且，围绕MySQL有一大堆监控和运维的工具，安装和使用很方便。\n\n![image-20220420083146539](%E7%AC%94%E8%AE%B0.assets/image-20220420083146539.png)\n\n\n\n##### 2.与非关系数据库区别\n\n关系型和非关系型数据库的主要差异是数据存储的方式。关系型数据天然就是表格式的，因此存储在数据表的行和列中。数据表可以彼此关联协作存储，也很容易提取数据。\n\n与其相反，非关系型数据不适合存储在数据表的行和列中，而是大块组合在一起。非关系型数据通常存储在数据集中，就像文档、键值对或者图结构。你的数据及其特性是选择数据存储和提取方式的首要影响因素。\n\n**关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织**\n优点：\n1、易于维护：都是使用表结构，格式一致；\n2、使用方便：SQL语言通用，可用于复杂查询；\n3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。\n缺点：\n1、读写性能比较差，尤其是海量数据的高效率读写；\n2、固定的表结构，灵活度稍欠；\n3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈。\n\n**非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。**\n\n优点：\n\n1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。\n2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；\n3、高扩展性；\n4、成本低：nosql数据库部署简单，基本都是开源软件。\n\n缺点：\n\n1、不提供sql支持；\n2、无事务处理；\n3、数据结构相对复杂，复杂查询方面稍欠。\n\n##### 3.sql语句\n\n![image-20220420092527846](%E7%AC%94%E8%AE%B0.assets/image-20220420092527846.png)\n\n插入：\n\n```sql\nINSERT INTO `students`(`id`, `name`, `score`, `gender`) VALUES (null,'kerwin',100,1)\n//可以不设置id,create_time\n```\n更新：\n```sql\nUPDATE `students` SET `name`='tiechui',`score`=20,`gender`=0 WHERE id=2;\n```\n删除：\n```sql\nDELETE FROM `students` WHERE id=2;\n```\n查询：\n```sql\n查所有的数据所有的字段\nSELECT * FROM `students` WHERE 1;\n\n查所有的数据某个字段\nSELECT `id`, `name`, `score`, `gender` FROM `students` WHERE 1;\n\n条件查询\nSELECT * FROM `students` WHERE score>=80;\nSELECT * FROM `students` where score>=80 AND gender=1\n\n模糊查询\nSELECT * FROM `students` where name like '%k%'\n\n排序\nSELECT id, name, gender, score FROM students ORDER BY score;\nSELECT id, name, gender, score FROM students ORDER BY score DESC;\n\n分页查询\nSELECT id, name, gender, score FROM students LIMIT 50 OFFSET 0\n\n记录条数\nSELECT COUNT(*) FROM students;\nSELECT COUNT(*) kerwinnum FROM students;\n\n多表查询\n\nSELECT * FROM students, classes;（这种多表查询又称笛卡尔查询，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有100行记录的表进行笛卡尔查询将返回1万条记录，对两个各自有1万行记录的表进行笛卡尔查询将返回1亿条记录）\nSELECT\n    students.id sid,\n    students.name,\n    students.gender,\n    students.score,\n    classes.id cid,\n    classes.name cname\nFROM students, classes; （要使用表名.列名这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。）\n\nSELECT\n    s.id sid,\n    s.name,\n    s.gender,\n    s.score,\n    c.id cid,\n    c.name cname\nFROM students s, classes c; （SQL还允许给表设置一个别名）\n\n\n联表查询\nSELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.score\nFROM students s\nINNER JOIN classes c\nON s.class_id = c.id; （连接查询对多个表进行JOIN运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。）\n\n\n```\n\n![image-20220420090841742](%E7%AC%94%E8%AE%B0.assets/image-20220420090841742.png)\n\n注意：\n\n> 1. InnoDB 支持事务，MyISAM 不支持事务。这是 MySQL 将默认存储引擎从 MyISAM 变成 InnoDB 的重要原因之一；\n> 2. InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MYISAM 会失败；\n\n**外键约束**\n\nCASCADE\n在父表上update/delete记录时，同步update/delete掉子表的匹配记录 \n\nSET NULL\n在父表上update/delete记录时，将子表上匹配记录的列设为null (要注意子表的外键列不能为not null)  \n\nNO ACTION\n如果子表中有匹配的记录,则不允许对父表对应候选键进行update/delete操作 \n\nRESTRICT\n同no action, 都是立即检查外键约束\n\n##### 4.nodejs 操作数据库\n\n```js\nconst express = require('express')\nconst app = express()\nconst mysql2 = require('mysql2')\nconst port = 9000\n\napp.get('/',async (req, res) => {\n  const config = getDBConfig()\n  const promisePool = mysql2.createPool(config).promise();\n  // console.log(promisePool)\n      let user = await promisePool.query('select * from students');\n\n      console.log(user)\n      if (user[0].length) {\n          //存在用户\n          res.send(user[0])\n      } else {\n          //不存在\n          res.send( {\n              code: -2,\n              msg: 'user not exsit',\n          })\n      }      \n})\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`)\n})\n\n\nfunction getDBConfig() {\n  return {\n    host: '127.0.0.1',\n    user: 'root',\n    port: 3306,\n    password: '',\n    database: 'kerwin_test',\n    connectionLimit: 1 //创建一个连接池\n  }\n}\n```\n\n```js\n查询：\npromisePool.query('select * from users');\n\n插入：\npromisePool.query('INSERT INTO `users`(`id`,`name`,`age`, `password`) VALUES (?,?,?,?)',[null,\"kerwin\",100,\"123456\"]);\n\n更新：\npromisePool.query(`UPDATE users SET name = ? ,age=? WHERE id = ?`,[\"xiaoming2\",20,1])\n\n删除：\npromisePool.query(`delete from users where id=?`,[1])\n\n```\n\n\n\n#### 十、Socket编程\n\n##### 1.websocket介绍\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220421084242097.png\" alt=\"image-20220421084242097\" style=\"zoom:50%;\" />\n\n**应用场景：**\n\n- 弹幕\n\n- 媒体聊天\n\n- 协同编辑\n\n- 基于位置的应用\n\n- 体育实况更新\n\n- 股票基金报价实时更新\n\n\n\nWebSocket并不是全新的协议，而是利用了HTTP协议来建立连接。我们来看看WebSocket连接是如何创建的。\n\n首先，WebSocket连接必须由浏览器发起，因为请求协议是一个标准的HTTP请求，格式如下：\n\n```js\nGET ws://localhost:3000/ws/chat HTTP/1.1\nHost: localhost\nUpgrade: websocket\nConnection: Upgrade\nOrigin: http://localhost:3000\nSec-WebSocket-Key: client-random-string\nSec-WebSocket-Version: 13\n```\n\n该请求和普通的HTTP请求有几点不同：\n\n1. GET请求的地址不是类似`/path/`，而是以`ws://`开头的地址；\n2. 请求头`Upgrade: websocket`和`Connection: Upgrade`表示这个连接将要被转换为WebSocket连接；\n3. `Sec-WebSocket-Key`是用于标识这个连接，并非用于加密数据；\n4. `Sec-WebSocket-Version`指定了WebSocket的协议版本。\n\n随后，服务器如果接受该请求，就会返回如下响应：\n\n```\nHTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: server-random-string\n```\n\n该响应代码`101`表示本次连接的HTTP协议即将被更改，更改后的协议就是`Upgrade: websocket`指定的WebSocket协议。\n\n版本号和子协议规定了双方能理解的数据格式，以及是否支持压缩等等。如果仅使用WebSocket的API，就不需要关心这些。\n\n现在，一个WebSocket连接就建立成功，浏览器和服务器就可以随时主动发送消息给对方。消息有两种，一种是文本，一种是二进制数据。通常，我们可以发送JSON格式的文本，这样，在浏览器处理起来就十分容易。\n\n为什么WebSocket连接可以实现全双工通信而HTTP连接不行呢？实际上HTTP协议是建立在TCP协议之上的，TCP协议本身就实现了全双工通信，但是HTTP协议的请求－应答机制限制了全双工通信。WebSocket连接建立以后，其实只是简单规定了一下：接下来，咱们通信就不使用HTTP协议了，直接互相发数据吧。\n\n安全的WebSocket连接机制和HTTPS类似。首先，浏览器用`wss://xxx`创建WebSocket连接时，会先通过HTTPS创建安全的连接，然后，该HTTPS连接升级为WebSocket连接，底层通信走的仍然是安全的SSL/TLS协议。\n\n**浏览器支持**\n\n很显然，要支持WebSocket通信，浏览器得支持这个协议，这样才能发出`ws://xxx`的请求。目前，支持WebSocket的主流浏览器如下：\n\n- Chrome\n- Firefox\n- IE >= 10\n- Sarafi >= 6\n- Android >= 4.4\n- iOS >= 8\n\n**服务器支持**\n\n由于WebSocket是一个协议，服务器具体怎么实现，取决于所用编程语言和框架本身。Node.js本身支持的协议包括TCP协议和HTTP协议，要支持WebSocket协议，需要对Node.js提供的HTTPServer做额外的开发。已经有若干基于Node.js的稳定可靠的WebSocket实现，我们直接用npm安装使用即可。\n\n##### 2.ws模块\n\n服务器：\n\n```js\nconst  WebSocket = require(\"ws\")\nWebSocketServer = WebSocket.WebSocketServer\nconst wss = new WebSocketServer({ port: 8080 });\nwss.on('connection', function connection(ws) {\n    ws.on('message', function message(data, isBinary) {\n        wss.clients.forEach(function each(client) {\n            if (client !== ws && client.readyState === WebSocket.OPEN) {\n                client.send(data, { binary: isBinary });\n            }\n        });\n\n    });\n\n    ws.send('欢迎加入聊天室');\n});\n```\n\n客户端：\n\n```js\nvar ws = new WebSocket(\"ws://localhost:8080\")\nws.onopen = ()=>{\n    console.log(\"open\")\n}\nws.onmessage = (evt)=>{\n    console.log(evt.data)\n}\n```\n\n授权验证：\n\n\n\n```js\n//前端\nvar ws = new WebSocket(`ws://localhost:8080?token=${localStorage.getItem(\"token\")}`)\nws.onopen = () => {\n      console.log(\"open\")\n      ws.send(JSON.stringify({\n        type: WebSocketType.GroupList\n      }))\n    }\nws.onmessage = (evt) => {\n    console.log(evt.data)\n}\n//后端\nconst WebSocket = require(\"ws\");\nconst JWT = require('../util/JWT');\nWebSocketServer = WebSocket.WebSocketServer\nconst wss = new WebSocketServer({ port: 8080 });\nwss.on('connection', function connection(ws, req) {\n  const myURL = new URL(req.url, 'http://127.0.0.1:3000');\n  const payload = JWT.verify(myURL.searchParams.get(\"token\"))\n  if (payload) {\n    ws.user = payload\n    ws.send(createMessage(WebSocketType.GroupChat, ws.user, \"欢迎来到聊天室\"))\n\n    sendBroadList() //发送好友列表\n  } else {\n    ws.send(createMessage(WebSocketType.Error, null, \"token过期\"))\n  }\n  // console.log(3333,url)\n  ws.on('message', function message(data, isBinary) {\n    const messageObj = JSON.parse(data)\n    switch (messageObj.type) {\n      case WebSocketType.GroupList:\n        ws.send(createMessage(WebSocketType.GroupList, ws.user, JSON.stringify(Array.from(wss.clients).map(item => item.user))))\n        break;\n      case WebSocketType.GroupChat:\n        wss.clients.forEach(function each(client) {\n          if (client !== ws && client.readyState === WebSocket.OPEN) {\n            client.send(createMessage(WebSocketType.GroupChat, ws.user, messageObj.data));\n          }\n        });\n        break;\n      case WebSocketType.SingleChat:\n        wss.clients.forEach(function each(client) {\n          if (client.user.username === messageObj.to && client.readyState === WebSocket.OPEN) {\n            client.send(createMessage(WebSocketType.SingleChat, ws.user, messageObj.data));\n          }\n        });\n        break;\n    }\n\n    ws.on(\"close\",function(){\n      //删除当前用户\n      wss.clients.delete(ws.user)\n      sendBroadList() //发送好用列表\n    })\n  });\n\n});\nconst WebSocketType = {\n  Error: 0, //错误\n  GroupList: 1,//群列表\n  GroupChat: 2,//群聊\n  SingleChat: 3//私聊\n}\nfunction createMessage(type, user, data) {\n  return JSON.stringify({\n    type: type,\n    user: user,\n    data: data\n  });\n}\n\nfunction sendBroadList(){\n  wss.clients.forEach(function each(client) {\n    if (client.readyState === WebSocket.OPEN) {\n      client.send(createMessage(WebSocketType.GroupList, client.user, JSON.stringify(Array.from(wss.clients).map(item => item.user))))\n    }\n  });\n}\n```\n\n\n\n##### 3.socket.io模块\n\n服务端：\n\n```js\nconst io = require('socket.io')(server);\nio.on('connection', (socket) => {\n\n  const payload = JWT.verify(socket.handshake.query.token)\n  if (payload) {\n    socket.user = payload\n    socket.emit(WebSocketType.GroupChat, createMessage(socket.user, \"欢迎来到聊天室\"))\n    sendBroadList() //发送好友列表\n  } else {\n    socket.emit(WebSocketType.Error, createMessage(null, \"token过期\"))\n  }\n\n\n  socket.on(WebSocketType.GroupList, () => {\n    socket.emit(WebSocketType.GroupList, createMessage(null, Array.from(io.sockets.sockets).map(item => item[1].user).filter(item=>item)));\n  })\n\n  socket.on(WebSocketType.GroupChat, (messageObj) => {\n    socket.broadcast.emit(WebSocketType.GroupChat, createMessage(socket.user, messageObj.data));\n  })\n\n  socket.on(WebSocketType.SingleChat, (messageObj) => {\n    Array.from(io.sockets.sockets).forEach(function (socket) {\n      if (socket[1].user.username === messageObj.to) {\n        socket[1].emit(WebSocketType.SingleChat, createMessage(socket[1].user, messageObj.data));\n      }\n    })\n  })\n\n  socket.on('disconnect', reason => {\n     \n     sendBroadList() //发送好用列表\n  });\n\n});\n\nfunction sendBroadList() {\n  io.sockets.emit(WebSocketType.GroupList, createMessage(null, Array.from(io.sockets.sockets).map(item => item[1].user).filter(item=>item)))\n}\n//最后filter，是因为 有可能存在null的值\n\n```\n\n客户端：\n\n```js\nconst WebSocketType = {\n    Error: 0, //错误\n    GroupList: 1, //群列表\n    GroupChat: 2, //群聊\n    SingleChat: 3 //私聊\n}\n\n\nconst socket = io(`ws://localhost:3000?token=${localStorage.getItem(\"token\")}`);\nsocket.on(\"connect\",()=>{\n\tsocket.emit(WebSocketType.GroupList)\n})\nsocket.on(WebSocketType.GroupList, (messageObj) => {\n    select.innerHTML = \"\"\n    select.innerHTML = `<option value=\"all\">all</option>` + messageObj.data.map(item => `\n    <option value=\"${item.username}\">${item.username}</option>`).join(\"\")\n})\n\nsocket.on(WebSocketType.GroupChat, (msg) => {\n\tconsole.log(msg)\n})\n\nsocket.on(WebSocketType.SingleChat, (msg) => {\n\tconsole.log(msg)\n})\n\nsocket.on(WebSocketType.Error, (msg) => {\n    localStorage.removeItem(\"token\")\n    location.href = \"/login\"\n})\n\nsend.onclick = () => {\n    if (select.value === \"all\") {\n        socket.emit(WebSocketType.GroupChat,{\n            data: text.value\n        })\n    } else {\n        socket.emit(WebSocketType.SingleChat,{\n            data: text.value,\n            to:select.value\n        })\n    }\n}\n```\n\n\n\n#### 十一、mocha\n\n单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。\n\n比如对函数abs()，我们可以编写出以下几个测试用例：\n\n输入正数，比如1、1.2、0.99，期待返回值与输入相同；\n\n输入负数，比如-1、-1.2、-0.99，期待返回值与输入相反；\n\n输入0，期待返回0；\n\n输入非数值类型，比如null、[]、{}，期待抛出Error。\n\n把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。\n\n如果单元测试通过，说明我们测试的这个函数能够正常工作。如果单元测试不通过，要么函数有bug，要么测试条件输入不正确，总之，需要修复使单元测试能够通过。\n\n单元测试通过后有什么意义呢？如果我们对abs()函数代码做了修改，只需要再跑一遍单元测试，如果通过，说明我们的修改不会对abs()函数原有的行为造成影响，如果测试不通过，说明我们的修改与原有行为不一致，要么修改代码，要么修改测试。\n\n这种以测试为驱动的开发模式最大的好处就是确保一个程序模块的行为符合我们设计的测试用例。在将来修改的时候，可以极大程度地保证该模块行为仍然是正确的。\n\nmocha是JavaScript的一种单元测试框架，既可以在浏览器环境下运行，也可以在Node.js环境下运行。\n\n使用mocha，我们就只需要专注于编写单元测试本身，然后，让mocha去自动运行所有的测试，并给出测试结果。\n\nmocha的特点主要有：\n\n1. 既可以测试简单的JavaScript函数，又可以测试异步代码，因为异步是JavaScript的特性之一；\n2. 可以自动运行所有测试，也可以只运行特定的测试；\n3. 可以支持before、after、beforeEach和afterEach来编写初始化代码。\n\n##### 1.编写测试\n\n```js\nconst assert = require('assert');\nconst sum = require('../test');\ndescribe('#hello.js', () => {\n\n    describe('#sum()', () => {\n        it('sum() should return 0', () => {\n            assert.strictEqual(sum(), 0);\n        });\n\n        it('sum(1) should return 1', () => {\n            assert.strictEqual(sum(1), 1);\n        });\n\n        it('sum(1, 2) should return 3', () => {\n            assert.strictEqual(sum(1, 2), 3);\n        });\n\n        it('sum(1, 2, 3) should return 6', () => {\n            assert.strictEqual(sum(1, 2, 3), 6);\n        });\n    });\n});\n```\n\n\n\n##### 2.chai断言库\n\n\n\n![image-20220505113605440](%E7%AC%94%E8%AE%B0.assets/image-20220505113605440.png)\n\n```js\nvar chai = require('chai')\nvar assert = chai.assert;\n\ndescribe('assert Demo', function () {\n    it('use assert lib', function () {\n        var value = \"hello\";\n        assert.typeOf(value, 'string')\n        assert.equal(value, 'hello')\n        assert.lengthOf(value, 5)\n    })\n})\n\n```\n\n```js\nvar chai = require('chai');\nchai.should();\n\ndescribe('should Demo', function(){\n    it('use should lib', function () {\n        var value = 'hello'\n        value.should.exist.and.equal('hello').and.have.length(5).and.be.a('string')\n        // value.should.be.a('string')\n        // value.should.equal('hello')\n        // value.should.not.equal('hello2')\n        // value.should.have.length(5);\n    })\n});\n\n```\n\n```js\nvar chai = require('chai');\nvar expect = chai.expect;\n\ndescribe('expect Demo', function() {\n    it('use expect lib', function () {\n        var value = 'hello'\n        var number = 3\n\n        expect(number).to.be.at.most(5)\n        expect(number).to.be.at.least(3)\n        expect(number).to.be.within(1, 4)\n\n        expect(value).to.exist\n        expect(value).to.be.a('string')\n        expect(value).to.equal('hello')\n        expect(value).to.not.equal('您好')\n        expect(value).to.have.length(5)\n    })\n});\n\n```\n\n\n\n##### 3.异步测试\n\n```js\nvar fs =require(\"fs\").promises\nvar chai = require('chai');\nvar expect = chai.expect;\nit('test async function',async function () {\n    const data =await fs.readFile('./1.txt',\"utf8\");\n    expect(data).to.equal('hello')\n});\n```\n\n\n\n##### 4.http测试\n\n```js\nconst request = require('supertest')\nconst app = require('../app');\n\ndescribe('#test koa app', () => {\n    let server = app.listen(3000);\n    describe('#test server', () => {\n        it('#test GET /', async () => {\n            await request(server)\n                .get('/')\n                .expect('Content-Type', /text\\/html/)\n                .expect(200, '<h1>hello world</h1>');\n        });\n\n        after(function () {\n            server.close()\n        });\n    });\n});\n```\n\n\n\n##### 5.钩子函数\n\n```js\ndescribe('#hello.js', () => {\n    describe('#sum()', () => {\n        before(function () {\n            console.log('before:');\n        });\n\n        after(function () {\n            console.log('after.');\n        });\n\n        beforeEach(function () {\n            console.log('  beforeEach:');\n        });\n\n        afterEach(function () {\n            console.log('  afterEach.');\n        });\n    });\n});\n```","slug":"node笔记","published":1,"_id":"cldgzp0l700027kuu8zm06wor","comments":1,"layout":"post","photos":[],"link":"","content":"<h4 id=\"一、Node-js基础\"><a href=\"#一、Node-js基础\" class=\"headerlink\" title=\"一、Node.js基础\"></a>一、Node.js基础</h4><h5 id=\"1-认识Node-js\"><a href=\"#1-认识Node-js\" class=\"headerlink\" title=\"1.  认识Node.js\"></a>1.  认识Node.js</h5><blockquote>\n<p>Node.js是一个javascript运行环境。它让javascript可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与PHP、Java、Python、.NET、Ruby等后端语言平起平坐。</p>\n<p>Nodejs是基于V8引擎，V8是Google发布的开源JavaScript引擎，本身就是用于Chrome浏览器的js解释部分，但是Ryan Dahl 这哥们，鬼才般的，把这个V8搬到了服务器上，用于做服务器的软件。</p>\n</blockquote>\n<h6 id=\"01-nodejs的特性\"><a href=\"#01-nodejs的特性\" class=\"headerlink\" title=\"01 nodejs的特性\"></a>01 nodejs的特性</h6><ul>\n<li>Nodejs语法完全是js语法，只要你懂js基础就可以学会Nodejs后端开发</li>\n<li>NodeJs超强的高并发能力,实现高性能服务器</li>\n<li>开发周期短、开发成本低、学习成本低</li>\n</ul>\n<h6 id=\"02-使用-Node-js-需要了解多少-JavaScript\"><a href=\"#02-使用-Node-js-需要了解多少-JavaScript\" class=\"headerlink\" title=\"02 使用 Node.js 需要了解多少 JavaScript\"></a>02 使用 Node.js 需要了解多少 JavaScript</h6><blockquote>\n<p><a href=\"http://nodejs.cn/learn/how-much-javascript-do-you-need-to-know-to-use-nodejs\">http://nodejs.cn/learn/how-much-javascript-do-you-need-to-know-to-use-nodejs</a></p>\n</blockquote>\n<h6 id=\"03-浏览器环境vs-node环境\"><a href=\"#03-浏览器环境vs-node环境\" class=\"headerlink\" title=\"03 浏览器环境vs node环境\"></a>03 浏览器环境vs node环境</h6><p>Node.js 可以解析JS代码（没有浏览器安全级别的限制）提供很多系统级别的API，如：</p>\n<ul>\n<li><p>文件的读写 (File System)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./ajax.png&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, content</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(content)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li><p>进程的管理 (Process)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">main</span>(<span class=\"params\">argv</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(argv)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">main</span>(process.<span class=\"property\">argv</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">2</span>))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>网络通信 (HTTP/HTTPS)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req,res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;content-type&quot;</span>: <span class=\"string\">&quot;text/plain&quot;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  res.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;hello nodejs&quot;</span>)</span><br><span class=\"line\">  res.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;).<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h5 id=\"2-开发环境搭建\"><a href=\"#2-开发环境搭建\" class=\"headerlink\" title=\"2.  开发环境搭建\"></a>2.  开发环境搭建</h5><blockquote>\n<p><a href=\"http://nodejs.cn/download/\">http://nodejs.cn/download/</a></p>\n</blockquote>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210095903409.png\" alt=\"image-20220210095903409\"></p>\n<h5 id=\"3-模块、包、commonJS\"><a href=\"#3-模块、包、commonJS\" class=\"headerlink\" title=\"3.  模块、包、commonJS\"></a>3.  模块、包、commonJS</h5><p>​            <img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210100015768.png\" alt=\"image-20220210100015768\"></p>\n<h6 id=\"02-CommonJS规范\"><a href=\"#02-CommonJS规范\" class=\"headerlink\" title=\"02 CommonJS规范\"></a>02 CommonJS规范</h6><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101652166.png\" alt=\"image-20220210101652166\" style=\"zoom: 67%; float: left;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101720533.png\" alt=\"image-20220210101720533\" style=\"zoom: 67%; float: left;\" />\n\n<h6 id=\"03-modules模块化规范写法\"><a href=\"#03-modules模块化规范写法\" class=\"headerlink\" title=\"03 modules模块化规范写法\"></a>03 modules模块化规范写法</h6><p>我们可以把公共的功能 抽离成为一个单独的 js 文件 作为一个模块，默认情况下面这个模块里面的方法或者属性，外面是没法访问的。如果要让外部可以访问模块里面的方法或者属性，就必须在模块里面通过 exports 或者 module.exports 暴露属性或者方法。</p>\n<p>m1.js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;gp19&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">sayName</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;module 1&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接口暴露方法一：</span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">say</span>: sayName</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接口暴露方法二：</span></span><br><span class=\"line\"><span class=\"built_in\">exports</span>.<span class=\"property\">say</span> = sayName</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误！</span></span><br><span class=\"line\"><span class=\"built_in\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">say</span>: sayName</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>main.js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> m1 = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./m1&#x27;</span>)</span><br><span class=\"line\">m1.<span class=\"title function_\">say</span>()</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-Npm-amp-Yarn\"><a href=\"#4-Npm-amp-Yarn\" class=\"headerlink\" title=\"4.  Npm&amp;Yarn\"></a>4.  Npm&amp;Yarn</h5><h6 id=\"01-npm的使用\"><a href=\"#01-npm的使用\" class=\"headerlink\" title=\"01 npm的使用\"></a>01 npm的使用</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init</span><br><span class=\"line\">npm install 包名 –g  （uninstall,update）</span><br><span class=\"line\">npm install 包名 --save-dev (uninstall,update)</span><br><span class=\"line\">npm list -g (不加-g，列举当前目录下的安装包)</span><br><span class=\"line\">npm info 包名（详细信息） npm info 包名 <span class=\"title function_\">version</span>(获取最新版本)</span><br><span class=\"line\">npm install md5@<span class=\"number\">1</span>（安装指定版本）</span><br><span class=\"line\">npm <span class=\"title function_\">outdated</span>(  检查包是否已经过时)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;dependencies&quot;</span>: &#123;    <span class=\"string\">&quot;md5&quot;</span>: <span class=\"string\">&quot;^2.1.0&quot;</span>  &#125;  ^ 表示 如果 直接npm install 将会 安md5</span><br><span class=\"line\">    <span class=\"number\">2.</span>*.*  \t最新版本</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;dependencies&quot;</span>: &#123;    <span class=\"string\">&quot;md5&quot;</span>: <span class=\"string\">&quot;~2.1.0&quot;</span>  &#125;  ~ 表示 如果 直接npm install 将会 安装md5 <span class=\"number\">2.1</span>.*  最新版本</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;dependencies&quot;</span>: &#123;    <span class=\"string\">&quot;md5&quot;</span>: <span class=\"string\">&quot;*&quot;</span>  &#125;  * 表示 如果 直接npm install 将会 安装 md5  最新版本</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"02-全局安装-nrm\"><a href=\"#02-全局安装-nrm\" class=\"headerlink\" title=\"02 全局安装 nrm\"></a>02 全局安装 nrm</h6><blockquote>\n<p>NRM (npm registry manager)是npm的镜像源管理工具，有时候国外资源太慢，使用这个就可以快速地在 npm 源间切换。</p>\n</blockquote>\n<p><code>手动切换方法： npm config set registry https://registry.npm.taobao.org</code></p>\n<p><strong>安装 nrm</strong></p>\n<p>在命令行执行命令，npm install -g nrm，全局安装nrm。</p>\n<p><strong>使用 nrm</strong></p>\n<p>执行命令 nrm ls 查看可选的源。 其中，带*的是当前使用的源，上面的输出表明当前源是官方源。</p>\n<p><strong>切换 nrm</strong></p>\n<p>如果要切换到taobao源，执行命令nrm use taobao。</p>\n<p><strong>测试速度</strong></p>\n<p>你还可以通过 nrm test 测试相应源的响应时间。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nrm test</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> 扩展：</p>\n</blockquote>\n<blockquote>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210114017616.png\" alt=\"image-20220210114017616\"></p>\n</blockquote>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g cnpm --registry=https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"03-yarn使用\"><a href=\"#03-yarn使用\" class=\"headerlink\" title=\"03 yarn使用\"></a>03 yarn使用</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g yarn</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">对比<span class=\"attr\">npm</span>:</span><br><span class=\"line\">\t速度超快: <span class=\"title class_\">Yarn</span> 缓存了每个下载过的包，所以再次使用时无需重复下载。 同时利用并行下载以最大化资源利用率，因此安装速度更快。</span><br><span class=\"line\">    超级安全: 在执行代码之前，<span class=\"title class_\">Yarn</span> 会通过算法校验每个安装包的完整性。</span><br><span class=\"line\"></span><br><span class=\"line\">开始新项目</span><br><span class=\"line\">\tyarn init </span><br><span class=\"line\">添加依赖包</span><br><span class=\"line\">\tyarn add [package] </span><br><span class=\"line\">\tyarn add [package]@[version] </span><br><span class=\"line\">\tyarn add [package] --dev </span><br><span class=\"line\">升级依赖包</span><br><span class=\"line\">\t yarn upgrade [package]@[version] </span><br><span class=\"line\">移除依赖包</span><br><span class=\"line\">\t yarn remove [package]</span><br><span class=\"line\">\t </span><br><span class=\"line\">安装项目的全部依赖</span><br><span class=\"line\">\t yarn install </span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"5-内置模块\"><a href=\"#5-内置模块\" class=\"headerlink\" title=\"5.  内置模块\"></a>5.  内置模块</h5><h6 id=\"01-http模块\"><a href=\"#01-http模块\" class=\"headerlink\" title=\"01  http模块\"></a>01  http模块</h6><blockquote>\n<p>要使用 HTTP 服务器和客户端，则必须 <code>require(&#39;http&#39;)</code>。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建本地服务器来从其接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span> &#125;);</span><br><span class=\"line\">  res.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">8000</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建本地服务器来从其接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听请求事件</span></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;request&#x27;</span>, <span class=\"function\">(<span class=\"params\">request, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span> &#125;);</span><br><span class=\"line\">  res.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">8000</span>);</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"02-url模块\"><a href=\"#02-url模块\" class=\"headerlink\" title=\"02   url模块\"></a>02   url模块</h6><p><strong>02.1 parse</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> urlString = <span class=\"string\">&#x27;https://www.baidu.com:443/ad/index.html?id=8&amp;name=mouse#tag=110&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> parsedStr = url.<span class=\"title function_\">parse</span>(urlString)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsedStr)</span><br></pre></td></tr></table></figure>\n\n<p><strong>02.2 format</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> urlObject = &#123;</span><br><span class=\"line\">  <span class=\"attr\">protocol</span>: <span class=\"string\">&#x27;https:&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">slashes</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">auth</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  <span class=\"attr\">host</span>: <span class=\"string\">&#x27;www.baidu.com:443&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">port</span>: <span class=\"string\">&#x27;443&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">hostname</span>: <span class=\"string\">&#x27;www.baidu.com&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">hash</span>: <span class=\"string\">&#x27;#tag=110&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">search</span>: <span class=\"string\">&#x27;?id=8&amp;name=mouse&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">query</span>: &#123; <span class=\"attr\">id</span>: <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;mouse&#x27;</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">pathname</span>: <span class=\"string\">&#x27;/ad/index.html&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/ad/index.html?id=8&amp;name=mouse&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> parsedObj = url.<span class=\"title function_\">format</span>(urlObject)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsedObj)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>02.3 resolve</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = url.<span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;/one/two/three&#x27;</span>, <span class=\"string\">&#x27;four&#x27;</span>)  ( 注意最后加/ ，不加/的区别 )</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = url.<span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;http://example.com/&#x27;</span>, <span class=\"string\">&#x27;/one&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = url.<span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;http://example.com/one&#x27;</span>, <span class=\"string\">&#x27;/two&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(a + <span class=\"string\">&quot;,&quot;</span> + b + <span class=\"string\">&quot;,&quot;</span> + c)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"03-querystring模块\"><a href=\"#03-querystring模块\" class=\"headerlink\" title=\"03  querystring模块\"></a>03  querystring模块</h6><p><strong>03.1 parse</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> qs = <span class=\"string\">&#x27;x=3&amp;y=4&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parsed = querystring.<span class=\"title function_\">parse</span>(qs)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsed)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>03.2 stringify</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> qo = &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">  <span class=\"attr\">y</span>: <span class=\"number\">4</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> parsed = querystring.<span class=\"title function_\">stringify</span>(qo)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsed)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>03.3 escape/unescape</strong></p>\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211406894.png\" alt=\"image-20220213211406894\" style=\"zoom:67%;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211423142.png\" alt=\"image-20220213211423142\" style=\"zoom:67%;\" />\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;id=3&amp;city=北京&amp;url=https://www.baidu.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> escaped = querystring.<span class=\"built_in\">escape</span>(str)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(escaped)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;id%3D3%26city%3D%E5%8C%97%E4%BA%AC%26url%3Dhttps%3A%2F%2Fwww.baidu.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> unescaped = querystring.<span class=\"built_in\">unescape</span>(str)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(unescaped)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"04-http模块补充\"><a href=\"#04-http模块补充\" class=\"headerlink\" title=\"04  http模块补充\"></a>04  http模块补充</h6><p><strong>04.1 接口：jsonp</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> urlObj = url.<span class=\"title function_\">parse</span>(req.<span class=\"property\">url</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (urlObj.<span class=\"property\">pathname</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/api/user&#x27;</span>:</span><br><span class=\"line\">      res.<span class=\"title function_\">end</span>(<span class=\"string\">`<span class=\"subst\">$&#123;urlObj.query.cb&#125;</span>(&#123;&quot;name&quot;: &quot;gp145&quot;&#125;)`</span>)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      res.<span class=\"title function_\">end</span>(<span class=\"string\">&#x27;404.&#x27;</span>)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">8080</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;localhost:8080&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>04.2 跨域：CORS</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> urlObj = url.<span class=\"title function_\">parse</span>(req.<span class=\"property\">url</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    data += chunk</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">responseResult</span>(querystring.<span class=\"title function_\">parse</span>(data))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">responseResult</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (urlObj.<span class=\"property\">pathname</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/api/login&#x27;</span>:</span><br><span class=\"line\">        res.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">message</span>: data</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"attr\">default</span>:</span><br><span class=\"line\">        res.<span class=\"title function_\">end</span>(<span class=\"string\">&#x27;404.&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">8080</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;localhost:8080&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><strong>04.3 模拟get</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;https&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、接口 2、跨域</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> url = request.<span class=\"property\">url</span>.<span class=\"title function_\">substr</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  response.<span class=\"title function_\">writeHeader</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  https.<span class=\"title function_\">get</span>(<span class=\"string\">`https://m.lagou.com/listmore.json<span class=\"subst\">$&#123;url&#125;</span>`</span>, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      data += chunk</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      response.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">ret</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        data</span><br><span class=\"line\">      &#125;))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">8080</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;localhost:8080&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>04.4 模拟post：服务器提交（攻击）</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;https&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> postData = querystring.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">province</span>: <span class=\"string\">&#x27;上海&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">city</span>: <span class=\"string\">&#x27;上海&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">district</span>: <span class=\"string\">&#x27;宝山区&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">address</span>: <span class=\"string\">&#x27;同济支路199号智慧七立方3号楼2-4层&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">latitude</span>: <span class=\"number\">43.0</span>,</span><br><span class=\"line\">  <span class=\"attr\">longitude</span>: <span class=\"number\">160.0</span>,</span><br><span class=\"line\">  <span class=\"attr\">message</span>: <span class=\"string\">&#x27;求购一条小鱼&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">contact</span>: <span class=\"string\">&#x27;13666666&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"string\">&#x27;sell&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">time</span>: <span class=\"number\">1571217561</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> options = &#123;</span><br><span class=\"line\">  <span class=\"attr\">protocol</span>: <span class=\"string\">&#x27;https:&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">hostname</span>: <span class=\"string\">&#x27;ik9hkddr.qcloud.la&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">method</span>: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">port</span>: <span class=\"number\">443</span>,</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/index.php/trade/add_item&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">headers</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"title class_\">Buffer</span>.<span class=\"title function_\">byteLength</span>(postData)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">doPost</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> data</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> req = https.<span class=\"title function_\">request</span>(options, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\"><span class=\"params\">chunk</span> =&gt;</span> data += chunk)</span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">write</span>(postData)</span><br><span class=\"line\">  req.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// setInterval(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   doPost()</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;, 1000)</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>04.5 爬虫</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;https&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cheerio&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  response.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json;charset=utf-8&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// protocol: &#x27;https:&#x27;,</span></span><br><span class=\"line\">    <span class=\"attr\">hostname</span>: <span class=\"string\">&#x27;i.maoyan.com&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">port</span>: <span class=\"number\">443</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> req = https.<span class=\"title function_\">request</span>(options, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      data += chunk</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">filterData</span>(data)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">filterData</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//   console.log(data)</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> $ = cheerio.<span class=\"title function_\">load</span>(data)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> $movieList = $(<span class=\"string\">&#x27;.column.content&#x27;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>($movieList)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> movies = []</span><br><span class=\"line\">    $movieList.<span class=\"title function_\">each</span>(<span class=\"function\">(<span class=\"params\">index, value</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      movies.<span class=\"title function_\">push</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: $(value).<span class=\"title function_\">find</span>(<span class=\"string\">&#x27;.movie-title .title&#x27;</span>).<span class=\"title function_\">text</span>(),</span><br><span class=\"line\">        <span class=\"attr\">detail</span>: $(value).<span class=\"title function_\">find</span>(<span class=\"string\">&#x27;.detail .actor&#x27;</span>).<span class=\"title function_\">text</span>(),</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    response.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(movies))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;).<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"05-event模块\"><a href=\"#05-event模块\" class=\"headerlink\" title=\"05  event模块\"></a>05  event模块</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">EventEmitter</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;events&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyEventEmitter</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">EventEmitter</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> event = <span class=\"keyword\">new</span> <span class=\"title class_\">MyEventEmitter</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">event.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;play&#x27;</span>, <span class=\"function\">(<span class=\"params\">movie</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(movie)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">event.<span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;play&#x27;</span>, <span class=\"string\">&#x27;我和我的祖国&#x27;</span>)</span><br><span class=\"line\">event.<span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;play&#x27;</span>, <span class=\"string\">&#x27;中国机长&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"06-fs文件操作模块\"><a href=\"#06-fs文件操作模块\" class=\"headerlink\" title=\"06  fs文件操作模块\"></a>06  fs文件操作模块</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建文件夹</span></span><br><span class=\"line\">fs.<span class=\"title function_\">mkdir</span>(<span class=\"string\">&#x27;./logs&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 文件夹改名</span></span><br><span class=\"line\">fs.<span class=\"title function_\">rename</span>(<span class=\"string\">&#x27;./logs&#x27;</span>, <span class=\"string\">&#x27;./log&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除文件夹</span></span><br><span class=\"line\">fs.<span class=\"title function_\">rmdir</span>(<span class=\"string\">&#x27;./log&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 写内容到文件里</span></span><br><span class=\"line\">fs.<span class=\"title function_\">writeFile</span>(</span><br><span class=\"line\">  <span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;hello&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 错误优先的回调函数</span></span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(err.<span class=\"property\">message</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;文件创建成功&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 给文件追加内容</span></span><br><span class=\"line\">fs.<span class=\"title function_\">appendFile</span>(<span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>, <span class=\"string\">&#x27;\\nworld&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读取文件内容</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除文件</span></span><br><span class=\"line\">fs.<span class=\"title function_\">unlink</span>(<span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 批量写文件</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">  fs.<span class=\"title function_\">writeFile</span>(<span class=\"string\">`./logs/log-<span class=\"subst\">$&#123;i&#125;</span>.txt`</span>, <span class=\"string\">`log-<span class=\"subst\">$&#123;i&#125;</span>`</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读取文件/目录信息</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readdir</span>(<span class=\"string\">&#x27;./&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  data.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">value, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    fs.<span class=\"title function_\">stat</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;value&#125;</span>`</span>, <span class=\"function\">(<span class=\"params\">err, stats</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// console.log(value + &#x27;:&#x27; + stats.size)</span></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(value + <span class=\"string\">&#x27; is &#x27;</span> + (stats.<span class=\"title function_\">isDirectory</span>() ? <span class=\"string\">&#x27;directory&#x27;</span> : <span class=\"string\">&#x27;file&#x27;</span>))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 同步读取文件</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> content = fs.<span class=\"title function_\">readFileSync</span>(<span class=\"string\">&#x27;./logs/log-1.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(content)</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(e.<span class=\"property\">message</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步读取文件：方法一</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./logs/log-0.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, content</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(content)</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步读取文件：方法二</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>).<span class=\"property\">promises</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./logs/log-0.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">result</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(result)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>在<code>fs</code>模块中，提供同步方法是为了方便使用。那我们到底是应该用异步方法还是同步方法呢？</p>\n<p>由于Node环境执行的JavaScript代码是服务器端代码，所以，绝大部分需要在服务器运行期反复执行业务逻辑的代码，<em>必须使用异步代码</em>，否则，同步代码在执行时期，服务器将停止响应，因为JavaScript只有一个执行线程。</p>\n<p>服务器启动时如果需要读取配置文件，或者结束时需要写入到状态文件时，可以使用同步代码，因为这些代码只在启动和结束时执行一次，不影响服务器正常运行时的异步执行。</p>\n<h6 id=\"07-stream流模块\"><a href=\"#07-stream流模块\" class=\"headerlink\" title=\"07  stream流模块\"></a>07  stream流模块</h6><p><code>stream</code>是Node.js提供的又一个仅在服务区端可用的模块，目的是支持“流”这种数据结构。</p>\n<p>什么是流？流是一种抽象的数据结构。想象水流，当在水管中流动时，就可以从某个地方（例如自来水厂）源源不断地到达另一个地方（比如你家的洗手池）。我们也可以把数据看成是数据流，比如你敲键盘的时候，就可以把每个字符依次连起来，看成字符流。这个流是从键盘输入到应用程序，实际上它还对应着一个名字：标准输入流（stdin）。</p>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220407085931744.png\" alt=\"image-20220407085931744\"></p>\n<p>如果应用程序把字符一个一个输出到显示器上，这也可以看成是一个流，这个流也有名字：标准输出流（stdout）。流的特点是数据是有序的，而且必须依次读取，或者依次写入，不能像Array那样随机定位。</p>\n<p>有些流用来读取数据，比如从文件读取数据时，可以打开一个文件流，然后从文件流中不断地读取数据。有些流用来写入数据，比如向文件写入数据时，只需要把数据不断地往文件流中写进去就可以了。</p>\n<p>在Node.js中，流也是一个对象，我们只需要响应流的事件就可以了：<code>data</code>事件表示流的数据已经可以读取了，<code>end</code>事件表示这个流已经到末尾了，没有数据可以读取了，<code>error</code>事件表示出错了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打开一个流:</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> rs = fs.<span class=\"title function_\">createReadStream</span>(<span class=\"string\">&#x27;sample.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">rs.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;DATA:&#x27;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(chunk);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">rs.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;END&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">rs.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">err</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ERROR: &#x27;</span> + err);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>要注意，<code>data</code>事件可能会有多次，每次传递的<code>chunk</code>是流的一部分数据。</p>\n<p>要以流的形式写入文件，只需要不断调用<code>write()</code>方法，最后以<code>end()</code>结束：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> ws1 = fs.<span class=\"title function_\">createWriteStream</span>(<span class=\"string\">&#x27;output1.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>);</span><br><span class=\"line\">ws1.<span class=\"title function_\">write</span>(<span class=\"string\">&#x27;使用Stream写入文本数据...\\n&#x27;</span>);</span><br><span class=\"line\">ws1.<span class=\"title function_\">write</span>(<span class=\"string\">&#x27;END.&#x27;</span>);</span><br><span class=\"line\">ws1.<span class=\"title function_\">end</span>();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>pipe</code> 就像可以把两个水管串成一个更长的水管一样，两个流也可以串起来。一个<code>Readable</code>流和一个<code>Writable</code>流串起来后，所有的数据自动从<code>Readable</code>流进入<code>Writable</code>流，这种操作叫<code>pipe</code>。</p>\n<p>在Node.js中，<code>Readable</code>流有一个<code>pipe()</code>方法，就是用来干这件事的。</p>\n<p>让我们用<code>pipe()</code>把一个文件流和另一个文件流串起来，这样源文件的所有数据就自动写入到目标文件里了，所以，这实际上是一个复制文件的程序：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> readstream = fs.<span class=\"title function_\">createReadStream</span>(<span class=\"string\">&#x27;./1.txt&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> writestream = fs.<span class=\"title function_\">createWriteStream</span>(<span class=\"string\">&#x27;./2.txt&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">readstream.<span class=\"title function_\">pipe</span>(writestream)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"08-zlib\"><a href=\"#08-zlib\" class=\"headerlink\" title=\"08 zlib\"></a>08 zlib</h6><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220407105916114.png\" alt=\"image-20220407105916114\" style=\"zoom:50%;\" />\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> zlib = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;zlib&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> gzip = zlib.<span class=\"title function_\">createGzip</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> readstream = fs.<span class=\"title function_\">createReadStream</span>(<span class=\"string\">&#x27;./note.txt&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> writestream = fs.<span class=\"title function_\">createWriteStream</span>(<span class=\"string\">&#x27;./note2.txt&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">readstream</span><br><span class=\"line\">  .<span class=\"title function_\">pipe</span>(gzip)</span><br><span class=\"line\">  .<span class=\"title function_\">pipe</span>(writestream)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"09-crypto\"><a href=\"#09-crypto\" class=\"headerlink\" title=\"09 crypto\"></a>09 crypto</h6><p>crypto模块的目的是为了提供通用的加密和哈希算法。用纯JavaScript代码实现这些功能不是不可能，但速度会非常慢。Nodejs用C/C++实现这些算法后，通过cypto这个模块暴露为JavaScript接口，这样用起来方便，运行速度也快。</p>\n<p>MD5是一种常用的哈希算法，用于给任意数据一个“签名”。这个签名通常用一个十六进制的字符串表示：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;crypto&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hash = crypto.<span class=\"title function_\">createHash</span>(<span class=\"string\">&#x27;md5&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 可任意多次调用update():</span></span><br><span class=\"line\">hash.<span class=\"title function_\">update</span>(<span class=\"string\">&#x27;Hello, world!&#x27;</span>);</span><br><span class=\"line\">hash.<span class=\"title function_\">update</span>(<span class=\"string\">&#x27;Hello, nodejs!&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(hash.<span class=\"title function_\">digest</span>(<span class=\"string\">&#x27;hex&#x27;</span>)); </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>update()</code>方法默认字符串编码为<code>UTF-8</code>，也可以传入Buffer。</p>\n<p>如果要计算SHA1，只需要把<code>&#39;md5&#39;</code>改成<code>&#39;sha1&#39;</code>，就可以得到SHA1的结果<code>1f32b9c9932c02227819a4151feed43e131aca40</code>。</p>\n<p>Hmac算法也是一种哈希算法，它可以利用MD5或SHA1等哈希算法。不同的是，Hmac还需要一个密钥：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const crypto = require(&#x27;crypto&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">const hmac = crypto.createHmac(&#x27;sha256&#x27;, &#x27;secret-key&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">hmac.update(&#x27;Hello, world!&#x27;);</span><br><span class=\"line\">hmac.update(&#x27;Hello, nodejs!&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(hmac.digest(&#x27;hex&#x27;)); // 80f7e22570...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>只要密钥发生了变化，那么同样的输入数据也会得到不同的签名，因此，可以把Hmac理解为用随机数“增强”的哈希算法。</p>\n<p>AES是一种常用的对称加密算法，加解密都用同一个密钥。crypto模块提供了AES支持，但是需要自己封装好函数，便于使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;crypto&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">encrypt</span> (key, iv, data) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> decipher = crypto.<span class=\"title function_\">createCipheriv</span>(<span class=\"string\">&#x27;aes-128-cbc&#x27;</span>, key, iv);</span><br><span class=\"line\">    <span class=\"comment\">// decipher.setAutoPadding(true);</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> decipher.<span class=\"title function_\">update</span>(data, <span class=\"string\">&#x27;binary&#x27;</span>, <span class=\"string\">&#x27;hex&#x27;</span>) + decipher.<span class=\"title function_\">final</span>(<span class=\"string\">&#x27;hex&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">decrypt</span> (key, iv, crypted) &#123;</span><br><span class=\"line\">     crypted = <span class=\"title class_\">Buffer</span>.<span class=\"title function_\">from</span>(crypted, <span class=\"string\">&#x27;hex&#x27;</span>).<span class=\"title function_\">toString</span>(<span class=\"string\">&#x27;binary&#x27;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">let</span> decipher = crypto.<span class=\"title function_\">createDecipheriv</span>(<span class=\"string\">&#x27;aes-128-cbc&#x27;</span>, key, iv);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> decipher.<span class=\"title function_\">update</span>(crypted, <span class=\"string\">&#x27;binary&#x27;</span>, <span class=\"string\">&#x27;utf8&#x27;</span>) + decipher.<span class=\"title function_\">final</span>(<span class=\"string\">&#x27;utf8&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">key,iv必须是<span class=\"number\">16</span>个字节</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>可以看出，加密后的字符串通过解密又得到了原始内容。</p>\n<h5 id=\"6-路由\"><a href=\"#6-路由\" class=\"headerlink\" title=\"6.   路由\"></a>6.   路由</h5><h6 id=\"01-基础\"><a href=\"#01-基础\" class=\"headerlink\" title=\"01   基础\"></a>01   基础</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * @作者: kerwin</span></span><br><span class=\"line\"><span class=\"comment\"> * @公众号: 大前端私房菜</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;path&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">render</span>(<span class=\"params\">res, path</span>) &#123;</span><br><span class=\"line\">    res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/html;charset=utf8&quot;</span> &#125;)</span><br><span class=\"line\">    res.<span class=\"title function_\">write</span>(fs.<span class=\"title function_\">readFileSync</span>(path, <span class=\"string\">&quot;utf8&quot;</span>))</span><br><span class=\"line\">    res.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> route = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;/login&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(res, <span class=\"string\">&quot;./static/login.html&quot;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&quot;/home&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(res, <span class=\"string\">&quot;./static/home.html&quot;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;/404&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">404</span>, &#123; <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/html;charset=utf8&quot;</span> &#125;)</span><br><span class=\"line\">        res.<span class=\"title function_\">write</span>(fs.<span class=\"title function_\">readFileSync</span>(<span class=\"string\">&quot;./static/404.html&quot;</span>, <span class=\"string\">&quot;utf8&quot;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"02-获取参数\"><a href=\"#02-获取参数\" class=\"headerlink\" title=\"02   获取参数\"></a>02   获取参数</h6><p>get请求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;/api/login&quot;</span>:<span class=\"function\">(<span class=\"params\">req,res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> myURL = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(req.<span class=\"property\">url</span>, <span class=\"string\">&#x27;http://127.0.0.1:3000&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myURL.<span class=\"property\">searchParams</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;username&quot;</span>))   </span><br><span class=\"line\">    <span class=\"title function_\">render</span>(res,<span class=\"string\">`&#123;ok:1&#125;`</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>post请求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;/api/login&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> post = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中</span></span><br><span class=\"line\">        req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) &#123;</span><br><span class=\"line\">            post += chunk;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。</span></span><br><span class=\"line\">        req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            post = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(post);</span><br><span class=\"line\">            <span class=\"title function_\">render</span>(res, <span class=\"string\">`&#123;ok:1&#125;`</span>)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"03-静态资源处理\"><a href=\"#03-静态资源处理\" class=\"headerlink\" title=\"03   静态资源处理\"></a>03   静态资源处理</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">readStaticFile</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> myURL = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(req.<span class=\"property\">url</span>, <span class=\"string\">&#x27;http://127.0.0.1:3000&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> filePathname = path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&quot;/static&quot;</span>, myURL.<span class=\"property\">pathname</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fs.<span class=\"title function_\">existsSync</span>(filePathname)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// console.log(1111)</span></span><br><span class=\"line\">        res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">`<span class=\"subst\">$&#123;mime.getType(myURL.pathname.split(<span class=\"string\">&quot;.&quot;</span>)[<span class=\"number\">1</span>])&#125;</span>;charset=utf8`</span> &#125;)</span><br><span class=\"line\">        res.<span class=\"title function_\">write</span>(fs.<span class=\"title function_\">readFileSync</span>(filePathname, <span class=\"string\">&quot;utf8&quot;</span>))</span><br><span class=\"line\">        res.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、Express\"><a href=\"#二、Express\" class=\"headerlink\" title=\"二、Express\"></a>二、Express</h4><blockquote>\n<p><a href=\"https://www.expressjs.com.cn/\">https://www.expressjs.com.cn/</a></p>\n</blockquote>\n<p>基于 Node.js 平台，快速、开放、极简的 web 开发框架。</p>\n<h5 id=\"1-特色\"><a href=\"#1-特色\" class=\"headerlink\" title=\"1.特色\"></a>1.特色</h5><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220411103139587.png\" alt=\"image-20220411103139587\" style=\"zoom: 50%;float:left;\" />\n\n<h5 id=\"2-安装\"><a href=\"#2-安装\" class=\"headerlink\" title=\"2.安装\"></a>2.安装</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install express --save</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-路由\"><a href=\"#3-路由\" class=\"headerlink\" title=\"3.路由\"></a>3.路由</h5><p>路由是指如何定义应用的端点（URIs）以及如何响应客户端的请求。</p>\n<p>路由是由一个 URI、HTTP 请求（GET、POST等）和若干个句柄组成，它的结构如下： app.METHOD(path, [callback…], callback)， app 是 express 对象的一个实例， METHOD 是一个 HTTP 请求方法， path 是服务器上的路径， callback 是当路由匹配时要执行的函数。</p>\n<p>下面是一个基本的路由示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// respond with &quot;hello world&quot; when a GET request is made to the homepage</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;hello world&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>路由路径和请求方法一起定义了请求的端点，它可以是字符串、字符串模式或者正则表达式。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配根路径的请求</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;root&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /about 路径的请求</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/about&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;about&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /random.text 路径的请求</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/random.text&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;random.text&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用字符串模式的路由路径示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配 acd 和 abcd</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab?cd&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab?cd&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /ab/******</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab/:id&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;aaaaaaa&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abbcd、abbbcd等</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab+cd&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab+cd&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab*cd&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab*cd&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /abe 和 /abcde</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab(cd)?e&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\"> res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab(cd)?e&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用正则表达式的路由路径示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配任何路径中含有 a 的路径：</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"regexp\">/a/</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;/a/&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"regexp\">/.*fly$/</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;/.*fly$/&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>可以为请求处理提供多个回调函数，其行为类似 中间件。唯一的区别是这些回调函数有可能调用 next(‘route’) 方法而略过其他路由回调函数。可以利用该机制为路由定义前提条件，如果在现有路径上继续执行没有意义，则可将控制权交给剩下的路径。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/a&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from A!&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用多个回调函数处理路由（记得指定 next 对象）：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/b&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;response will be sent by the next function ...&#x27;</span>);</span><br><span class=\"line\">  <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from B!&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>使用回调函数数组处理路由：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cb0 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB0&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cb1 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB1&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cb2 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from C!&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/c&#x27;</span>, [cb0, cb1, cb2])</span><br></pre></td></tr></table></figure>\n\n<p>混合使用函数和函数数组处理路由：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cb0 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB0&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cb1 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB1&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/d&#x27;</span>, [cb0, cb1], <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;response will be sent by the next function ...&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from D!&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-中间件\"><a href=\"#4-中间件\" class=\"headerlink\" title=\"4.中间件\"></a>4.中间件</h5><p>Express 是一个自身功能极简，完全是由路由和中间件构成一个的 web 开发框架：从本质上来说，一个 Express 应用就是在调用各种中间件。</p>\n<p>中间件（Middleware） 是一个函数，它可以访问请求对象（request object (req)）, 响应对象（response object (res)）, 和 web 应用中处于请求-响应循环流程中的中间件，一般被命名为 next 的变量。</p>\n<p>中间件的功能包括：</p>\n<ul>\n<li>执行任何代码。</li>\n<li>修改请求和响应对象。</li>\n<li>终结请求-响应循环。</li>\n<li>调用堆栈中的下一个中间件。</li>\n</ul>\n<p>如果当前中间件没有终结请求-响应循环，则必须调用 next() 方法将控制权交给下一个中间件，否则请求就会挂起。</p>\n<p>Express 应用可使用如下几种中间件：</p>\n<ul>\n<li>应用级中间件</li>\n<li>路由级中间件</li>\n<li>错误处理中间件</li>\n<li>内置中间件</li>\n<li>第三方中间件</li>\n</ul>\n<p>使用可选则挂载路径，可在应用级别或路由级别装载中间件。另外，你还可以同时装在一系列中间件函数，从而在一个挂载点上创建一个子中间件栈。</p>\n<h6 id=\"（1）应用级中间件\"><a href=\"#（1）应用级中间件\" class=\"headerlink\" title=\"（1）应用级中间件\"></a>（1）应用级中间件</h6><p>应用级中间件绑定到 app 对象 使用 app.use() 和 app.METHOD()， 其中， METHOD 是需要处理的 HTTP 请求的方法，例如 GET, PUT, POST 等等，全部小写。例如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 没有挂载路径的中间件，应用的每个请求都会执行该中间件</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Time:&#x27;</span>, <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>())</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（2）路由级中间件\"><a href=\"#（2）路由级中间件\" class=\"headerlink\" title=\"（2）路由级中间件\"></a>（2）路由级中间件</h6><p>路由级中间件和应用级中间件一样，只是它绑定的对象为 express.Router()。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> router = express.<span class=\"title class_\">Router</span>()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = express.<span class=\"title class_\">Router</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 没有挂载路径的中间件，通过该路由的每个请求都会执行该中间件</span></span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Time:&#x27;</span>, <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>())</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一个中间件栈，显示任何指向 /user/:id 的 HTTP 请求的信息</span></span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/user/:id&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Request URL:&#x27;</span>, req.<span class=\"property\">originalUrl</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Request Type:&#x27;</span>, req.<span class=\"property\">method</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一个中间件栈，处理指向 /user/:id 的 GET 请求</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/user/:id&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 如果 user id 为 0, 跳到下一个路由</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.<span class=\"property\">params</span>.<span class=\"property\">id</span> == <span class=\"number\">0</span>) <span class=\"title function_\">next</span>(<span class=\"string\">&#x27;route&#x27;</span>)</span><br><span class=\"line\">  <span class=\"comment\">// 负责将控制权交给栈中下一个中间件</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"title function_\">next</span>() <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 渲染常规页面</span></span><br><span class=\"line\">  res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;regular&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 处理 /user/:id， 渲染一个特殊页面</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/user/:id&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">params</span>.<span class=\"property\">id</span>)</span><br><span class=\"line\">  res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;special&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将路由挂载至应用</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/&#x27;</span>, router)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（3）错误处理中间件\"><a href=\"#（3）错误处理中间件\" class=\"headerlink\" title=\"（3）错误处理中间件\"></a>（3）错误处理中间件</h6><p>错误处理中间件和其他中间件定义类似，只是要使用 4 个参数，而不是 3 个，其签名如下： (err, req, res, next)。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span>(<span class=\"params\">err, req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(err.<span class=\"property\">stack</span>)</span><br><span class=\"line\">  res.<span class=\"title function_\">status</span>(<span class=\"number\">500</span>).<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Something broke!&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（4）内置的中间件\"><a href=\"#（4）内置的中间件\" class=\"headerlink\" title=\"（4）内置的中间件\"></a>（4）内置的中间件</h6><p>express.static 是 Express 唯一内置的中间件。它基于 serve-static，负责在 Express 应用中提托管静态资源。每个应用可有多个静态目录。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;public&#x27;</span>))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;uploads&#x27;</span>))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;files&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（5）第三方中间件\"><a href=\"#（5）第三方中间件\" class=\"headerlink\" title=\"（5）第三方中间件\"></a>（5）第三方中间件</h6><p>安装所需功能的 node 模块，并在应用中加载，可以在应用级加载，也可以在路由级加载。</p>\n<p>下面的例子安装并加载了一个解析 cookie 的中间件： cookie-parser</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install cookie-parser</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cookie-parser&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载用于解析 cookie 的中间件</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">cookieParser</span>())</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"5-获取请求参数\"><a href=\"#5-获取请求参数\" class=\"headerlink\" title=\"5. 获取请求参数\"></a>5. 获取请求参数</h5><p>get</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">req.<span class=\"property\">query</span></span><br></pre></td></tr></table></figure>\n\n<p>post</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">urlencoded</span>(&#123;<span class=\"attr\">extended</span>:<span class=\"literal\">false</span>&#125;))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">json</span>())</span><br><span class=\"line\">req.<span class=\"property\">body</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"6-利用-Express-托管静态文件\"><a href=\"#6-利用-Express-托管静态文件\" class=\"headerlink\" title=\"6.利用 Express 托管静态文件\"></a>6.利用 Express 托管静态文件</h5><p>通过 Express 内置的 express.static 可以方便地托管静态文件，例如图片、CSS、JavaScript 文件等。</p>\n<p>将静态资源文件所在的目录作为参数传递给 express.static 中间件就可以提供静态资源文件的访问了。例如，假设在 public 目录放置了图片、CSS 和 JavaScript 文件，你就可以：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>现在，public 目录下面的文件就可以访问了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/images/kitten.jpg</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/css/style.css</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/js/app.js</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/images/bg.png</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/hello.html</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>所有文件的路径都是相对于存放目录的，因此，存放静态文件的目录名不会出现在 URL 中。</p>\n</blockquote>\n<p>如果你的静态资源存放在多个目录下面，你可以多次调用 express.static 中间件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;public&#x27;</span>))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;files&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>访问静态资源文件时，express.static 中间件会根据目录添加的顺序查找所需的文件。</p>\n<p>如果你希望所有通过 express.static 访问的文件都存放在一个“虚拟（virtual）”目录（即目录根本不存在）下面，可以通过为静态资源目录指定一个挂载路径的方式来实现，如下所示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(&#x27;/static&#x27;, express.static(&#x27;public&#x27;))</span><br></pre></td></tr></table></figure>\n\n<p>现在，你就可以通过带有 “/static” 前缀的地址来访问 public 目录下面的文件了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/images/kitten.jpg</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/css/style.css</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/js/app.js</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/images/bg.png</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/hello.html</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"7-服务端渲染（模板引擎）\"><a href=\"#7-服务端渲染（模板引擎）\" class=\"headerlink\" title=\"7.服务端渲染（模板引擎）\"></a>7.服务端渲染（模板引擎）</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i ejs</span><br></pre></td></tr></table></figure>\n\n<p>需要在应用中进行如下设置才能让 Express 渲染模板文件：</p>\n<ul>\n<li>views, 放模板文件的目录，比如： app.set(‘views’, ‘./views’)</li>\n<li>view engine, 模板引擎，比如： app.set(‘view engine’, ‘ejs’)</li>\n</ul>\n<p><b>ejs模板用法</b></p>\n<ul>\n<li>&lt;%  %&gt; 流程控制标签（写的是if else ，for）</li>\n<li>&lt;%= %&gt; 输出标签（原文输出HTML标签）</li>\n<li>&lt;%- %&gt; 输出标签（HTML会被浏览器解析）</li>\n<li>&lt;%# %&gt; 注释标签</li>\n<li>&lt;%- include(‘user/show’,{user:user}) %&gt; 导入公共的模板内容</li>\n</ul>\n<h5 id=\"8-express项目生成器\"><a href=\"#8-express项目生成器\" class=\"headerlink\" title=\"8.express项目生成器\"></a>8.express项目生成器</h5><ul>\n<li>下载依赖项目：<code>$ npm i express-generator -g </code></li>\n<li>创建项目：<code>$ express [项目名] --view=[视图类型] </code></li>\n<li>下载依赖：<code>$ npm i </code></li>\n<li>内部代码解读： <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.bin/www :该文件为启动目录</span><br><span class=\"line\">2.app.js文件解读：</span><br><span class=\"line\">      var createError = require(&#x27;http-errors&#x27;);//错误信息提示</span><br><span class=\"line\">      var cookieParser = require(&#x27;cookie-parser&#x27;);//后端获取设置cookie值</span><br><span class=\"line\">      var logger = require(&#x27;morgan&#x27;); //后端终端显示端口等日志</span><br></pre></td></tr></table></figure>\n<h4 id=\"三、MongoDB\"><a href=\"#三、MongoDB\" class=\"headerlink\" title=\"三、MongoDB\"></a>三、MongoDB</h4></li>\n</ul>\n<h5 id=\"1-MongoDB数据库\"><a href=\"#1-MongoDB数据库\" class=\"headerlink\" title=\"1.MongoDB数据库\"></a>1.MongoDB数据库</h5><p>简单介绍一下MongoDB：<br>传统的关系数据库（如mysql）一般由数据库（database）、表（table）、记录（record）三个层次概念组成，<br>MongoDB是由数据库（database）、集合（collection）、文档对象（document）三个层次组成。<br>MongoDB稳定<br>MongoDB支持索引，索引放在内存中，能够提升随机读写的性能。如果索引不能完全放在内存，一旦出现随机读写比较高的时候，就会频繁地进行磁盘交换，MongoDB的性能就会急剧下降<br>MongoDB占用的空间很大，因为它属于典型空间换时间原则的类型。那么它的磁盘空间比普通数据库会浪费一些</p>\n<h5 id=\"2-安装数据库\"><a href=\"#2-安装数据库\" class=\"headerlink\" title=\"2.安装数据库\"></a>2.安装数据库</h5><p><a href=\"https://docs.mongodb.com/manual/administration/install-community/\">https://docs.mongodb.com/manual/administration/install-community/</a></p>\n<h5 id=\"3-启动数据库\"><a href=\"#3-启动数据库\" class=\"headerlink\" title=\"3.启动数据库\"></a>3.启动数据库</h5><h6 id=\"（1）windows\"><a href=\"#（1）windows\" class=\"headerlink\" title=\"（1）windows\"></a>（1）windows</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod --dbpath d:/data/db</span><br><span class=\"line\">mongo</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（2）mac\"><a href=\"#（2）mac\" class=\"headerlink\" title=\"（2）mac\"></a>（2）mac</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod --config /usr/local/etc/mongod.conf</span><br><span class=\"line\">mongo</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-在命令行中操作数据库\"><a href=\"#4-在命令行中操作数据库\" class=\"headerlink\" title=\"4.在命令行中操作数据库\"></a>4.在命令行中操作数据库</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//常规数据库操作</span><br><span class=\"line\">(1)Help查看命令提示 </span><br><span class=\"line\">\thelp    db.help()  db.test.help()  db.test.find().help()</span><br><span class=\"line\">(2)创建/切换数据库</span><br><span class=\"line\">\tuse music </span><br><span class=\"line\">(3)查询数据库</span><br><span class=\"line\">\tshow dbs</span><br><span class=\"line\">(4)查看当前使用的数据库</span><br><span class=\"line\">\tdb/db.getName()</span><br><span class=\"line\">(5)显示当前DB状态</span><br><span class=\"line\">\tdb.stats()</span><br><span class=\"line\">(6)查看当前DB版本</span><br><span class=\"line\">\tdb.version()</span><br><span class=\"line\">(7)查看当前DB的链接机器地址</span><br><span class=\"line\">\tdb.getMongo()</span><br><span class=\"line\">(8)删除数据库</span><br><span class=\"line\">\tdb.dropDatabase()</span><br><span class=\"line\">//常规集合操作</span><br><span class=\"line\">(1)创建一个集合</span><br><span class=\"line\">\tdb.createCollection(&quot;collName&quot;,&#123;size:xx,capped:true,max:xx&#125;)</span><br><span class=\"line\"> // collName:名称 size:集合大小 capped:固定大小 max:最大存储空间</span><br><span class=\"line\">(2)得到指定名称的集合</span><br><span class=\"line\">\tdb.getCollection(&quot;account&quot;)</span><br><span class=\"line\">(3)得到当前所有的集合</span><br><span class=\"line\">\tdb.getCollectionNames()</span><br><span class=\"line\">(4)显示当前db所有集合的状态</span><br><span class=\"line\">\tdb.printCollectionStats()</span><br><span class=\"line\">(5)删除集合</span><br><span class=\"line\">\tdb.users(集合名称).drop() </span><br><span class=\"line\">//集合增删改查(以users集合为例)</span><br><span class=\"line\">(1)添加</span><br><span class=\"line\">\tdb.users.save([&#123;name:&#x27;pan&#x27;,age:21&#125;,name:&#x27;zhang&#x27;,age:20])</span><br><span class=\"line\">(2)删除</span><br><span class=\"line\">\tdb.users.remove(&#123;age:20&#125;) //删除一条带有age:20的数据</span><br><span class=\"line\">\tdb.users.remove(&#123;&#125;) //删除所有数据</span><br><span class=\"line\">(3)修改</span><br><span class=\"line\">\tdb.users.update(&#123;name:&#x27;pan&#x27;&#125;,&#123;age:29&#125;)</span><br><span class=\"line\"> \t//找到一条是name:pan的数据将这一条数据替换成age:29</span><br><span class=\"line\">\tdb.users.update(&#123;name:&#x27;pan&#x27;&#125;,&#123;$set:&#123;age:29&#125;&#125;)</span><br><span class=\"line\"> \t//找到一条是name:pan的数据将这一条数据中age替换成29</span><br><span class=\"line\"> \tdb.users.update(&#123;name:&#x27;pan&#x27;&#125;,&#123;$inc:&#123;age:29&#125;&#125;)</span><br><span class=\"line\"> \t//找到一条是name:pan的数据将这一条数据中age增加29(数据可为负数)</span><br><span class=\"line\">(4)查询</span><br><span class=\"line\">\t- 查询所有记录</span><br><span class=\"line\">    db.users.find()</span><br><span class=\"line\">   - 查询age=29的数据</span><br><span class=\"line\">    db.users.find(&#123;age:29&#125;)</span><br><span class=\"line\">   - 查询age&gt;29的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$gt:29&#125;)</span><br><span class=\"line\">   - 查询age&gt;=29的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$gte:29&#125;)</span><br><span class=\"line\">   - 查询age&lt;30的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$lt:30&#125;)</span><br><span class=\"line\">   - 查询age&lt;=30的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$lte:30&#125;)</span><br><span class=\"line\">   - 查询29&lt;=age&lt;=30的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$gle:29,$lte:30&#125;)</span><br><span class=\"line\">   - 模糊查询</span><br><span class=\"line\">    db.users.find(name:/pan/) //注：name后面参数为正则</span><br><span class=\"line\">   - 查询指定数据</span><br><span class=\"line\">    db.users.find(&#123;&#125;,&#123;name:1,age:1,_id:0&#125;)</span><br><span class=\"line\">    //第一个参数表示查询条件</span><br><span class=\"line\">    //第二个参数中1表示显示，0表示不显示</span><br><span class=\"line\">   -按照年龄排序</span><br><span class=\"line\">   \t db.users.find(&#123;&#125;).sort(&#123;age:1&#125;)</span><br><span class=\"line\">    // 1表示升序，-1表示降序</span><br><span class=\"line\">   - 查询第n页m条数据</span><br><span class=\"line\">   \t db.users.find(&#123;&#125;).skip((n-1)*m).limit(m)</span><br><span class=\"line\">   - 或者条件查询</span><br><span class=\"line\">    db.users.find(&#123;$or:[&#123;age:12&#125;,&#123;age:20&#125;]&#125;)</span><br><span class=\"line\">    // 查询age:12或者age:20的所有每条数据</span><br><span class=\"line\">   - 查询第一条数据</span><br><span class=\"line\">   db.users.findOne()</span><br><span class=\"line\">   - 查询某个结果记录条数</span><br><span class=\"line\">   db.users.find().count()</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-可视化工具进行增删改查\"><a href=\"#5-可视化工具进行增删改查\" class=\"headerlink\" title=\"5.可视化工具进行增删改查\"></a>5.可视化工具进行增删改查</h5><p>Robomongo Robo3T adminMongo</p>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220413091031852.png\" alt=\"image-20220413091031852\"></p>\n<h5 id=\"6-nodejs连接操作数据库\"><a href=\"#6-nodejs连接操作数据库\" class=\"headerlink\" title=\"6.nodejs连接操作数据库\"></a>6.nodejs连接操作数据库</h5><p>连接数据库</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(<span class=\"string\">&quot;mongodb://127.0.0.1:27017/company-system&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>创建模型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Schema</span> = mongoose.<span class=\"property\">Schema</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserType</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">username</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">password</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">gender</span>:<span class=\"title class_\">Number</span>,</span><br><span class=\"line\">    <span class=\"attr\">introduction</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">avatar</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">role</span>:<span class=\"title class_\">Number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserModel</span> = mongoose.<span class=\"title function_\">model</span>(<span class=\"string\">&quot;user&quot;</span>,<span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(<span class=\"title class_\">UserType</span>))</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span>  = <span class=\"title class_\">UserModel</span> </span><br></pre></td></tr></table></figure>\n\n<p>增加数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">    introduction,username,gender,avatar,password,role</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>查询数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">find</span>(&#123;<span class=\"attr\">username</span>:<span class=\"string\">&quot;kerwin&quot;</span>&#125;,[<span class=\"string\">&quot;username&quot;</span>,<span class=\"string\">&quot;role&quot;</span>,<span class=\"string\">&quot;introduction&quot;</span>,<span class=\"string\">&quot;password&quot;</span>]).<span class=\"title function_\">sort</span>(&#123;<span class=\"attr\">createTime</span>:-<span class=\"number\">1</span>&#125;).<span class=\"title function_\">skip</span>(<span class=\"number\">10</span>).<span class=\"title function_\">limit</span>(<span class=\"number\">10</span>)</span><br></pre></td></tr></table></figure>\n\n<p>更新数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">updateOne</span>(&#123;</span><br><span class=\"line\">    _id</span><br><span class=\"line\">&#125;,&#123;</span><br><span class=\"line\">    introduction,username,gender,avatar</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>删除数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">deleteOne</span>(&#123;_id&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、接口规范与业务分层\"><a href=\"#四、接口规范与业务分层\" class=\"headerlink\" title=\"四、接口规范与业务分层\"></a>四、接口规范与业务分层</h4><h5 id=\"1-接口规范\"><a href=\"#1-接口规范\" class=\"headerlink\" title=\"1.接口规范\"></a>1.接口规范</h5><h6 id=\"RESTful架构\"><a href=\"#RESTful架构\" class=\"headerlink\" title=\"RESTful架构\"></a>RESTful架构</h6><blockquote>\n<p>服务器上每一种资源，比如一个文件，一张图片，一部电影，都有对应的地址，如果我们的客户端需要对服务器上的这个资源进行操作，就需要通过http西医执行相应的动作来操作它，比如进行获取、更新、删除</p>\n</blockquote>\n<p>简单来说就是<strong>url中只包含名词表示资源，使用http动词表示动作进行操作资源</strong>，举个例子左边错误，右边正确</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /blog/getname --&gt; GET /blog/name 获取所有文章</span><br><span class=\"line\">GET /blog/addname --&gt; POST /blog/name 添加一篇文章</span><br><span class=\"line\">GET /blog/editname --&gt; PUT /blog/name 添加一篇文章</span><br><span class=\"line\">GET /blog/delname?id=1 --&gt; DELETE /blog/name/1 删除一篇文章</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>使用方式</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET http://xxx/api/user    #获取列表</span><br><span class=\"line\">POST http://xxx/api/user   #创建列表</span><br><span class=\"line\">PUT http://xxx/api/user/&#123;id&#125;    #修改用户信息</span><br><span class=\"line\">DELETE http://xxx/api/user/&#123;id&#125;  #删除用户信息</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>过滤信息</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用于补充规范一些通用字段</span><br><span class=\"line\">?limit=10 #指定返回记录的数量</span><br><span class=\"line\">?offset=10 #指定烦货柜记录的开始位置</span><br><span class=\"line\">?page=2&amp;per_page=100 #指定第几页，以及每页的记录数</span><br><span class=\"line\">?sortby=name&amp;order=asc #指定返回结果按照那个属性排序，以及排序顺序</span><br><span class=\"line\">?state=close #指定筛选条件</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-业务分层\"><a href=\"#2-业务分层\" class=\"headerlink\" title=\"2.业务分层\"></a>2.业务分层</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.js:负责请求分发给C层</span><br><span class=\"line\">controller.js:C层负责处理业务逻辑（V与M之间的沟通）</span><br><span class=\"line\">views:V层:负责展示页面</span><br><span class=\"line\">model:M层:负责处理数据（增删改查）</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"五、登录鉴权\"><a href=\"#五、登录鉴权\" class=\"headerlink\" title=\"五、登录鉴权\"></a>五、登录鉴权</h4><h5 id=\"1-Cookie-amp-Session\"><a href=\"#1-Cookie-amp-Session\" class=\"headerlink\" title=\"1. Cookie&amp;Session\"></a>1. Cookie&amp;Session</h5><p>「HTTP 无状态」<strong>我们知道，HTTP 是无状态的。也就是说，HTTP 请求方和响应方间无法维护状态，都是一次性的，它不知道前后的请求都发生了什么。但有的场景下，我们需要维护状态。最典型的，一个用户登陆微博，发布、关注、评论，都应是在登录后的用户状态下的。</strong>「标记」那解决办法是什么呢？!</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express-session&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">MongoStore</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;connect-mongo&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">express</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(</span><br><span class=\"line\">  <span class=\"title function_\">session</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">secret</span>: <span class=\"string\">&quot;this is session&quot;</span>, <span class=\"comment\">// 服务器生成 session 的签名</span></span><br><span class=\"line\">    <span class=\"attr\">resave</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">    <span class=\"attr\">saveUninitialized</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//强制将为初始化的 session 存储</span></span><br><span class=\"line\">    <span class=\"attr\">cookie</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">maxAge</span>: <span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">10</span>,<span class=\"comment\">// 过期时间</span></span><br><span class=\"line\">      <span class=\"attr\">secure</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 为 true 时候表示只有 https 协议才能访问cookie</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">rolling</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//为 true 表示 超时前刷新，cookie 会重新计时； 为 false 表示在超时前刷新多少次，都是按照第一次刷新开始计时。</span></span><br><span class=\"line\">    <span class=\"attr\">store</span>: <span class=\"title class_\">MongoStore</span>.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">mongoUrl</span>: <span class=\"string\">&#x27;mongodb://127.0.0.1:27017/kerwin_session&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">ttl</span>: <span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">10</span> <span class=\"comment\">// 过期时间</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">req,res,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.<span class=\"property\">url</span>===<span class=\"string\">&quot;/login&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.<span class=\"property\">session</span>.<span class=\"property\">user</span>)&#123;</span><br><span class=\"line\">      req.<span class=\"property\">session</span>.<span class=\"property\">garbage</span> = <span class=\"title class_\">Date</span>();</span><br><span class=\"line\">      <span class=\"title function_\">next</span>();</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">   \t  res.<span class=\"title function_\">redirect</span>(<span class=\"string\">&quot;/login&quot;</span>)   </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"2-JSON-Web-Token-JWT\"><a href=\"#2-JSON-Web-Token-JWT\" class=\"headerlink\" title=\"2. JSON Web Token (JWT)\"></a>2. JSON Web Token (JWT)</h5><h6 id=\"（1）介绍\"><a href=\"#（1）介绍\" class=\"headerlink\" title=\"（1）介绍\"></a>（1）介绍</h6><p>我为什么要保存这可恶的session呢， 只让每个客户端去保存该多好？</p>\n<p>当然， 如果一个人的token 被别人偷走了， 那我也没办法， 我也会认为小偷就是合法用户， 这其实和一个人的session id 被别人偷走是一样的。</p>\n<p>这样一来， 我就不保存session id 了， 我只是生成token , 然后验证token ， 我用我的CPU计算时间获取了我的session 存储空间 ！</p>\n<p>解除了session id这个负担， 可以说是无事一身轻， 我的机器集群现在可以轻松地做水平扩展， 用户访问量增大， 直接加机器就行。 这种无状态的感觉实在是太好了！</p>\n<p>缺点：</p>\n<blockquote>\n<ol>\n<li>占带宽，正常情况下要比 session_id 更大，需要消耗更多流量，挤占更多带宽，假如你的网站每月有 10 万次的浏览器，就意味着要多开销几十兆的流量。听起来并不多，但日积月累也是不小一笔开销。实际上，许多人会在 JWT 中存储的信息会更多；</li>\n<li>无法在服务端注销，那么久很难解决劫持问题；</li>\n<li>性能问题，JWT 的卖点之一就是加密签名，由于这个特性，接收方得以验证 JWT 是否有效且被信任。对于有着严格性能要求的 Web 应用，这并不理想，尤其对于单线程环境。</li>\n</ol>\n</blockquote>\n<p>注意：</p>\n<blockquote>\n<p>CSRF攻击的原因是浏览器会自动带上cookie，而不会带上token；</p>\n<p>以CSRF攻击为例：</p>\n<p>cookie：用户点击了链接，cookie未失效，导致发起请求后后端以为是用户正常操作，于是进行扣款操作；<br>token：用户点击链接，由于浏览器不会自动带上token，所以即使发了请求，后端的token验证不会通过，所以不会进行扣款操作；</p>\n</blockquote>\n<h6 id=\"（2）实现\"><a href=\"#（2）实现\" class=\"headerlink\" title=\"（2）实现\"></a>（2）实现</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//jsonwebtoken 封装</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> jsonwebtoken = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;jsonwebtoken&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> secret = <span class=\"string\">&quot;kerwin&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">JWT</span> = &#123;</span><br><span class=\"line\">    <span class=\"title function_\">generate</span>(<span class=\"params\">value,exprires</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jsonwebtoken.<span class=\"title function_\">sign</span>(value,secret,&#123;<span class=\"attr\">expiresIn</span>:exprires&#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">verify</span>(<span class=\"params\">token</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> jsonwebtoken.<span class=\"title function_\">verify</span>(token,secret)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"variable constant_\">JWT</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//node中间件校验</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">req,res,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 如果token有效 ,next() </span></span><br><span class=\"line\">  <span class=\"comment\">// 如果token过期了, 返回401错误</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.<span class=\"property\">url</span>===<span class=\"string\">&quot;/login&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> token = req.<span class=\"property\">headers</span>[<span class=\"string\">&quot;authorization&quot;</span>].<span class=\"title function_\">split</span>(<span class=\"string\">&quot; &quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(token)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> payload = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(token)</span><br><span class=\"line\">    <span class=\"comment\">// console.log(payload)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(payload)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newToken = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">generate</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">_id</span>:payload.<span class=\"property\">_id</span>,</span><br><span class=\"line\">        <span class=\"attr\">username</span>:payload.<span class=\"property\">username</span></span><br><span class=\"line\">      &#125;,<span class=\"string\">&quot;1d&quot;</span>)</span><br><span class=\"line\">      res.<span class=\"title function_\">header</span>(<span class=\"string\">&quot;Authorization&quot;</span>,newToken)</span><br><span class=\"line\">      <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      res.<span class=\"title function_\">status</span>(<span class=\"number\">401</span>).<span class=\"title function_\">send</span>(&#123;<span class=\"attr\">errCode</span>:<span class=\"string\">&quot;-1&quot;</span>,<span class=\"attr\">errorInfo</span>:<span class=\"string\">&quot;token过期&quot;</span>&#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//生成token</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> token = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">generate</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">_id</span>: result[<span class=\"number\">0</span>].<span class=\"property\">_id</span>,</span><br><span class=\"line\">    <span class=\"attr\">username</span>: result[<span class=\"number\">0</span>].<span class=\"property\">username</span></span><br><span class=\"line\">&#125;, <span class=\"string\">&quot;1d&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res.<span class=\"title function_\">header</span>(<span class=\"string\">&quot;Authorization&quot;</span>, token)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//前端拦截</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * @作者: kerwin</span></span><br><span class=\"line\"><span class=\"comment\"> * @公众号: 大前端私房菜</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&#x27;axios&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// Add a request interceptor</span></span><br><span class=\"line\">axios.<span class=\"property\">interceptors</span>.<span class=\"property\">request</span>.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;token&quot;</span>)</span><br><span class=\"line\">    config.<span class=\"property\">headers</span>.<span class=\"property\">Authorization</span> = <span class=\"string\">`Bearer <span class=\"subst\">$&#123;token&#125;</span>`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  &#125;, <span class=\"keyword\">function</span> (<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Add a response interceptor</span></span><br><span class=\"line\">axios.<span class=\"property\">interceptors</span>.<span class=\"property\">response</span>.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">response</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123;authorization &#125; = response.<span class=\"property\">headers</span></span><br><span class=\"line\">    authorization &amp;&amp; <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&quot;token&quot;</span>,authorization)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">  &#125;, <span class=\"keyword\">function</span> (<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123;status&#125; = error.<span class=\"property\">response</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(status===<span class=\"number\">401</span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(<span class=\"string\">&quot;token&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">href</span>=<span class=\"string\">&quot;/login&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"六、文件上传管理\"><a href=\"#六、文件上传管理\" class=\"headerlink\" title=\"六、文件上传管理\"></a>六、文件上传管理</h4><p>Multer 是一个 node.js 中间件，用于处理 <code>multipart/form-data</code> 类型的表单数据，它主要用于上传文件。</p>\n<p><strong>注意</strong>: Multer 不会处理任何非 <code>multipart/form-data</code> 类型的表单数据。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save multer</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//前后端分离-前端</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> params = <span class=\"keyword\">new</span> <span class=\"title class_\">FormData</span>()</span><br><span class=\"line\">params.<span class=\"title function_\">append</span>(<span class=\"string\">&#x27;kerwinfile&#x27;</span>, file.<span class=\"property\">file</span>)</span><br><span class=\"line\">params.<span class=\"title function_\">append</span>(<span class=\"string\">&#x27;username&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">username</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = &#123;</span><br><span class=\"line\">\t<span class=\"attr\">headers</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;Content-Type&quot;</span>:<span class=\"string\">&quot;multipart/form-data&quot;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/api/upload&#x27;</span>, params, config).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.<span class=\"property\">imgpath</span> = <span class=\"string\">&#x27;http://localhost:3000&#x27;</span> + res.<span class=\"property\">data</span></span><br><span class=\"line\">&#125;)\t</span><br></pre></td></tr></table></figure>\n\n<p>Multer 会添加一个 <code>body</code> 对象 以及 <code>file</code> 或 <code>files</code> 对象 到 express 的 <code>request</code> 对象中。 <code>body</code> 对象包含表单的文本域信息，<code>file</code> 或 <code>files</code> 对象包含对象表单上传的文件信息。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//前后端分离-后端</span></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/upload&#x27;</span>, upload.<span class=\"title function_\">single</span>(<span class=\"string\">&#x27;kerwinfile&#x27;</span>),<span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">file</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"七、APIDOC-API-文档生成工具\"><a href=\"#七、APIDOC-API-文档生成工具\" class=\"headerlink\" title=\"七、APIDOC - API 文档生成工具\"></a>七、APIDOC - API 文档生成工具</h4><p>apidoc 是一个简单的 RESTful API 文档生成工具，它从代码注释中提取特定格式的内容生成文档。支持诸如 Go、Java、C++、Rust 等大部分开发语言，具体可使用 <code>apidoc lang</code> 命令行查看所有的支持列表。</p>\n<p>apidoc 拥有以下特点：</p>\n<ol>\n<li>跨平台，linux、windows、macOS 等都支持；</li>\n<li>支持语言广泛，即使是不支持，也很方便扩展；</li>\n<li>支持多个不同语言的多个项目生成一份文档；</li>\n<li>输出模板可自定义；</li>\n<li>根据文档生成 mock 数据；</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g apidoc</span><br></pre></td></tr></table></figure>\n\n\n<p>注意：</p>\n<p>(1) 在当前文件夹下 apidoc.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;****接口文档&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;关于****的接口文档描述&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;****&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>（2）可以利用vscode apidoc snippets 插件创建api</p>\n<h4 id=\"八、Koa2\"><a href=\"#八、Koa2\" class=\"headerlink\" title=\"八、Koa2\"></a>八、Koa2</h4><h5 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1.简介\"></a>1.简介</h5><p>koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。使用 koa 编写 web 应用，通过组合不同的 generator，可以免除重复繁琐的回调函数嵌套，并极大地提升错误处理的效率。koa 不在内核方法中绑定任何中间件，它仅仅提供了一个轻量优雅的函数库，使得编写 Web 应用变得得心应手。</p>\n<h5 id=\"2-快速开始\"><a href=\"#2-快速开始\" class=\"headerlink\" title=\"2. 快速开始\"></a>2. 快速开始</h5><h6 id=\"2-1-安装koa2\"><a href=\"#2-1-安装koa2\" class=\"headerlink\" title=\"2.1 安装koa2\"></a>2.1 安装koa2</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 初始化package.json</span><br><span class=\"line\">npm init</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装koa2 </span><br><span class=\"line\">npm install koa</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"2-2-hello-world-代码\"><a href=\"#2-2-hello-world-代码\" class=\"headerlink\" title=\"2.2 hello world 代码\"></a>2.2 hello world 代码</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>( <span class=\"keyword\">async</span> ( ctx ) =&gt; &#123;</span><br><span class=\"line\">  ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;hello koa2&#x27;</span> <span class=\"comment\">//json数据</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.req</span><br><span class=\"line\">Node 的 request对象.</span><br><span class=\"line\">ctx.res</span><br><span class=\"line\">Node的 response对象.</span><br><span class=\"line\">绕过Koa的response 处理是不被支持的.应避免使用以下node 属性:</span><br><span class=\"line\">res.statusCode()</span><br><span class=\"line\">res.WiiteHead()</span><br><span class=\"line\">res.Write()</span><br><span class=\"line\">res.end()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.request</span><br><span class=\"line\">koa的 Request对象.</span><br><span class=\"line\">ctx.response</span><br><span class=\"line\">koa的 Response对象.</span><br><span class=\"line\">以下访问器和Request别名等效:</span><br><span class=\"line\">ctx. header</span><br><span class=\"line\">ctx. headers</span><br><span class=\"line\">ctx.method</span><br><span class=\"line\"> ctx. method=</span><br><span class=\"line\">ctx.url</span><br><span class=\"line\"> ctx.url=</span><br><span class=\"line\">ctx. originalUrl</span><br><span class=\"line\">ctx.origin</span><br><span class=\"line\">ctx. href</span><br><span class=\"line\"> ctx. path</span><br><span class=\"line\">ctx. path=</span><br><span class=\"line\"> ctx. query</span><br><span class=\"line\">ctx. query=</span><br><span class=\"line\">ctx. querystring</span><br><span class=\"line\"> ctx. querystring=</span><br><span class=\"line\">ctx. host</span><br><span class=\"line\">ct.x.hostname</span><br><span class=\"line\">以下访问器和Response 别名等效:</span><br><span class=\"line\">ctx.body</span><br><span class=\"line\">ctx.body=</span><br><span class=\"line\">ctx.status</span><br><span class=\"line\">ctx.status=</span><br><span class=\"line\">ctx.message</span><br><span class=\"line\">ctx.message=</span><br><span class=\"line\">ctx.length=</span><br><span class=\"line\">ctx.length</span><br><span class=\"line\">ctx.type=</span><br><span class=\"line\">ctx.type</span><br><span class=\"line\">ctx.headerSent</span><br><span class=\"line\">ctx.redirect()</span><br><span class=\"line\">ctx.attachment()</span><br><span class=\"line\">ctx.set()</span><br><span class=\"line\">ctx.append ()</span><br><span class=\"line\">ctx.remove ()</span><br><span class=\"line\">ctx.lastModified=</span><br><span class=\"line\">ctx.etag=</span><br></pre></td></tr></table></figure>\n\n\n<h6 id=\"2-3-启动demo\"><a href=\"#2-3-启动demo\" class=\"headerlink\" title=\"2.3 启动demo\"></a>2.3 启动demo</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node index.js</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-koa-vs-express\"><a href=\"#3-koa-vs-express\" class=\"headerlink\" title=\"3. koa vs express\"></a>3. koa vs express</h5><p>通常都会说 Koa 是洋葱模型，这重点在于中间件的设计。但是按照上面的分析，会发现 Express 也是类似的，不同的是Express 中间件机制使用了 Callback 实现，这样如果出现异步则可能会使你在执行顺序上感到困惑，因此如果我们想做接口耗时统计、错误处理 Koa 的这种中间件模式处理起来更方便些。最后一点响应机制也很重要，Koa 不是立即响应，是整个中间件处理完成在最外层进行了响应，而 Express 则是立即响应。</p>\n<h6 id=\"3-1更轻量\"><a href=\"#3-1更轻量\" class=\"headerlink\" title=\"3.1更轻量\"></a>3.1更轻量</h6><ul>\n<li>koa 不提供内置的中间件；</li>\n<li>koa 不提供路由，而是把路由这个库分离出来了（koa/router）</li>\n</ul>\n<h6 id=\"3-2-Context对象\"><a href=\"#3-2-Context对象\" class=\"headerlink\" title=\"3.2 Context对象\"></a>3.2 Context对象</h6><p>koa增加了一个Context的对象，作为这次请求的上下文对象（在koa2中作为中间件的第一个参数传入）。同时Context上也挂载了Request和Response两个对象。和Express类似，这两个对象都提供了大量的便捷方法辅助开发, 这样的话对于在保存一些公有的参数的话变得更加合情合理</p>\n<h6 id=\"3-3-异步流程控制\"><a href=\"#3-3-异步流程控制\" class=\"headerlink\" title=\"3.3 异步流程控制\"></a>3.3 异步流程控制</h6><p>​    express采用callback来处理异步，    koa v1采用generator，koa v2 采用async/await。</p>\n<p>​    generator和async/await使用同步的写法来处理异步，明显好于callback和promise，</p>\n<h6 id=\"3-4-中间件模型\"><a href=\"#3-4-中间件模型\" class=\"headerlink\" title=\"3.4 中间件模型\"></a>3.4 中间件模型</h6><p>​    express基于connect中间件，线性模型；</p>\n<p>​     koa中间件采用洋葱模型（对于每个中间件，在完成了一些事情后，可以非常优雅的将控制权传递给下一个中间件，并能够等待它完成，当后续的中间件完成处理后，控制权又回到了自己）</p>\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417083817823.png\" alt=\"image-20220417083817823\" style=\"zoom:50%;float:left;\" />\n\n<p>   <img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417085913567.png\" alt=\"image-20220417085913567\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//同步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">req,res,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"><span class=\"comment\">//异步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (req,res,next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> ()=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">delay</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">delay</span>(<span class=\"params\">time</span>)&#123;</span><br><span class=\"line\"> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolve,<span class=\"number\">1000</span>)</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//同步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> koa = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title function_\">koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">ctx,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=<span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//异步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> koa = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title function_\">koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx,next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=<span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\">&#125;) </span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> ()=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">delay</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">delay</span>(<span class=\"params\">time</span>)&#123;</span><br><span class=\"line\"> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolve,<span class=\"number\">1000</span>)</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-路由\"><a href=\"#4-路由\" class=\"headerlink\" title=\"4. 路由\"></a>4. 路由</h5><h6 id=\"4-1基本用发\"><a href=\"#4-1基本用发\" class=\"headerlink\" title=\"4.1基本用发\"></a>4.1基本用发</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/list&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=[<span class=\"string\">&quot;111&quot;</span>,<span class=\"string\">&quot;222&quot;</span>,<span class=\"string\">&quot;333&quot;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(router.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"4-2-router-allowedMethods作用\"><a href=\"#4-2-router-allowedMethods作用\" class=\"headerlink\" title=\"4.2 router.allowedMethods作用\"></a>4.2 router.allowedMethods作用</h6><p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417102845079.png\" alt=\"image-20220417102845079\"></p>\n<h6 id=\"4-3-请求方式\"><a href=\"#4-3-请求方式\" class=\"headerlink\" title=\"4.3 请求方式\"></a>4.3 请求方式</h6><p>Koa-router 请求方式： <code>get</code> 、 <code>put</code> 、 <code>post</code> 、 <code>patch</code> 、 <code>delete</code> 、 <code>del</code>  ，而使用方法就是 <code>router.方式()</code>  ，比如 <code>router.get()</code> 和 <code>router.post()</code> 。而 <code>router.all()</code> 会匹配所有的请求方法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/user&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=[<span class=\"string\">&quot;aaa&quot;</span>,<span class=\"string\">&quot;bbb&quot;</span>,<span class=\"string\">&quot;ccc&quot;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">put</span>(<span class=\"string\">&quot;/user/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;user update&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/user&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;user post&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">del</span>(<span class=\"string\">&quot;/user/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;user del&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(router.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"4-4-拆分路由\"><a href=\"#4-4-拆分路由\" class=\"headerlink\" title=\"4.4 拆分路由\"></a>4.4 拆分路由</h6><p>list.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=[<span class=\"string\">&quot;111&quot;</span>,<span class=\"string\">&quot;222&quot;</span>,<span class=\"string\">&quot;333&quot;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">put</span>(<span class=\"string\">&quot;/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;list update&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;list post&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">del</span>(<span class=\"string\">&quot;/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;list del&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router</span><br></pre></td></tr></table></figure>\n\n<p>index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> user = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./user&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> list = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./list&quot;</span>)</span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/user&#x27;</span>, user.<span class=\"title function_\">routes</span>(), user.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/list&#x27;</span>, list.<span class=\"title function_\">routes</span>(), list.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router</span><br></pre></td></tr></table></figure>\n\n<p>entry入口</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./router/index&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(router.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"4-5-路由前缀\"><a href=\"#4-5-路由前缀\" class=\"headerlink\" title=\"4.5 路由前缀\"></a>4.5 路由前缀</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">prefix</span>(<span class=\"string\">&#x27;/api&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"4-6-路由重定向\"><a href=\"#4-6-路由重定向\" class=\"headerlink\" title=\"4.6 路由重定向\"></a>4.6 路由重定向</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/home&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=<span class=\"string\">&quot;home页面&quot;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">//写法1 </span></span><br><span class=\"line\">router.<span class=\"title function_\">redirect</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;/home&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">//写法2</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">redirect</span>(<span class=\"string\">&quot;/home&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-静态资源\"><a href=\"#5-静态资源\" class=\"headerlink\" title=\"5.  静态资源\"></a>5.  静态资源</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">static</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-static&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">static</span>(</span><br><span class=\"line\">  path.<span class=\"title function_\">join</span>( __dirname,  <span class=\"string\">&quot;public&quot;</span>)</span><br><span class=\"line\">))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>( <span class=\"keyword\">async</span> ( ctx ) =&gt; &#123;</span><br><span class=\"line\">  ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;hello world&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;[demo] static-use-middleware is starting at port 3000&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"6-获取请求参数\"><a href=\"#6-获取请求参数\" class=\"headerlink\" title=\"6.  获取请求参数\"></a>6.  获取请求参数</h5><h6 id=\"6-1get参数\"><a href=\"#6-1get参数\" class=\"headerlink\" title=\"6.1get参数\"></a>6.1get参数</h6><p>在koa中，获取GET请求数据源头是koa中request对象中的query方法或querystring方法，query返回是格式化好的参数对象，querystring返回的是请求字符串，由于ctx对request的API有直接引用的方式，所以获取GET请求数据有两个途径。</p>\n<ul>\n<li>是从上下文中直接获取 请求对象ctx.query，返回如 { a:1, b:2 } 请求字符串 ctx.querystring，返回如 a=1&amp;b=2</li>\n<li>是从上下文的request对象中获取 请求对象ctx.request.query，返回如 { a:1, b:2 } 请求字符串 ctx.request.querystring，返回如 a=1&amp;b=2</li>\n</ul>\n<h6 id=\"6-2post参数\"><a href=\"#6-2post参数\" class=\"headerlink\" title=\"6.2post参数\"></a>6.2post参数</h6><p>对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文的formData数据解析到ctx.request.body中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用ctx.body解析中间件</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyParser</span>())</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"7-ejs模板\"><a href=\"#7-ejs模板\" class=\"headerlink\" title=\"7. ejs模板\"></a>7. ejs模板</h5><h6 id=\"7-1-安装模块\"><a href=\"#7-1-安装模块\" class=\"headerlink\" title=\"7.1 安装模块\"></a>7.1 安装模块</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装koa模板使用中间件</span><br><span class=\"line\">npm install --save koa-views</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装ejs模板引擎</span><br><span class=\"line\">npm install --save ejs</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"7-2-使用模板引擎\"><a href=\"#7-2-使用模板引擎\" class=\"headerlink\" title=\"7.2 使用模板引擎\"></a>7.2 使用模板引擎</h6><p><strong>文件目录</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── package.json</span><br><span class=\"line\">├── index.js</span><br><span class=\"line\">└── view</span><br><span class=\"line\">    └── index.ejs</span><br></pre></td></tr></table></figure>\n\n<p><strong>./index.js文件</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> views = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-views&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载模板引擎</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">views</span>(path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;./view&#x27;</span>), &#123;</span><br><span class=\"line\">  <span class=\"attr\">extension</span>: <span class=\"string\">&#x27;ejs&#x27;</span></span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>( <span class=\"keyword\">async</span> ( ctx ) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> title = <span class=\"string\">&#x27;hello koa2&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> ctx.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;index&#x27;</span>, &#123;</span><br><span class=\"line\">    title,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>./view/index.ejs 模板</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&lt;%= title %&gt;<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&lt;%= title %&gt;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>EJS Welcome to &lt;%= title %&gt;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"8-cookie-amp-session\"><a href=\"#8-cookie-amp-session\" class=\"headerlink\" title=\"8. cookie&amp;session\"></a>8. cookie&amp;session</h5><h6 id=\"8-1-cookie\"><a href=\"#8-1-cookie\" class=\"headerlink\" title=\"8.1 cookie\"></a>8.1 cookie</h6><p>koa提供了从上下文直接读取、写入cookie的方法</p>\n<ul>\n<li>ctx.cookies.get(name, [options]) 读取上下文请求中的cookie</li>\n<li>ctx.cookies.set(name, value, [options]) 在上下文中写入cookie</li>\n</ul>\n<h6 id=\"8-2-session\"><a href=\"#8-2-session\" class=\"headerlink\" title=\"8.2 session\"></a>8.2 session</h6><ul>\n<li><p>koa-session-minimal 适用于koa2 的session中间件，提供存储介质的读写接口 。</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-session-minimal&#x27;</span>)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">session</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">key</span>: <span class=\"string\">&#x27;SESSION_ID&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">cookie</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">maxAge</span>:<span class=\"number\">1000</span>*<span class=\"number\">60</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure>\n\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//排除login相关的路由和接口</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">url</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&quot;login&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">session</span>.<span class=\"property\">user</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//重新设置以下sesssion</span></span><br><span class=\"line\">        ctx.<span class=\"property\">session</span>.<span class=\"property\">mydate</span> = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        ctx.<span class=\"title function_\">redirect</span>(<span class=\"string\">&quot;/login&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"9-JWT\"><a href=\"#9-JWT\" class=\"headerlink\" title=\"9. JWT\"></a>9. JWT</h5> <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">async</span>(ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//排除login相关的路由和接口</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">url</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&quot;login&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = ctx.<span class=\"property\">headers</span>[<span class=\"string\">&quot;authorization&quot;</span>]?.<span class=\"title function_\">split</span>(<span class=\"string\">&quot; &quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"comment\">// console.log(req.headers[&quot;authorization&quot;])</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(token)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> payload=  <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(token)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(payload)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//重新计算token过期时间</span></span><br><span class=\"line\">            <span class=\"keyword\">const</span> newToken = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">generate</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">_id</span>:payload.<span class=\"property\">_id</span>,</span><br><span class=\"line\">                <span class=\"attr\">username</span>:payload.<span class=\"property\">username</span></span><br><span class=\"line\">            &#125;,<span class=\"string\">&quot;10s&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            ctx.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Authorization&quot;</span>,newToken)</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            ctx.<span class=\"property\">status</span> = <span class=\"number\">401</span></span><br><span class=\"line\">            ctx.<span class=\"property\">body</span> = &#123;<span class=\"attr\">errCode</span>:-<span class=\"number\">1</span>,<span class=\"attr\">errInfo</span>:<span class=\"string\">&quot;token过期&quot;</span>&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"10-上传文件\"><a href=\"#10-上传文件\" class=\"headerlink\" title=\"10.上传文件\"></a>10.上传文件</h5><blockquote>\n<p><a href=\"https://www.npmjs.com/package/@koa/multer\">https://www.npmjs.com/package/@koa/multer</a></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save @koa/multer multer</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> multer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@koa/multer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> upload = <span class=\"title function_\">multer</span>(&#123; <span class=\"attr\">dest</span>: <span class=\"string\">&#x27;public/uploads/&#x27;</span> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/&quot;</span>,upload.<span class=\"title function_\">single</span>(<span class=\"string\">&#x27;avatar&#x27;</span>),</span><br><span class=\"line\"><span class=\"function\">(<span class=\"params\">ctx,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>,ctx.<span class=\"property\">file</span>)</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;</span><br><span class=\"line\">        <span class=\"attr\">ok</span>:<span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">info</span>:<span class=\"string\">&quot;add user success&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"11-操作MongoDB\"><a href=\"#11-操作MongoDB\" class=\"headerlink\" title=\"11.操作MongoDB\"></a>11.操作MongoDB</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(<span class=\"string\">&quot;mongodb://127.0.0.1:27017/kerwin_project&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//插入集合和数据,数据库kerwin_project会自动创建</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Schema</span> = mongoose.<span class=\"property\">Schema</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserType</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">username</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">password</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>:<span class=\"title class_\">Number</span>,</span><br><span class=\"line\">    <span class=\"attr\">avatar</span>:<span class=\"title class_\">String</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserModel</span> = mongoose.<span class=\"title function_\">model</span>(<span class=\"string\">&quot;user&quot;</span>,<span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(<span class=\"title class_\">UserType</span>))</span><br><span class=\"line\"><span class=\"comment\">// 模型user 将会对应 users 集合, </span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title class_\">UserModel</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"九、MySQL\"><a href=\"#九、MySQL\" class=\"headerlink\" title=\"九、MySQL\"></a>九、MySQL</h4><h5 id=\"1-介绍\"><a href=\"#1-介绍\" class=\"headerlink\" title=\"1.介绍\"></a>1.介绍</h5><p>付费的商用数据库：</p>\n<ul>\n<li>Oracle，典型的高富帅；</li>\n<li>SQL Server，微软自家产品，Windows定制专款；</li>\n<li>DB2，IBM的产品，听起来挺高端；</li>\n<li>Sybase，曾经跟微软是好基友，后来关系破裂，现在家境惨淡。</li>\n</ul>\n<p>这些数据库都是不开源而且付费的，最大的好处是花了钱出了问题可以找厂家解决，不过在Web的世界里，常常需要部署成千上万的数据库服务器，当然不能把大把大把的银子扔给厂家，所以，无论是Google、Facebook，还是国内的BAT，无一例外都选择了免费的开源数据库：</p>\n<ul>\n<li>MySQL，大家都在用，一般错不了；</li>\n<li>PostgreSQL，学术气息有点重，其实挺不错，但知名度没有MySQL高；</li>\n<li>sqlite，嵌入式数据库，适合桌面和移动应用。</li>\n</ul>\n<p>作为一个JavaScript全栈工程师，选择哪个免费数据库呢？当然是MySQL。因为MySQL普及率最高，出了错，可以很容易找到解决方法。而且，围绕MySQL有一大堆监控和运维的工具，安装和使用很方便。</p>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220420083146539.png\" alt=\"image-20220420083146539\"></p>\n<h5 id=\"2-与非关系数据库区别\"><a href=\"#2-与非关系数据库区别\" class=\"headerlink\" title=\"2.与非关系数据库区别\"></a>2.与非关系数据库区别</h5><p>关系型和非关系型数据库的主要差异是数据存储的方式。关系型数据天然就是表格式的，因此存储在数据表的行和列中。数据表可以彼此关联协作存储，也很容易提取数据。</p>\n<p>与其相反，非关系型数据不适合存储在数据表的行和列中，而是大块组合在一起。非关系型数据通常存储在数据集中，就像文档、键值对或者图结构。你的数据及其特性是选择数据存储和提取方式的首要影响因素。</p>\n<p><strong>关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织</strong><br>优点：<br>1、易于维护：都是使用表结构，格式一致；<br>2、使用方便：SQL语言通用，可用于复杂查询；<br>3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。<br>缺点：<br>1、读写性能比较差，尤其是海量数据的高效率读写；<br>2、固定的表结构，灵活度稍欠；<br>3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈。</p>\n<p><strong>非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。</strong></p>\n<p>优点：</p>\n<p>1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。<br>2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；<br>3、高扩展性；<br>4、成本低：nosql数据库部署简单，基本都是开源软件。</p>\n<p>缺点：</p>\n<p>1、不提供sql支持；<br>2、无事务处理；<br>3、数据结构相对复杂，复杂查询方面稍欠。</p>\n<h5 id=\"3-sql语句\"><a href=\"#3-sql语句\" class=\"headerlink\" title=\"3.sql语句\"></a>3.sql语句</h5><p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220420092527846.png\" alt=\"image-20220420092527846\"></p>\n<p>插入：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> `students`(`id`, `name`, `score`, `gender`) <span class=\"keyword\">VALUES</span> (<span class=\"keyword\">null</span>,<span class=\"string\">&#x27;kerwin&#x27;</span>,<span class=\"number\">100</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>可以不设置id,create_time</span><br></pre></td></tr></table></figure>\n<p>更新：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> `students` <span class=\"keyword\">SET</span> `name`<span class=\"operator\">=</span><span class=\"string\">&#x27;tiechui&#x27;</span>,`score`<span class=\"operator\">=</span><span class=\"number\">20</span>,`gender`<span class=\"operator\">=</span><span class=\"number\">0</span> <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<p>删除：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<p>查询：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查所有的数据所有的字段</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">查所有的数据某个字段</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> `id`, `name`, `score`, `gender` <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">条件查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> score<span class=\"operator\">&gt;=</span><span class=\"number\">80</span>;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">where</span> score<span class=\"operator\">&gt;=</span><span class=\"number\">80</span> <span class=\"keyword\">AND</span> gender<span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">模糊查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">where</span> name <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%k%&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">排序</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id, name, gender, score <span class=\"keyword\">FROM</span> students <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> score;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id, name, gender, score <span class=\"keyword\">FROM</span> students <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> score <span class=\"keyword\">DESC</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">分页查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id, name, gender, score <span class=\"keyword\">FROM</span> students LIMIT <span class=\"number\">50</span> <span class=\"keyword\">OFFSET</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">记录条数</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> students;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) kerwinnum <span class=\"keyword\">FROM</span> students;</span><br><span class=\"line\"></span><br><span class=\"line\">多表查询</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> students, classes;（这种多表查询又称笛卡尔查询，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有<span class=\"number\">100</span>行记录的表进行笛卡尔查询将返回<span class=\"number\">1</span>万条记录，对两个各自有<span class=\"number\">1</span>万行记录的表进行笛卡尔查询将返回<span class=\"number\">1</span>亿条记录）</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    students.id sid,</span><br><span class=\"line\">    students.name,</span><br><span class=\"line\">    students.gender,</span><br><span class=\"line\">    students.score,</span><br><span class=\"line\">    classes.id cid,</span><br><span class=\"line\">    classes.name cname</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> students, classes; （要使用表名.列名这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    s.id sid,</span><br><span class=\"line\">    s.name,</span><br><span class=\"line\">    s.gender,</span><br><span class=\"line\">    s.score,</span><br><span class=\"line\">    c.id cid,</span><br><span class=\"line\">    c.name cname</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> students s, classes c; （<span class=\"keyword\">SQL</span>还允许给表设置一个别名）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">联表查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> s.id, s.name, s.class_id, c.name class_name, s.gender, s.score</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> students s</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> classes c</span><br><span class=\"line\"><span class=\"keyword\">ON</span> s.class_id <span class=\"operator\">=</span> c.id; （连接查询对多个表进行<span class=\"keyword\">JOIN</span>运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220420090841742.png\" alt=\"image-20220420090841742\"></p>\n<p>注意：</p>\n<blockquote>\n<ol>\n<li>InnoDB 支持事务，MyISAM 不支持事务。这是 MySQL 将默认存储引擎从 MyISAM 变成 InnoDB 的重要原因之一；</li>\n<li>InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MYISAM 会失败；</li>\n</ol>\n</blockquote>\n<p><strong>外键约束</strong></p>\n<p>CASCADE<br>在父表上update/delete记录时，同步update/delete掉子表的匹配记录 </p>\n<p>SET NULL<br>在父表上update/delete记录时，将子表上匹配记录的列设为null (要注意子表的外键列不能为not null)  </p>\n<p>NO ACTION<br>如果子表中有匹配的记录,则不允许对父表对应候选键进行update/delete操作 </p>\n<p>RESTRICT<br>同no action, 都是立即检查外键约束</p>\n<h5 id=\"4-nodejs-操作数据库\"><a href=\"#4-nodejs-操作数据库\" class=\"headerlink\" title=\"4.nodejs 操作数据库\"></a>4.nodejs 操作数据库</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"><span class=\"keyword\">const</span> mysql2 = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mysql2&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = <span class=\"number\">9000</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>,<span class=\"keyword\">async</span> (req, res) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> config = <span class=\"title function_\">getDBConfig</span>()</span><br><span class=\"line\">  <span class=\"keyword\">const</span> promisePool = mysql2.<span class=\"title function_\">createPool</span>(config).<span class=\"title function_\">promise</span>();</span><br><span class=\"line\">  <span class=\"comment\">// console.log(promisePool)</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> user = <span class=\"keyword\">await</span> promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">&#x27;select * from students&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(user)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (user[<span class=\"number\">0</span>].<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//存在用户</span></span><br><span class=\"line\">          res.<span class=\"title function_\">send</span>(user[<span class=\"number\">0</span>])</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//不存在</span></span><br><span class=\"line\">          res.<span class=\"title function_\">send</span>( &#123;</span><br><span class=\"line\">              <span class=\"attr\">code</span>: -<span class=\"number\">2</span>,</span><br><span class=\"line\">              <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;user not exsit&#x27;</span>,</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;      </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(port, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`Example app listening at http://localhost:<span class=\"subst\">$&#123;port&#125;</span>`</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getDBConfig</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">host</span>: <span class=\"string\">&#x27;127.0.0.1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">user</span>: <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">port</span>: <span class=\"number\">3306</span>,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">database</span>: <span class=\"string\">&#x27;kerwin_test&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">connectionLimit</span>: <span class=\"number\">1</span> <span class=\"comment\">//创建一个连接池</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查询：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">&#x27;select * from users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">插入：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">&#x27;INSERT INTO `users`(`id`,`name`,`age`, `password`) VALUES (?,?,?,?)&#x27;</span>,[<span class=\"literal\">null</span>,<span class=\"string\">&quot;kerwin&quot;</span>,<span class=\"number\">100</span>,<span class=\"string\">&quot;123456&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">更新：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">`UPDATE users SET name = ? ,age=? WHERE id = ?`</span>,[<span class=\"string\">&quot;xiaoming2&quot;</span>,<span class=\"number\">20</span>,<span class=\"number\">1</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">删除：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">`delete from users where id=?`</span>,[<span class=\"number\">1</span>])</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"十、Socket编程\"><a href=\"#十、Socket编程\" class=\"headerlink\" title=\"十、Socket编程\"></a>十、Socket编程</h4><h5 id=\"1-websocket介绍\"><a href=\"#1-websocket介绍\" class=\"headerlink\" title=\"1.websocket介绍\"></a>1.websocket介绍</h5><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220421084242097.png\" alt=\"image-20220421084242097\" style=\"zoom:50%;\" />\n\n<p><strong>应用场景：</strong></p>\n<ul>\n<li><p>弹幕</p>\n</li>\n<li><p>媒体聊天</p>\n</li>\n<li><p>协同编辑</p>\n</li>\n<li><p>基于位置的应用</p>\n</li>\n<li><p>体育实况更新</p>\n</li>\n<li><p>股票基金报价实时更新</p>\n</li>\n</ul>\n<p>WebSocket并不是全新的协议，而是利用了HTTP协议来建立连接。我们来看看WebSocket连接是如何创建的。</p>\n<p>首先，WebSocket连接必须由浏览器发起，因为请求协议是一个标准的HTTP请求，格式如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">GET</span> <span class=\"attr\">ws</span>:<span class=\"comment\">//localhost:3000/ws/chat HTTP/1.1</span></span><br><span class=\"line\"><span class=\"title class_\">Host</span>: localhost</span><br><span class=\"line\"><span class=\"title class_\">Upgrade</span>: websocket</span><br><span class=\"line\"><span class=\"title class_\">Connection</span>: <span class=\"title class_\">Upgrade</span></span><br><span class=\"line\"><span class=\"title class_\">Origin</span>: <span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000</span></span><br><span class=\"line\"><span class=\"title class_\">Sec</span>-<span class=\"title class_\">WebSocket</span>-<span class=\"title class_\">Key</span>: client-random-string</span><br><span class=\"line\"><span class=\"title class_\">Sec</span>-<span class=\"title class_\">WebSocket</span>-<span class=\"title class_\">Version</span>: <span class=\"number\">13</span></span><br></pre></td></tr></table></figure>\n\n<p>该请求和普通的HTTP请求有几点不同：</p>\n<ol>\n<li>GET请求的地址不是类似<code>/path/</code>，而是以<code>ws://</code>开头的地址；</li>\n<li>请求头<code>Upgrade: websocket</code>和<code>Connection: Upgrade</code>表示这个连接将要被转换为WebSocket连接；</li>\n<li><code>Sec-WebSocket-Key</code>是用于标识这个连接，并非用于加密数据；</li>\n<li><code>Sec-WebSocket-Version</code>指定了WebSocket的协议版本。</li>\n</ol>\n<p>随后，服务器如果接受该请求，就会返回如下响应：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 101 Switching Protocols</span><br><span class=\"line\">Upgrade: websocket</span><br><span class=\"line\">Connection: Upgrade</span><br><span class=\"line\">Sec-WebSocket-Accept: server-random-string</span><br></pre></td></tr></table></figure>\n\n<p>该响应代码<code>101</code>表示本次连接的HTTP协议即将被更改，更改后的协议就是<code>Upgrade: websocket</code>指定的WebSocket协议。</p>\n<p>版本号和子协议规定了双方能理解的数据格式，以及是否支持压缩等等。如果仅使用WebSocket的API，就不需要关心这些。</p>\n<p>现在，一个WebSocket连接就建立成功，浏览器和服务器就可以随时主动发送消息给对方。消息有两种，一种是文本，一种是二进制数据。通常，我们可以发送JSON格式的文本，这样，在浏览器处理起来就十分容易。</p>\n<p>为什么WebSocket连接可以实现全双工通信而HTTP连接不行呢？实际上HTTP协议是建立在TCP协议之上的，TCP协议本身就实现了全双工通信，但是HTTP协议的请求－应答机制限制了全双工通信。WebSocket连接建立以后，其实只是简单规定了一下：接下来，咱们通信就不使用HTTP协议了，直接互相发数据吧。</p>\n<p>安全的WebSocket连接机制和HTTPS类似。首先，浏览器用<code>wss://xxx</code>创建WebSocket连接时，会先通过HTTPS创建安全的连接，然后，该HTTPS连接升级为WebSocket连接，底层通信走的仍然是安全的SSL/TLS协议。</p>\n<p><strong>浏览器支持</strong></p>\n<p>很显然，要支持WebSocket通信，浏览器得支持这个协议，这样才能发出<code>ws://xxx</code>的请求。目前，支持WebSocket的主流浏览器如下：</p>\n<ul>\n<li>Chrome</li>\n<li>Firefox</li>\n<li>IE &gt;= 10</li>\n<li>Sarafi &gt;= 6</li>\n<li>Android &gt;= 4.4</li>\n<li>iOS &gt;= 8</li>\n</ul>\n<p><strong>服务器支持</strong></p>\n<p>由于WebSocket是一个协议，服务器具体怎么实现，取决于所用编程语言和框架本身。Node.js本身支持的协议包括TCP协议和HTTP协议，要支持WebSocket协议，需要对Node.js提供的HTTPServer做额外的开发。已经有若干基于Node.js的稳定可靠的WebSocket实现，我们直接用npm安装使用即可。</p>\n<h5 id=\"2-ws模块\"><a href=\"#2-ws模块\" class=\"headerlink\" title=\"2.ws模块\"></a>2.ws模块</h5><p>服务器：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span>  <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;ws&quot;</span>)</span><br><span class=\"line\"><span class=\"title class_\">WebSocketServer</span> = <span class=\"title class_\">WebSocket</span>.<span class=\"property\">WebSocketServer</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> wss = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocketServer</span>(&#123; <span class=\"attr\">port</span>: <span class=\"number\">8080</span> &#125;);</span><br><span class=\"line\">wss.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws</span>) &#123;</span><br><span class=\"line\">    ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">message</span>(<span class=\"params\">data, isBinary</span>) &#123;</span><br><span class=\"line\">        wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (client !== ws &amp;&amp; client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">                client.<span class=\"title function_\">send</span>(data, &#123; <span class=\"attr\">binary</span>: isBinary &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;欢迎加入聊天室&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>客户端：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ws = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>(<span class=\"string\">&quot;ws://localhost:8080&quot;</span>)</span><br><span class=\"line\">ws.<span class=\"property\">onopen</span> = <span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;open&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ws.<span class=\"property\">onmessage</span> = <span class=\"function\">(<span class=\"params\">evt</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(evt.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>授权验证：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//前端</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ws = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>(<span class=\"string\">`ws://localhost:8080?token=<span class=\"subst\">$&#123;<span class=\"variable language_\">localStorage</span>.getItem(<span class=\"string\">&quot;token&quot;</span>)&#125;</span>`</span>)</span><br><span class=\"line\">ws.<span class=\"property\">onopen</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;open&quot;</span>)</span><br><span class=\"line\">      ws.<span class=\"title function_\">send</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span></span><br><span class=\"line\">      &#125;))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">ws.<span class=\"property\">onmessage</span> = <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(evt.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//后端</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;ws&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">JWT</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../util/JWT&#x27;</span>);</span><br><span class=\"line\"><span class=\"title class_\">WebSocketServer</span> = <span class=\"title class_\">WebSocket</span>.<span class=\"property\">WebSocketServer</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> wss = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocketServer</span>(&#123; <span class=\"attr\">port</span>: <span class=\"number\">8080</span> &#125;);</span><br><span class=\"line\">wss.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws, req</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> myURL = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(req.<span class=\"property\">url</span>, <span class=\"string\">&#x27;http://127.0.0.1:3000&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> payload = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(myURL.<span class=\"property\">searchParams</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;token&quot;</span>))</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (payload) &#123;</span><br><span class=\"line\">    ws.<span class=\"property\">user</span> = payload</span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, ws.<span class=\"property\">user</span>, <span class=\"string\">&quot;欢迎来到聊天室&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好友列表</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">Error</span>, <span class=\"literal\">null</span>, <span class=\"string\">&quot;token过期&quot;</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// console.log(3333,url)</span></span><br><span class=\"line\">  ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">message</span>(<span class=\"params\">data, isBinary</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> messageObj = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(data)</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (messageObj.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>:</span><br><span class=\"line\">        ws.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, ws.<span class=\"property\">user</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(<span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(wss.<span class=\"property\">clients</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">user</span>))))</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>:</span><br><span class=\"line\">        wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (client !== ws &amp;&amp; client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">            client.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, ws.<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>:</span><br><span class=\"line\">        wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (client.<span class=\"property\">user</span>.<span class=\"property\">username</span> === messageObj.<span class=\"property\">to</span> &amp;&amp; client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">            client.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, ws.<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ws.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;close&quot;</span>,<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">      <span class=\"comment\">//删除当前用户</span></span><br><span class=\"line\">      wss.<span class=\"property\">clients</span>.<span class=\"title function_\">delete</span>(ws.<span class=\"property\">user</span>)</span><br><span class=\"line\">      <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好用列表</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocketType</span> = &#123;</span><br><span class=\"line\">  <span class=\"title class_\">Error</span>: <span class=\"number\">0</span>, <span class=\"comment\">//错误</span></span><br><span class=\"line\">  <span class=\"title class_\">GroupList</span>: <span class=\"number\">1</span>,<span class=\"comment\">//群列表</span></span><br><span class=\"line\">  <span class=\"title class_\">GroupChat</span>: <span class=\"number\">2</span>,<span class=\"comment\">//群聊</span></span><br><span class=\"line\">  <span class=\"title class_\">SingleChat</span>: <span class=\"number\">3</span><span class=\"comment\">//私聊</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">createMessage</span>(<span class=\"params\">type, user, data</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: type,</span><br><span class=\"line\">    <span class=\"attr\">user</span>: user,</span><br><span class=\"line\">    <span class=\"attr\">data</span>: data</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendBroadList</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">      client.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, client.<span class=\"property\">user</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(<span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(wss.<span class=\"property\">clients</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">user</span>))))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"3-socket-io模块\"><a href=\"#3-socket-io模块\" class=\"headerlink\" title=\"3.socket.io模块\"></a>3.socket.io模块</h5><p>服务端：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> io = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;socket.io&#x27;</span>)(server);</span><br><span class=\"line\">io.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"function\">(<span class=\"params\">socket</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> payload = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(socket.<span class=\"property\">handshake</span>.<span class=\"property\">query</span>.<span class=\"property\">token</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (payload) &#123;</span><br><span class=\"line\">    socket.<span class=\"property\">user</span> = payload</span><br><span class=\"line\">    socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"title function_\">createMessage</span>(socket.<span class=\"property\">user</span>, <span class=\"string\">&quot;欢迎来到聊天室&quot;</span>))</span><br><span class=\"line\">    <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好友列表</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">Error</span>, <span class=\"title function_\">createMessage</span>(<span class=\"literal\">null</span>, <span class=\"string\">&quot;token过期&quot;</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"title function_\">createMessage</span>(<span class=\"literal\">null</span>, <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(io.<span class=\"property\">sockets</span>.<span class=\"property\">sockets</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item[<span class=\"number\">1</span>].<span class=\"property\">user</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">item</span>=&gt;</span>item)));</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"function\">(<span class=\"params\">messageObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    socket.<span class=\"property\">broadcast</span>.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"title function_\">createMessage</span>(socket.<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, <span class=\"function\">(<span class=\"params\">messageObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(io.<span class=\"property\">sockets</span>.<span class=\"property\">sockets</span>).<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">socket</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (socket[<span class=\"number\">1</span>].<span class=\"property\">user</span>.<span class=\"property\">username</span> === messageObj.<span class=\"property\">to</span>) &#123;</span><br><span class=\"line\">        socket[<span class=\"number\">1</span>].<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, <span class=\"title function_\">createMessage</span>(socket[<span class=\"number\">1</span>].<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;disconnect&#x27;</span>, <span class=\"function\"><span class=\"params\">reason</span> =&gt;</span> &#123;</span><br><span class=\"line\">     </span><br><span class=\"line\">     <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好用列表</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendBroadList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  io.<span class=\"property\">sockets</span>.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"title function_\">createMessage</span>(<span class=\"literal\">null</span>, <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(io.<span class=\"property\">sockets</span>.<span class=\"property\">sockets</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item[<span class=\"number\">1</span>].<span class=\"property\">user</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">item</span>=&gt;</span>item)))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//最后filter，是因为 有可能存在null的值</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>客户端：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocketType</span> = &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Error</span>: <span class=\"number\">0</span>, <span class=\"comment\">//错误</span></span><br><span class=\"line\">    <span class=\"title class_\">GroupList</span>: <span class=\"number\">1</span>, <span class=\"comment\">//群列表</span></span><br><span class=\"line\">    <span class=\"title class_\">GroupChat</span>: <span class=\"number\">2</span>, <span class=\"comment\">//群聊</span></span><br><span class=\"line\">    <span class=\"title class_\">SingleChat</span>: <span class=\"number\">3</span> <span class=\"comment\">//私聊</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> socket = <span class=\"title function_\">io</span>(<span class=\"string\">`ws://localhost:3000?token=<span class=\"subst\">$&#123;<span class=\"variable language_\">localStorage</span>.getItem(<span class=\"string\">&quot;token&quot;</span>)&#125;</span>`</span>);</span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;connect&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">\tsocket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"function\">(<span class=\"params\">messageObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    select.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    select.<span class=\"property\">innerHTML</span> = <span class=\"string\">`&lt;option value=&quot;all&quot;&gt;all&lt;/option&gt;`</span> + messageObj.<span class=\"property\">data</span>.<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">    &lt;option value=&quot;<span class=\"subst\">$&#123;item.username&#125;</span>&quot;&gt;<span class=\"subst\">$&#123;item.username&#125;</span>&lt;/option&gt;`</span>).<span class=\"title function_\">join</span>(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msg)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, <span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msg)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">Error</span>, <span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(<span class=\"string\">&quot;token&quot;</span>)</span><br><span class=\"line\">    location.<span class=\"property\">href</span> = <span class=\"string\">&quot;/login&quot;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">send.<span class=\"property\">onclick</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (select.<span class=\"property\">value</span> === <span class=\"string\">&quot;all&quot;</span>) &#123;</span><br><span class=\"line\">        socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>,&#123;</span><br><span class=\"line\">            <span class=\"attr\">data</span>: text.<span class=\"property\">value</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>,&#123;</span><br><span class=\"line\">            <span class=\"attr\">data</span>: text.<span class=\"property\">value</span>,</span><br><span class=\"line\">            <span class=\"attr\">to</span>:select.<span class=\"property\">value</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"十一、mocha\"><a href=\"#十一、mocha\" class=\"headerlink\" title=\"十一、mocha\"></a>十一、mocha</h4><p>单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>\n<p>比如对函数abs()，我们可以编写出以下几个测试用例：</p>\n<p>输入正数，比如1、1.2、0.99，期待返回值与输入相同；</p>\n<p>输入负数，比如-1、-1.2、-0.99，期待返回值与输入相反；</p>\n<p>输入0，期待返回0；</p>\n<p>输入非数值类型，比如null、[]、{}，期待抛出Error。</p>\n<p>把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。</p>\n<p>如果单元测试通过，说明我们测试的这个函数能够正常工作。如果单元测试不通过，要么函数有bug，要么测试条件输入不正确，总之，需要修复使单元测试能够通过。</p>\n<p>单元测试通过后有什么意义呢？如果我们对abs()函数代码做了修改，只需要再跑一遍单元测试，如果通过，说明我们的修改不会对abs()函数原有的行为造成影响，如果测试不通过，说明我们的修改与原有行为不一致，要么修改代码，要么修改测试。</p>\n<p>这种以测试为驱动的开发模式最大的好处就是确保一个程序模块的行为符合我们设计的测试用例。在将来修改的时候，可以极大程度地保证该模块行为仍然是正确的。</p>\n<p>mocha是JavaScript的一种单元测试框架，既可以在浏览器环境下运行，也可以在Node.js环境下运行。</p>\n<p>使用mocha，我们就只需要专注于编写单元测试本身，然后，让mocha去自动运行所有的测试，并给出测试结果。</p>\n<p>mocha的特点主要有：</p>\n<ol>\n<li>既可以测试简单的JavaScript函数，又可以测试异步代码，因为异步是JavaScript的特性之一；</li>\n<li>可以自动运行所有测试，也可以只运行特定的测试；</li>\n<li>可以支持before、after、beforeEach和afterEach来编写初始化代码。</li>\n</ol>\n<h5 id=\"1-编写测试\"><a href=\"#1-编写测试\" class=\"headerlink\" title=\"1.编写测试\"></a>1.编写测试</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> assert = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;assert&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> sum = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../test&#x27;</span>);</span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#hello.js&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#sum()&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum() should return 0&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(), <span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum(1) should return 1&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(<span class=\"number\">1</span>), <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum(1, 2) should return 3&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>), <span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum(1, 2, 3) should return 6&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>), <span class=\"number\">6</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"2-chai断言库\"><a href=\"#2-chai断言库\" class=\"headerlink\" title=\"2.chai断言库\"></a>2.chai断言库</h5><p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220505113605440.png\" alt=\"image-20220505113605440\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> assert = chai.<span class=\"property\">assert</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;assert Demo&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;use assert lib&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\">        assert.<span class=\"title function_\">typeOf</span>(value, <span class=\"string\">&#x27;string&#x27;</span>)</span><br><span class=\"line\">        assert.<span class=\"title function_\">equal</span>(value, <span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">        assert.<span class=\"title function_\">lengthOf</span>(value, <span class=\"number\">5</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>);</span><br><span class=\"line\">chai.<span class=\"title function_\">should</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;should Demo&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;use should lib&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">        value.<span class=\"property\">should</span>.<span class=\"property\">exist</span>.<span class=\"property\">and</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;hello&#x27;</span>).<span class=\"property\">and</span>.<span class=\"property\">have</span>.<span class=\"title function_\">length</span>(<span class=\"number\">5</span>).<span class=\"property\">and</span>.<span class=\"property\">be</span>.<span class=\"title function_\">a</span>(<span class=\"string\">&#x27;string&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// value.should.be.a(&#x27;string&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">// value.should.equal(&#x27;hello&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">// value.should.not.equal(&#x27;hello2&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">// value.should.have.length(5);</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> expect = chai.<span class=\"property\">expect</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;expect Demo&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;use expect lib&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> number = <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(number).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"property\">at</span>.<span class=\"title function_\">most</span>(<span class=\"number\">5</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(number).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"property\">at</span>.<span class=\"title function_\">least</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(number).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"title function_\">within</span>(<span class=\"number\">1</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">exist</span></span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"title function_\">a</span>(<span class=\"string\">&#x27;string&#x27;</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">not</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;您好&#x27;</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">have</span>.<span class=\"title function_\">length</span>(<span class=\"number\">5</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"3-异步测试\"><a href=\"#3-异步测试\" class=\"headerlink\" title=\"3.异步测试\"></a>3.异步测试</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs =<span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>).<span class=\"property\">promises</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> expect = chai.<span class=\"property\">expect</span>;</span><br><span class=\"line\"><span class=\"title function_\">it</span>(<span class=\"string\">&#x27;test async function&#x27;</span>,<span class=\"keyword\">async</span> <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> data =<span class=\"keyword\">await</span> fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./1.txt&#x27;</span>,<span class=\"string\">&quot;utf8&quot;</span>);</span><br><span class=\"line\">    <span class=\"title function_\">expect</span>(data).<span class=\"property\">to</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"4-http测试\"><a href=\"#4-http测试\" class=\"headerlink\" title=\"4.http测试\"></a>4.http测试</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;supertest&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../app&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#test koa app&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> server = app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>);</span><br><span class=\"line\">    <span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#test server&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;#test GET /&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"title function_\">request</span>(server)</span><br><span class=\"line\">                .<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">                .<span class=\"title function_\">expect</span>(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"regexp\">/text\\/html/</span>)</span><br><span class=\"line\">                .<span class=\"title function_\">expect</span>(<span class=\"number\">200</span>, <span class=\"string\">&#x27;&lt;h1&gt;hello world&lt;/h1&gt;&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">after</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            server.<span class=\"title function_\">close</span>()</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"5-钩子函数\"><a href=\"#5-钩子函数\" class=\"headerlink\" title=\"5.钩子函数\"></a>5.钩子函数</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#hello.js&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#sum()&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">before</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;before:&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">after</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;after.&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">beforeEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;  beforeEach:&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">afterEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;  afterEach.&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h4 id=\"一、Node-js基础\"><a href=\"#一、Node-js基础\" class=\"headerlink\" title=\"一、Node.js基础\"></a>一、Node.js基础</h4><h5 id=\"1-认识Node-js\"><a href=\"#1-认识Node-js\" class=\"headerlink\" title=\"1.  认识Node.js\"></a>1.  认识Node.js</h5><blockquote>\n<p>Node.js是一个javascript运行环境。它让javascript可以开发后端程序，实现几乎其他后端语言实现的所有功能，可以与PHP、Java、Python、.NET、Ruby等后端语言平起平坐。</p>\n<p>Nodejs是基于V8引擎，V8是Google发布的开源JavaScript引擎，本身就是用于Chrome浏览器的js解释部分，但是Ryan Dahl 这哥们，鬼才般的，把这个V8搬到了服务器上，用于做服务器的软件。</p>\n</blockquote>\n<h6 id=\"01-nodejs的特性\"><a href=\"#01-nodejs的特性\" class=\"headerlink\" title=\"01 nodejs的特性\"></a>01 nodejs的特性</h6><ul>\n<li>Nodejs语法完全是js语法，只要你懂js基础就可以学会Nodejs后端开发</li>\n<li>NodeJs超强的高并发能力,实现高性能服务器</li>\n<li>开发周期短、开发成本低、学习成本低</li>\n</ul>\n<h6 id=\"02-使用-Node-js-需要了解多少-JavaScript\"><a href=\"#02-使用-Node-js-需要了解多少-JavaScript\" class=\"headerlink\" title=\"02 使用 Node.js 需要了解多少 JavaScript\"></a>02 使用 Node.js 需要了解多少 JavaScript</h6><blockquote>\n<p><a href=\"http://nodejs.cn/learn/how-much-javascript-do-you-need-to-know-to-use-nodejs\">http://nodejs.cn/learn/how-much-javascript-do-you-need-to-know-to-use-nodejs</a></p>\n</blockquote>\n<h6 id=\"03-浏览器环境vs-node环境\"><a href=\"#03-浏览器环境vs-node环境\" class=\"headerlink\" title=\"03 浏览器环境vs node环境\"></a>03 浏览器环境vs node环境</h6><p>Node.js 可以解析JS代码（没有浏览器安全级别的限制）提供很多系统级别的API，如：</p>\n<ul>\n<li><p>文件的读写 (File System)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./ajax.png&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, content</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(content)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li><p>进程的管理 (Process)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">main</span>(<span class=\"params\">argv</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(argv)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">main</span>(process.<span class=\"property\">argv</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">2</span>))</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>网络通信 (HTTP/HTTPS)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req,res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;content-type&quot;</span>: <span class=\"string\">&quot;text/plain&quot;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  res.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;hello nodejs&quot;</span>)</span><br><span class=\"line\">  res.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;).<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h5 id=\"2-开发环境搭建\"><a href=\"#2-开发环境搭建\" class=\"headerlink\" title=\"2.  开发环境搭建\"></a>2.  开发环境搭建</h5><blockquote>\n<p><a href=\"http://nodejs.cn/download/\">http://nodejs.cn/download/</a></p>\n</blockquote>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210095903409.png\" alt=\"image-20220210095903409\"></p>\n<h5 id=\"3-模块、包、commonJS\"><a href=\"#3-模块、包、commonJS\" class=\"headerlink\" title=\"3.  模块、包、commonJS\"></a>3.  模块、包、commonJS</h5><p>​            <img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210100015768.png\" alt=\"image-20220210100015768\"></p>\n<h6 id=\"02-CommonJS规范\"><a href=\"#02-CommonJS规范\" class=\"headerlink\" title=\"02 CommonJS规范\"></a>02 CommonJS规范</h6><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101652166.png\" alt=\"image-20220210101652166\" style=\"zoom: 67%; float: left;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210101720533.png\" alt=\"image-20220210101720533\" style=\"zoom: 67%; float: left;\" />\n\n<h6 id=\"03-modules模块化规范写法\"><a href=\"#03-modules模块化规范写法\" class=\"headerlink\" title=\"03 modules模块化规范写法\"></a>03 modules模块化规范写法</h6><p>我们可以把公共的功能 抽离成为一个单独的 js 文件 作为一个模块，默认情况下面这个模块里面的方法或者属性，外面是没法访问的。如果要让外部可以访问模块里面的方法或者属性，就必须在模块里面通过 exports 或者 module.exports 暴露属性或者方法。</p>\n<p>m1.js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;gp19&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">sayName</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;module 1&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接口暴露方法一：</span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">say</span>: sayName</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 接口暴露方法二：</span></span><br><span class=\"line\"><span class=\"built_in\">exports</span>.<span class=\"property\">say</span> = sayName</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误！</span></span><br><span class=\"line\"><span class=\"built_in\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">say</span>: sayName</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>main.js：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> m1 = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;./m1&#x27;</span>)</span><br><span class=\"line\">m1.<span class=\"title function_\">say</span>()</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-Npm-amp-Yarn\"><a href=\"#4-Npm-amp-Yarn\" class=\"headerlink\" title=\"4.  Npm&amp;Yarn\"></a>4.  Npm&amp;Yarn</h5><h6 id=\"01-npm的使用\"><a href=\"#01-npm的使用\" class=\"headerlink\" title=\"01 npm的使用\"></a>01 npm的使用</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init</span><br><span class=\"line\">npm install 包名 –g  （uninstall,update）</span><br><span class=\"line\">npm install 包名 --save-dev (uninstall,update)</span><br><span class=\"line\">npm list -g (不加-g，列举当前目录下的安装包)</span><br><span class=\"line\">npm info 包名（详细信息） npm info 包名 <span class=\"title function_\">version</span>(获取最新版本)</span><br><span class=\"line\">npm install md5@<span class=\"number\">1</span>（安装指定版本）</span><br><span class=\"line\">npm <span class=\"title function_\">outdated</span>(  检查包是否已经过时)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;dependencies&quot;</span>: &#123;    <span class=\"string\">&quot;md5&quot;</span>: <span class=\"string\">&quot;^2.1.0&quot;</span>  &#125;  ^ 表示 如果 直接npm install 将会 安md5</span><br><span class=\"line\">    <span class=\"number\">2.</span>*.*  \t最新版本</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;dependencies&quot;</span>: &#123;    <span class=\"string\">&quot;md5&quot;</span>: <span class=\"string\">&quot;~2.1.0&quot;</span>  &#125;  ~ 表示 如果 直接npm install 将会 安装md5 <span class=\"number\">2.1</span>.*  最新版本</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;dependencies&quot;</span>: &#123;    <span class=\"string\">&quot;md5&quot;</span>: <span class=\"string\">&quot;*&quot;</span>  &#125;  * 表示 如果 直接npm install 将会 安装 md5  最新版本</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"02-全局安装-nrm\"><a href=\"#02-全局安装-nrm\" class=\"headerlink\" title=\"02 全局安装 nrm\"></a>02 全局安装 nrm</h6><blockquote>\n<p>NRM (npm registry manager)是npm的镜像源管理工具，有时候国外资源太慢，使用这个就可以快速地在 npm 源间切换。</p>\n</blockquote>\n<p><code>手动切换方法： npm config set registry https://registry.npm.taobao.org</code></p>\n<p><strong>安装 nrm</strong></p>\n<p>在命令行执行命令，npm install -g nrm，全局安装nrm。</p>\n<p><strong>使用 nrm</strong></p>\n<p>执行命令 nrm ls 查看可选的源。 其中，带*的是当前使用的源，上面的输出表明当前源是官方源。</p>\n<p><strong>切换 nrm</strong></p>\n<p>如果要切换到taobao源，执行命令nrm use taobao。</p>\n<p><strong>测试速度</strong></p>\n<p>你还可以通过 nrm test 测试相应源的响应时间。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nrm test</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> 扩展：</p>\n</blockquote>\n<blockquote>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220210114017616.png\" alt=\"image-20220210114017616\"></p>\n</blockquote>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g cnpm --registry=https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"03-yarn使用\"><a href=\"#03-yarn使用\" class=\"headerlink\" title=\"03 yarn使用\"></a>03 yarn使用</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g yarn</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">对比<span class=\"attr\">npm</span>:</span><br><span class=\"line\">\t速度超快: <span class=\"title class_\">Yarn</span> 缓存了每个下载过的包，所以再次使用时无需重复下载。 同时利用并行下载以最大化资源利用率，因此安装速度更快。</span><br><span class=\"line\">    超级安全: 在执行代码之前，<span class=\"title class_\">Yarn</span> 会通过算法校验每个安装包的完整性。</span><br><span class=\"line\"></span><br><span class=\"line\">开始新项目</span><br><span class=\"line\">\tyarn init </span><br><span class=\"line\">添加依赖包</span><br><span class=\"line\">\tyarn add [package] </span><br><span class=\"line\">\tyarn add [package]@[version] </span><br><span class=\"line\">\tyarn add [package] --dev </span><br><span class=\"line\">升级依赖包</span><br><span class=\"line\">\t yarn upgrade [package]@[version] </span><br><span class=\"line\">移除依赖包</span><br><span class=\"line\">\t yarn remove [package]</span><br><span class=\"line\">\t </span><br><span class=\"line\">安装项目的全部依赖</span><br><span class=\"line\">\t yarn install </span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"5-内置模块\"><a href=\"#5-内置模块\" class=\"headerlink\" title=\"5.  内置模块\"></a>5.  内置模块</h5><h6 id=\"01-http模块\"><a href=\"#01-http模块\" class=\"headerlink\" title=\"01  http模块\"></a>01  http模块</h6><blockquote>\n<p>要使用 HTTP 服务器和客户端，则必须 <code>require(&#39;http&#39;)</code>。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建本地服务器来从其接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span> &#125;);</span><br><span class=\"line\">  res.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">8000</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建本地服务器来从其接收数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 监听请求事件</span></span><br><span class=\"line\">server.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;request&#x27;</span>, <span class=\"function\">(<span class=\"params\">request, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span> &#125;);</span><br><span class=\"line\">  res.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&#x27;Hello World!&#x27;</span></span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">8000</span>);</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"02-url模块\"><a href=\"#02-url模块\" class=\"headerlink\" title=\"02   url模块\"></a>02   url模块</h6><p><strong>02.1 parse</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> urlString = <span class=\"string\">&#x27;https://www.baidu.com:443/ad/index.html?id=8&amp;name=mouse#tag=110&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> parsedStr = url.<span class=\"title function_\">parse</span>(urlString)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsedStr)</span><br></pre></td></tr></table></figure>\n\n<p><strong>02.2 format</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> urlObject = &#123;</span><br><span class=\"line\">  <span class=\"attr\">protocol</span>: <span class=\"string\">&#x27;https:&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">slashes</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">auth</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  <span class=\"attr\">host</span>: <span class=\"string\">&#x27;www.baidu.com:443&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">port</span>: <span class=\"string\">&#x27;443&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">hostname</span>: <span class=\"string\">&#x27;www.baidu.com&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">hash</span>: <span class=\"string\">&#x27;#tag=110&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">search</span>: <span class=\"string\">&#x27;?id=8&amp;name=mouse&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">query</span>: &#123; <span class=\"attr\">id</span>: <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"attr\">name</span>: <span class=\"string\">&#x27;mouse&#x27;</span> &#125;,</span><br><span class=\"line\">  <span class=\"attr\">pathname</span>: <span class=\"string\">&#x27;/ad/index.html&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/ad/index.html?id=8&amp;name=mouse&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> parsedObj = url.<span class=\"title function_\">format</span>(urlObject)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsedObj)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>02.3 resolve</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = url.<span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;/one/two/three&#x27;</span>, <span class=\"string\">&#x27;four&#x27;</span>)  ( 注意最后加/ ，不加/的区别 )</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = url.<span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;http://example.com/&#x27;</span>, <span class=\"string\">&#x27;/one&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = url.<span class=\"title function_\">resolve</span>(<span class=\"string\">&#x27;http://example.com/one&#x27;</span>, <span class=\"string\">&#x27;/two&#x27;</span>)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(a + <span class=\"string\">&quot;,&quot;</span> + b + <span class=\"string\">&quot;,&quot;</span> + c)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"03-querystring模块\"><a href=\"#03-querystring模块\" class=\"headerlink\" title=\"03  querystring模块\"></a>03  querystring模块</h6><p><strong>03.1 parse</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> qs = <span class=\"string\">&#x27;x=3&amp;y=4&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> parsed = querystring.<span class=\"title function_\">parse</span>(qs)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsed)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>03.2 stringify</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> qo = &#123;</span><br><span class=\"line\">  <span class=\"attr\">x</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">  <span class=\"attr\">y</span>: <span class=\"number\">4</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> parsed = querystring.<span class=\"title function_\">stringify</span>(qo)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(parsed)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>03.3 escape/unescape</strong></p>\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211406894.png\" alt=\"image-20220213211406894\" style=\"zoom:67%;\" />\n\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220213211423142.png\" alt=\"image-20220213211423142\" style=\"zoom:67%;\" />\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;id=3&amp;city=北京&amp;url=https://www.baidu.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> escaped = querystring.<span class=\"built_in\">escape</span>(str)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(escaped)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;id%3D3%26city%3D%E5%8C%97%E4%BA%AC%26url%3Dhttps%3A%2F%2Fwww.baidu.com&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> unescaped = querystring.<span class=\"built_in\">unescape</span>(str)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(unescaped)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"04-http模块补充\"><a href=\"#04-http模块补充\" class=\"headerlink\" title=\"04  http模块补充\"></a>04  http模块补充</h6><p><strong>04.1 接口：jsonp</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> urlObj = url.<span class=\"title function_\">parse</span>(req.<span class=\"property\">url</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (urlObj.<span class=\"property\">pathname</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/api/user&#x27;</span>:</span><br><span class=\"line\">      res.<span class=\"title function_\">end</span>(<span class=\"string\">`<span class=\"subst\">$&#123;urlObj.query.cb&#125;</span>(&#123;&quot;name&quot;: &quot;gp145&quot;&#125;)`</span>)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      res.<span class=\"title function_\">end</span>(<span class=\"string\">&#x27;404.&#x27;</span>)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">8080</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;localhost:8080&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>04.2 跨域：CORS</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;url&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> urlObj = url.<span class=\"title function_\">parse</span>(req.<span class=\"property\">url</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    data += chunk</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">responseResult</span>(querystring.<span class=\"title function_\">parse</span>(data))</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">responseResult</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (urlObj.<span class=\"property\">pathname</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/api/login&#x27;</span>:</span><br><span class=\"line\">        res.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">message</span>: data</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"attr\">default</span>:</span><br><span class=\"line\">        res.<span class=\"title function_\">end</span>(<span class=\"string\">&#x27;404.&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">8080</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;localhost:8080&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><strong>04.3 模拟get</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;https&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1、接口 2、跨域</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> url = request.<span class=\"property\">url</span>.<span class=\"title function_\">substr</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  response.<span class=\"title function_\">writeHeader</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  https.<span class=\"title function_\">get</span>(<span class=\"string\">`https://m.lagou.com/listmore.json<span class=\"subst\">$&#123;url&#125;</span>`</span>, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      data += chunk</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      response.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">ret</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        data</span><br><span class=\"line\">      &#125;))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">server.<span class=\"title function_\">listen</span>(<span class=\"number\">8080</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;localhost:8080&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>04.4 模拟post：服务器提交（攻击）</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;https&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> querystring = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;querystring&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> postData = querystring.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">province</span>: <span class=\"string\">&#x27;上海&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">city</span>: <span class=\"string\">&#x27;上海&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">district</span>: <span class=\"string\">&#x27;宝山区&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">address</span>: <span class=\"string\">&#x27;同济支路199号智慧七立方3号楼2-4层&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">latitude</span>: <span class=\"number\">43.0</span>,</span><br><span class=\"line\">  <span class=\"attr\">longitude</span>: <span class=\"number\">160.0</span>,</span><br><span class=\"line\">  <span class=\"attr\">message</span>: <span class=\"string\">&#x27;求购一条小鱼&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">contact</span>: <span class=\"string\">&#x27;13666666&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"string\">&#x27;sell&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">time</span>: <span class=\"number\">1571217561</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> options = &#123;</span><br><span class=\"line\">  <span class=\"attr\">protocol</span>: <span class=\"string\">&#x27;https:&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">hostname</span>: <span class=\"string\">&#x27;ik9hkddr.qcloud.la&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">method</span>: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">port</span>: <span class=\"number\">443</span>,</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/index.php/trade/add_item&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">headers</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Content-Length&#x27;</span>: <span class=\"title class_\">Buffer</span>.<span class=\"title function_\">byteLength</span>(postData)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">doPost</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> data</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> req = https.<span class=\"title function_\">request</span>(options, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\"><span class=\"params\">chunk</span> =&gt;</span> data += chunk)</span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">write</span>(postData)</span><br><span class=\"line\">  req.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// setInterval(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   doPost()</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;, 1000)</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>04.5 爬虫</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> https = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;https&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;http&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cheerio&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">http.<span class=\"title function_\">createServer</span>(<span class=\"function\">(<span class=\"params\">request, response</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  response.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;content-type&#x27;</span>: <span class=\"string\">&#x27;application/json;charset=utf-8&#x27;</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// protocol: &#x27;https:&#x27;,</span></span><br><span class=\"line\">    <span class=\"attr\">hostname</span>: <span class=\"string\">&#x27;i.maoyan.com&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">port</span>: <span class=\"number\">443</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> req = https.<span class=\"title function_\">request</span>(options, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      data += chunk</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">filterData</span>(data)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">filterData</span>(<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//   console.log(data)</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> $ = cheerio.<span class=\"title function_\">load</span>(data)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> $movieList = $(<span class=\"string\">&#x27;.column.content&#x27;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>($movieList)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> movies = []</span><br><span class=\"line\">    $movieList.<span class=\"title function_\">each</span>(<span class=\"function\">(<span class=\"params\">index, value</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      movies.<span class=\"title function_\">push</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: $(value).<span class=\"title function_\">find</span>(<span class=\"string\">&#x27;.movie-title .title&#x27;</span>).<span class=\"title function_\">text</span>(),</span><br><span class=\"line\">        <span class=\"attr\">detail</span>: $(value).<span class=\"title function_\">find</span>(<span class=\"string\">&#x27;.detail .actor&#x27;</span>).<span class=\"title function_\">text</span>(),</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    response.<span class=\"title function_\">end</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(movies))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  req.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;).<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"05-event模块\"><a href=\"#05-event模块\" class=\"headerlink\" title=\"05  event模块\"></a>05  event模块</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">EventEmitter</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;events&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyEventEmitter</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">EventEmitter</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> event = <span class=\"keyword\">new</span> <span class=\"title class_\">MyEventEmitter</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">event.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;play&#x27;</span>, <span class=\"function\">(<span class=\"params\">movie</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(movie)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">event.<span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;play&#x27;</span>, <span class=\"string\">&#x27;我和我的祖国&#x27;</span>)</span><br><span class=\"line\">event.<span class=\"title function_\">emit</span>(<span class=\"string\">&#x27;play&#x27;</span>, <span class=\"string\">&#x27;中国机长&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"06-fs文件操作模块\"><a href=\"#06-fs文件操作模块\" class=\"headerlink\" title=\"06  fs文件操作模块\"></a>06  fs文件操作模块</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 创建文件夹</span></span><br><span class=\"line\">fs.<span class=\"title function_\">mkdir</span>(<span class=\"string\">&#x27;./logs&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 文件夹改名</span></span><br><span class=\"line\">fs.<span class=\"title function_\">rename</span>(<span class=\"string\">&#x27;./logs&#x27;</span>, <span class=\"string\">&#x27;./log&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除文件夹</span></span><br><span class=\"line\">fs.<span class=\"title function_\">rmdir</span>(<span class=\"string\">&#x27;./log&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 写内容到文件里</span></span><br><span class=\"line\">fs.<span class=\"title function_\">writeFile</span>(</span><br><span class=\"line\">  <span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;hello&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 错误优先的回调函数</span></span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(err.<span class=\"property\">message</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;文件创建成功&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 给文件追加内容</span></span><br><span class=\"line\">fs.<span class=\"title function_\">appendFile</span>(<span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>, <span class=\"string\">&#x27;\\nworld&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读取文件内容</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除文件</span></span><br><span class=\"line\">fs.<span class=\"title function_\">unlink</span>(<span class=\"string\">&#x27;./logs/log1.txt&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 批量写文件</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">  fs.<span class=\"title function_\">writeFile</span>(<span class=\"string\">`./logs/log-<span class=\"subst\">$&#123;i&#125;</span>.txt`</span>, <span class=\"string\">`log-<span class=\"subst\">$&#123;i&#125;</span>`</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;done.&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读取文件/目录信息</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readdir</span>(<span class=\"string\">&#x27;./&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  data.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">value, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    fs.<span class=\"title function_\">stat</span>(<span class=\"string\">`./<span class=\"subst\">$&#123;value&#125;</span>`</span>, <span class=\"function\">(<span class=\"params\">err, stats</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// console.log(value + &#x27;:&#x27; + stats.size)</span></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(value + <span class=\"string\">&#x27; is &#x27;</span> + (stats.<span class=\"title function_\">isDirectory</span>() ? <span class=\"string\">&#x27;directory&#x27;</span> : <span class=\"string\">&#x27;file&#x27;</span>))</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 同步读取文件</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> content = fs.<span class=\"title function_\">readFileSync</span>(<span class=\"string\">&#x27;./logs/log-1.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(content)</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(e.<span class=\"property\">message</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步读取文件：方法一</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./logs/log-0.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"function\">(<span class=\"params\">err, content</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(content)</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 异步读取文件：方法二</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>).<span class=\"property\">promises</span></span><br><span class=\"line\">fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./logs/log-0.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">result</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(result)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>在<code>fs</code>模块中，提供同步方法是为了方便使用。那我们到底是应该用异步方法还是同步方法呢？</p>\n<p>由于Node环境执行的JavaScript代码是服务器端代码，所以，绝大部分需要在服务器运行期反复执行业务逻辑的代码，<em>必须使用异步代码</em>，否则，同步代码在执行时期，服务器将停止响应，因为JavaScript只有一个执行线程。</p>\n<p>服务器启动时如果需要读取配置文件，或者结束时需要写入到状态文件时，可以使用同步代码，因为这些代码只在启动和结束时执行一次，不影响服务器正常运行时的异步执行。</p>\n<h6 id=\"07-stream流模块\"><a href=\"#07-stream流模块\" class=\"headerlink\" title=\"07  stream流模块\"></a>07  stream流模块</h6><p><code>stream</code>是Node.js提供的又一个仅在服务区端可用的模块，目的是支持“流”这种数据结构。</p>\n<p>什么是流？流是一种抽象的数据结构。想象水流，当在水管中流动时，就可以从某个地方（例如自来水厂）源源不断地到达另一个地方（比如你家的洗手池）。我们也可以把数据看成是数据流，比如你敲键盘的时候，就可以把每个字符依次连起来，看成字符流。这个流是从键盘输入到应用程序，实际上它还对应着一个名字：标准输入流（stdin）。</p>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220407085931744.png\" alt=\"image-20220407085931744\"></p>\n<p>如果应用程序把字符一个一个输出到显示器上，这也可以看成是一个流，这个流也有名字：标准输出流（stdout）。流的特点是数据是有序的，而且必须依次读取，或者依次写入，不能像Array那样随机定位。</p>\n<p>有些流用来读取数据，比如从文件读取数据时，可以打开一个文件流，然后从文件流中不断地读取数据。有些流用来写入数据，比如向文件写入数据时，只需要把数据不断地往文件流中写进去就可以了。</p>\n<p>在Node.js中，流也是一个对象，我们只需要响应流的事件就可以了：<code>data</code>事件表示流的数据已经可以读取了，<code>end</code>事件表示这个流已经到末尾了，没有数据可以读取了，<code>error</code>事件表示出错了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打开一个流:</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> rs = fs.<span class=\"title function_\">createReadStream</span>(<span class=\"string\">&#x27;sample.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">rs.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;DATA:&#x27;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(chunk);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">rs.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;END&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">rs.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">err</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ERROR: &#x27;</span> + err);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>要注意，<code>data</code>事件可能会有多次，每次传递的<code>chunk</code>是流的一部分数据。</p>\n<p>要以流的形式写入文件，只需要不断调用<code>write()</code>方法，最后以<code>end()</code>结束：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> ws1 = fs.<span class=\"title function_\">createWriteStream</span>(<span class=\"string\">&#x27;output1.txt&#x27;</span>, <span class=\"string\">&#x27;utf-8&#x27;</span>);</span><br><span class=\"line\">ws1.<span class=\"title function_\">write</span>(<span class=\"string\">&#x27;使用Stream写入文本数据...\\n&#x27;</span>);</span><br><span class=\"line\">ws1.<span class=\"title function_\">write</span>(<span class=\"string\">&#x27;END.&#x27;</span>);</span><br><span class=\"line\">ws1.<span class=\"title function_\">end</span>();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>pipe</code> 就像可以把两个水管串成一个更长的水管一样，两个流也可以串起来。一个<code>Readable</code>流和一个<code>Writable</code>流串起来后，所有的数据自动从<code>Readable</code>流进入<code>Writable</code>流，这种操作叫<code>pipe</code>。</p>\n<p>在Node.js中，<code>Readable</code>流有一个<code>pipe()</code>方法，就是用来干这件事的。</p>\n<p>让我们用<code>pipe()</code>把一个文件流和另一个文件流串起来，这样源文件的所有数据就自动写入到目标文件里了，所以，这实际上是一个复制文件的程序：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> readstream = fs.<span class=\"title function_\">createReadStream</span>(<span class=\"string\">&#x27;./1.txt&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> writestream = fs.<span class=\"title function_\">createWriteStream</span>(<span class=\"string\">&#x27;./2.txt&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">readstream.<span class=\"title function_\">pipe</span>(writestream)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"08-zlib\"><a href=\"#08-zlib\" class=\"headerlink\" title=\"08 zlib\"></a>08 zlib</h6><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220407105916114.png\" alt=\"image-20220407105916114\" style=\"zoom:50%;\" />\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> zlib = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;zlib&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> gzip = zlib.<span class=\"title function_\">createGzip</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> readstream = fs.<span class=\"title function_\">createReadStream</span>(<span class=\"string\">&#x27;./note.txt&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> writestream = fs.<span class=\"title function_\">createWriteStream</span>(<span class=\"string\">&#x27;./note2.txt&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">readstream</span><br><span class=\"line\">  .<span class=\"title function_\">pipe</span>(gzip)</span><br><span class=\"line\">  .<span class=\"title function_\">pipe</span>(writestream)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"09-crypto\"><a href=\"#09-crypto\" class=\"headerlink\" title=\"09 crypto\"></a>09 crypto</h6><p>crypto模块的目的是为了提供通用的加密和哈希算法。用纯JavaScript代码实现这些功能不是不可能，但速度会非常慢。Nodejs用C/C++实现这些算法后，通过cypto这个模块暴露为JavaScript接口，这样用起来方便，运行速度也快。</p>\n<p>MD5是一种常用的哈希算法，用于给任意数据一个“签名”。这个签名通常用一个十六进制的字符串表示：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;crypto&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hash = crypto.<span class=\"title function_\">createHash</span>(<span class=\"string\">&#x27;md5&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 可任意多次调用update():</span></span><br><span class=\"line\">hash.<span class=\"title function_\">update</span>(<span class=\"string\">&#x27;Hello, world!&#x27;</span>);</span><br><span class=\"line\">hash.<span class=\"title function_\">update</span>(<span class=\"string\">&#x27;Hello, nodejs!&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(hash.<span class=\"title function_\">digest</span>(<span class=\"string\">&#x27;hex&#x27;</span>)); </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>update()</code>方法默认字符串编码为<code>UTF-8</code>，也可以传入Buffer。</p>\n<p>如果要计算SHA1，只需要把<code>&#39;md5&#39;</code>改成<code>&#39;sha1&#39;</code>，就可以得到SHA1的结果<code>1f32b9c9932c02227819a4151feed43e131aca40</code>。</p>\n<p>Hmac算法也是一种哈希算法，它可以利用MD5或SHA1等哈希算法。不同的是，Hmac还需要一个密钥：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const crypto = require(&#x27;crypto&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">const hmac = crypto.createHmac(&#x27;sha256&#x27;, &#x27;secret-key&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">hmac.update(&#x27;Hello, world!&#x27;);</span><br><span class=\"line\">hmac.update(&#x27;Hello, nodejs!&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(hmac.digest(&#x27;hex&#x27;)); // 80f7e22570...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>只要密钥发生了变化，那么同样的输入数据也会得到不同的签名，因此，可以把Hmac理解为用随机数“增强”的哈希算法。</p>\n<p>AES是一种常用的对称加密算法，加解密都用同一个密钥。crypto模块提供了AES支持，但是需要自己封装好函数，便于使用：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;crypto&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">encrypt</span> (key, iv, data) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> decipher = crypto.<span class=\"title function_\">createCipheriv</span>(<span class=\"string\">&#x27;aes-128-cbc&#x27;</span>, key, iv);</span><br><span class=\"line\">    <span class=\"comment\">// decipher.setAutoPadding(true);</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> decipher.<span class=\"title function_\">update</span>(data, <span class=\"string\">&#x27;binary&#x27;</span>, <span class=\"string\">&#x27;hex&#x27;</span>) + decipher.<span class=\"title function_\">final</span>(<span class=\"string\">&#x27;hex&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">decrypt</span> (key, iv, crypted) &#123;</span><br><span class=\"line\">     crypted = <span class=\"title class_\">Buffer</span>.<span class=\"title function_\">from</span>(crypted, <span class=\"string\">&#x27;hex&#x27;</span>).<span class=\"title function_\">toString</span>(<span class=\"string\">&#x27;binary&#x27;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">let</span> decipher = crypto.<span class=\"title function_\">createDecipheriv</span>(<span class=\"string\">&#x27;aes-128-cbc&#x27;</span>, key, iv);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> decipher.<span class=\"title function_\">update</span>(crypted, <span class=\"string\">&#x27;binary&#x27;</span>, <span class=\"string\">&#x27;utf8&#x27;</span>) + decipher.<span class=\"title function_\">final</span>(<span class=\"string\">&#x27;utf8&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">key,iv必须是<span class=\"number\">16</span>个字节</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>可以看出，加密后的字符串通过解密又得到了原始内容。</p>\n<h5 id=\"6-路由\"><a href=\"#6-路由\" class=\"headerlink\" title=\"6.   路由\"></a>6.   路由</h5><h6 id=\"01-基础\"><a href=\"#01-基础\" class=\"headerlink\" title=\"01   基础\"></a>01   基础</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * @作者: kerwin</span></span><br><span class=\"line\"><span class=\"comment\"> * @公众号: 大前端私房菜</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;path&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">render</span>(<span class=\"params\">res, path</span>) &#123;</span><br><span class=\"line\">    res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/html;charset=utf8&quot;</span> &#125;)</span><br><span class=\"line\">    res.<span class=\"title function_\">write</span>(fs.<span class=\"title function_\">readFileSync</span>(path, <span class=\"string\">&quot;utf8&quot;</span>))</span><br><span class=\"line\">    res.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> route = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;/login&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(res, <span class=\"string\">&quot;./static/login.html&quot;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&quot;/home&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">render</span>(res, <span class=\"string\">&quot;./static/home.html&quot;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">&quot;/404&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">404</span>, &#123; <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/html;charset=utf8&quot;</span> &#125;)</span><br><span class=\"line\">        res.<span class=\"title function_\">write</span>(fs.<span class=\"title function_\">readFileSync</span>(<span class=\"string\">&quot;./static/404.html&quot;</span>, <span class=\"string\">&quot;utf8&quot;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"02-获取参数\"><a href=\"#02-获取参数\" class=\"headerlink\" title=\"02   获取参数\"></a>02   获取参数</h6><p>get请求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;/api/login&quot;</span>:<span class=\"function\">(<span class=\"params\">req,res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> myURL = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(req.<span class=\"property\">url</span>, <span class=\"string\">&#x27;http://127.0.0.1:3000&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(myURL.<span class=\"property\">searchParams</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;username&quot;</span>))   </span><br><span class=\"line\">    <span class=\"title function_\">render</span>(res,<span class=\"string\">`&#123;ok:1&#125;`</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>post请求</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;/api/login&quot;</span>: <span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> post = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中</span></span><br><span class=\"line\">        req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;data&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) &#123;</span><br><span class=\"line\">            post += chunk;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。</span></span><br><span class=\"line\">        req.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            post = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(post);</span><br><span class=\"line\">            <span class=\"title function_\">render</span>(res, <span class=\"string\">`&#123;ok:1&#125;`</span>)</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"03-静态资源处理\"><a href=\"#03-静态资源处理\" class=\"headerlink\" title=\"03   静态资源处理\"></a>03   静态资源处理</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">readStaticFile</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> myURL = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(req.<span class=\"property\">url</span>, <span class=\"string\">&#x27;http://127.0.0.1:3000&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> filePathname = path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&quot;/static&quot;</span>, myURL.<span class=\"property\">pathname</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fs.<span class=\"title function_\">existsSync</span>(filePathname)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// console.log(1111)</span></span><br><span class=\"line\">        res.<span class=\"title function_\">writeHead</span>(<span class=\"number\">200</span>, &#123; <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">`<span class=\"subst\">$&#123;mime.getType(myURL.pathname.split(<span class=\"string\">&quot;.&quot;</span>)[<span class=\"number\">1</span>])&#125;</span>;charset=utf8`</span> &#125;)</span><br><span class=\"line\">        res.<span class=\"title function_\">write</span>(fs.<span class=\"title function_\">readFileSync</span>(filePathname, <span class=\"string\">&quot;utf8&quot;</span>))</span><br><span class=\"line\">        res.<span class=\"title function_\">end</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、Express\"><a href=\"#二、Express\" class=\"headerlink\" title=\"二、Express\"></a>二、Express</h4><blockquote>\n<p><a href=\"https://www.expressjs.com.cn/\">https://www.expressjs.com.cn/</a></p>\n</blockquote>\n<p>基于 Node.js 平台，快速、开放、极简的 web 开发框架。</p>\n<h5 id=\"1-特色\"><a href=\"#1-特色\" class=\"headerlink\" title=\"1.特色\"></a>1.特色</h5><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220411103139587.png\" alt=\"image-20220411103139587\" style=\"zoom: 50%;float:left;\" />\n\n<h5 id=\"2-安装\"><a href=\"#2-安装\" class=\"headerlink\" title=\"2.安装\"></a>2.安装</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install express --save</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-路由\"><a href=\"#3-路由\" class=\"headerlink\" title=\"3.路由\"></a>3.路由</h5><p>路由是指如何定义应用的端点（URIs）以及如何响应客户端的请求。</p>\n<p>路由是由一个 URI、HTTP 请求（GET、POST等）和若干个句柄组成，它的结构如下： app.METHOD(path, [callback…], callback)， app 是 express 对象的一个实例， METHOD 是一个 HTTP 请求方法， path 是服务器上的路径， callback 是当路由匹配时要执行的函数。</p>\n<p>下面是一个基本的路由示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// respond with &quot;hello world&quot; when a GET request is made to the homepage</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;hello world&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>路由路径和请求方法一起定义了请求的端点，它可以是字符串、字符串模式或者正则表达式。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配根路径的请求</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;root&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /about 路径的请求</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/about&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;about&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /random.text 路径的请求</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/random.text&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;random.text&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用字符串模式的路由路径示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配 acd 和 abcd</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab?cd&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab?cd&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /ab/******</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab/:id&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;aaaaaaa&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abbcd、abbbcd等</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab+cd&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab+cd&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab*cd&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab*cd&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 /abe 和 /abcde</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/ab(cd)?e&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\"> res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;ab(cd)?e&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用正则表达式的路由路径示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 匹配任何路径中含有 a 的路径：</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"regexp\">/a/</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;/a/&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"regexp\">/.*fly$/</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;/.*fly$/&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>可以为请求处理提供多个回调函数，其行为类似 中间件。唯一的区别是这些回调函数有可能调用 next(‘route’) 方法而略过其他路由回调函数。可以利用该机制为路由定义前提条件，如果在现有路径上继续执行没有意义，则可将控制权交给剩下的路径。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/a&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from A!&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>使用多个回调函数处理路由（记得指定 next 对象）：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/b&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;response will be sent by the next function ...&#x27;</span>);</span><br><span class=\"line\">  <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from B!&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>使用回调函数数组处理路由：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cb0 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB0&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cb1 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB1&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cb2 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from C!&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/c&#x27;</span>, [cb0, cb1, cb2])</span><br></pre></td></tr></table></figure>\n\n<p>混合使用函数和函数数组处理路由：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cb0 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB0&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> cb1 = <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;CB1&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/example/d&#x27;</span>, [cb0, cb1], <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;response will be sent by the next function ...&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">  res.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Hello from D!&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-中间件\"><a href=\"#4-中间件\" class=\"headerlink\" title=\"4.中间件\"></a>4.中间件</h5><p>Express 是一个自身功能极简，完全是由路由和中间件构成一个的 web 开发框架：从本质上来说，一个 Express 应用就是在调用各种中间件。</p>\n<p>中间件（Middleware） 是一个函数，它可以访问请求对象（request object (req)）, 响应对象（response object (res)）, 和 web 应用中处于请求-响应循环流程中的中间件，一般被命名为 next 的变量。</p>\n<p>中间件的功能包括：</p>\n<ul>\n<li>执行任何代码。</li>\n<li>修改请求和响应对象。</li>\n<li>终结请求-响应循环。</li>\n<li>调用堆栈中的下一个中间件。</li>\n</ul>\n<p>如果当前中间件没有终结请求-响应循环，则必须调用 next() 方法将控制权交给下一个中间件，否则请求就会挂起。</p>\n<p>Express 应用可使用如下几种中间件：</p>\n<ul>\n<li>应用级中间件</li>\n<li>路由级中间件</li>\n<li>错误处理中间件</li>\n<li>内置中间件</li>\n<li>第三方中间件</li>\n</ul>\n<p>使用可选则挂载路径，可在应用级别或路由级别装载中间件。另外，你还可以同时装在一系列中间件函数，从而在一个挂载点上创建一个子中间件栈。</p>\n<h6 id=\"（1）应用级中间件\"><a href=\"#（1）应用级中间件\" class=\"headerlink\" title=\"（1）应用级中间件\"></a>（1）应用级中间件</h6><p>应用级中间件绑定到 app 对象 使用 app.use() 和 app.METHOD()， 其中， METHOD 是需要处理的 HTTP 请求的方法，例如 GET, PUT, POST 等等，全部小写。例如：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 没有挂载路径的中间件，应用的每个请求都会执行该中间件</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Time:&#x27;</span>, <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>())</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（2）路由级中间件\"><a href=\"#（2）路由级中间件\" class=\"headerlink\" title=\"（2）路由级中间件\"></a>（2）路由级中间件</h6><p>路由级中间件和应用级中间件一样，只是它绑定的对象为 express.Router()。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> router = express.<span class=\"title class_\">Router</span>()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = express.<span class=\"title class_\">Router</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 没有挂载路径的中间件，通过该路由的每个请求都会执行该中间件</span></span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Time:&#x27;</span>, <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>())</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一个中间件栈，显示任何指向 /user/:id 的 HTTP 请求的信息</span></span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/user/:id&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Request URL:&#x27;</span>, req.<span class=\"property\">originalUrl</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;Request Type:&#x27;</span>, req.<span class=\"property\">method</span>)</span><br><span class=\"line\">  <span class=\"title function_\">next</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一个中间件栈，处理指向 /user/:id 的 GET 请求</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/user/:id&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 如果 user id 为 0, 跳到下一个路由</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.<span class=\"property\">params</span>.<span class=\"property\">id</span> == <span class=\"number\">0</span>) <span class=\"title function_\">next</span>(<span class=\"string\">&#x27;route&#x27;</span>)</span><br><span class=\"line\">  <span class=\"comment\">// 负责将控制权交给栈中下一个中间件</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"title function_\">next</span>() <span class=\"comment\">//</span></span><br><span class=\"line\">&#125;, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 渲染常规页面</span></span><br><span class=\"line\">  res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;regular&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 处理 /user/:id， 渲染一个特殊页面</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/user/:id&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">params</span>.<span class=\"property\">id</span>)</span><br><span class=\"line\">  res.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;special&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将路由挂载至应用</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/&#x27;</span>, router)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（3）错误处理中间件\"><a href=\"#（3）错误处理中间件\" class=\"headerlink\" title=\"（3）错误处理中间件\"></a>（3）错误处理中间件</h6><p>错误处理中间件和其他中间件定义类似，只是要使用 4 个参数，而不是 3 个，其签名如下： (err, req, res, next)。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span>(<span class=\"params\">err, req, res, next</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(err.<span class=\"property\">stack</span>)</span><br><span class=\"line\">  res.<span class=\"title function_\">status</span>(<span class=\"number\">500</span>).<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Something broke!&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（4）内置的中间件\"><a href=\"#（4）内置的中间件\" class=\"headerlink\" title=\"（4）内置的中间件\"></a>（4）内置的中间件</h6><p>express.static 是 Express 唯一内置的中间件。它基于 serve-static，负责在 Express 应用中提托管静态资源。每个应用可有多个静态目录。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;public&#x27;</span>))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;uploads&#x27;</span>))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;files&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（5）第三方中间件\"><a href=\"#（5）第三方中间件\" class=\"headerlink\" title=\"（5）第三方中间件\"></a>（5）第三方中间件</h6><p>安装所需功能的 node 模块，并在应用中加载，可以在应用级加载，也可以在路由级加载。</p>\n<p>下面的例子安装并加载了一个解析 cookie 的中间件： cookie-parser</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install cookie-parser</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;cookie-parser&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载用于解析 cookie 的中间件</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">cookieParser</span>())</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"5-获取请求参数\"><a href=\"#5-获取请求参数\" class=\"headerlink\" title=\"5. 获取请求参数\"></a>5. 获取请求参数</h5><p>get</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">req.<span class=\"property\">query</span></span><br></pre></td></tr></table></figure>\n\n<p>post</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">urlencoded</span>(&#123;<span class=\"attr\">extended</span>:<span class=\"literal\">false</span>&#125;))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">json</span>())</span><br><span class=\"line\">req.<span class=\"property\">body</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"6-利用-Express-托管静态文件\"><a href=\"#6-利用-Express-托管静态文件\" class=\"headerlink\" title=\"6.利用 Express 托管静态文件\"></a>6.利用 Express 托管静态文件</h5><p>通过 Express 内置的 express.static 可以方便地托管静态文件，例如图片、CSS、JavaScript 文件等。</p>\n<p>将静态资源文件所在的目录作为参数传递给 express.static 中间件就可以提供静态资源文件的访问了。例如，假设在 public 目录放置了图片、CSS 和 JavaScript 文件，你就可以：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>现在，public 目录下面的文件就可以访问了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/images/kitten.jpg</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/css/style.css</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/js/app.js</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/images/bg.png</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/hello.html</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>所有文件的路径都是相对于存放目录的，因此，存放静态文件的目录名不会出现在 URL 中。</p>\n</blockquote>\n<p>如果你的静态资源存放在多个目录下面，你可以多次调用 express.static 中间件：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;public&#x27;</span>))</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">static</span>(<span class=\"string\">&#x27;files&#x27;</span>))</span><br></pre></td></tr></table></figure>\n\n<p>访问静态资源文件时，express.static 中间件会根据目录添加的顺序查找所需的文件。</p>\n<p>如果你希望所有通过 express.static 访问的文件都存放在一个“虚拟（virtual）”目录（即目录根本不存在）下面，可以通过为静态资源目录指定一个挂载路径的方式来实现，如下所示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(&#x27;/static&#x27;, express.static(&#x27;public&#x27;))</span><br></pre></td></tr></table></figure>\n\n<p>现在，你就可以通过带有 “/static” 前缀的地址来访问 public 目录下面的文件了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/images/kitten.jpg</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/css/style.css</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/js/app.js</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/images/bg.png</span></span><br><span class=\"line\"><span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000/static/hello.html</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"7-服务端渲染（模板引擎）\"><a href=\"#7-服务端渲染（模板引擎）\" class=\"headerlink\" title=\"7.服务端渲染（模板引擎）\"></a>7.服务端渲染（模板引擎）</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i ejs</span><br></pre></td></tr></table></figure>\n\n<p>需要在应用中进行如下设置才能让 Express 渲染模板文件：</p>\n<ul>\n<li>views, 放模板文件的目录，比如： app.set(‘views’, ‘./views’)</li>\n<li>view engine, 模板引擎，比如： app.set(‘view engine’, ‘ejs’)</li>\n</ul>\n<p><b>ejs模板用法</b></p>\n<ul>\n<li>&lt;%  %&gt; 流程控制标签（写的是if else ，for）</li>\n<li>&lt;%= %&gt; 输出标签（原文输出HTML标签）</li>\n<li>&lt;%- %&gt; 输出标签（HTML会被浏览器解析）</li>\n<li>&lt;%# %&gt; 注释标签</li>\n<li>&lt;%- include(‘user/show’,{user:user}) %&gt; 导入公共的模板内容</li>\n</ul>\n<h5 id=\"8-express项目生成器\"><a href=\"#8-express项目生成器\" class=\"headerlink\" title=\"8.express项目生成器\"></a>8.express项目生成器</h5><ul>\n<li>下载依赖项目：<code>$ npm i express-generator -g </code></li>\n<li>创建项目：<code>$ express [项目名] --view=[视图类型] </code></li>\n<li>下载依赖：<code>$ npm i </code></li>\n<li>内部代码解读： <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.bin/www :该文件为启动目录</span><br><span class=\"line\">2.app.js文件解读：</span><br><span class=\"line\">      var createError = require(&#x27;http-errors&#x27;);//错误信息提示</span><br><span class=\"line\">      var cookieParser = require(&#x27;cookie-parser&#x27;);//后端获取设置cookie值</span><br><span class=\"line\">      var logger = require(&#x27;morgan&#x27;); //后端终端显示端口等日志</span><br></pre></td></tr></table></figure>\n<h4 id=\"三、MongoDB\"><a href=\"#三、MongoDB\" class=\"headerlink\" title=\"三、MongoDB\"></a>三、MongoDB</h4></li>\n</ul>\n<h5 id=\"1-MongoDB数据库\"><a href=\"#1-MongoDB数据库\" class=\"headerlink\" title=\"1.MongoDB数据库\"></a>1.MongoDB数据库</h5><p>简单介绍一下MongoDB：<br>传统的关系数据库（如mysql）一般由数据库（database）、表（table）、记录（record）三个层次概念组成，<br>MongoDB是由数据库（database）、集合（collection）、文档对象（document）三个层次组成。<br>MongoDB稳定<br>MongoDB支持索引，索引放在内存中，能够提升随机读写的性能。如果索引不能完全放在内存，一旦出现随机读写比较高的时候，就会频繁地进行磁盘交换，MongoDB的性能就会急剧下降<br>MongoDB占用的空间很大，因为它属于典型空间换时间原则的类型。那么它的磁盘空间比普通数据库会浪费一些</p>\n<h5 id=\"2-安装数据库\"><a href=\"#2-安装数据库\" class=\"headerlink\" title=\"2.安装数据库\"></a>2.安装数据库</h5><p><a href=\"https://docs.mongodb.com/manual/administration/install-community/\">https://docs.mongodb.com/manual/administration/install-community/</a></p>\n<h5 id=\"3-启动数据库\"><a href=\"#3-启动数据库\" class=\"headerlink\" title=\"3.启动数据库\"></a>3.启动数据库</h5><h6 id=\"（1）windows\"><a href=\"#（1）windows\" class=\"headerlink\" title=\"（1）windows\"></a>（1）windows</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod --dbpath d:/data/db</span><br><span class=\"line\">mongo</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"（2）mac\"><a href=\"#（2）mac\" class=\"headerlink\" title=\"（2）mac\"></a>（2）mac</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongod --config /usr/local/etc/mongod.conf</span><br><span class=\"line\">mongo</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-在命令行中操作数据库\"><a href=\"#4-在命令行中操作数据库\" class=\"headerlink\" title=\"4.在命令行中操作数据库\"></a>4.在命令行中操作数据库</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//常规数据库操作</span><br><span class=\"line\">(1)Help查看命令提示 </span><br><span class=\"line\">\thelp    db.help()  db.test.help()  db.test.find().help()</span><br><span class=\"line\">(2)创建/切换数据库</span><br><span class=\"line\">\tuse music </span><br><span class=\"line\">(3)查询数据库</span><br><span class=\"line\">\tshow dbs</span><br><span class=\"line\">(4)查看当前使用的数据库</span><br><span class=\"line\">\tdb/db.getName()</span><br><span class=\"line\">(5)显示当前DB状态</span><br><span class=\"line\">\tdb.stats()</span><br><span class=\"line\">(6)查看当前DB版本</span><br><span class=\"line\">\tdb.version()</span><br><span class=\"line\">(7)查看当前DB的链接机器地址</span><br><span class=\"line\">\tdb.getMongo()</span><br><span class=\"line\">(8)删除数据库</span><br><span class=\"line\">\tdb.dropDatabase()</span><br><span class=\"line\">//常规集合操作</span><br><span class=\"line\">(1)创建一个集合</span><br><span class=\"line\">\tdb.createCollection(&quot;collName&quot;,&#123;size:xx,capped:true,max:xx&#125;)</span><br><span class=\"line\"> // collName:名称 size:集合大小 capped:固定大小 max:最大存储空间</span><br><span class=\"line\">(2)得到指定名称的集合</span><br><span class=\"line\">\tdb.getCollection(&quot;account&quot;)</span><br><span class=\"line\">(3)得到当前所有的集合</span><br><span class=\"line\">\tdb.getCollectionNames()</span><br><span class=\"line\">(4)显示当前db所有集合的状态</span><br><span class=\"line\">\tdb.printCollectionStats()</span><br><span class=\"line\">(5)删除集合</span><br><span class=\"line\">\tdb.users(集合名称).drop() </span><br><span class=\"line\">//集合增删改查(以users集合为例)</span><br><span class=\"line\">(1)添加</span><br><span class=\"line\">\tdb.users.save([&#123;name:&#x27;pan&#x27;,age:21&#125;,name:&#x27;zhang&#x27;,age:20])</span><br><span class=\"line\">(2)删除</span><br><span class=\"line\">\tdb.users.remove(&#123;age:20&#125;) //删除一条带有age:20的数据</span><br><span class=\"line\">\tdb.users.remove(&#123;&#125;) //删除所有数据</span><br><span class=\"line\">(3)修改</span><br><span class=\"line\">\tdb.users.update(&#123;name:&#x27;pan&#x27;&#125;,&#123;age:29&#125;)</span><br><span class=\"line\"> \t//找到一条是name:pan的数据将这一条数据替换成age:29</span><br><span class=\"line\">\tdb.users.update(&#123;name:&#x27;pan&#x27;&#125;,&#123;$set:&#123;age:29&#125;&#125;)</span><br><span class=\"line\"> \t//找到一条是name:pan的数据将这一条数据中age替换成29</span><br><span class=\"line\"> \tdb.users.update(&#123;name:&#x27;pan&#x27;&#125;,&#123;$inc:&#123;age:29&#125;&#125;)</span><br><span class=\"line\"> \t//找到一条是name:pan的数据将这一条数据中age增加29(数据可为负数)</span><br><span class=\"line\">(4)查询</span><br><span class=\"line\">\t- 查询所有记录</span><br><span class=\"line\">    db.users.find()</span><br><span class=\"line\">   - 查询age=29的数据</span><br><span class=\"line\">    db.users.find(&#123;age:29&#125;)</span><br><span class=\"line\">   - 查询age&gt;29的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$gt:29&#125;)</span><br><span class=\"line\">   - 查询age&gt;=29的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$gte:29&#125;)</span><br><span class=\"line\">   - 查询age&lt;30的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$lt:30&#125;)</span><br><span class=\"line\">   - 查询age&lt;=30的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$lte:30&#125;)</span><br><span class=\"line\">   - 查询29&lt;=age&lt;=30的数据</span><br><span class=\"line\">    db.users.find(age:&#123;$gle:29,$lte:30&#125;)</span><br><span class=\"line\">   - 模糊查询</span><br><span class=\"line\">    db.users.find(name:/pan/) //注：name后面参数为正则</span><br><span class=\"line\">   - 查询指定数据</span><br><span class=\"line\">    db.users.find(&#123;&#125;,&#123;name:1,age:1,_id:0&#125;)</span><br><span class=\"line\">    //第一个参数表示查询条件</span><br><span class=\"line\">    //第二个参数中1表示显示，0表示不显示</span><br><span class=\"line\">   -按照年龄排序</span><br><span class=\"line\">   \t db.users.find(&#123;&#125;).sort(&#123;age:1&#125;)</span><br><span class=\"line\">    // 1表示升序，-1表示降序</span><br><span class=\"line\">   - 查询第n页m条数据</span><br><span class=\"line\">   \t db.users.find(&#123;&#125;).skip((n-1)*m).limit(m)</span><br><span class=\"line\">   - 或者条件查询</span><br><span class=\"line\">    db.users.find(&#123;$or:[&#123;age:12&#125;,&#123;age:20&#125;]&#125;)</span><br><span class=\"line\">    // 查询age:12或者age:20的所有每条数据</span><br><span class=\"line\">   - 查询第一条数据</span><br><span class=\"line\">   db.users.findOne()</span><br><span class=\"line\">   - 查询某个结果记录条数</span><br><span class=\"line\">   db.users.find().count()</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-可视化工具进行增删改查\"><a href=\"#5-可视化工具进行增删改查\" class=\"headerlink\" title=\"5.可视化工具进行增删改查\"></a>5.可视化工具进行增删改查</h5><p>Robomongo Robo3T adminMongo</p>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220413091031852.png\" alt=\"image-20220413091031852\"></p>\n<h5 id=\"6-nodejs连接操作数据库\"><a href=\"#6-nodejs连接操作数据库\" class=\"headerlink\" title=\"6.nodejs连接操作数据库\"></a>6.nodejs连接操作数据库</h5><p>连接数据库</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(<span class=\"string\">&quot;mongodb://127.0.0.1:27017/company-system&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>创建模型</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Schema</span> = mongoose.<span class=\"property\">Schema</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserType</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">username</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">password</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">gender</span>:<span class=\"title class_\">Number</span>,</span><br><span class=\"line\">    <span class=\"attr\">introduction</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">avatar</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">role</span>:<span class=\"title class_\">Number</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserModel</span> = mongoose.<span class=\"title function_\">model</span>(<span class=\"string\">&quot;user&quot;</span>,<span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(<span class=\"title class_\">UserType</span>))</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span>  = <span class=\"title class_\">UserModel</span> </span><br></pre></td></tr></table></figure>\n\n<p>增加数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">    introduction,username,gender,avatar,password,role</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>查询数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">find</span>(&#123;<span class=\"attr\">username</span>:<span class=\"string\">&quot;kerwin&quot;</span>&#125;,[<span class=\"string\">&quot;username&quot;</span>,<span class=\"string\">&quot;role&quot;</span>,<span class=\"string\">&quot;introduction&quot;</span>,<span class=\"string\">&quot;password&quot;</span>]).<span class=\"title function_\">sort</span>(&#123;<span class=\"attr\">createTime</span>:-<span class=\"number\">1</span>&#125;).<span class=\"title function_\">skip</span>(<span class=\"number\">10</span>).<span class=\"title function_\">limit</span>(<span class=\"number\">10</span>)</span><br></pre></td></tr></table></figure>\n\n<p>更新数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">updateOne</span>(&#123;</span><br><span class=\"line\">    _id</span><br><span class=\"line\">&#125;,&#123;</span><br><span class=\"line\">    introduction,username,gender,avatar</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>删除数据</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">UserModel</span>.<span class=\"title function_\">deleteOne</span>(&#123;_id&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、接口规范与业务分层\"><a href=\"#四、接口规范与业务分层\" class=\"headerlink\" title=\"四、接口规范与业务分层\"></a>四、接口规范与业务分层</h4><h5 id=\"1-接口规范\"><a href=\"#1-接口规范\" class=\"headerlink\" title=\"1.接口规范\"></a>1.接口规范</h5><h6 id=\"RESTful架构\"><a href=\"#RESTful架构\" class=\"headerlink\" title=\"RESTful架构\"></a>RESTful架构</h6><blockquote>\n<p>服务器上每一种资源，比如一个文件，一张图片，一部电影，都有对应的地址，如果我们的客户端需要对服务器上的这个资源进行操作，就需要通过http西医执行相应的动作来操作它，比如进行获取、更新、删除</p>\n</blockquote>\n<p>简单来说就是<strong>url中只包含名词表示资源，使用http动词表示动作进行操作资源</strong>，举个例子左边错误，右边正确</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /blog/getname --&gt; GET /blog/name 获取所有文章</span><br><span class=\"line\">GET /blog/addname --&gt; POST /blog/name 添加一篇文章</span><br><span class=\"line\">GET /blog/editname --&gt; PUT /blog/name 添加一篇文章</span><br><span class=\"line\">GET /blog/delname?id=1 --&gt; DELETE /blog/name/1 删除一篇文章</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>使用方式</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET http://xxx/api/user    #获取列表</span><br><span class=\"line\">POST http://xxx/api/user   #创建列表</span><br><span class=\"line\">PUT http://xxx/api/user/&#123;id&#125;    #修改用户信息</span><br><span class=\"line\">DELETE http://xxx/api/user/&#123;id&#125;  #删除用户信息</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>过滤信息</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用于补充规范一些通用字段</span><br><span class=\"line\">?limit=10 #指定返回记录的数量</span><br><span class=\"line\">?offset=10 #指定烦货柜记录的开始位置</span><br><span class=\"line\">?page=2&amp;per_page=100 #指定第几页，以及每页的记录数</span><br><span class=\"line\">?sortby=name&amp;order=asc #指定返回结果按照那个属性排序，以及排序顺序</span><br><span class=\"line\">?state=close #指定筛选条件</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-业务分层\"><a href=\"#2-业务分层\" class=\"headerlink\" title=\"2.业务分层\"></a>2.业务分层</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.js:负责请求分发给C层</span><br><span class=\"line\">controller.js:C层负责处理业务逻辑（V与M之间的沟通）</span><br><span class=\"line\">views:V层:负责展示页面</span><br><span class=\"line\">model:M层:负责处理数据（增删改查）</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"五、登录鉴权\"><a href=\"#五、登录鉴权\" class=\"headerlink\" title=\"五、登录鉴权\"></a>五、登录鉴权</h4><h5 id=\"1-Cookie-amp-Session\"><a href=\"#1-Cookie-amp-Session\" class=\"headerlink\" title=\"1. Cookie&amp;Session\"></a>1. Cookie&amp;Session</h5><p>「HTTP 无状态」<strong>我们知道，HTTP 是无状态的。也就是说，HTTP 请求方和响应方间无法维护状态，都是一次性的，它不知道前后的请求都发生了什么。但有的场景下，我们需要维护状态。最典型的，一个用户登陆微博，发布、关注、评论，都应是在登录后的用户状态下的。</strong>「标记」那解决办法是什么呢？!</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express-session&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">MongoStore</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;connect-mongo&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">express</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(</span><br><span class=\"line\">  <span class=\"title function_\">session</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">secret</span>: <span class=\"string\">&quot;this is session&quot;</span>, <span class=\"comment\">// 服务器生成 session 的签名</span></span><br><span class=\"line\">    <span class=\"attr\">resave</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">    <span class=\"attr\">saveUninitialized</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//强制将为初始化的 session 存储</span></span><br><span class=\"line\">    <span class=\"attr\">cookie</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">maxAge</span>: <span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">10</span>,<span class=\"comment\">// 过期时间</span></span><br><span class=\"line\">      <span class=\"attr\">secure</span>: <span class=\"literal\">false</span>, <span class=\"comment\">// 为 true 时候表示只有 https 协议才能访问cookie</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">rolling</span>: <span class=\"literal\">true</span>, <span class=\"comment\">//为 true 表示 超时前刷新，cookie 会重新计时； 为 false 表示在超时前刷新多少次，都是按照第一次刷新开始计时。</span></span><br><span class=\"line\">    <span class=\"attr\">store</span>: <span class=\"title class_\">MongoStore</span>.<span class=\"title function_\">create</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">mongoUrl</span>: <span class=\"string\">&#x27;mongodb://127.0.0.1:27017/kerwin_session&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">ttl</span>: <span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">10</span> <span class=\"comment\">// 过期时间</span></span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">req,res,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.<span class=\"property\">url</span>===<span class=\"string\">&quot;/login&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.<span class=\"property\">session</span>.<span class=\"property\">user</span>)&#123;</span><br><span class=\"line\">      req.<span class=\"property\">session</span>.<span class=\"property\">garbage</span> = <span class=\"title class_\">Date</span>();</span><br><span class=\"line\">      <span class=\"title function_\">next</span>();</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">   \t  res.<span class=\"title function_\">redirect</span>(<span class=\"string\">&quot;/login&quot;</span>)   </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"2-JSON-Web-Token-JWT\"><a href=\"#2-JSON-Web-Token-JWT\" class=\"headerlink\" title=\"2. JSON Web Token (JWT)\"></a>2. JSON Web Token (JWT)</h5><h6 id=\"（1）介绍\"><a href=\"#（1）介绍\" class=\"headerlink\" title=\"（1）介绍\"></a>（1）介绍</h6><p>我为什么要保存这可恶的session呢， 只让每个客户端去保存该多好？</p>\n<p>当然， 如果一个人的token 被别人偷走了， 那我也没办法， 我也会认为小偷就是合法用户， 这其实和一个人的session id 被别人偷走是一样的。</p>\n<p>这样一来， 我就不保存session id 了， 我只是生成token , 然后验证token ， 我用我的CPU计算时间获取了我的session 存储空间 ！</p>\n<p>解除了session id这个负担， 可以说是无事一身轻， 我的机器集群现在可以轻松地做水平扩展， 用户访问量增大， 直接加机器就行。 这种无状态的感觉实在是太好了！</p>\n<p>缺点：</p>\n<blockquote>\n<ol>\n<li>占带宽，正常情况下要比 session_id 更大，需要消耗更多流量，挤占更多带宽，假如你的网站每月有 10 万次的浏览器，就意味着要多开销几十兆的流量。听起来并不多，但日积月累也是不小一笔开销。实际上，许多人会在 JWT 中存储的信息会更多；</li>\n<li>无法在服务端注销，那么久很难解决劫持问题；</li>\n<li>性能问题，JWT 的卖点之一就是加密签名，由于这个特性，接收方得以验证 JWT 是否有效且被信任。对于有着严格性能要求的 Web 应用，这并不理想，尤其对于单线程环境。</li>\n</ol>\n</blockquote>\n<p>注意：</p>\n<blockquote>\n<p>CSRF攻击的原因是浏览器会自动带上cookie，而不会带上token；</p>\n<p>以CSRF攻击为例：</p>\n<p>cookie：用户点击了链接，cookie未失效，导致发起请求后后端以为是用户正常操作，于是进行扣款操作；<br>token：用户点击链接，由于浏览器不会自动带上token，所以即使发了请求，后端的token验证不会通过，所以不会进行扣款操作；</p>\n</blockquote>\n<h6 id=\"（2）实现\"><a href=\"#（2）实现\" class=\"headerlink\" title=\"（2）实现\"></a>（2）实现</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//jsonwebtoken 封装</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> jsonwebtoken = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;jsonwebtoken&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> secret = <span class=\"string\">&quot;kerwin&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">JWT</span> = &#123;</span><br><span class=\"line\">    <span class=\"title function_\">generate</span>(<span class=\"params\">value,exprires</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jsonwebtoken.<span class=\"title function_\">sign</span>(value,secret,&#123;<span class=\"attr\">expiresIn</span>:exprires&#125;)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">verify</span>(<span class=\"params\">token</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> jsonwebtoken.<span class=\"title function_\">verify</span>(token,secret)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"variable constant_\">JWT</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//node中间件校验</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">req,res,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 如果token有效 ,next() </span></span><br><span class=\"line\">  <span class=\"comment\">// 如果token过期了, 返回401错误</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(req.<span class=\"property\">url</span>===<span class=\"string\">&quot;/login&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> token = req.<span class=\"property\">headers</span>[<span class=\"string\">&quot;authorization&quot;</span>].<span class=\"title function_\">split</span>(<span class=\"string\">&quot; &quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(token)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> payload = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(token)</span><br><span class=\"line\">    <span class=\"comment\">// console.log(payload)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(payload)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newToken = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">generate</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">_id</span>:payload.<span class=\"property\">_id</span>,</span><br><span class=\"line\">        <span class=\"attr\">username</span>:payload.<span class=\"property\">username</span></span><br><span class=\"line\">      &#125;,<span class=\"string\">&quot;1d&quot;</span>)</span><br><span class=\"line\">      res.<span class=\"title function_\">header</span>(<span class=\"string\">&quot;Authorization&quot;</span>,newToken)</span><br><span class=\"line\">      <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      res.<span class=\"title function_\">status</span>(<span class=\"number\">401</span>).<span class=\"title function_\">send</span>(&#123;<span class=\"attr\">errCode</span>:<span class=\"string\">&quot;-1&quot;</span>,<span class=\"attr\">errorInfo</span>:<span class=\"string\">&quot;token过期&quot;</span>&#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//生成token</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> token = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">generate</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">_id</span>: result[<span class=\"number\">0</span>].<span class=\"property\">_id</span>,</span><br><span class=\"line\">    <span class=\"attr\">username</span>: result[<span class=\"number\">0</span>].<span class=\"property\">username</span></span><br><span class=\"line\">&#125;, <span class=\"string\">&quot;1d&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">res.<span class=\"title function_\">header</span>(<span class=\"string\">&quot;Authorization&quot;</span>, token)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//前端拦截</span></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * @作者: kerwin</span></span><br><span class=\"line\"><span class=\"comment\"> * @公众号: 大前端私房菜</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">&#x27;axios&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">// Add a request interceptor</span></span><br><span class=\"line\">axios.<span class=\"property\">interceptors</span>.<span class=\"property\">request</span>.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">config</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&quot;token&quot;</span>)</span><br><span class=\"line\">    config.<span class=\"property\">headers</span>.<span class=\"property\">Authorization</span> = <span class=\"string\">`Bearer <span class=\"subst\">$&#123;token&#125;</span>`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  &#125;, <span class=\"keyword\">function</span> (<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Add a response interceptor</span></span><br><span class=\"line\">axios.<span class=\"property\">interceptors</span>.<span class=\"property\">response</span>.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span> (<span class=\"params\">response</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123;authorization &#125; = response.<span class=\"property\">headers</span></span><br><span class=\"line\">    authorization &amp;&amp; <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&quot;token&quot;</span>,authorization)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">  &#125;, <span class=\"keyword\">function</span> (<span class=\"params\">error</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123;status&#125; = error.<span class=\"property\">response</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(status===<span class=\"number\">401</span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(<span class=\"string\">&quot;token&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">href</span>=<span class=\"string\">&quot;/login&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">reject</span>(error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"六、文件上传管理\"><a href=\"#六、文件上传管理\" class=\"headerlink\" title=\"六、文件上传管理\"></a>六、文件上传管理</h4><p>Multer 是一个 node.js 中间件，用于处理 <code>multipart/form-data</code> 类型的表单数据，它主要用于上传文件。</p>\n<p><strong>注意</strong>: Multer 不会处理任何非 <code>multipart/form-data</code> 类型的表单数据。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save multer</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//前后端分离-前端</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> params = <span class=\"keyword\">new</span> <span class=\"title class_\">FormData</span>()</span><br><span class=\"line\">params.<span class=\"title function_\">append</span>(<span class=\"string\">&#x27;kerwinfile&#x27;</span>, file.<span class=\"property\">file</span>)</span><br><span class=\"line\">params.<span class=\"title function_\">append</span>(<span class=\"string\">&#x27;username&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">username</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = &#123;</span><br><span class=\"line\">\t<span class=\"attr\">headers</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;Content-Type&quot;</span>:<span class=\"string\">&quot;multipart/form-data&quot;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/api/upload&#x27;</span>, params, config).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">this</span>.<span class=\"property\">imgpath</span> = <span class=\"string\">&#x27;http://localhost:3000&#x27;</span> + res.<span class=\"property\">data</span></span><br><span class=\"line\">&#125;)\t</span><br></pre></td></tr></table></figure>\n\n<p>Multer 会添加一个 <code>body</code> 对象 以及 <code>file</code> 或 <code>files</code> 对象 到 express 的 <code>request</code> 对象中。 <code>body</code> 对象包含表单的文本域信息，<code>file</code> 或 <code>files</code> 对象包含对象表单上传的文件信息。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//前后端分离-后端</span></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/upload&#x27;</span>, upload.<span class=\"title function_\">single</span>(<span class=\"string\">&#x27;kerwinfile&#x27;</span>),<span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">file</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"七、APIDOC-API-文档生成工具\"><a href=\"#七、APIDOC-API-文档生成工具\" class=\"headerlink\" title=\"七、APIDOC - API 文档生成工具\"></a>七、APIDOC - API 文档生成工具</h4><p>apidoc 是一个简单的 RESTful API 文档生成工具，它从代码注释中提取特定格式的内容生成文档。支持诸如 Go、Java、C++、Rust 等大部分开发语言，具体可使用 <code>apidoc lang</code> 命令行查看所有的支持列表。</p>\n<p>apidoc 拥有以下特点：</p>\n<ol>\n<li>跨平台，linux、windows、macOS 等都支持；</li>\n<li>支持语言广泛，即使是不支持，也很方便扩展；</li>\n<li>支持多个不同语言的多个项目生成一份文档；</li>\n<li>输出模板可自定义；</li>\n<li>根据文档生成 mock 数据；</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g apidoc</span><br></pre></td></tr></table></figure>\n\n\n<p>注意：</p>\n<p>(1) 在当前文件夹下 apidoc.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;****接口文档&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;关于****的接口文档描述&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;title&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;****&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>（2）可以利用vscode apidoc snippets 插件创建api</p>\n<h4 id=\"八、Koa2\"><a href=\"#八、Koa2\" class=\"headerlink\" title=\"八、Koa2\"></a>八、Koa2</h4><h5 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1.简介\"></a>1.简介</h5><p>koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。使用 koa 编写 web 应用，通过组合不同的 generator，可以免除重复繁琐的回调函数嵌套，并极大地提升错误处理的效率。koa 不在内核方法中绑定任何中间件，它仅仅提供了一个轻量优雅的函数库，使得编写 Web 应用变得得心应手。</p>\n<h5 id=\"2-快速开始\"><a href=\"#2-快速开始\" class=\"headerlink\" title=\"2. 快速开始\"></a>2. 快速开始</h5><h6 id=\"2-1-安装koa2\"><a href=\"#2-1-安装koa2\" class=\"headerlink\" title=\"2.1 安装koa2\"></a>2.1 安装koa2</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 初始化package.json</span><br><span class=\"line\">npm init</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装koa2 </span><br><span class=\"line\">npm install koa</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"2-2-hello-world-代码\"><a href=\"#2-2-hello-world-代码\" class=\"headerlink\" title=\"2.2 hello world 代码\"></a>2.2 hello world 代码</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>( <span class=\"keyword\">async</span> ( ctx ) =&gt; &#123;</span><br><span class=\"line\">  ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;hello koa2&#x27;</span> <span class=\"comment\">//json数据</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.req</span><br><span class=\"line\">Node 的 request对象.</span><br><span class=\"line\">ctx.res</span><br><span class=\"line\">Node的 response对象.</span><br><span class=\"line\">绕过Koa的response 处理是不被支持的.应避免使用以下node 属性:</span><br><span class=\"line\">res.statusCode()</span><br><span class=\"line\">res.WiiteHead()</span><br><span class=\"line\">res.Write()</span><br><span class=\"line\">res.end()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.request</span><br><span class=\"line\">koa的 Request对象.</span><br><span class=\"line\">ctx.response</span><br><span class=\"line\">koa的 Response对象.</span><br><span class=\"line\">以下访问器和Request别名等效:</span><br><span class=\"line\">ctx. header</span><br><span class=\"line\">ctx. headers</span><br><span class=\"line\">ctx.method</span><br><span class=\"line\"> ctx. method=</span><br><span class=\"line\">ctx.url</span><br><span class=\"line\"> ctx.url=</span><br><span class=\"line\">ctx. originalUrl</span><br><span class=\"line\">ctx.origin</span><br><span class=\"line\">ctx. href</span><br><span class=\"line\"> ctx. path</span><br><span class=\"line\">ctx. path=</span><br><span class=\"line\"> ctx. query</span><br><span class=\"line\">ctx. query=</span><br><span class=\"line\">ctx. querystring</span><br><span class=\"line\"> ctx. querystring=</span><br><span class=\"line\">ctx. host</span><br><span class=\"line\">ct.x.hostname</span><br><span class=\"line\">以下访问器和Response 别名等效:</span><br><span class=\"line\">ctx.body</span><br><span class=\"line\">ctx.body=</span><br><span class=\"line\">ctx.status</span><br><span class=\"line\">ctx.status=</span><br><span class=\"line\">ctx.message</span><br><span class=\"line\">ctx.message=</span><br><span class=\"line\">ctx.length=</span><br><span class=\"line\">ctx.length</span><br><span class=\"line\">ctx.type=</span><br><span class=\"line\">ctx.type</span><br><span class=\"line\">ctx.headerSent</span><br><span class=\"line\">ctx.redirect()</span><br><span class=\"line\">ctx.attachment()</span><br><span class=\"line\">ctx.set()</span><br><span class=\"line\">ctx.append ()</span><br><span class=\"line\">ctx.remove ()</span><br><span class=\"line\">ctx.lastModified=</span><br><span class=\"line\">ctx.etag=</span><br></pre></td></tr></table></figure>\n\n\n<h6 id=\"2-3-启动demo\"><a href=\"#2-3-启动demo\" class=\"headerlink\" title=\"2.3 启动demo\"></a>2.3 启动demo</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node index.js</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-koa-vs-express\"><a href=\"#3-koa-vs-express\" class=\"headerlink\" title=\"3. koa vs express\"></a>3. koa vs express</h5><p>通常都会说 Koa 是洋葱模型，这重点在于中间件的设计。但是按照上面的分析，会发现 Express 也是类似的，不同的是Express 中间件机制使用了 Callback 实现，这样如果出现异步则可能会使你在执行顺序上感到困惑，因此如果我们想做接口耗时统计、错误处理 Koa 的这种中间件模式处理起来更方便些。最后一点响应机制也很重要，Koa 不是立即响应，是整个中间件处理完成在最外层进行了响应，而 Express 则是立即响应。</p>\n<h6 id=\"3-1更轻量\"><a href=\"#3-1更轻量\" class=\"headerlink\" title=\"3.1更轻量\"></a>3.1更轻量</h6><ul>\n<li>koa 不提供内置的中间件；</li>\n<li>koa 不提供路由，而是把路由这个库分离出来了（koa/router）</li>\n</ul>\n<h6 id=\"3-2-Context对象\"><a href=\"#3-2-Context对象\" class=\"headerlink\" title=\"3.2 Context对象\"></a>3.2 Context对象</h6><p>koa增加了一个Context的对象，作为这次请求的上下文对象（在koa2中作为中间件的第一个参数传入）。同时Context上也挂载了Request和Response两个对象。和Express类似，这两个对象都提供了大量的便捷方法辅助开发, 这样的话对于在保存一些公有的参数的话变得更加合情合理</p>\n<h6 id=\"3-3-异步流程控制\"><a href=\"#3-3-异步流程控制\" class=\"headerlink\" title=\"3.3 异步流程控制\"></a>3.3 异步流程控制</h6><p>​    express采用callback来处理异步，    koa v1采用generator，koa v2 采用async/await。</p>\n<p>​    generator和async/await使用同步的写法来处理异步，明显好于callback和promise，</p>\n<h6 id=\"3-4-中间件模型\"><a href=\"#3-4-中间件模型\" class=\"headerlink\" title=\"3.4 中间件模型\"></a>3.4 中间件模型</h6><p>​    express基于connect中间件，线性模型；</p>\n<p>​     koa中间件采用洋葱模型（对于每个中间件，在完成了一些事情后，可以非常优雅的将控制权传递给下一个中间件，并能够等待它完成，当后续的中间件完成处理后，控制权又回到了自己）</p>\n<img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417083817823.png\" alt=\"image-20220417083817823\" style=\"zoom:50%;float:left;\" />\n\n<p>   <img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417085913567.png\" alt=\"image-20220417085913567\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//同步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">req,res,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"><span class=\"comment\">//异步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (req,res,next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;hello&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> ()=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">delay</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">delay</span>(<span class=\"params\">time</span>)&#123;</span><br><span class=\"line\"> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolve,<span class=\"number\">1000</span>)</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//同步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> koa = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title function_\">koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">ctx,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=<span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//异步</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> koa = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title function_\">koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx,next)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">4</span>)</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=<span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\">&#125;) </span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> ()=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> <span class=\"title function_\">delay</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">delay</span>(<span class=\"params\">time</span>)&#123;</span><br><span class=\"line\"> <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolve,<span class=\"number\">1000</span>)</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-路由\"><a href=\"#4-路由\" class=\"headerlink\" title=\"4. 路由\"></a>4. 路由</h5><h6 id=\"4-1基本用发\"><a href=\"#4-1基本用发\" class=\"headerlink\" title=\"4.1基本用发\"></a>4.1基本用发</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/list&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=[<span class=\"string\">&quot;111&quot;</span>,<span class=\"string\">&quot;222&quot;</span>,<span class=\"string\">&quot;333&quot;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(router.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"4-2-router-allowedMethods作用\"><a href=\"#4-2-router-allowedMethods作用\" class=\"headerlink\" title=\"4.2 router.allowedMethods作用\"></a>4.2 router.allowedMethods作用</h6><p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220417102845079.png\" alt=\"image-20220417102845079\"></p>\n<h6 id=\"4-3-请求方式\"><a href=\"#4-3-请求方式\" class=\"headerlink\" title=\"4.3 请求方式\"></a>4.3 请求方式</h6><p>Koa-router 请求方式： <code>get</code> 、 <code>put</code> 、 <code>post</code> 、 <code>patch</code> 、 <code>delete</code> 、 <code>del</code>  ，而使用方法就是 <code>router.方式()</code>  ，比如 <code>router.get()</code> 和 <code>router.post()</code> 。而 <code>router.all()</code> 会匹配所有的请求方法。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/user&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=[<span class=\"string\">&quot;aaa&quot;</span>,<span class=\"string\">&quot;bbb&quot;</span>,<span class=\"string\">&quot;ccc&quot;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">put</span>(<span class=\"string\">&quot;/user/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;user update&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/user&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;user post&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">del</span>(<span class=\"string\">&quot;/user/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;user del&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(router.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"4-4-拆分路由\"><a href=\"#4-4-拆分路由\" class=\"headerlink\" title=\"4.4 拆分路由\"></a>4.4 拆分路由</h6><p>list.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=[<span class=\"string\">&quot;111&quot;</span>,<span class=\"string\">&quot;222&quot;</span>,<span class=\"string\">&quot;333&quot;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">put</span>(<span class=\"string\">&quot;/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;list update&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;list post&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.<span class=\"title function_\">del</span>(<span class=\"string\">&quot;/:id&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;<span class=\"attr\">ok</span>:<span class=\"number\">1</span>,<span class=\"attr\">info</span>:<span class=\"string\">&quot;list del&quot;</span>&#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router</span><br></pre></td></tr></table></figure>\n\n<p>index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Router</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa-router&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">Router</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> user = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./user&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> list = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./list&quot;</span>)</span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/user&#x27;</span>, user.<span class=\"title function_\">routes</span>(), user.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">router.<span class=\"title function_\">use</span>(<span class=\"string\">&#x27;/list&#x27;</span>, list.<span class=\"title function_\">routes</span>(), list.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = router</span><br></pre></td></tr></table></figure>\n\n<p>entry入口</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;koa&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;./router/index&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(router.<span class=\"title function_\">routes</span>()).<span class=\"title function_\">use</span>(router.<span class=\"title function_\">allowedMethods</span>())</span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"4-5-路由前缀\"><a href=\"#4-5-路由前缀\" class=\"headerlink\" title=\"4.5 路由前缀\"></a>4.5 路由前缀</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">prefix</span>(<span class=\"string\">&#x27;/api&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"4-6-路由重定向\"><a href=\"#4-6-路由重定向\" class=\"headerlink\" title=\"4.6 路由重定向\"></a>4.6 路由重定向</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/home&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=<span class=\"string\">&quot;home页面&quot;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">//写法1 </span></span><br><span class=\"line\">router.<span class=\"title function_\">redirect</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"string\">&#x27;/home&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">//写法2</span></span><br><span class=\"line\">router.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;/&quot;</span>,<span class=\"function\">(<span class=\"params\">ctx</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    ctx.<span class=\"title function_\">redirect</span>(<span class=\"string\">&quot;/home&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-静态资源\"><a href=\"#5-静态资源\" class=\"headerlink\" title=\"5.  静态资源\"></a>5.  静态资源</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">static</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-static&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">static</span>(</span><br><span class=\"line\">  path.<span class=\"title function_\">join</span>( __dirname,  <span class=\"string\">&quot;public&quot;</span>)</span><br><span class=\"line\">))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>( <span class=\"keyword\">async</span> ( ctx ) =&gt; &#123;</span><br><span class=\"line\">  ctx.<span class=\"property\">body</span> = <span class=\"string\">&#x27;hello world&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;[demo] static-use-middleware is starting at port 3000&#x27;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"6-获取请求参数\"><a href=\"#6-获取请求参数\" class=\"headerlink\" title=\"6.  获取请求参数\"></a>6.  获取请求参数</h5><h6 id=\"6-1get参数\"><a href=\"#6-1get参数\" class=\"headerlink\" title=\"6.1get参数\"></a>6.1get参数</h6><p>在koa中，获取GET请求数据源头是koa中request对象中的query方法或querystring方法，query返回是格式化好的参数对象，querystring返回的是请求字符串，由于ctx对request的API有直接引用的方式，所以获取GET请求数据有两个途径。</p>\n<ul>\n<li>是从上下文中直接获取 请求对象ctx.query，返回如 { a:1, b:2 } 请求字符串 ctx.querystring，返回如 a=1&amp;b=2</li>\n<li>是从上下文的request对象中获取 请求对象ctx.request.query，返回如 { a:1, b:2 } 请求字符串 ctx.request.querystring，返回如 a=1&amp;b=2</li>\n</ul>\n<h6 id=\"6-2post参数\"><a href=\"#6-2post参数\" class=\"headerlink\" title=\"6.2post参数\"></a>6.2post参数</h6><p>对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文的formData数据解析到ctx.request.body中</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-bodyparser&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用ctx.body解析中间件</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">bodyParser</span>())</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"7-ejs模板\"><a href=\"#7-ejs模板\" class=\"headerlink\" title=\"7. ejs模板\"></a>7. ejs模板</h5><h6 id=\"7-1-安装模块\"><a href=\"#7-1-安装模块\" class=\"headerlink\" title=\"7.1 安装模块\"></a>7.1 安装模块</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装koa模板使用中间件</span><br><span class=\"line\">npm install --save koa-views</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装ejs模板引擎</span><br><span class=\"line\">npm install --save ejs</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"7-2-使用模板引擎\"><a href=\"#7-2-使用模板引擎\" class=\"headerlink\" title=\"7.2 使用模板引擎\"></a>7.2 使用模板引擎</h6><p><strong>文件目录</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── package.json</span><br><span class=\"line\">├── index.js</span><br><span class=\"line\">└── view</span><br><span class=\"line\">    └── index.ejs</span><br></pre></td></tr></table></figure>\n\n<p><strong>./index.js文件</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> views = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-views&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加载模板引擎</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">views</span>(path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;./view&#x27;</span>), &#123;</span><br><span class=\"line\">  <span class=\"attr\">extension</span>: <span class=\"string\">&#x27;ejs&#x27;</span></span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>( <span class=\"keyword\">async</span> ( ctx ) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> title = <span class=\"string\">&#x27;hello koa2&#x27;</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> ctx.<span class=\"title function_\">render</span>(<span class=\"string\">&#x27;index&#x27;</span>, &#123;</span><br><span class=\"line\">    title,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>./view/index.ejs 模板</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>&lt;%= title %&gt;<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&lt;%= title %&gt;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>EJS Welcome to &lt;%= title %&gt;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"8-cookie-amp-session\"><a href=\"#8-cookie-amp-session\" class=\"headerlink\" title=\"8. cookie&amp;session\"></a>8. cookie&amp;session</h5><h6 id=\"8-1-cookie\"><a href=\"#8-1-cookie\" class=\"headerlink\" title=\"8.1 cookie\"></a>8.1 cookie</h6><p>koa提供了从上下文直接读取、写入cookie的方法</p>\n<ul>\n<li>ctx.cookies.get(name, [options]) 读取上下文请求中的cookie</li>\n<li>ctx.cookies.set(name, value, [options]) 在上下文中写入cookie</li>\n</ul>\n<h6 id=\"8-2-session\"><a href=\"#8-2-session\" class=\"headerlink\" title=\"8.2 session\"></a>8.2 session</h6><ul>\n<li><p>koa-session-minimal 适用于koa2 的session中间件，提供存储介质的读写接口 。</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-session-minimal&#x27;</span>)</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">session</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">key</span>: <span class=\"string\">&#x27;SESSION_ID&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">cookie</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">maxAge</span>:<span class=\"number\">1000</span>*<span class=\"number\">60</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;))</span><br></pre></td></tr></table></figure>\n\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">async</span> (ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//排除login相关的路由和接口</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">url</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&quot;login&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">session</span>.<span class=\"property\">user</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//重新设置以下sesssion</span></span><br><span class=\"line\">        ctx.<span class=\"property\">session</span>.<span class=\"property\">mydate</span> = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        ctx.<span class=\"title function_\">redirect</span>(<span class=\"string\">&quot;/login&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"9-JWT\"><a href=\"#9-JWT\" class=\"headerlink\" title=\"9. JWT\"></a>9. JWT</h5> <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"title function_\">async</span>(ctx, next) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//排除login相关的路由和接口</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx.<span class=\"property\">url</span>.<span class=\"title function_\">includes</span>(<span class=\"string\">&quot;login&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = ctx.<span class=\"property\">headers</span>[<span class=\"string\">&quot;authorization&quot;</span>]?.<span class=\"title function_\">split</span>(<span class=\"string\">&quot; &quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"comment\">// console.log(req.headers[&quot;authorization&quot;])</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(token)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> payload=  <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(token)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(payload)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//重新计算token过期时间</span></span><br><span class=\"line\">            <span class=\"keyword\">const</span> newToken = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">generate</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">_id</span>:payload.<span class=\"property\">_id</span>,</span><br><span class=\"line\">                <span class=\"attr\">username</span>:payload.<span class=\"property\">username</span></span><br><span class=\"line\">            &#125;,<span class=\"string\">&quot;10s&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">            ctx.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;Authorization&quot;</span>,newToken)</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            ctx.<span class=\"property\">status</span> = <span class=\"number\">401</span></span><br><span class=\"line\">            ctx.<span class=\"property\">body</span> = &#123;<span class=\"attr\">errCode</span>:-<span class=\"number\">1</span>,<span class=\"attr\">errInfo</span>:<span class=\"string\">&quot;token过期&quot;</span>&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">next</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"10-上传文件\"><a href=\"#10-上传文件\" class=\"headerlink\" title=\"10.上传文件\"></a>10.上传文件</h5><blockquote>\n<p><a href=\"https://www.npmjs.com/package/@koa/multer\">https://www.npmjs.com/package/@koa/multer</a></p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save @koa/multer multer</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> multer = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;@koa/multer&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> upload = <span class=\"title function_\">multer</span>(&#123; <span class=\"attr\">dest</span>: <span class=\"string\">&#x27;public/uploads/&#x27;</span> &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">router.<span class=\"title function_\">post</span>(<span class=\"string\">&quot;/&quot;</span>,upload.<span class=\"title function_\">single</span>(<span class=\"string\">&#x27;avatar&#x27;</span>),</span><br><span class=\"line\"><span class=\"function\">(<span class=\"params\">ctx,next</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(ctx.<span class=\"property\">request</span>.<span class=\"property\">body</span>,ctx.<span class=\"property\">file</span>)</span><br><span class=\"line\">    ctx.<span class=\"property\">body</span>=&#123;</span><br><span class=\"line\">        <span class=\"attr\">ok</span>:<span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">info</span>:<span class=\"string\">&quot;add user success&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"11-操作MongoDB\"><a href=\"#11-操作MongoDB\" class=\"headerlink\" title=\"11.操作MongoDB\"></a>11.操作MongoDB</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.<span class=\"title function_\">connect</span>(<span class=\"string\">&quot;mongodb://127.0.0.1:27017/kerwin_project&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">//插入集合和数据,数据库kerwin_project会自动创建</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;mongoose&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Schema</span> = mongoose.<span class=\"property\">Schema</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserType</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">username</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">password</span>:<span class=\"title class_\">String</span>,</span><br><span class=\"line\">    <span class=\"attr\">age</span>:<span class=\"title class_\">Number</span>,</span><br><span class=\"line\">    <span class=\"attr\">avatar</span>:<span class=\"title class_\">String</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">UserModel</span> = mongoose.<span class=\"title function_\">model</span>(<span class=\"string\">&quot;user&quot;</span>,<span class=\"keyword\">new</span> <span class=\"title class_\">Schema</span>(<span class=\"title class_\">UserType</span>))</span><br><span class=\"line\"><span class=\"comment\">// 模型user 将会对应 users 集合, </span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title class_\">UserModel</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"九、MySQL\"><a href=\"#九、MySQL\" class=\"headerlink\" title=\"九、MySQL\"></a>九、MySQL</h4><h5 id=\"1-介绍\"><a href=\"#1-介绍\" class=\"headerlink\" title=\"1.介绍\"></a>1.介绍</h5><p>付费的商用数据库：</p>\n<ul>\n<li>Oracle，典型的高富帅；</li>\n<li>SQL Server，微软自家产品，Windows定制专款；</li>\n<li>DB2，IBM的产品，听起来挺高端；</li>\n<li>Sybase，曾经跟微软是好基友，后来关系破裂，现在家境惨淡。</li>\n</ul>\n<p>这些数据库都是不开源而且付费的，最大的好处是花了钱出了问题可以找厂家解决，不过在Web的世界里，常常需要部署成千上万的数据库服务器，当然不能把大把大把的银子扔给厂家，所以，无论是Google、Facebook，还是国内的BAT，无一例外都选择了免费的开源数据库：</p>\n<ul>\n<li>MySQL，大家都在用，一般错不了；</li>\n<li>PostgreSQL，学术气息有点重，其实挺不错，但知名度没有MySQL高；</li>\n<li>sqlite，嵌入式数据库，适合桌面和移动应用。</li>\n</ul>\n<p>作为一个JavaScript全栈工程师，选择哪个免费数据库呢？当然是MySQL。因为MySQL普及率最高，出了错，可以很容易找到解决方法。而且，围绕MySQL有一大堆监控和运维的工具，安装和使用很方便。</p>\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220420083146539.png\" alt=\"image-20220420083146539\"></p>\n<h5 id=\"2-与非关系数据库区别\"><a href=\"#2-与非关系数据库区别\" class=\"headerlink\" title=\"2.与非关系数据库区别\"></a>2.与非关系数据库区别</h5><p>关系型和非关系型数据库的主要差异是数据存储的方式。关系型数据天然就是表格式的，因此存储在数据表的行和列中。数据表可以彼此关联协作存储，也很容易提取数据。</p>\n<p>与其相反，非关系型数据不适合存储在数据表的行和列中，而是大块组合在一起。非关系型数据通常存储在数据集中，就像文档、键值对或者图结构。你的数据及其特性是选择数据存储和提取方式的首要影响因素。</p>\n<p><strong>关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织</strong><br>优点：<br>1、易于维护：都是使用表结构，格式一致；<br>2、使用方便：SQL语言通用，可用于复杂查询；<br>3、复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。<br>缺点：<br>1、读写性能比较差，尤其是海量数据的高效率读写；<br>2、固定的表结构，灵活度稍欠；<br>3、高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈。</p>\n<p><strong>非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。</strong></p>\n<p>优点：</p>\n<p>1、格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。<br>2、速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；<br>3、高扩展性；<br>4、成本低：nosql数据库部署简单，基本都是开源软件。</p>\n<p>缺点：</p>\n<p>1、不提供sql支持；<br>2、无事务处理；<br>3、数据结构相对复杂，复杂查询方面稍欠。</p>\n<h5 id=\"3-sql语句\"><a href=\"#3-sql语句\" class=\"headerlink\" title=\"3.sql语句\"></a>3.sql语句</h5><p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220420092527846.png\" alt=\"image-20220420092527846\"></p>\n<p>插入：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> `students`(`id`, `name`, `score`, `gender`) <span class=\"keyword\">VALUES</span> (<span class=\"keyword\">null</span>,<span class=\"string\">&#x27;kerwin&#x27;</span>,<span class=\"number\">100</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"operator\">/</span><span class=\"operator\">/</span>可以不设置id,create_time</span><br></pre></td></tr></table></figure>\n<p>更新：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> `students` <span class=\"keyword\">SET</span> `name`<span class=\"operator\">=</span><span class=\"string\">&#x27;tiechui&#x27;</span>,`score`<span class=\"operator\">=</span><span class=\"number\">20</span>,`gender`<span class=\"operator\">=</span><span class=\"number\">0</span> <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<p>删除：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<p>查询：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查所有的数据所有的字段</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">查所有的数据某个字段</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> `id`, `name`, `score`, `gender` <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">条件查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">WHERE</span> score<span class=\"operator\">&gt;=</span><span class=\"number\">80</span>;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">where</span> score<span class=\"operator\">&gt;=</span><span class=\"number\">80</span> <span class=\"keyword\">AND</span> gender<span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">模糊查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `students` <span class=\"keyword\">where</span> name <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%k%&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">排序</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id, name, gender, score <span class=\"keyword\">FROM</span> students <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> score;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id, name, gender, score <span class=\"keyword\">FROM</span> students <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> score <span class=\"keyword\">DESC</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">分页查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> id, name, gender, score <span class=\"keyword\">FROM</span> students LIMIT <span class=\"number\">50</span> <span class=\"keyword\">OFFSET</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">记录条数</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> students;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span>(<span class=\"operator\">*</span>) kerwinnum <span class=\"keyword\">FROM</span> students;</span><br><span class=\"line\"></span><br><span class=\"line\">多表查询</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> students, classes;（这种多表查询又称笛卡尔查询，使用笛卡尔查询时要非常小心，由于结果集是目标表的行数乘积，对两个各自有<span class=\"number\">100</span>行记录的表进行笛卡尔查询将返回<span class=\"number\">1</span>万条记录，对两个各自有<span class=\"number\">1</span>万行记录的表进行笛卡尔查询将返回<span class=\"number\">1</span>亿条记录）</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    students.id sid,</span><br><span class=\"line\">    students.name,</span><br><span class=\"line\">    students.gender,</span><br><span class=\"line\">    students.score,</span><br><span class=\"line\">    classes.id cid,</span><br><span class=\"line\">    classes.name cname</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> students, classes; （要使用表名.列名这样的方式来引用列和设置别名，这样就避免了结果集的列名重复问题。）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    s.id sid,</span><br><span class=\"line\">    s.name,</span><br><span class=\"line\">    s.gender,</span><br><span class=\"line\">    s.score,</span><br><span class=\"line\">    c.id cid,</span><br><span class=\"line\">    c.name cname</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> students s, classes c; （<span class=\"keyword\">SQL</span>还允许给表设置一个别名）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">联表查询</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> s.id, s.name, s.class_id, c.name class_name, s.gender, s.score</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> students s</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> classes c</span><br><span class=\"line\"><span class=\"keyword\">ON</span> s.class_id <span class=\"operator\">=</span> c.id; （连接查询对多个表进行<span class=\"keyword\">JOIN</span>运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220420090841742.png\" alt=\"image-20220420090841742\"></p>\n<p>注意：</p>\n<blockquote>\n<ol>\n<li>InnoDB 支持事务，MyISAM 不支持事务。这是 MySQL 将默认存储引擎从 MyISAM 变成 InnoDB 的重要原因之一；</li>\n<li>InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MYISAM 会失败；</li>\n</ol>\n</blockquote>\n<p><strong>外键约束</strong></p>\n<p>CASCADE<br>在父表上update/delete记录时，同步update/delete掉子表的匹配记录 </p>\n<p>SET NULL<br>在父表上update/delete记录时，将子表上匹配记录的列设为null (要注意子表的外键列不能为not null)  </p>\n<p>NO ACTION<br>如果子表中有匹配的记录,则不允许对父表对应候选键进行update/delete操作 </p>\n<p>RESTRICT<br>同no action, 都是立即检查外键约束</p>\n<h5 id=\"4-nodejs-操作数据库\"><a href=\"#4-nodejs-操作数据库\" class=\"headerlink\" title=\"4.nodejs 操作数据库\"></a>4.nodejs 操作数据库</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">express</span>()</span><br><span class=\"line\"><span class=\"keyword\">const</span> mysql2 = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mysql2&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> port = <span class=\"number\">9000</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>,<span class=\"keyword\">async</span> (req, res) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> config = <span class=\"title function_\">getDBConfig</span>()</span><br><span class=\"line\">  <span class=\"keyword\">const</span> promisePool = mysql2.<span class=\"title function_\">createPool</span>(config).<span class=\"title function_\">promise</span>();</span><br><span class=\"line\">  <span class=\"comment\">// console.log(promisePool)</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> user = <span class=\"keyword\">await</span> promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">&#x27;select * from students&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(user)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (user[<span class=\"number\">0</span>].<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//存在用户</span></span><br><span class=\"line\">          res.<span class=\"title function_\">send</span>(user[<span class=\"number\">0</span>])</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//不存在</span></span><br><span class=\"line\">          res.<span class=\"title function_\">send</span>( &#123;</span><br><span class=\"line\">              <span class=\"attr\">code</span>: -<span class=\"number\">2</span>,</span><br><span class=\"line\">              <span class=\"attr\">msg</span>: <span class=\"string\">&#x27;user not exsit&#x27;</span>,</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;      </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(port, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`Example app listening at http://localhost:<span class=\"subst\">$&#123;port&#125;</span>`</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getDBConfig</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">host</span>: <span class=\"string\">&#x27;127.0.0.1&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">user</span>: <span class=\"string\">&#x27;root&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">port</span>: <span class=\"number\">3306</span>,</span><br><span class=\"line\">    <span class=\"attr\">password</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">database</span>: <span class=\"string\">&#x27;kerwin_test&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">connectionLimit</span>: <span class=\"number\">1</span> <span class=\"comment\">//创建一个连接池</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查询：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">&#x27;select * from users&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">插入：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">&#x27;INSERT INTO `users`(`id`,`name`,`age`, `password`) VALUES (?,?,?,?)&#x27;</span>,[<span class=\"literal\">null</span>,<span class=\"string\">&quot;kerwin&quot;</span>,<span class=\"number\">100</span>,<span class=\"string\">&quot;123456&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">更新：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">`UPDATE users SET name = ? ,age=? WHERE id = ?`</span>,[<span class=\"string\">&quot;xiaoming2&quot;</span>,<span class=\"number\">20</span>,<span class=\"number\">1</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">删除：</span><br><span class=\"line\">promisePool.<span class=\"title function_\">query</span>(<span class=\"string\">`delete from users where id=?`</span>,[<span class=\"number\">1</span>])</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"十、Socket编程\"><a href=\"#十、Socket编程\" class=\"headerlink\" title=\"十、Socket编程\"></a>十、Socket编程</h4><h5 id=\"1-websocket介绍\"><a href=\"#1-websocket介绍\" class=\"headerlink\" title=\"1.websocket介绍\"></a>1.websocket介绍</h5><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220421084242097.png\" alt=\"image-20220421084242097\" style=\"zoom:50%;\" />\n\n<p><strong>应用场景：</strong></p>\n<ul>\n<li><p>弹幕</p>\n</li>\n<li><p>媒体聊天</p>\n</li>\n<li><p>协同编辑</p>\n</li>\n<li><p>基于位置的应用</p>\n</li>\n<li><p>体育实况更新</p>\n</li>\n<li><p>股票基金报价实时更新</p>\n</li>\n</ul>\n<p>WebSocket并不是全新的协议，而是利用了HTTP协议来建立连接。我们来看看WebSocket连接是如何创建的。</p>\n<p>首先，WebSocket连接必须由浏览器发起，因为请求协议是一个标准的HTTP请求，格式如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">GET</span> <span class=\"attr\">ws</span>:<span class=\"comment\">//localhost:3000/ws/chat HTTP/1.1</span></span><br><span class=\"line\"><span class=\"title class_\">Host</span>: localhost</span><br><span class=\"line\"><span class=\"title class_\">Upgrade</span>: websocket</span><br><span class=\"line\"><span class=\"title class_\">Connection</span>: <span class=\"title class_\">Upgrade</span></span><br><span class=\"line\"><span class=\"title class_\">Origin</span>: <span class=\"attr\">http</span>:<span class=\"comment\">//localhost:3000</span></span><br><span class=\"line\"><span class=\"title class_\">Sec</span>-<span class=\"title class_\">WebSocket</span>-<span class=\"title class_\">Key</span>: client-random-string</span><br><span class=\"line\"><span class=\"title class_\">Sec</span>-<span class=\"title class_\">WebSocket</span>-<span class=\"title class_\">Version</span>: <span class=\"number\">13</span></span><br></pre></td></tr></table></figure>\n\n<p>该请求和普通的HTTP请求有几点不同：</p>\n<ol>\n<li>GET请求的地址不是类似<code>/path/</code>，而是以<code>ws://</code>开头的地址；</li>\n<li>请求头<code>Upgrade: websocket</code>和<code>Connection: Upgrade</code>表示这个连接将要被转换为WebSocket连接；</li>\n<li><code>Sec-WebSocket-Key</code>是用于标识这个连接，并非用于加密数据；</li>\n<li><code>Sec-WebSocket-Version</code>指定了WebSocket的协议版本。</li>\n</ol>\n<p>随后，服务器如果接受该请求，就会返回如下响应：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 101 Switching Protocols</span><br><span class=\"line\">Upgrade: websocket</span><br><span class=\"line\">Connection: Upgrade</span><br><span class=\"line\">Sec-WebSocket-Accept: server-random-string</span><br></pre></td></tr></table></figure>\n\n<p>该响应代码<code>101</code>表示本次连接的HTTP协议即将被更改，更改后的协议就是<code>Upgrade: websocket</code>指定的WebSocket协议。</p>\n<p>版本号和子协议规定了双方能理解的数据格式，以及是否支持压缩等等。如果仅使用WebSocket的API，就不需要关心这些。</p>\n<p>现在，一个WebSocket连接就建立成功，浏览器和服务器就可以随时主动发送消息给对方。消息有两种，一种是文本，一种是二进制数据。通常，我们可以发送JSON格式的文本，这样，在浏览器处理起来就十分容易。</p>\n<p>为什么WebSocket连接可以实现全双工通信而HTTP连接不行呢？实际上HTTP协议是建立在TCP协议之上的，TCP协议本身就实现了全双工通信，但是HTTP协议的请求－应答机制限制了全双工通信。WebSocket连接建立以后，其实只是简单规定了一下：接下来，咱们通信就不使用HTTP协议了，直接互相发数据吧。</p>\n<p>安全的WebSocket连接机制和HTTPS类似。首先，浏览器用<code>wss://xxx</code>创建WebSocket连接时，会先通过HTTPS创建安全的连接，然后，该HTTPS连接升级为WebSocket连接，底层通信走的仍然是安全的SSL/TLS协议。</p>\n<p><strong>浏览器支持</strong></p>\n<p>很显然，要支持WebSocket通信，浏览器得支持这个协议，这样才能发出<code>ws://xxx</code>的请求。目前，支持WebSocket的主流浏览器如下：</p>\n<ul>\n<li>Chrome</li>\n<li>Firefox</li>\n<li>IE &gt;= 10</li>\n<li>Sarafi &gt;= 6</li>\n<li>Android &gt;= 4.4</li>\n<li>iOS &gt;= 8</li>\n</ul>\n<p><strong>服务器支持</strong></p>\n<p>由于WebSocket是一个协议，服务器具体怎么实现，取决于所用编程语言和框架本身。Node.js本身支持的协议包括TCP协议和HTTP协议，要支持WebSocket协议，需要对Node.js提供的HTTPServer做额外的开发。已经有若干基于Node.js的稳定可靠的WebSocket实现，我们直接用npm安装使用即可。</p>\n<h5 id=\"2-ws模块\"><a href=\"#2-ws模块\" class=\"headerlink\" title=\"2.ws模块\"></a>2.ws模块</h5><p>服务器：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span>  <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;ws&quot;</span>)</span><br><span class=\"line\"><span class=\"title class_\">WebSocketServer</span> = <span class=\"title class_\">WebSocket</span>.<span class=\"property\">WebSocketServer</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> wss = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocketServer</span>(&#123; <span class=\"attr\">port</span>: <span class=\"number\">8080</span> &#125;);</span><br><span class=\"line\">wss.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws</span>) &#123;</span><br><span class=\"line\">    ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">message</span>(<span class=\"params\">data, isBinary</span>) &#123;</span><br><span class=\"line\">        wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (client !== ws &amp;&amp; client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">                client.<span class=\"title function_\">send</span>(data, &#123; <span class=\"attr\">binary</span>: isBinary &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;欢迎加入聊天室&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>客户端：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ws = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>(<span class=\"string\">&quot;ws://localhost:8080&quot;</span>)</span><br><span class=\"line\">ws.<span class=\"property\">onopen</span> = <span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;open&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ws.<span class=\"property\">onmessage</span> = <span class=\"function\">(<span class=\"params\">evt</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(evt.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>授权验证：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//前端</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ws = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocket</span>(<span class=\"string\">`ws://localhost:8080?token=<span class=\"subst\">$&#123;<span class=\"variable language_\">localStorage</span>.getItem(<span class=\"string\">&quot;token&quot;</span>)&#125;</span>`</span>)</span><br><span class=\"line\">ws.<span class=\"property\">onopen</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;open&quot;</span>)</span><br><span class=\"line\">      ws.<span class=\"title function_\">send</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span></span><br><span class=\"line\">      &#125;))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">ws.<span class=\"property\">onmessage</span> = <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(evt.<span class=\"property\">data</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//后端</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocket</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;ws&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">JWT</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../util/JWT&#x27;</span>);</span><br><span class=\"line\"><span class=\"title class_\">WebSocketServer</span> = <span class=\"title class_\">WebSocket</span>.<span class=\"property\">WebSocketServer</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> wss = <span class=\"keyword\">new</span> <span class=\"title class_\">WebSocketServer</span>(&#123; <span class=\"attr\">port</span>: <span class=\"number\">8080</span> &#125;);</span><br><span class=\"line\">wss.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">connection</span>(<span class=\"params\">ws, req</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> myURL = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(req.<span class=\"property\">url</span>, <span class=\"string\">&#x27;http://127.0.0.1:3000&#x27;</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> payload = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(myURL.<span class=\"property\">searchParams</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;token&quot;</span>))</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (payload) &#123;</span><br><span class=\"line\">    ws.<span class=\"property\">user</span> = payload</span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, ws.<span class=\"property\">user</span>, <span class=\"string\">&quot;欢迎来到聊天室&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好友列表</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">Error</span>, <span class=\"literal\">null</span>, <span class=\"string\">&quot;token过期&quot;</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// console.log(3333,url)</span></span><br><span class=\"line\">  ws.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"keyword\">function</span> <span class=\"title function_\">message</span>(<span class=\"params\">data, isBinary</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> messageObj = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(data)</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (messageObj.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>:</span><br><span class=\"line\">        ws.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, ws.<span class=\"property\">user</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(<span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(wss.<span class=\"property\">clients</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">user</span>))))</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>:</span><br><span class=\"line\">        wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (client !== ws &amp;&amp; client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">            client.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, ws.<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>:</span><br><span class=\"line\">        wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (client.<span class=\"property\">user</span>.<span class=\"property\">username</span> === messageObj.<span class=\"property\">to</span> &amp;&amp; client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">            client.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, ws.<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ws.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;close&quot;</span>,<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">      <span class=\"comment\">//删除当前用户</span></span><br><span class=\"line\">      wss.<span class=\"property\">clients</span>.<span class=\"title function_\">delete</span>(ws.<span class=\"property\">user</span>)</span><br><span class=\"line\">      <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好用列表</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocketType</span> = &#123;</span><br><span class=\"line\">  <span class=\"title class_\">Error</span>: <span class=\"number\">0</span>, <span class=\"comment\">//错误</span></span><br><span class=\"line\">  <span class=\"title class_\">GroupList</span>: <span class=\"number\">1</span>,<span class=\"comment\">//群列表</span></span><br><span class=\"line\">  <span class=\"title class_\">GroupChat</span>: <span class=\"number\">2</span>,<span class=\"comment\">//群聊</span></span><br><span class=\"line\">  <span class=\"title class_\">SingleChat</span>: <span class=\"number\">3</span><span class=\"comment\">//私聊</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">createMessage</span>(<span class=\"params\">type, user, data</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: type,</span><br><span class=\"line\">    <span class=\"attr\">user</span>: user,</span><br><span class=\"line\">    <span class=\"attr\">data</span>: data</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendBroadList</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  wss.<span class=\"property\">clients</span>.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">each</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (client.<span class=\"property\">readyState</span> === <span class=\"title class_\">WebSocket</span>.<span class=\"property\">OPEN</span>) &#123;</span><br><span class=\"line\">      client.<span class=\"title function_\">send</span>(<span class=\"title function_\">createMessage</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, client.<span class=\"property\">user</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(<span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(wss.<span class=\"property\">clients</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.<span class=\"property\">user</span>))))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"3-socket-io模块\"><a href=\"#3-socket-io模块\" class=\"headerlink\" title=\"3.socket.io模块\"></a>3.socket.io模块</h5><p>服务端：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> io = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;socket.io&#x27;</span>)(server);</span><br><span class=\"line\">io.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;connection&#x27;</span>, <span class=\"function\">(<span class=\"params\">socket</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> payload = <span class=\"variable constant_\">JWT</span>.<span class=\"title function_\">verify</span>(socket.<span class=\"property\">handshake</span>.<span class=\"property\">query</span>.<span class=\"property\">token</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (payload) &#123;</span><br><span class=\"line\">    socket.<span class=\"property\">user</span> = payload</span><br><span class=\"line\">    socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"title function_\">createMessage</span>(socket.<span class=\"property\">user</span>, <span class=\"string\">&quot;欢迎来到聊天室&quot;</span>))</span><br><span class=\"line\">    <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好友列表</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">Error</span>, <span class=\"title function_\">createMessage</span>(<span class=\"literal\">null</span>, <span class=\"string\">&quot;token过期&quot;</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"title function_\">createMessage</span>(<span class=\"literal\">null</span>, <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(io.<span class=\"property\">sockets</span>.<span class=\"property\">sockets</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item[<span class=\"number\">1</span>].<span class=\"property\">user</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">item</span>=&gt;</span>item)));</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"function\">(<span class=\"params\">messageObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    socket.<span class=\"property\">broadcast</span>.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"title function_\">createMessage</span>(socket.<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, <span class=\"function\">(<span class=\"params\">messageObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(io.<span class=\"property\">sockets</span>.<span class=\"property\">sockets</span>).<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">socket</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (socket[<span class=\"number\">1</span>].<span class=\"property\">user</span>.<span class=\"property\">username</span> === messageObj.<span class=\"property\">to</span>) &#123;</span><br><span class=\"line\">        socket[<span class=\"number\">1</span>].<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, <span class=\"title function_\">createMessage</span>(socket[<span class=\"number\">1</span>].<span class=\"property\">user</span>, messageObj.<span class=\"property\">data</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  socket.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;disconnect&#x27;</span>, <span class=\"function\"><span class=\"params\">reason</span> =&gt;</span> &#123;</span><br><span class=\"line\">     </span><br><span class=\"line\">     <span class=\"title function_\">sendBroadList</span>() <span class=\"comment\">//发送好用列表</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">sendBroadList</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  io.<span class=\"property\">sockets</span>.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"title function_\">createMessage</span>(<span class=\"literal\">null</span>, <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(io.<span class=\"property\">sockets</span>.<span class=\"property\">sockets</span>).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item[<span class=\"number\">1</span>].<span class=\"property\">user</span>).<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">item</span>=&gt;</span>item)))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//最后filter，是因为 有可能存在null的值</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>客户端：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">WebSocketType</span> = &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Error</span>: <span class=\"number\">0</span>, <span class=\"comment\">//错误</span></span><br><span class=\"line\">    <span class=\"title class_\">GroupList</span>: <span class=\"number\">1</span>, <span class=\"comment\">//群列表</span></span><br><span class=\"line\">    <span class=\"title class_\">GroupChat</span>: <span class=\"number\">2</span>, <span class=\"comment\">//群聊</span></span><br><span class=\"line\">    <span class=\"title class_\">SingleChat</span>: <span class=\"number\">3</span> <span class=\"comment\">//私聊</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> socket = <span class=\"title function_\">io</span>(<span class=\"string\">`ws://localhost:3000?token=<span class=\"subst\">$&#123;<span class=\"variable language_\">localStorage</span>.getItem(<span class=\"string\">&quot;token&quot;</span>)&#125;</span>`</span>);</span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;connect&quot;</span>,<span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">\tsocket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupList</span>, <span class=\"function\">(<span class=\"params\">messageObj</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    select.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    select.<span class=\"property\">innerHTML</span> = <span class=\"string\">`&lt;option value=&quot;all&quot;&gt;all&lt;/option&gt;`</span> + messageObj.<span class=\"property\">data</span>.<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">    &lt;option value=&quot;<span class=\"subst\">$&#123;item.username&#125;</span>&quot;&gt;<span class=\"subst\">$&#123;item.username&#125;</span>&lt;/option&gt;`</span>).<span class=\"title function_\">join</span>(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>, <span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msg)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>, <span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(msg)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">socket.<span class=\"title function_\">on</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">Error</span>, <span class=\"function\">(<span class=\"params\">msg</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">removeItem</span>(<span class=\"string\">&quot;token&quot;</span>)</span><br><span class=\"line\">    location.<span class=\"property\">href</span> = <span class=\"string\">&quot;/login&quot;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">send.<span class=\"property\">onclick</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (select.<span class=\"property\">value</span> === <span class=\"string\">&quot;all&quot;</span>) &#123;</span><br><span class=\"line\">        socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">GroupChat</span>,&#123;</span><br><span class=\"line\">            <span class=\"attr\">data</span>: text.<span class=\"property\">value</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        socket.<span class=\"title function_\">emit</span>(<span class=\"title class_\">WebSocketType</span>.<span class=\"property\">SingleChat</span>,&#123;</span><br><span class=\"line\">            <span class=\"attr\">data</span>: text.<span class=\"property\">value</span>,</span><br><span class=\"line\">            <span class=\"attr\">to</span>:select.<span class=\"property\">value</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"十一、mocha\"><a href=\"#十一、mocha\" class=\"headerlink\" title=\"十一、mocha\"></a>十一、mocha</h4><p>单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>\n<p>比如对函数abs()，我们可以编写出以下几个测试用例：</p>\n<p>输入正数，比如1、1.2、0.99，期待返回值与输入相同；</p>\n<p>输入负数，比如-1、-1.2、-0.99，期待返回值与输入相反；</p>\n<p>输入0，期待返回0；</p>\n<p>输入非数值类型，比如null、[]、{}，期待抛出Error。</p>\n<p>把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。</p>\n<p>如果单元测试通过，说明我们测试的这个函数能够正常工作。如果单元测试不通过，要么函数有bug，要么测试条件输入不正确，总之，需要修复使单元测试能够通过。</p>\n<p>单元测试通过后有什么意义呢？如果我们对abs()函数代码做了修改，只需要再跑一遍单元测试，如果通过，说明我们的修改不会对abs()函数原有的行为造成影响，如果测试不通过，说明我们的修改与原有行为不一致，要么修改代码，要么修改测试。</p>\n<p>这种以测试为驱动的开发模式最大的好处就是确保一个程序模块的行为符合我们设计的测试用例。在将来修改的时候，可以极大程度地保证该模块行为仍然是正确的。</p>\n<p>mocha是JavaScript的一种单元测试框架，既可以在浏览器环境下运行，也可以在Node.js环境下运行。</p>\n<p>使用mocha，我们就只需要专注于编写单元测试本身，然后，让mocha去自动运行所有的测试，并给出测试结果。</p>\n<p>mocha的特点主要有：</p>\n<ol>\n<li>既可以测试简单的JavaScript函数，又可以测试异步代码，因为异步是JavaScript的特性之一；</li>\n<li>可以自动运行所有测试，也可以只运行特定的测试；</li>\n<li>可以支持before、after、beforeEach和afterEach来编写初始化代码。</li>\n</ol>\n<h5 id=\"1-编写测试\"><a href=\"#1-编写测试\" class=\"headerlink\" title=\"1.编写测试\"></a>1.编写测试</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> assert = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;assert&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> sum = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../test&#x27;</span>);</span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#hello.js&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#sum()&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum() should return 0&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(), <span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum(1) should return 1&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(<span class=\"number\">1</span>), <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum(1, 2) should return 3&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>), <span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;sum(1, 2, 3) should return 6&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">            assert.<span class=\"title function_\">strictEqual</span>(<span class=\"title function_\">sum</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>), <span class=\"number\">6</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"2-chai断言库\"><a href=\"#2-chai断言库\" class=\"headerlink\" title=\"2.chai断言库\"></a>2.chai断言库</h5><p><img src=\"%E7%AC%94%E8%AE%B0.assets/image-20220505113605440.png\" alt=\"image-20220505113605440\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> assert = chai.<span class=\"property\">assert</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;assert Demo&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;use assert lib&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\">        assert.<span class=\"title function_\">typeOf</span>(value, <span class=\"string\">&#x27;string&#x27;</span>)</span><br><span class=\"line\">        assert.<span class=\"title function_\">equal</span>(value, <span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">        assert.<span class=\"title function_\">lengthOf</span>(value, <span class=\"number\">5</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>);</span><br><span class=\"line\">chai.<span class=\"title function_\">should</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;should Demo&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;use should lib&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">        value.<span class=\"property\">should</span>.<span class=\"property\">exist</span>.<span class=\"property\">and</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;hello&#x27;</span>).<span class=\"property\">and</span>.<span class=\"property\">have</span>.<span class=\"title function_\">length</span>(<span class=\"number\">5</span>).<span class=\"property\">and</span>.<span class=\"property\">be</span>.<span class=\"title function_\">a</span>(<span class=\"string\">&#x27;string&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\">// value.should.be.a(&#x27;string&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">// value.should.equal(&#x27;hello&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">// value.should.not.equal(&#x27;hello2&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">// value.should.have.length(5);</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> expect = chai.<span class=\"property\">expect</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;expect Demo&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;use expect lib&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = <span class=\"string\">&#x27;hello&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> number = <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(number).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"property\">at</span>.<span class=\"title function_\">most</span>(<span class=\"number\">5</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(number).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"property\">at</span>.<span class=\"title function_\">least</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(number).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"title function_\">within</span>(<span class=\"number\">1</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">exist</span></span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"title function_\">a</span>(<span class=\"string\">&#x27;string&#x27;</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">not</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;您好&#x27;</span>)</span><br><span class=\"line\">        <span class=\"title function_\">expect</span>(value).<span class=\"property\">to</span>.<span class=\"property\">have</span>.<span class=\"title function_\">length</span>(<span class=\"number\">5</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"3-异步测试\"><a href=\"#3-异步测试\" class=\"headerlink\" title=\"3.异步测试\"></a>3.异步测试</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs =<span class=\"built_in\">require</span>(<span class=\"string\">&quot;fs&quot;</span>).<span class=\"property\">promises</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> chai = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;chai&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> expect = chai.<span class=\"property\">expect</span>;</span><br><span class=\"line\"><span class=\"title function_\">it</span>(<span class=\"string\">&#x27;test async function&#x27;</span>,<span class=\"keyword\">async</span> <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> data =<span class=\"keyword\">await</span> fs.<span class=\"title function_\">readFile</span>(<span class=\"string\">&#x27;./1.txt&#x27;</span>,<span class=\"string\">&quot;utf8&quot;</span>);</span><br><span class=\"line\">    <span class=\"title function_\">expect</span>(data).<span class=\"property\">to</span>.<span class=\"title function_\">equal</span>(<span class=\"string\">&#x27;hello&#x27;</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"4-http测试\"><a href=\"#4-http测试\" class=\"headerlink\" title=\"4.http测试\"></a>4.http测试</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;supertest&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../app&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#test koa app&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> server = app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>);</span><br><span class=\"line\">    <span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#test server&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;#test GET /&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"title function_\">request</span>(server)</span><br><span class=\"line\">                .<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">                .<span class=\"title function_\">expect</span>(<span class=\"string\">&#x27;Content-Type&#x27;</span>, <span class=\"regexp\">/text\\/html/</span>)</span><br><span class=\"line\">                .<span class=\"title function_\">expect</span>(<span class=\"number\">200</span>, <span class=\"string\">&#x27;&lt;h1&gt;hello world&lt;/h1&gt;&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">after</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            server.<span class=\"title function_\">close</span>()</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"5-钩子函数\"><a href=\"#5-钩子函数\" class=\"headerlink\" title=\"5.钩子函数\"></a>5.钩子函数</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#hello.js&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;#sum()&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">before</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;before:&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">after</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;after.&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">beforeEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;  beforeEach:&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_\">afterEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;  afterEach.&#x27;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"Typora-写作神器","date":"2023-01-27T16:00:00.000Z","updated":"2023-01-31T07:16:58.472Z","type":"tags","description":"Typora","keywords":"软件推荐","top_img":"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9GMXVFSG84dEhzYXJmMUw5WTBidGV0a3UzbThPTFF5OW51RFpwaEhudDMyRWpoMUJHVUZ5cUd2emxicTRCaGZpYzJ3VFMxaWFrYTVpY1RHblN5OE1ZclpGZy82NDA?x-oss-process=image/format,png","cover":"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9GMXVFSG84dEhzYXJmMUw5WTBidGV0a3UzbThPTFF5OW51RFpwaEhudDMyRWpoMUJHVUZ5cUd2emxicTRCaGZpYzJ3VFMxaWFrYTVpY1RHblN5OE1ZclpGZy82NDA?x-oss-process=image/format,png","_content":"\nTypora 一直是我认为桌面端笔记应用应有的终极形态。「它的**功能之强大、设计之冷静、体验之美妙、理念之先进**，我认为值得所有笔记应用厂商学习。」\n\n但一件很尴尬的事情是，由于它极简的设计理念，有许多使用者并没能完全地了解到 Typora 的全部强大功能。我想在这篇文章中由浅入深地介绍 Typora 的功能亮点。无论你从未用过 Typora，还是已经体验了很久，我相信你都能在这篇文章中发现 Typora 新的惊喜。\n\n## Typora 是什么？\n\nTypora 是一款**支持实时预览的 Markdown 文本编辑器**。它有 OS X、Windows、Linux 三个平台的版本，并且由于仍在测试中，是**完全免费**的。\n\n在这篇文章中，我希望以「Typora 是什么」这个问题为线索，向大家全面介绍这款令人爱不释手的笔记应用。\n\n## 一个 Markdown 文本编辑器\n\nTypora 首先是一个 Markdown 文本编辑器，它支持且仅支持 Markdown 语法的文本编辑。在 [Typora 官网](https://sspai.com/link?target=https%3A%2F%2Ftypora.io%2F) 上他们将 Typora 描述为 「A truly **minimal** markdown editor. 」。\n\n![img](https://cdn.sspai.com/2019/05/24/49c4cdef47bf81018b9871a628523064.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)\n\n### 关于 Markdown\n\nMarkdown 是用来编写结构化文档的一种纯文本格式，它使我们在双手不离开键盘的情况下，可以对文本进行一定程度的格式排版。你可以在 [这篇文章](https://sspai.com/post/36610) 中快速入门 Markdown。\n\n由于目前还没有一个权威机构对 Markdown 的语法进行规范，各应用厂商制作时遵循的 Markdown 语法也是不尽相同的。其中比较受到认可的是 [GFM 标准](https://sspai.com/link?target=https%3A%2F%2Fgithub.github.com%2Fgfm%2F)，它是由著名代码托管网站 [GitHub](https://sspai.com/link?target=https%3A%2F%2Fgithub.com%2F) 所制定的。Typora 主要使用的也是 GFM 标准。同时，你还可以在 `文件 - 偏好设置 - Markdown 语法偏好 - 严格模式` 中将标准设置为「更严格地遵循 GFM 标准」。具体内容你可以在官方的 [这篇文档](https://sspai.com/link?target=http%3A%2F%2Fsupport.typora.io%2FStrict-Mode%2F) 中查看。\n\n![img](https://cdn.sspai.com/2019/05/24/a35f8fd5e9d968edfe5a0b02b54d0881.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)严格模式\n\n### 写得舒服\n\n一个文本编辑器，**写得舒服**是关键。我曾说过，「更有趣的是，一个笔记应用不会因为它支持 Markdown 语法而高级或易用很多。」，细枝末节处的人性化考虑才是最重要的。而 Typora 的编辑体验显然是经过深思熟虑设计的产物。\n\n我认为：一个优秀的笔记应用应该给用户**选择 Markdown 语法风格的权利**。而 Typora 在这一点上是我目前见过所有 Markdown 笔记应用中做得最好的。\n\n![img](https://cdn.sspai.com/2019/05/24/ea30087c6f93d0fa3c5a313c8cdce357.jpg?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)文本编辑设置\n\n通过打开 `文件 - 偏好设置` 你会发现 Typora 为编辑体验的考虑细致到了令人叹为观止的程度。Typora 中提供了大量有关 Markdown 偏好的设置，据此，你可以构建一个几乎完全适合自己的 Markdown 编辑器。下面我将依次介绍一些与文本编辑体验有关的功能亮点。\n\n#### 智能标点\n\n我认为「智能标点」是比较有趣的一点。它可以自动帮你将不是很美观的直引号 `\"` `'` 转化为更美观的弯引号 `“` `‘` `’` `”`。具体内容你可以在官方的 [这篇文档](https://sspai.com/link?target=http%3A%2F%2Fsupport.typora.io%2FSmartyPants%2F) 中查看。关于直弯引号在 macOS 上如何输入你也可以看 [这篇文章](https://sspai.com/post/38342)。\n\n#### 图片插入\n\nTypora 的图片插入功能是广受好评的。要知道，Markdown 原生不太注重图片插入的功能，但你可以在 Typora 中：\n\n- 直接使用 `右键 - 复制 Ctrl + V` 将网络图片、剪贴板图片复制到文档中\n- 拖动本地图片到文档中\n\nTypora 会自动帮你插入符合 Markdown 语法的图片语句，并给它加上标题。\n\n![img](https://cdn.sspai.com/2019/05/24/1de13eae43785e27bbbcd631931fd161.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)复制图片\n\n你也完全可以使用图床来保证文档在分享后图片仍能正常显示。\n\n更强大的是，Typora 支持在拖动或 `Ctrl + V` 网络图片后自动将其保存到本地。你可以在 `文件 - 偏好设置 - 编辑器 - 图片插入` 中选择复制到哪个路径，什么情况下需要复制。\n\n![img](https://cdn.sspai.com/2019/05/24/717da653ad91e938c5f1f40555b9c057.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)图片插入\n\n这一功能保证了即使网络图片源失效了，你还有本地的备份可用。同时也能使你的文档文件夹更合理、完整。\n\n#### 打字机模式和专注模式\n\n**「打字机模式」**使得你所编辑的那一行永远处于屏幕正中。\n\n**「专注模式」**使你正在编辑的那一行保留颜色，而其他行的字体呈灰色。\n\n你可以在 `视图 - 专注模式 / 打字机模式` 中勾选使用这两个模式。\n\n![img](https://cdn.sspai.com/2019/05/24/8b4e14ef732a23d4cc2a8fb1f8ec016c.gif)两种模式\n\n#### 实时预览\n\n我想很果断地下这个结论：到现在还不支持编辑界面实时预览的 Markdown 编辑器基本可以退出市场了。Typora 在这一方面显然已经领先了一大步——他们连 Markdown 语法的标记都在实时预览中消去了。当你离开正在编辑的有格式的文本段后，Typora 会自动隐藏 Markdown 标记，只留下**「所见即所得」**的美妙。*他们把这称为 Hybrid View。*\n\n![img](https://cdn.sspai.com/2019/05/24/f99c9ce02e2728ec6c64b443947fc67e.gif)所见即所得\n\n为了防止一些程序 bug 的发生（虽然在我使用下来感到是很少的）导致格式问题无法修改，Typora 保留了一个**「源代码模式」**。你可以通过 `视图 - 源代码模式` 或左下角的 `</>` 按钮进入。\n\n![img](https://cdn.sspai.com/2019/05/24/bcda9c4e35725b7297a6b90d8745564e.gif)源代码模式\n\n#### 大纲 / 文件侧边栏\n\n![img](https://cdn.sspai.com/2019/05/24/f2461efb5ac297facfcd9f72cc5da6be.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)侧边栏\n\nTypora 会根据你 Markdown 标记的 H1、H2、H3…… 各级标题为你呈现一个大纲。\n\n你也可以选择查看文件夹中的文件，但由于目前 Typora 只支持查看 md 文件，因此我认为文件侧边栏这个功能还是很鸡肋的。\n\n#### 空格与换行\n\nTypora 在空格与换行部分主要是使用 [CommonMark](https://sspai.com/link?target=http%3A%2F%2Fwww.commonmark.cn%2Fw%2F) 作为标注规范。与前文提到的 GFM 一样，CommonMark 也是比较流行的 Markdown 语言规范（解析器）之一。\n\n- **空格：**在输入连续的空格后，Typora 会在编辑器视图里为你保留这些空格，但当你打印或导出时，这些空格会被省略成一个。 \n  你可以在源代码模式下，为每个空格前加一个 `\\` 转义符，或者直接使用 HTML 风格的 `&nbps;` 来保持连续的空格。\n- **软换行：**需要说明的是，在 Markdown 语法中，换行（line break）与换段是不同的。且换行分为软换行和硬换行。在 Typora 中，你可以通过 `Shift + Enter` 完成一次软换行。软换行只在编辑界面可见，当文档被导出时换行会被省略。\n- **硬换行：**你可以通过 `空格 + 空格 + Shift + Enter` 完成一次硬换行，而这也是许多 Markdown 编辑器所原生支持的。硬换行在文档被导出时将被保留，且没有换段的段后距。\n- **换段：**你可以通过 `Enter` 完成一次换段。Typora 会自动帮你完成两次 `Shift + Enter` 的软换行，从而完成一次换段。这也意味着在 Markdown 语法下，换段是通过在段与段之间加入空行来实现的。\n- **Windows 风格（CR+LF）与 Unix 风格（CR）的换行符：**CR 表示回车 `\\r` ，即回到一行的开头，而 LF 表示换行 `\\n` ，即另起一行。 \n  所以 Windows 风格的换行符本质是「回车 + 换行」，而 Unix 风格的换行符是「换行」。这也是为什么 Unix / Mac 系统下的文件，如果在 Windows 系统直接打开会全部在同一行内。 你可以在 `文件 - 偏好设置 - 编辑器 - 默认换行符` 中对此进行切换。\n\n下附以上各空格、换行、换段的测试结果图。具体内容你可以在官网的 [这篇文档](https://sspai.com/link?target=http%3A%2F%2Fsupport.typora.io%2FLine-Break%2F) 中查阅。\n\n![img](https://cdn.sspai.com/2019/05/24/5c2fbaa53b27666a7fd0b07ac3e100bf.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)空格、换行、换段\n\n#### emoji 表情\n\n如今 emoji 表情越来越多地出现在一些网站文章中，但在桌面端（特别是 Windows 系统）文本编辑器上插入 emoji 是一件十分麻烦的事情。在使用 Typora 之前，我打出 emoji 表情的办法基本有两个：\n\n1. **输入法联想：**优点是比较方便，但会插入一张图片而不是一个字符，在许多情景下都不是很合适。 \n2. **复制 emoji 符号：**优点是能保证符号的形式，但显然每次用都需要去复制，比较麻烦。\n\n![img](https://cdn.sspai.com/2019/05/24/b2601a694aba07b8a68615ca59bcc495.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)输入法联想\n\n在 Typora 中，你可以用 `:emoji:` 的形式来打出 emoji，软件会自动给出图形的提示，还是比较好用的。\n\n![img](https://cdn.sspai.com/2019/05/24/ff26eeb5ff2d6fae16cab163ebfcd096.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)Typora 中输入 emoji\n\n## 一个学术文档编辑器\n\n除了基本的文本编辑体验极佳之外，Typora 还是一个非常优秀的学术文档编辑器。当然作为一个轻量级的、基于 Markdown 的编辑器，它不能与那些 LaTeX 编辑器相提并论，但它仍支持了许多可用于学术写作的功能。\n\n### LaTeX\n\n> LaTeX 是一种基于 TeX 的排版系统，由于它易于快速生成复杂表格和数学公式，非常适用于生成高印刷质量的科技和数学类文档。如果你常阅读数学、计算机等领域的学术论文，你一定对 LaTeX 不陌生。\n\nTypora 原生支持 LaTeX 语法，你有两种方式输入 LaTeX 风格的数学公式：\n\n1. **行内公式（inline）：**用 `$...$` 括起公式，公式会出现在行内。\n2. **块间公式（display）：**用 `$$...$$` 括起公式（注意 `$$` 后需要换行），公式会默认显示在行中间。\n\n具体的 LaTeX 语法在此不赘述了，你可以在 [这篇文章](https://sspai.com/link?target=https%3A%2F%2Fblog.csdn.net%2Fhappyday_d%2Farticle%2Fdetails%2F83715440) 中查看。\n\n### 代码高亮\n\nTypora 中代码的插入也可以分为行内和块间两种：\n\n1. 行内代码：用 ``...`` 或 ```...``` 括起代码，代码会以主题中设置的样式出现在行内，但不会实现代码高亮。\n2. 代码块：输入 ````` 后并输入语言名，换行，开始写代码，Typora 就会自动帮你实现代码高亮。Typora 原生支持许多编程语言代码块的语法高亮，基本日常常用的编程语言它都能很好地支持。 \n   除此以外，你也可以直接换行开始写，而后再选择语言。\n\n![img](https://cdn.sspai.com/2019/05/24/a8c283ba4f1ba09d41331b87e2eef3b9.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)代码块\n\n### 表格\n\n在 Markdown 中插入表格一直是一件比较头疼的事情。在一般的 Markdown 编辑器中，你可以通过以下的格式插入表格：\n\n```\n| 左对齐 | 右对齐 | 居中对齐 |\n| :-----| ----: | :----: |\n| 单元格 | 单元格 | 单元格 |\n| 单元格 | 单元格 | 单元格 |\n```\n\n乍一看还挺直观好用的是吧？但想想，一旦表格内容层次不齐，又或是表格长得难以下手，直接用键盘输入表格就显得十分麻烦和痛苦了。\n\n好在 Typora 为我们提供了图形界面的插入表格的功能，你只需要在行内 `鼠标右键 - 插入 - 表格` ，并输入行数和列数，Typora 就会自动生成一张样式不错的空表格。\n\n![img](https://cdn.sspai.com/2019/05/24/51bf2f290592e1ddbadb95765c04f297.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)Typora 表格\n\n### 链接引用与脚注\n\n**链接引用**类似于我们常在论文末尾看到的「参考文献」的写法，你可以通过 `[]:` 的语法来为你的文档加上链接引用。\n\n**脚注**在少数派的文章中也很常见，即某段话结尾右上角标有数字标记，页面底部进行注释的写法。你可以在需要插入脚注标号的位置写 `[^ number ]` ，再在下方通过 `[^ number ]:` 在文档中插入脚注。注意不要遗漏了脚注编号 `number` 前后的空格。\n\n![img](https://cdn.sspai.com/2019/05/24/5f82606e6d89fe1eb24705c4ca6b895d.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)链接引用和脚注\n\n### 文件系统\n\n除了前文提到的文件侧边栏，Typora 还提供了一些耦合度不高的文件系统。\n\n- **快速打开：**你可以通过 `文件 - 快速打开...` 或 `Ctrl + P` 快捷键快速打开最近的文档。\n- **保存：**Typora 支持自动保存，一般很少有写好的文档丢失的情况。同时它也提供了诸如「保存」、「另存为」、「保存全部打开的文件...」之类的功能。\n- **导入：**Typora 支持非常多的文件格式：.docx, .latex, .tex, .ltx, .rst, .rest, .org, .wiki, .dokuwiki, .textile, .opml, .epub。\n- **导出：**Typora 原生支持导出 PDF，HTML等格式。你可以根据软件内提示安装 **Pandoc 插件**来导出更多例如 docx，LaTeX 等格式。 \n\n![img](https://cdn.sspai.com/2019/05/24/ba295f21f0b71646bb36a0517e868ced.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)导出\n\n","source":"_posts/Typora.md","raw":"---\ntitle: Typora-写作神器\ndate: 2023-01-28 00:00:00\nupdated:\ntype: tags\ndescription: Typora\nkeywords: 软件推荐\ntop_img: https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9GMXVFSG84dEhzYXJmMUw5WTBidGV0a3UzbThPTFF5OW51RFpwaEhudDMyRWpoMUJHVUZ5cUd2emxicTRCaGZpYzJ3VFMxaWFrYTVpY1RHblN5OE1ZclpGZy82NDA?x-oss-process=image/format,png\ntags:\n- Typora\ncategories:\n- 软件推荐\ncover: https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9GMXVFSG84dEhzYXJmMUw5WTBidGV0a3UzbThPTFF5OW51RFpwaEhudDMyRWpoMUJHVUZ5cUd2emxicTRCaGZpYzJ3VFMxaWFrYTVpY1RHblN5OE1ZclpGZy82NDA?x-oss-process=image/format,png\n---\n\nTypora 一直是我认为桌面端笔记应用应有的终极形态。「它的**功能之强大、设计之冷静、体验之美妙、理念之先进**，我认为值得所有笔记应用厂商学习。」\n\n但一件很尴尬的事情是，由于它极简的设计理念，有许多使用者并没能完全地了解到 Typora 的全部强大功能。我想在这篇文章中由浅入深地介绍 Typora 的功能亮点。无论你从未用过 Typora，还是已经体验了很久，我相信你都能在这篇文章中发现 Typora 新的惊喜。\n\n## Typora 是什么？\n\nTypora 是一款**支持实时预览的 Markdown 文本编辑器**。它有 OS X、Windows、Linux 三个平台的版本，并且由于仍在测试中，是**完全免费**的。\n\n在这篇文章中，我希望以「Typora 是什么」这个问题为线索，向大家全面介绍这款令人爱不释手的笔记应用。\n\n## 一个 Markdown 文本编辑器\n\nTypora 首先是一个 Markdown 文本编辑器，它支持且仅支持 Markdown 语法的文本编辑。在 [Typora 官网](https://sspai.com/link?target=https%3A%2F%2Ftypora.io%2F) 上他们将 Typora 描述为 「A truly **minimal** markdown editor. 」。\n\n![img](https://cdn.sspai.com/2019/05/24/49c4cdef47bf81018b9871a628523064.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)\n\n### 关于 Markdown\n\nMarkdown 是用来编写结构化文档的一种纯文本格式，它使我们在双手不离开键盘的情况下，可以对文本进行一定程度的格式排版。你可以在 [这篇文章](https://sspai.com/post/36610) 中快速入门 Markdown。\n\n由于目前还没有一个权威机构对 Markdown 的语法进行规范，各应用厂商制作时遵循的 Markdown 语法也是不尽相同的。其中比较受到认可的是 [GFM 标准](https://sspai.com/link?target=https%3A%2F%2Fgithub.github.com%2Fgfm%2F)，它是由著名代码托管网站 [GitHub](https://sspai.com/link?target=https%3A%2F%2Fgithub.com%2F) 所制定的。Typora 主要使用的也是 GFM 标准。同时，你还可以在 `文件 - 偏好设置 - Markdown 语法偏好 - 严格模式` 中将标准设置为「更严格地遵循 GFM 标准」。具体内容你可以在官方的 [这篇文档](https://sspai.com/link?target=http%3A%2F%2Fsupport.typora.io%2FStrict-Mode%2F) 中查看。\n\n![img](https://cdn.sspai.com/2019/05/24/a35f8fd5e9d968edfe5a0b02b54d0881.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)严格模式\n\n### 写得舒服\n\n一个文本编辑器，**写得舒服**是关键。我曾说过，「更有趣的是，一个笔记应用不会因为它支持 Markdown 语法而高级或易用很多。」，细枝末节处的人性化考虑才是最重要的。而 Typora 的编辑体验显然是经过深思熟虑设计的产物。\n\n我认为：一个优秀的笔记应用应该给用户**选择 Markdown 语法风格的权利**。而 Typora 在这一点上是我目前见过所有 Markdown 笔记应用中做得最好的。\n\n![img](https://cdn.sspai.com/2019/05/24/ea30087c6f93d0fa3c5a313c8cdce357.jpg?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)文本编辑设置\n\n通过打开 `文件 - 偏好设置` 你会发现 Typora 为编辑体验的考虑细致到了令人叹为观止的程度。Typora 中提供了大量有关 Markdown 偏好的设置，据此，你可以构建一个几乎完全适合自己的 Markdown 编辑器。下面我将依次介绍一些与文本编辑体验有关的功能亮点。\n\n#### 智能标点\n\n我认为「智能标点」是比较有趣的一点。它可以自动帮你将不是很美观的直引号 `\"` `'` 转化为更美观的弯引号 `“` `‘` `’` `”`。具体内容你可以在官方的 [这篇文档](https://sspai.com/link?target=http%3A%2F%2Fsupport.typora.io%2FSmartyPants%2F) 中查看。关于直弯引号在 macOS 上如何输入你也可以看 [这篇文章](https://sspai.com/post/38342)。\n\n#### 图片插入\n\nTypora 的图片插入功能是广受好评的。要知道，Markdown 原生不太注重图片插入的功能，但你可以在 Typora 中：\n\n- 直接使用 `右键 - 复制 Ctrl + V` 将网络图片、剪贴板图片复制到文档中\n- 拖动本地图片到文档中\n\nTypora 会自动帮你插入符合 Markdown 语法的图片语句，并给它加上标题。\n\n![img](https://cdn.sspai.com/2019/05/24/1de13eae43785e27bbbcd631931fd161.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)复制图片\n\n你也完全可以使用图床来保证文档在分享后图片仍能正常显示。\n\n更强大的是，Typora 支持在拖动或 `Ctrl + V` 网络图片后自动将其保存到本地。你可以在 `文件 - 偏好设置 - 编辑器 - 图片插入` 中选择复制到哪个路径，什么情况下需要复制。\n\n![img](https://cdn.sspai.com/2019/05/24/717da653ad91e938c5f1f40555b9c057.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)图片插入\n\n这一功能保证了即使网络图片源失效了，你还有本地的备份可用。同时也能使你的文档文件夹更合理、完整。\n\n#### 打字机模式和专注模式\n\n**「打字机模式」**使得你所编辑的那一行永远处于屏幕正中。\n\n**「专注模式」**使你正在编辑的那一行保留颜色，而其他行的字体呈灰色。\n\n你可以在 `视图 - 专注模式 / 打字机模式` 中勾选使用这两个模式。\n\n![img](https://cdn.sspai.com/2019/05/24/8b4e14ef732a23d4cc2a8fb1f8ec016c.gif)两种模式\n\n#### 实时预览\n\n我想很果断地下这个结论：到现在还不支持编辑界面实时预览的 Markdown 编辑器基本可以退出市场了。Typora 在这一方面显然已经领先了一大步——他们连 Markdown 语法的标记都在实时预览中消去了。当你离开正在编辑的有格式的文本段后，Typora 会自动隐藏 Markdown 标记，只留下**「所见即所得」**的美妙。*他们把这称为 Hybrid View。*\n\n![img](https://cdn.sspai.com/2019/05/24/f99c9ce02e2728ec6c64b443947fc67e.gif)所见即所得\n\n为了防止一些程序 bug 的发生（虽然在我使用下来感到是很少的）导致格式问题无法修改，Typora 保留了一个**「源代码模式」**。你可以通过 `视图 - 源代码模式` 或左下角的 `</>` 按钮进入。\n\n![img](https://cdn.sspai.com/2019/05/24/bcda9c4e35725b7297a6b90d8745564e.gif)源代码模式\n\n#### 大纲 / 文件侧边栏\n\n![img](https://cdn.sspai.com/2019/05/24/f2461efb5ac297facfcd9f72cc5da6be.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)侧边栏\n\nTypora 会根据你 Markdown 标记的 H1、H2、H3…… 各级标题为你呈现一个大纲。\n\n你也可以选择查看文件夹中的文件，但由于目前 Typora 只支持查看 md 文件，因此我认为文件侧边栏这个功能还是很鸡肋的。\n\n#### 空格与换行\n\nTypora 在空格与换行部分主要是使用 [CommonMark](https://sspai.com/link?target=http%3A%2F%2Fwww.commonmark.cn%2Fw%2F) 作为标注规范。与前文提到的 GFM 一样，CommonMark 也是比较流行的 Markdown 语言规范（解析器）之一。\n\n- **空格：**在输入连续的空格后，Typora 会在编辑器视图里为你保留这些空格，但当你打印或导出时，这些空格会被省略成一个。 \n  你可以在源代码模式下，为每个空格前加一个 `\\` 转义符，或者直接使用 HTML 风格的 `&nbps;` 来保持连续的空格。\n- **软换行：**需要说明的是，在 Markdown 语法中，换行（line break）与换段是不同的。且换行分为软换行和硬换行。在 Typora 中，你可以通过 `Shift + Enter` 完成一次软换行。软换行只在编辑界面可见，当文档被导出时换行会被省略。\n- **硬换行：**你可以通过 `空格 + 空格 + Shift + Enter` 完成一次硬换行，而这也是许多 Markdown 编辑器所原生支持的。硬换行在文档被导出时将被保留，且没有换段的段后距。\n- **换段：**你可以通过 `Enter` 完成一次换段。Typora 会自动帮你完成两次 `Shift + Enter` 的软换行，从而完成一次换段。这也意味着在 Markdown 语法下，换段是通过在段与段之间加入空行来实现的。\n- **Windows 风格（CR+LF）与 Unix 风格（CR）的换行符：**CR 表示回车 `\\r` ，即回到一行的开头，而 LF 表示换行 `\\n` ，即另起一行。 \n  所以 Windows 风格的换行符本质是「回车 + 换行」，而 Unix 风格的换行符是「换行」。这也是为什么 Unix / Mac 系统下的文件，如果在 Windows 系统直接打开会全部在同一行内。 你可以在 `文件 - 偏好设置 - 编辑器 - 默认换行符` 中对此进行切换。\n\n下附以上各空格、换行、换段的测试结果图。具体内容你可以在官网的 [这篇文档](https://sspai.com/link?target=http%3A%2F%2Fsupport.typora.io%2FLine-Break%2F) 中查阅。\n\n![img](https://cdn.sspai.com/2019/05/24/5c2fbaa53b27666a7fd0b07ac3e100bf.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)空格、换行、换段\n\n#### emoji 表情\n\n如今 emoji 表情越来越多地出现在一些网站文章中，但在桌面端（特别是 Windows 系统）文本编辑器上插入 emoji 是一件十分麻烦的事情。在使用 Typora 之前，我打出 emoji 表情的办法基本有两个：\n\n1. **输入法联想：**优点是比较方便，但会插入一张图片而不是一个字符，在许多情景下都不是很合适。 \n2. **复制 emoji 符号：**优点是能保证符号的形式，但显然每次用都需要去复制，比较麻烦。\n\n![img](https://cdn.sspai.com/2019/05/24/b2601a694aba07b8a68615ca59bcc495.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)输入法联想\n\n在 Typora 中，你可以用 `:emoji:` 的形式来打出 emoji，软件会自动给出图形的提示，还是比较好用的。\n\n![img](https://cdn.sspai.com/2019/05/24/ff26eeb5ff2d6fae16cab163ebfcd096.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)Typora 中输入 emoji\n\n## 一个学术文档编辑器\n\n除了基本的文本编辑体验极佳之外，Typora 还是一个非常优秀的学术文档编辑器。当然作为一个轻量级的、基于 Markdown 的编辑器，它不能与那些 LaTeX 编辑器相提并论，但它仍支持了许多可用于学术写作的功能。\n\n### LaTeX\n\n> LaTeX 是一种基于 TeX 的排版系统，由于它易于快速生成复杂表格和数学公式，非常适用于生成高印刷质量的科技和数学类文档。如果你常阅读数学、计算机等领域的学术论文，你一定对 LaTeX 不陌生。\n\nTypora 原生支持 LaTeX 语法，你有两种方式输入 LaTeX 风格的数学公式：\n\n1. **行内公式（inline）：**用 `$...$` 括起公式，公式会出现在行内。\n2. **块间公式（display）：**用 `$$...$$` 括起公式（注意 `$$` 后需要换行），公式会默认显示在行中间。\n\n具体的 LaTeX 语法在此不赘述了，你可以在 [这篇文章](https://sspai.com/link?target=https%3A%2F%2Fblog.csdn.net%2Fhappyday_d%2Farticle%2Fdetails%2F83715440) 中查看。\n\n### 代码高亮\n\nTypora 中代码的插入也可以分为行内和块间两种：\n\n1. 行内代码：用 ``...`` 或 ```...``` 括起代码，代码会以主题中设置的样式出现在行内，但不会实现代码高亮。\n2. 代码块：输入 ````` 后并输入语言名，换行，开始写代码，Typora 就会自动帮你实现代码高亮。Typora 原生支持许多编程语言代码块的语法高亮，基本日常常用的编程语言它都能很好地支持。 \n   除此以外，你也可以直接换行开始写，而后再选择语言。\n\n![img](https://cdn.sspai.com/2019/05/24/a8c283ba4f1ba09d41331b87e2eef3b9.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)代码块\n\n### 表格\n\n在 Markdown 中插入表格一直是一件比较头疼的事情。在一般的 Markdown 编辑器中，你可以通过以下的格式插入表格：\n\n```\n| 左对齐 | 右对齐 | 居中对齐 |\n| :-----| ----: | :----: |\n| 单元格 | 单元格 | 单元格 |\n| 单元格 | 单元格 | 单元格 |\n```\n\n乍一看还挺直观好用的是吧？但想想，一旦表格内容层次不齐，又或是表格长得难以下手，直接用键盘输入表格就显得十分麻烦和痛苦了。\n\n好在 Typora 为我们提供了图形界面的插入表格的功能，你只需要在行内 `鼠标右键 - 插入 - 表格` ，并输入行数和列数，Typora 就会自动生成一张样式不错的空表格。\n\n![img](https://cdn.sspai.com/2019/05/24/51bf2f290592e1ddbadb95765c04f297.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)Typora 表格\n\n### 链接引用与脚注\n\n**链接引用**类似于我们常在论文末尾看到的「参考文献」的写法，你可以通过 `[]:` 的语法来为你的文档加上链接引用。\n\n**脚注**在少数派的文章中也很常见，即某段话结尾右上角标有数字标记，页面底部进行注释的写法。你可以在需要插入脚注标号的位置写 `[^ number ]` ，再在下方通过 `[^ number ]:` 在文档中插入脚注。注意不要遗漏了脚注编号 `number` 前后的空格。\n\n![img](https://cdn.sspai.com/2019/05/24/5f82606e6d89fe1eb24705c4ca6b895d.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)链接引用和脚注\n\n### 文件系统\n\n除了前文提到的文件侧边栏，Typora 还提供了一些耦合度不高的文件系统。\n\n- **快速打开：**你可以通过 `文件 - 快速打开...` 或 `Ctrl + P` 快捷键快速打开最近的文档。\n- **保存：**Typora 支持自动保存，一般很少有写好的文档丢失的情况。同时它也提供了诸如「保存」、「另存为」、「保存全部打开的文件...」之类的功能。\n- **导入：**Typora 支持非常多的文件格式：.docx, .latex, .tex, .ltx, .rst, .rest, .org, .wiki, .dokuwiki, .textile, .opml, .epub。\n- **导出：**Typora 原生支持导出 PDF，HTML等格式。你可以根据软件内提示安装 **Pandoc 插件**来导出更多例如 docx，LaTeX 等格式。 \n\n![img](https://cdn.sspai.com/2019/05/24/ba295f21f0b71646bb36a0517e868ced.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1)导出\n\n","slug":"Typora","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cldjztiw80001a5w0h7sy9dcf","content":"<p>Typora 一直是我认为桌面端笔记应用应有的终极形态。「它的<strong>功能之强大、设计之冷静、体验之美妙、理念之先进</strong>，我认为值得所有笔记应用厂商学习。」</p>\n<p>但一件很尴尬的事情是，由于它极简的设计理念，有许多使用者并没能完全地了解到 Typora 的全部强大功能。我想在这篇文章中由浅入深地介绍 Typora 的功能亮点。无论你从未用过 Typora，还是已经体验了很久，我相信你都能在这篇文章中发现 Typora 新的惊喜。</p>\n<h2 id=\"Typora-是什么？\"><a href=\"#Typora-是什么？\" class=\"headerlink\" title=\"Typora 是什么？\"></a>Typora 是什么？</h2><p>Typora 是一款<strong>支持实时预览的 Markdown 文本编辑器</strong>。它有 OS X、Windows、Linux 三个平台的版本，并且由于仍在测试中，是<strong>完全免费</strong>的。</p>\n<p>在这篇文章中，我希望以「Typora 是什么」这个问题为线索，向大家全面介绍这款令人爱不释手的笔记应用。</p>\n<h2 id=\"一个-Markdown-文本编辑器\"><a href=\"#一个-Markdown-文本编辑器\" class=\"headerlink\" title=\"一个 Markdown 文本编辑器\"></a>一个 Markdown 文本编辑器</h2><p>Typora 首先是一个 Markdown 文本编辑器，它支持且仅支持 Markdown 语法的文本编辑。在 <a href=\"https://sspai.com/link?target=https://typora.io/\">Typora 官网</a> 上他们将 Typora 描述为 「A truly <strong>minimal</strong> markdown editor. 」。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/49c4cdef47bf81018b9871a628523064.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\"></p>\n<h3 id=\"关于-Markdown\"><a href=\"#关于-Markdown\" class=\"headerlink\" title=\"关于 Markdown\"></a>关于 Markdown</h3><p>Markdown 是用来编写结构化文档的一种纯文本格式，它使我们在双手不离开键盘的情况下，可以对文本进行一定程度的格式排版。你可以在 <a href=\"https://sspai.com/post/36610\">这篇文章</a> 中快速入门 Markdown。</p>\n<p>由于目前还没有一个权威机构对 Markdown 的语法进行规范，各应用厂商制作时遵循的 Markdown 语法也是不尽相同的。其中比较受到认可的是 <a href=\"https://sspai.com/link?target=https://github.github.com/gfm/\">GFM 标准</a>，它是由著名代码托管网站 <a href=\"https://sspai.com/link?target=https://github.com/\">GitHub</a> 所制定的。Typora 主要使用的也是 GFM 标准。同时，你还可以在 <code>文件 - 偏好设置 - Markdown 语法偏好 - 严格模式</code> 中将标准设置为「更严格地遵循 GFM 标准」。具体内容你可以在官方的 <a href=\"https://sspai.com/link?target=http://support.typora.io/Strict-Mode/\">这篇文档</a> 中查看。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/a35f8fd5e9d968edfe5a0b02b54d0881.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">严格模式</p>\n<h3 id=\"写得舒服\"><a href=\"#写得舒服\" class=\"headerlink\" title=\"写得舒服\"></a>写得舒服</h3><p>一个文本编辑器，<strong>写得舒服</strong>是关键。我曾说过，「更有趣的是，一个笔记应用不会因为它支持 Markdown 语法而高级或易用很多。」，细枝末节处的人性化考虑才是最重要的。而 Typora 的编辑体验显然是经过深思熟虑设计的产物。</p>\n<p>我认为：一个优秀的笔记应用应该给用户<strong>选择 Markdown 语法风格的权利</strong>。而 Typora 在这一点上是我目前见过所有 Markdown 笔记应用中做得最好的。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/ea30087c6f93d0fa3c5a313c8cdce357.jpg?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">文本编辑设置</p>\n<p>通过打开 <code>文件 - 偏好设置</code> 你会发现 Typora 为编辑体验的考虑细致到了令人叹为观止的程度。Typora 中提供了大量有关 Markdown 偏好的设置，据此，你可以构建一个几乎完全适合自己的 Markdown 编辑器。下面我将依次介绍一些与文本编辑体验有关的功能亮点。</p>\n<h4 id=\"智能标点\"><a href=\"#智能标点\" class=\"headerlink\" title=\"智能标点\"></a>智能标点</h4><p>我认为「智能标点」是比较有趣的一点。它可以自动帮你将不是很美观的直引号 <code>&quot;</code> <code>&#39;</code> 转化为更美观的弯引号 <code>“</code> <code>‘</code> <code>’</code> <code>”</code>。具体内容你可以在官方的 <a href=\"https://sspai.com/link?target=http://support.typora.io/SmartyPants/\">这篇文档</a> 中查看。关于直弯引号在 macOS 上如何输入你也可以看 <a href=\"https://sspai.com/post/38342\">这篇文章</a>。</p>\n<h4 id=\"图片插入\"><a href=\"#图片插入\" class=\"headerlink\" title=\"图片插入\"></a>图片插入</h4><p>Typora 的图片插入功能是广受好评的。要知道，Markdown 原生不太注重图片插入的功能，但你可以在 Typora 中：</p>\n<ul>\n<li>直接使用 <code>右键 - 复制 Ctrl + V</code> 将网络图片、剪贴板图片复制到文档中</li>\n<li>拖动本地图片到文档中</li>\n</ul>\n<p>Typora 会自动帮你插入符合 Markdown 语法的图片语句，并给它加上标题。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/1de13eae43785e27bbbcd631931fd161.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">复制图片</p>\n<p>你也完全可以使用图床来保证文档在分享后图片仍能正常显示。</p>\n<p>更强大的是，Typora 支持在拖动或 <code>Ctrl + V</code> 网络图片后自动将其保存到本地。你可以在 <code>文件 - 偏好设置 - 编辑器 - 图片插入</code> 中选择复制到哪个路径，什么情况下需要复制。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/717da653ad91e938c5f1f40555b9c057.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">图片插入</p>\n<p>这一功能保证了即使网络图片源失效了，你还有本地的备份可用。同时也能使你的文档文件夹更合理、完整。</p>\n<h4 id=\"打字机模式和专注模式\"><a href=\"#打字机模式和专注模式\" class=\"headerlink\" title=\"打字机模式和专注模式\"></a>打字机模式和专注模式</h4><p><strong>「打字机模式」</strong>使得你所编辑的那一行永远处于屏幕正中。</p>\n<p><strong>「专注模式」</strong>使你正在编辑的那一行保留颜色，而其他行的字体呈灰色。</p>\n<p>你可以在 <code>视图 - 专注模式 / 打字机模式</code> 中勾选使用这两个模式。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/8b4e14ef732a23d4cc2a8fb1f8ec016c.gif\" alt=\"img\">两种模式</p>\n<h4 id=\"实时预览\"><a href=\"#实时预览\" class=\"headerlink\" title=\"实时预览\"></a>实时预览</h4><p>我想很果断地下这个结论：到现在还不支持编辑界面实时预览的 Markdown 编辑器基本可以退出市场了。Typora 在这一方面显然已经领先了一大步——他们连 Markdown 语法的标记都在实时预览中消去了。当你离开正在编辑的有格式的文本段后，Typora 会自动隐藏 Markdown 标记，只留下<strong>「所见即所得」</strong>的美妙。<em>他们把这称为 Hybrid View。</em></p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/f99c9ce02e2728ec6c64b443947fc67e.gif\" alt=\"img\">所见即所得</p>\n<p>为了防止一些程序 bug 的发生（虽然在我使用下来感到是很少的）导致格式问题无法修改，Typora 保留了一个<strong>「源代码模式」</strong>。你可以通过 <code>视图 - 源代码模式</code> 或左下角的 <code>&lt;/&gt;</code> 按钮进入。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/bcda9c4e35725b7297a6b90d8745564e.gif\" alt=\"img\">源代码模式</p>\n<h4 id=\"大纲-文件侧边栏\"><a href=\"#大纲-文件侧边栏\" class=\"headerlink\" title=\"大纲 / 文件侧边栏\"></a>大纲 / 文件侧边栏</h4><p><img src=\"https://cdn.sspai.com/2019/05/24/f2461efb5ac297facfcd9f72cc5da6be.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">侧边栏</p>\n<p>Typora 会根据你 Markdown 标记的 H1、H2、H3…… 各级标题为你呈现一个大纲。</p>\n<p>你也可以选择查看文件夹中的文件，但由于目前 Typora 只支持查看 md 文件，因此我认为文件侧边栏这个功能还是很鸡肋的。</p>\n<h4 id=\"空格与换行\"><a href=\"#空格与换行\" class=\"headerlink\" title=\"空格与换行\"></a>空格与换行</h4><p>Typora 在空格与换行部分主要是使用 <a href=\"https://sspai.com/link?target=http://www.commonmark.cn/w/\">CommonMark</a> 作为标注规范。与前文提到的 GFM 一样，CommonMark 也是比较流行的 Markdown 语言规范（解析器）之一。</p>\n<ul>\n<li><strong>空格：</strong>在输入连续的空格后，Typora 会在编辑器视图里为你保留这些空格，但当你打印或导出时，这些空格会被省略成一个。<br>你可以在源代码模式下，为每个空格前加一个 <code>\\</code> 转义符，或者直接使用 HTML 风格的 <code>&amp;nbps;</code> 来保持连续的空格。</li>\n<li><strong>软换行：</strong>需要说明的是，在 Markdown 语法中，换行（line break）与换段是不同的。且换行分为软换行和硬换行。在 Typora 中，你可以通过 <code>Shift + Enter</code> 完成一次软换行。软换行只在编辑界面可见，当文档被导出时换行会被省略。</li>\n<li><strong>硬换行：</strong>你可以通过 <code>空格 + 空格 + Shift + Enter</code> 完成一次硬换行，而这也是许多 Markdown 编辑器所原生支持的。硬换行在文档被导出时将被保留，且没有换段的段后距。</li>\n<li><strong>换段：</strong>你可以通过 <code>Enter</code> 完成一次换段。Typora 会自动帮你完成两次 <code>Shift + Enter</code> 的软换行，从而完成一次换段。这也意味着在 Markdown 语法下，换段是通过在段与段之间加入空行来实现的。</li>\n<li><strong>Windows 风格（CR+LF）与 Unix 风格（CR）的换行符：</strong>CR 表示回车 <code>\\r</code> ，即回到一行的开头，而 LF 表示换行 <code>\\n</code> ，即另起一行。<br>所以 Windows 风格的换行符本质是「回车 + 换行」，而 Unix 风格的换行符是「换行」。这也是为什么 Unix / Mac 系统下的文件，如果在 Windows 系统直接打开会全部在同一行内。 你可以在 <code>文件 - 偏好设置 - 编辑器 - 默认换行符</code> 中对此进行切换。</li>\n</ul>\n<p>下附以上各空格、换行、换段的测试结果图。具体内容你可以在官网的 <a href=\"https://sspai.com/link?target=http://support.typora.io/Line-Break/\">这篇文档</a> 中查阅。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/5c2fbaa53b27666a7fd0b07ac3e100bf.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">空格、换行、换段</p>\n<h4 id=\"emoji-表情\"><a href=\"#emoji-表情\" class=\"headerlink\" title=\"emoji 表情\"></a>emoji 表情</h4><p>如今 emoji 表情越来越多地出现在一些网站文章中，但在桌面端（特别是 Windows 系统）文本编辑器上插入 emoji 是一件十分麻烦的事情。在使用 Typora 之前，我打出 emoji 表情的办法基本有两个：</p>\n<ol>\n<li><strong>输入法联想：</strong>优点是比较方便，但会插入一张图片而不是一个字符，在许多情景下都不是很合适。 </li>\n<li><strong>复制 emoji 符号：</strong>优点是能保证符号的形式，但显然每次用都需要去复制，比较麻烦。</li>\n</ol>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/b2601a694aba07b8a68615ca59bcc495.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">输入法联想</p>\n<p>在 Typora 中，你可以用 <code>:emoji:</code> 的形式来打出 emoji，软件会自动给出图形的提示，还是比较好用的。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/ff26eeb5ff2d6fae16cab163ebfcd096.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">Typora 中输入 emoji</p>\n<h2 id=\"一个学术文档编辑器\"><a href=\"#一个学术文档编辑器\" class=\"headerlink\" title=\"一个学术文档编辑器\"></a>一个学术文档编辑器</h2><p>除了基本的文本编辑体验极佳之外，Typora 还是一个非常优秀的学术文档编辑器。当然作为一个轻量级的、基于 Markdown 的编辑器，它不能与那些 LaTeX 编辑器相提并论，但它仍支持了许多可用于学术写作的功能。</p>\n<h3 id=\"LaTeX\"><a href=\"#LaTeX\" class=\"headerlink\" title=\"LaTeX\"></a>LaTeX</h3><blockquote>\n<p>LaTeX 是一种基于 TeX 的排版系统，由于它易于快速生成复杂表格和数学公式，非常适用于生成高印刷质量的科技和数学类文档。如果你常阅读数学、计算机等领域的学术论文，你一定对 LaTeX 不陌生。</p>\n</blockquote>\n<p>Typora 原生支持 LaTeX 语法，你有两种方式输入 LaTeX 风格的数学公式：</p>\n<ol>\n<li><strong>行内公式（inline）：</strong>用 <code>$...$</code> 括起公式，公式会出现在行内。</li>\n<li><strong>块间公式（display）：</strong>用 <code>$$...$$</code> 括起公式（注意 <code>$$</code> 后需要换行），公式会默认显示在行中间。</li>\n</ol>\n<p>具体的 LaTeX 语法在此不赘述了，你可以在 <a href=\"https://sspai.com/link?target=https://blog.csdn.net/happyday_d/article/details/83715440\">这篇文章</a> 中查看。</p>\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>Typora 中代码的插入也可以分为行内和块间两种：</p>\n<ol>\n<li>行内代码：用 <code>...</code> 或 <code>...</code> 括起代码，代码会以主题中设置的样式出现在行内，但不会实现代码高亮。</li>\n<li>代码块：输入 ````` 后并输入语言名，换行，开始写代码，Typora 就会自动帮你实现代码高亮。Typora 原生支持许多编程语言代码块的语法高亮，基本日常常用的编程语言它都能很好地支持。<br>除此以外，你也可以直接换行开始写，而后再选择语言。</li>\n</ol>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/a8c283ba4f1ba09d41331b87e2eef3b9.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">代码块</p>\n<h3 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h3><p>在 Markdown 中插入表格一直是一件比较头疼的事情。在一般的 Markdown 编辑器中，你可以通过以下的格式插入表格：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| 左对齐 | 右对齐 | 居中对齐 |</span><br><span class=\"line\">| :-----| ----: | :----: |</span><br><span class=\"line\">| 单元格 | 单元格 | 单元格 |</span><br><span class=\"line\">| 单元格 | 单元格 | 单元格 |</span><br></pre></td></tr></table></figure>\n\n<p>乍一看还挺直观好用的是吧？但想想，一旦表格内容层次不齐，又或是表格长得难以下手，直接用键盘输入表格就显得十分麻烦和痛苦了。</p>\n<p>好在 Typora 为我们提供了图形界面的插入表格的功能，你只需要在行内 <code>鼠标右键 - 插入 - 表格</code> ，并输入行数和列数，Typora 就会自动生成一张样式不错的空表格。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/51bf2f290592e1ddbadb95765c04f297.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">Typora 表格</p>\n<h3 id=\"链接引用与脚注\"><a href=\"#链接引用与脚注\" class=\"headerlink\" title=\"链接引用与脚注\"></a>链接引用与脚注</h3><p><strong>链接引用</strong>类似于我们常在论文末尾看到的「参考文献」的写法，你可以通过 <code>[]:</code> 的语法来为你的文档加上链接引用。</p>\n<p><strong>脚注</strong>在少数派的文章中也很常见，即某段话结尾右上角标有数字标记，页面底部进行注释的写法。你可以在需要插入脚注标号的位置写 <code>[^ number ]</code> ，再在下方通过 <code>[^ number ]:</code> 在文档中插入脚注。注意不要遗漏了脚注编号 <code>number</code> 前后的空格。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/5f82606e6d89fe1eb24705c4ca6b895d.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">链接引用和脚注</p>\n<h3 id=\"文件系统\"><a href=\"#文件系统\" class=\"headerlink\" title=\"文件系统\"></a>文件系统</h3><p>除了前文提到的文件侧边栏，Typora 还提供了一些耦合度不高的文件系统。</p>\n<ul>\n<li><strong>快速打开：</strong>你可以通过 <code>文件 - 快速打开...</code> 或 <code>Ctrl + P</code> 快捷键快速打开最近的文档。</li>\n<li><strong>保存：</strong>Typora 支持自动保存，一般很少有写好的文档丢失的情况。同时它也提供了诸如「保存」、「另存为」、「保存全部打开的文件…」之类的功能。</li>\n<li><strong>导入：</strong>Typora 支持非常多的文件格式：.docx, .latex, .tex, .ltx, .rst, .rest, .org, .wiki, .dokuwiki, .textile, .opml, .epub。</li>\n<li><strong>导出：</strong>Typora 原生支持导出 PDF，HTML等格式。你可以根据软件内提示安装 <strong>Pandoc 插件</strong>来导出更多例如 docx，LaTeX 等格式。 </li>\n</ul>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/ba295f21f0b71646bb36a0517e868ced.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">导出</p>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<p>Typora 一直是我认为桌面端笔记应用应有的终极形态。「它的<strong>功能之强大、设计之冷静、体验之美妙、理念之先进</strong>，我认为值得所有笔记应用厂商学习。」</p>\n<p>但一件很尴尬的事情是，由于它极简的设计理念，有许多使用者并没能完全地了解到 Typora 的全部强大功能。我想在这篇文章中由浅入深地介绍 Typora 的功能亮点。无论你从未用过 Typora，还是已经体验了很久，我相信你都能在这篇文章中发现 Typora 新的惊喜。</p>\n<h2 id=\"Typora-是什么？\"><a href=\"#Typora-是什么？\" class=\"headerlink\" title=\"Typora 是什么？\"></a>Typora 是什么？</h2><p>Typora 是一款<strong>支持实时预览的 Markdown 文本编辑器</strong>。它有 OS X、Windows、Linux 三个平台的版本，并且由于仍在测试中，是<strong>完全免费</strong>的。</p>\n<p>在这篇文章中，我希望以「Typora 是什么」这个问题为线索，向大家全面介绍这款令人爱不释手的笔记应用。</p>\n<h2 id=\"一个-Markdown-文本编辑器\"><a href=\"#一个-Markdown-文本编辑器\" class=\"headerlink\" title=\"一个 Markdown 文本编辑器\"></a>一个 Markdown 文本编辑器</h2><p>Typora 首先是一个 Markdown 文本编辑器，它支持且仅支持 Markdown 语法的文本编辑。在 <a href=\"https://sspai.com/link?target=https://typora.io/\">Typora 官网</a> 上他们将 Typora 描述为 「A truly <strong>minimal</strong> markdown editor. 」。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/49c4cdef47bf81018b9871a628523064.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\"></p>\n<h3 id=\"关于-Markdown\"><a href=\"#关于-Markdown\" class=\"headerlink\" title=\"关于 Markdown\"></a>关于 Markdown</h3><p>Markdown 是用来编写结构化文档的一种纯文本格式，它使我们在双手不离开键盘的情况下，可以对文本进行一定程度的格式排版。你可以在 <a href=\"https://sspai.com/post/36610\">这篇文章</a> 中快速入门 Markdown。</p>\n<p>由于目前还没有一个权威机构对 Markdown 的语法进行规范，各应用厂商制作时遵循的 Markdown 语法也是不尽相同的。其中比较受到认可的是 <a href=\"https://sspai.com/link?target=https://github.github.com/gfm/\">GFM 标准</a>，它是由著名代码托管网站 <a href=\"https://sspai.com/link?target=https://github.com/\">GitHub</a> 所制定的。Typora 主要使用的也是 GFM 标准。同时，你还可以在 <code>文件 - 偏好设置 - Markdown 语法偏好 - 严格模式</code> 中将标准设置为「更严格地遵循 GFM 标准」。具体内容你可以在官方的 <a href=\"https://sspai.com/link?target=http://support.typora.io/Strict-Mode/\">这篇文档</a> 中查看。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/a35f8fd5e9d968edfe5a0b02b54d0881.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">严格模式</p>\n<h3 id=\"写得舒服\"><a href=\"#写得舒服\" class=\"headerlink\" title=\"写得舒服\"></a>写得舒服</h3><p>一个文本编辑器，<strong>写得舒服</strong>是关键。我曾说过，「更有趣的是，一个笔记应用不会因为它支持 Markdown 语法而高级或易用很多。」，细枝末节处的人性化考虑才是最重要的。而 Typora 的编辑体验显然是经过深思熟虑设计的产物。</p>\n<p>我认为：一个优秀的笔记应用应该给用户<strong>选择 Markdown 语法风格的权利</strong>。而 Typora 在这一点上是我目前见过所有 Markdown 笔记应用中做得最好的。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/ea30087c6f93d0fa3c5a313c8cdce357.jpg?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">文本编辑设置</p>\n<p>通过打开 <code>文件 - 偏好设置</code> 你会发现 Typora 为编辑体验的考虑细致到了令人叹为观止的程度。Typora 中提供了大量有关 Markdown 偏好的设置，据此，你可以构建一个几乎完全适合自己的 Markdown 编辑器。下面我将依次介绍一些与文本编辑体验有关的功能亮点。</p>\n<h4 id=\"智能标点\"><a href=\"#智能标点\" class=\"headerlink\" title=\"智能标点\"></a>智能标点</h4><p>我认为「智能标点」是比较有趣的一点。它可以自动帮你将不是很美观的直引号 <code>&quot;</code> <code>&#39;</code> 转化为更美观的弯引号 <code>“</code> <code>‘</code> <code>’</code> <code>”</code>。具体内容你可以在官方的 <a href=\"https://sspai.com/link?target=http://support.typora.io/SmartyPants/\">这篇文档</a> 中查看。关于直弯引号在 macOS 上如何输入你也可以看 <a href=\"https://sspai.com/post/38342\">这篇文章</a>。</p>\n<h4 id=\"图片插入\"><a href=\"#图片插入\" class=\"headerlink\" title=\"图片插入\"></a>图片插入</h4><p>Typora 的图片插入功能是广受好评的。要知道，Markdown 原生不太注重图片插入的功能，但你可以在 Typora 中：</p>\n<ul>\n<li>直接使用 <code>右键 - 复制 Ctrl + V</code> 将网络图片、剪贴板图片复制到文档中</li>\n<li>拖动本地图片到文档中</li>\n</ul>\n<p>Typora 会自动帮你插入符合 Markdown 语法的图片语句，并给它加上标题。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/1de13eae43785e27bbbcd631931fd161.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">复制图片</p>\n<p>你也完全可以使用图床来保证文档在分享后图片仍能正常显示。</p>\n<p>更强大的是，Typora 支持在拖动或 <code>Ctrl + V</code> 网络图片后自动将其保存到本地。你可以在 <code>文件 - 偏好设置 - 编辑器 - 图片插入</code> 中选择复制到哪个路径，什么情况下需要复制。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/717da653ad91e938c5f1f40555b9c057.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">图片插入</p>\n<p>这一功能保证了即使网络图片源失效了，你还有本地的备份可用。同时也能使你的文档文件夹更合理、完整。</p>\n<h4 id=\"打字机模式和专注模式\"><a href=\"#打字机模式和专注模式\" class=\"headerlink\" title=\"打字机模式和专注模式\"></a>打字机模式和专注模式</h4><p><strong>「打字机模式」</strong>使得你所编辑的那一行永远处于屏幕正中。</p>\n<p><strong>「专注模式」</strong>使你正在编辑的那一行保留颜色，而其他行的字体呈灰色。</p>\n<p>你可以在 <code>视图 - 专注模式 / 打字机模式</code> 中勾选使用这两个模式。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/8b4e14ef732a23d4cc2a8fb1f8ec016c.gif\" alt=\"img\">两种模式</p>\n<h4 id=\"实时预览\"><a href=\"#实时预览\" class=\"headerlink\" title=\"实时预览\"></a>实时预览</h4><p>我想很果断地下这个结论：到现在还不支持编辑界面实时预览的 Markdown 编辑器基本可以退出市场了。Typora 在这一方面显然已经领先了一大步——他们连 Markdown 语法的标记都在实时预览中消去了。当你离开正在编辑的有格式的文本段后，Typora 会自动隐藏 Markdown 标记，只留下<strong>「所见即所得」</strong>的美妙。<em>他们把这称为 Hybrid View。</em></p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/f99c9ce02e2728ec6c64b443947fc67e.gif\" alt=\"img\">所见即所得</p>\n<p>为了防止一些程序 bug 的发生（虽然在我使用下来感到是很少的）导致格式问题无法修改，Typora 保留了一个<strong>「源代码模式」</strong>。你可以通过 <code>视图 - 源代码模式</code> 或左下角的 <code>&lt;/&gt;</code> 按钮进入。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/bcda9c4e35725b7297a6b90d8745564e.gif\" alt=\"img\">源代码模式</p>\n<h4 id=\"大纲-文件侧边栏\"><a href=\"#大纲-文件侧边栏\" class=\"headerlink\" title=\"大纲 / 文件侧边栏\"></a>大纲 / 文件侧边栏</h4><p><img src=\"https://cdn.sspai.com/2019/05/24/f2461efb5ac297facfcd9f72cc5da6be.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">侧边栏</p>\n<p>Typora 会根据你 Markdown 标记的 H1、H2、H3…… 各级标题为你呈现一个大纲。</p>\n<p>你也可以选择查看文件夹中的文件，但由于目前 Typora 只支持查看 md 文件，因此我认为文件侧边栏这个功能还是很鸡肋的。</p>\n<h4 id=\"空格与换行\"><a href=\"#空格与换行\" class=\"headerlink\" title=\"空格与换行\"></a>空格与换行</h4><p>Typora 在空格与换行部分主要是使用 <a href=\"https://sspai.com/link?target=http://www.commonmark.cn/w/\">CommonMark</a> 作为标注规范。与前文提到的 GFM 一样，CommonMark 也是比较流行的 Markdown 语言规范（解析器）之一。</p>\n<ul>\n<li><strong>空格：</strong>在输入连续的空格后，Typora 会在编辑器视图里为你保留这些空格，但当你打印或导出时，这些空格会被省略成一个。<br>你可以在源代码模式下，为每个空格前加一个 <code>\\</code> 转义符，或者直接使用 HTML 风格的 <code>&amp;nbps;</code> 来保持连续的空格。</li>\n<li><strong>软换行：</strong>需要说明的是，在 Markdown 语法中，换行（line break）与换段是不同的。且换行分为软换行和硬换行。在 Typora 中，你可以通过 <code>Shift + Enter</code> 完成一次软换行。软换行只在编辑界面可见，当文档被导出时换行会被省略。</li>\n<li><strong>硬换行：</strong>你可以通过 <code>空格 + 空格 + Shift + Enter</code> 完成一次硬换行，而这也是许多 Markdown 编辑器所原生支持的。硬换行在文档被导出时将被保留，且没有换段的段后距。</li>\n<li><strong>换段：</strong>你可以通过 <code>Enter</code> 完成一次换段。Typora 会自动帮你完成两次 <code>Shift + Enter</code> 的软换行，从而完成一次换段。这也意味着在 Markdown 语法下，换段是通过在段与段之间加入空行来实现的。</li>\n<li><strong>Windows 风格（CR+LF）与 Unix 风格（CR）的换行符：</strong>CR 表示回车 <code>\\r</code> ，即回到一行的开头，而 LF 表示换行 <code>\\n</code> ，即另起一行。<br>所以 Windows 风格的换行符本质是「回车 + 换行」，而 Unix 风格的换行符是「换行」。这也是为什么 Unix / Mac 系统下的文件，如果在 Windows 系统直接打开会全部在同一行内。 你可以在 <code>文件 - 偏好设置 - 编辑器 - 默认换行符</code> 中对此进行切换。</li>\n</ul>\n<p>下附以上各空格、换行、换段的测试结果图。具体内容你可以在官网的 <a href=\"https://sspai.com/link?target=http://support.typora.io/Line-Break/\">这篇文档</a> 中查阅。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/5c2fbaa53b27666a7fd0b07ac3e100bf.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">空格、换行、换段</p>\n<h4 id=\"emoji-表情\"><a href=\"#emoji-表情\" class=\"headerlink\" title=\"emoji 表情\"></a>emoji 表情</h4><p>如今 emoji 表情越来越多地出现在一些网站文章中，但在桌面端（特别是 Windows 系统）文本编辑器上插入 emoji 是一件十分麻烦的事情。在使用 Typora 之前，我打出 emoji 表情的办法基本有两个：</p>\n<ol>\n<li><strong>输入法联想：</strong>优点是比较方便，但会插入一张图片而不是一个字符，在许多情景下都不是很合适。 </li>\n<li><strong>复制 emoji 符号：</strong>优点是能保证符号的形式，但显然每次用都需要去复制，比较麻烦。</li>\n</ol>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/b2601a694aba07b8a68615ca59bcc495.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">输入法联想</p>\n<p>在 Typora 中，你可以用 <code>:emoji:</code> 的形式来打出 emoji，软件会自动给出图形的提示，还是比较好用的。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/ff26eeb5ff2d6fae16cab163ebfcd096.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">Typora 中输入 emoji</p>\n<h2 id=\"一个学术文档编辑器\"><a href=\"#一个学术文档编辑器\" class=\"headerlink\" title=\"一个学术文档编辑器\"></a>一个学术文档编辑器</h2><p>除了基本的文本编辑体验极佳之外，Typora 还是一个非常优秀的学术文档编辑器。当然作为一个轻量级的、基于 Markdown 的编辑器，它不能与那些 LaTeX 编辑器相提并论，但它仍支持了许多可用于学术写作的功能。</p>\n<h3 id=\"LaTeX\"><a href=\"#LaTeX\" class=\"headerlink\" title=\"LaTeX\"></a>LaTeX</h3><blockquote>\n<p>LaTeX 是一种基于 TeX 的排版系统，由于它易于快速生成复杂表格和数学公式，非常适用于生成高印刷质量的科技和数学类文档。如果你常阅读数学、计算机等领域的学术论文，你一定对 LaTeX 不陌生。</p>\n</blockquote>\n<p>Typora 原生支持 LaTeX 语法，你有两种方式输入 LaTeX 风格的数学公式：</p>\n<ol>\n<li><strong>行内公式（inline）：</strong>用 <code>$...$</code> 括起公式，公式会出现在行内。</li>\n<li><strong>块间公式（display）：</strong>用 <code>$$...$$</code> 括起公式（注意 <code>$$</code> 后需要换行），公式会默认显示在行中间。</li>\n</ol>\n<p>具体的 LaTeX 语法在此不赘述了，你可以在 <a href=\"https://sspai.com/link?target=https://blog.csdn.net/happyday_d/article/details/83715440\">这篇文章</a> 中查看。</p>\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>Typora 中代码的插入也可以分为行内和块间两种：</p>\n<ol>\n<li>行内代码：用 <code>...</code> 或 <code>...</code> 括起代码，代码会以主题中设置的样式出现在行内，但不会实现代码高亮。</li>\n<li>代码块：输入 ````` 后并输入语言名，换行，开始写代码，Typora 就会自动帮你实现代码高亮。Typora 原生支持许多编程语言代码块的语法高亮，基本日常常用的编程语言它都能很好地支持。<br>除此以外，你也可以直接换行开始写，而后再选择语言。</li>\n</ol>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/a8c283ba4f1ba09d41331b87e2eef3b9.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">代码块</p>\n<h3 id=\"表格\"><a href=\"#表格\" class=\"headerlink\" title=\"表格\"></a>表格</h3><p>在 Markdown 中插入表格一直是一件比较头疼的事情。在一般的 Markdown 编辑器中，你可以通过以下的格式插入表格：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| 左对齐 | 右对齐 | 居中对齐 |</span><br><span class=\"line\">| :-----| ----: | :----: |</span><br><span class=\"line\">| 单元格 | 单元格 | 单元格 |</span><br><span class=\"line\">| 单元格 | 单元格 | 单元格 |</span><br></pre></td></tr></table></figure>\n\n<p>乍一看还挺直观好用的是吧？但想想，一旦表格内容层次不齐，又或是表格长得难以下手，直接用键盘输入表格就显得十分麻烦和痛苦了。</p>\n<p>好在 Typora 为我们提供了图形界面的插入表格的功能，你只需要在行内 <code>鼠标右键 - 插入 - 表格</code> ，并输入行数和列数，Typora 就会自动生成一张样式不错的空表格。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/51bf2f290592e1ddbadb95765c04f297.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">Typora 表格</p>\n<h3 id=\"链接引用与脚注\"><a href=\"#链接引用与脚注\" class=\"headerlink\" title=\"链接引用与脚注\"></a>链接引用与脚注</h3><p><strong>链接引用</strong>类似于我们常在论文末尾看到的「参考文献」的写法，你可以通过 <code>[]:</code> 的语法来为你的文档加上链接引用。</p>\n<p><strong>脚注</strong>在少数派的文章中也很常见，即某段话结尾右上角标有数字标记，页面底部进行注释的写法。你可以在需要插入脚注标号的位置写 <code>[^ number ]</code> ，再在下方通过 <code>[^ number ]:</code> 在文档中插入脚注。注意不要遗漏了脚注编号 <code>number</code> 前后的空格。</p>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/5f82606e6d89fe1eb24705c4ca6b895d.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">链接引用和脚注</p>\n<h3 id=\"文件系统\"><a href=\"#文件系统\" class=\"headerlink\" title=\"文件系统\"></a>文件系统</h3><p>除了前文提到的文件侧边栏，Typora 还提供了一些耦合度不高的文件系统。</p>\n<ul>\n<li><strong>快速打开：</strong>你可以通过 <code>文件 - 快速打开...</code> 或 <code>Ctrl + P</code> 快捷键快速打开最近的文档。</li>\n<li><strong>保存：</strong>Typora 支持自动保存，一般很少有写好的文档丢失的情况。同时它也提供了诸如「保存」、「另存为」、「保存全部打开的文件…」之类的功能。</li>\n<li><strong>导入：</strong>Typora 支持非常多的文件格式：.docx, .latex, .tex, .ltx, .rst, .rest, .org, .wiki, .dokuwiki, .textile, .opml, .epub。</li>\n<li><strong>导出：</strong>Typora 原生支持导出 PDF，HTML等格式。你可以根据软件内提示安装 <strong>Pandoc 插件</strong>来导出更多例如 docx，LaTeX 等格式。 </li>\n</ul>\n<p><img src=\"https://cdn.sspai.com/2019/05/24/ba295f21f0b71646bb36a0517e868ced.png?imageView2/2/w/1120/q/90/interlace/1/ignore-error/1\" alt=\"img\">导出</p>\n"},{"title":"新一代-效率工具平台","date":"2023-01-30T16:00:00.000Z","updated":"2023-01-31T07:05:11.671Z","type":"tags","description":"utools","keywords":"软件推荐","top_img":"https://pic1.zhimg.com/v2-1f3d5b9cdd3d3498d2b212a1d9dab203_1440w.jpg?source=172ae18b","cover":"https://pic1.zhimg.com/v2-1f3d5b9cdd3d3498d2b212a1d9dab203_1440w.jpg?source=172ae18b","_content":"\n# 介绍\n\n![utools.png](https://res.u-tools.cn/website/utools.png)\n\n## [#](https://u.tools/docs/guide/about-uTools.html#utools-是什么)uTools 是什么？\n\n> uTools = your tools（你的工具集）\n\nuTools 是一个极简、插件化的现代桌面软件，通过自由选配丰富的插件，打造得心应手的工具集合。\n\n通过快捷键（默认 `alt + space` ）就可以快速呼出这个搜索框。你可以往输入框内粘贴文本、图片、截图、文件、文件夹等等，能够处理此内容的插件也早已准备就绪，统一的设计风格和操作方式，助你高效的得到结果。\n\n一旦你熟悉它后，能够为你节约大量时间，即用即走、不中断、无干扰，让你可以更加专注地改变世界。\n\n> 观看 uTools 的介绍视频\n\n[![dd](https://res.u-tools.cn/images/play.png)open in new window](https://www.bilibili.com/video/BV1eg411M7TZ?share_source=copy_web)\n\n## [#](https://u.tools/docs/guide/about-uTools.html#utools-能做什么)uTools 能做什么？\n\n最简单的，uTools 可以作为一个程序快速启动器，支持英文、英文驼峰、中文拼音、拼音首字母来打开你的本地程序。除程序外， win10+ 和 macOS 用户还可以快速搜索并打开「控制面板」内的细项。总之，你只要还记得一个大概的名字，直接输入基本都能找到。\n\n> 针对中文特别优化，例如可以通过搜索 `记事本` 或 `jsb` 打开记事本，而不是搜索 `notepad`\n\n## [#](https://u.tools/docs/guide/about-uTools.html#一切皆插件)一切皆插件！\n\n启动已安装的程序仅仅是最基础的功能，uTools 最大的特点就是拥有强大的插件系统。\n\n现在已有 400+ 的插件供你选择，每个插件解决一个具体场景的问题，简洁美观、即用即走。\n\n输入 `插件市场` 进入插件管理，你就可以根据自己的需求挑选安装，组合成自己最称手的工具集合，为各种日常操作提供便利，不断产生的新插件，也将为你带来无限可能。\n\n![plugin](https://res.u-tools.cn/website/plugin1.png)\n\n## [#](https://u.tools/docs/guide/about-uTools.html#超级面板)超级面板\n\n可以通过鼠标右键/中键（可配置），快速打开 uTools 超级面板，uTools 会根据当前选择的内容（文本、截图、文件、文件夹）自动匹配已安装的插件供你选择。与平时使用右键类似的习惯，uTools 超级面板却能为你带来完全不一样的内容及体验。\n\n> 针对英文，还提供单词词典和整句翻译功能。\n\n![superPanel](https://res.u-tools.cn/website/translate.jpg)\n\n# 使用技巧\n\n## [#](https://u.tools/docs/guide/skills.html#esc-键-快速回到主输入框)ESC 键 快速回到主输入框\n\n在任何进入插件后，可以通过 `esc` 快速回到初始状态。\n\n## [#](https://u.tools/docs/guide/skills.html#窗口分离)窗口分离\n\nuTools 插件都自带图形界面，或许有些时候你希望长时间使用某个插件，或是希望同时开启多个相同的插件，这个时候，你只需按 `ctrl + d`（ mac 下 `command + d` ），即可以将插件脱离 uTools 主输入框，把插件当成一个独立的应用程序来使用。\n\n## [#](https://u.tools/docs/guide/skills.html#自动识别)自动识别\n\n安装对应的插件后，uTools 可以自动识别文本格式，并列出能够处理此文本的插件供你选择。\n\n例如：\n\n- 通过超级面板划词翻译：`复制一段英文`->`通过长按右键或者中键唤出超级面板`->`选择「翻译」插件`->`松开鼠标按键得到结果`。\n- 通过输入框编辑 JSON ：`复制一段 json 字符串`->`呼出 uTools (会自动粘贴)`->`选择「 json 」插件`->`得到结果`。\n\n## [#](https://u.tools/docs/guide/skills.html#全局快捷键)全局快捷键\n\nuTools 已经可以快速的辅助你解决一些小场景的问题，但是在使用很频繁的一些场景，合理的使用全局快捷键可以一键直达，快上加快。\n\n首先，你需要在「 setting 」中配置全局快捷键，事例如下图： ![setting.png](https://res.u-tools.cn/website/shortcuts.png)\n\n- 设置 `F1 `为「百度」功能，按 `F1` 将打开插件，如果启用『自动复制』，将自动打开浏览器搜索当前选中的内容。\n- 设置 `F2` 为「翻译」功能，当复制一段文本后，在5秒内按 `F2` 直接翻译复制的文本。\n- 设置 `F3` 为「截图并自动识别」功能，将调用系统截图，完成截图后，进入插件自动识别图片中的文字。\n- 设置 `F4` 为「截图」功能，将调用系统截图。\n\n更多玩法等你探索\n\n## [#](https://u.tools/docs/guide/skills.html#数据同步)数据同步\n\nuTools 是一个桌面应用程序，各插件所产生配置、内容都将保存在你本地数据库中。\n\n但是你可能需要在公司、家里不同的设备上面使用 uTools ，或者为了预防重装系统等原因造成数据丢失。我们特别准备了云端实时同步备份服务，你可以在成为 uTools 会员 之后进入「设置」自助开启。","source":"_posts/utools介绍.md","raw":"---\ntitle: 新一代-效率工具平台\ndate: 2023-01-31 00:00:00\nupdated:\ntype: tags\ndescription: utools\nkeywords: 软件推荐\ntop_img: https://pic1.zhimg.com/v2-1f3d5b9cdd3d3498d2b212a1d9dab203_1440w.jpg?source=172ae18b\ntags:\n- 快捷效率工具\ncategories:\n- 软件推荐\ncover: https://pic1.zhimg.com/v2-1f3d5b9cdd3d3498d2b212a1d9dab203_1440w.jpg?source=172ae18b\n---\n\n# 介绍\n\n![utools.png](https://res.u-tools.cn/website/utools.png)\n\n## [#](https://u.tools/docs/guide/about-uTools.html#utools-是什么)uTools 是什么？\n\n> uTools = your tools（你的工具集）\n\nuTools 是一个极简、插件化的现代桌面软件，通过自由选配丰富的插件，打造得心应手的工具集合。\n\n通过快捷键（默认 `alt + space` ）就可以快速呼出这个搜索框。你可以往输入框内粘贴文本、图片、截图、文件、文件夹等等，能够处理此内容的插件也早已准备就绪，统一的设计风格和操作方式，助你高效的得到结果。\n\n一旦你熟悉它后，能够为你节约大量时间，即用即走、不中断、无干扰，让你可以更加专注地改变世界。\n\n> 观看 uTools 的介绍视频\n\n[![dd](https://res.u-tools.cn/images/play.png)open in new window](https://www.bilibili.com/video/BV1eg411M7TZ?share_source=copy_web)\n\n## [#](https://u.tools/docs/guide/about-uTools.html#utools-能做什么)uTools 能做什么？\n\n最简单的，uTools 可以作为一个程序快速启动器，支持英文、英文驼峰、中文拼音、拼音首字母来打开你的本地程序。除程序外， win10+ 和 macOS 用户还可以快速搜索并打开「控制面板」内的细项。总之，你只要还记得一个大概的名字，直接输入基本都能找到。\n\n> 针对中文特别优化，例如可以通过搜索 `记事本` 或 `jsb` 打开记事本，而不是搜索 `notepad`\n\n## [#](https://u.tools/docs/guide/about-uTools.html#一切皆插件)一切皆插件！\n\n启动已安装的程序仅仅是最基础的功能，uTools 最大的特点就是拥有强大的插件系统。\n\n现在已有 400+ 的插件供你选择，每个插件解决一个具体场景的问题，简洁美观、即用即走。\n\n输入 `插件市场` 进入插件管理，你就可以根据自己的需求挑选安装，组合成自己最称手的工具集合，为各种日常操作提供便利，不断产生的新插件，也将为你带来无限可能。\n\n![plugin](https://res.u-tools.cn/website/plugin1.png)\n\n## [#](https://u.tools/docs/guide/about-uTools.html#超级面板)超级面板\n\n可以通过鼠标右键/中键（可配置），快速打开 uTools 超级面板，uTools 会根据当前选择的内容（文本、截图、文件、文件夹）自动匹配已安装的插件供你选择。与平时使用右键类似的习惯，uTools 超级面板却能为你带来完全不一样的内容及体验。\n\n> 针对英文，还提供单词词典和整句翻译功能。\n\n![superPanel](https://res.u-tools.cn/website/translate.jpg)\n\n# 使用技巧\n\n## [#](https://u.tools/docs/guide/skills.html#esc-键-快速回到主输入框)ESC 键 快速回到主输入框\n\n在任何进入插件后，可以通过 `esc` 快速回到初始状态。\n\n## [#](https://u.tools/docs/guide/skills.html#窗口分离)窗口分离\n\nuTools 插件都自带图形界面，或许有些时候你希望长时间使用某个插件，或是希望同时开启多个相同的插件，这个时候，你只需按 `ctrl + d`（ mac 下 `command + d` ），即可以将插件脱离 uTools 主输入框，把插件当成一个独立的应用程序来使用。\n\n## [#](https://u.tools/docs/guide/skills.html#自动识别)自动识别\n\n安装对应的插件后，uTools 可以自动识别文本格式，并列出能够处理此文本的插件供你选择。\n\n例如：\n\n- 通过超级面板划词翻译：`复制一段英文`->`通过长按右键或者中键唤出超级面板`->`选择「翻译」插件`->`松开鼠标按键得到结果`。\n- 通过输入框编辑 JSON ：`复制一段 json 字符串`->`呼出 uTools (会自动粘贴)`->`选择「 json 」插件`->`得到结果`。\n\n## [#](https://u.tools/docs/guide/skills.html#全局快捷键)全局快捷键\n\nuTools 已经可以快速的辅助你解决一些小场景的问题，但是在使用很频繁的一些场景，合理的使用全局快捷键可以一键直达，快上加快。\n\n首先，你需要在「 setting 」中配置全局快捷键，事例如下图： ![setting.png](https://res.u-tools.cn/website/shortcuts.png)\n\n- 设置 `F1 `为「百度」功能，按 `F1` 将打开插件，如果启用『自动复制』，将自动打开浏览器搜索当前选中的内容。\n- 设置 `F2` 为「翻译」功能，当复制一段文本后，在5秒内按 `F2` 直接翻译复制的文本。\n- 设置 `F3` 为「截图并自动识别」功能，将调用系统截图，完成截图后，进入插件自动识别图片中的文字。\n- 设置 `F4` 为「截图」功能，将调用系统截图。\n\n更多玩法等你探索\n\n## [#](https://u.tools/docs/guide/skills.html#数据同步)数据同步\n\nuTools 是一个桌面应用程序，各插件所产生配置、内容都将保存在你本地数据库中。\n\n但是你可能需要在公司、家里不同的设备上面使用 uTools ，或者为了预防重装系统等原因造成数据丢失。我们特别准备了云端实时同步备份服务，你可以在成为 uTools 会员 之后进入「设置」自助开启。","slug":"utools介绍","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cldjztiwt0002a5w0fmn08qso","content":"<h1 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h1><p><img src=\"https://res.u-tools.cn/website/utools.png\" alt=\"utools.png\"></p>\n<h2 id=\"uTools-是什么？\"><a href=\"#uTools-是什么？\" class=\"headerlink\" title=\"#uTools 是什么？\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#utools-%E6%98%AF%E4%BB%80%E4%B9%88\">#</a>uTools 是什么？</h2><blockquote>\n<p>uTools = your tools（你的工具集）</p>\n</blockquote>\n<p>uTools 是一个极简、插件化的现代桌面软件，通过自由选配丰富的插件，打造得心应手的工具集合。</p>\n<p>通过快捷键（默认 <code>alt + space</code> ）就可以快速呼出这个搜索框。你可以往输入框内粘贴文本、图片、截图、文件、文件夹等等，能够处理此内容的插件也早已准备就绪，统一的设计风格和操作方式，助你高效的得到结果。</p>\n<p>一旦你熟悉它后，能够为你节约大量时间，即用即走、不中断、无干扰，让你可以更加专注地改变世界。</p>\n<blockquote>\n<p>观看 uTools 的介绍视频</p>\n</blockquote>\n<p><a href=\"https://www.bilibili.com/video/BV1eg411M7TZ?share_source=copy_web\"><img src=\"https://res.u-tools.cn/images/play.png\" alt=\"dd\">open in new window</a></p>\n<h2 id=\"uTools-能做什么？\"><a href=\"#uTools-能做什么？\" class=\"headerlink\" title=\"#uTools 能做什么？\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#utools-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88\">#</a>uTools 能做什么？</h2><p>最简单的，uTools 可以作为一个程序快速启动器，支持英文、英文驼峰、中文拼音、拼音首字母来打开你的本地程序。除程序外， win10+ 和 macOS 用户还可以快速搜索并打开「控制面板」内的细项。总之，你只要还记得一个大概的名字，直接输入基本都能找到。</p>\n<blockquote>\n<p>针对中文特别优化，例如可以通过搜索 <code>记事本</code> 或 <code>jsb</code> 打开记事本，而不是搜索 <code>notepad</code></p>\n</blockquote>\n<h2 id=\"一切皆插件！\"><a href=\"#一切皆插件！\" class=\"headerlink\" title=\"#一切皆插件！\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#%E4%B8%80%E5%88%87%E7%9A%86%E6%8F%92%E4%BB%B6\">#</a>一切皆插件！</h2><p>启动已安装的程序仅仅是最基础的功能，uTools 最大的特点就是拥有强大的插件系统。</p>\n<p>现在已有 400+ 的插件供你选择，每个插件解决一个具体场景的问题，简洁美观、即用即走。</p>\n<p>输入 <code>插件市场</code> 进入插件管理，你就可以根据自己的需求挑选安装，组合成自己最称手的工具集合，为各种日常操作提供便利，不断产生的新插件，也将为你带来无限可能。</p>\n<p><img src=\"https://res.u-tools.cn/website/plugin1.png\" alt=\"plugin\"></p>\n<h2 id=\"超级面板\"><a href=\"#超级面板\" class=\"headerlink\" title=\"#超级面板\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#%E8%B6%85%E7%BA%A7%E9%9D%A2%E6%9D%BF\">#</a>超级面板</h2><p>可以通过鼠标右键/中键（可配置），快速打开 uTools 超级面板，uTools 会根据当前选择的内容（文本、截图、文件、文件夹）自动匹配已安装的插件供你选择。与平时使用右键类似的习惯，uTools 超级面板却能为你带来完全不一样的内容及体验。</p>\n<blockquote>\n<p>针对英文，还提供单词词典和整句翻译功能。</p>\n</blockquote>\n<p><img src=\"https://res.u-tools.cn/website/translate.jpg\" alt=\"superPanel\"></p>\n<h1 id=\"使用技巧\"><a href=\"#使用技巧\" class=\"headerlink\" title=\"使用技巧\"></a>使用技巧</h1><h2 id=\"ESC-键-快速回到主输入框\"><a href=\"#ESC-键-快速回到主输入框\" class=\"headerlink\" title=\"#ESC 键 快速回到主输入框\"></a><a href=\"https://u.tools/docs/guide/skills.html#esc-%E9%94%AE-%E5%BF%AB%E9%80%9F%E5%9B%9E%E5%88%B0%E4%B8%BB%E8%BE%93%E5%85%A5%E6%A1%86\">#</a>ESC 键 快速回到主输入框</h2><p>在任何进入插件后，可以通过 <code>esc</code> 快速回到初始状态。</p>\n<h2 id=\"窗口分离\"><a href=\"#窗口分离\" class=\"headerlink\" title=\"#窗口分离\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E7%AA%97%E5%8F%A3%E5%88%86%E7%A6%BB\">#</a>窗口分离</h2><p>uTools 插件都自带图形界面，或许有些时候你希望长时间使用某个插件，或是希望同时开启多个相同的插件，这个时候，你只需按 <code>ctrl + d</code>（ mac 下 <code>command + d</code> ），即可以将插件脱离 uTools 主输入框，把插件当成一个独立的应用程序来使用。</p>\n<h2 id=\"自动识别\"><a href=\"#自动识别\" class=\"headerlink\" title=\"#自动识别\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB\">#</a>自动识别</h2><p>安装对应的插件后，uTools 可以自动识别文本格式，并列出能够处理此文本的插件供你选择。</p>\n<p>例如：</p>\n<ul>\n<li>通过超级面板划词翻译：<code>复制一段英文</code>-&gt;<code>通过长按右键或者中键唤出超级面板</code>-&gt;<code>选择「翻译」插件</code>-&gt;<code>松开鼠标按键得到结果</code>。</li>\n<li>通过输入框编辑 JSON ：<code>复制一段 json 字符串</code>-&gt;<code>呼出 uTools (会自动粘贴)</code>-&gt;<code>选择「 json 」插件</code>-&gt;<code>得到结果</code>。</li>\n</ul>\n<h2 id=\"全局快捷键\"><a href=\"#全局快捷键\" class=\"headerlink\" title=\"#全局快捷键\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E5%85%A8%E5%B1%80%E5%BF%AB%E6%8D%B7%E9%94%AE\">#</a>全局快捷键</h2><p>uTools 已经可以快速的辅助你解决一些小场景的问题，但是在使用很频繁的一些场景，合理的使用全局快捷键可以一键直达，快上加快。</p>\n<p>首先，你需要在「 setting 」中配置全局快捷键，事例如下图： <img src=\"https://res.u-tools.cn/website/shortcuts.png\" alt=\"setting.png\"></p>\n<ul>\n<li>设置 <code>F1 </code>为「百度」功能，按 <code>F1</code> 将打开插件，如果启用『自动复制』，将自动打开浏览器搜索当前选中的内容。</li>\n<li>设置 <code>F2</code> 为「翻译」功能，当复制一段文本后，在5秒内按 <code>F2</code> 直接翻译复制的文本。</li>\n<li>设置 <code>F3</code> 为「截图并自动识别」功能，将调用系统截图，完成截图后，进入插件自动识别图片中的文字。</li>\n<li>设置 <code>F4</code> 为「截图」功能，将调用系统截图。</li>\n</ul>\n<p>更多玩法等你探索</p>\n<h2 id=\"数据同步\"><a href=\"#数据同步\" class=\"headerlink\" title=\"#数据同步\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5\">#</a>数据同步</h2><p>uTools 是一个桌面应用程序，各插件所产生配置、内容都将保存在你本地数据库中。</p>\n<p>但是你可能需要在公司、家里不同的设备上面使用 uTools ，或者为了预防重装系统等原因造成数据丢失。我们特别准备了云端实时同步备份服务，你可以在成为 uTools 会员 之后进入「设置」自助开启。</p>\n","site":{"data":{}},"cover_type":"img","excerpt":"","more":"<h1 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h1><p><img src=\"https://res.u-tools.cn/website/utools.png\" alt=\"utools.png\"></p>\n<h2 id=\"uTools-是什么？\"><a href=\"#uTools-是什么？\" class=\"headerlink\" title=\"#uTools 是什么？\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#utools-%E6%98%AF%E4%BB%80%E4%B9%88\">#</a>uTools 是什么？</h2><blockquote>\n<p>uTools = your tools（你的工具集）</p>\n</blockquote>\n<p>uTools 是一个极简、插件化的现代桌面软件，通过自由选配丰富的插件，打造得心应手的工具集合。</p>\n<p>通过快捷键（默认 <code>alt + space</code> ）就可以快速呼出这个搜索框。你可以往输入框内粘贴文本、图片、截图、文件、文件夹等等，能够处理此内容的插件也早已准备就绪，统一的设计风格和操作方式，助你高效的得到结果。</p>\n<p>一旦你熟悉它后，能够为你节约大量时间，即用即走、不中断、无干扰，让你可以更加专注地改变世界。</p>\n<blockquote>\n<p>观看 uTools 的介绍视频</p>\n</blockquote>\n<p><a href=\"https://www.bilibili.com/video/BV1eg411M7TZ?share_source=copy_web\"><img src=\"https://res.u-tools.cn/images/play.png\" alt=\"dd\">open in new window</a></p>\n<h2 id=\"uTools-能做什么？\"><a href=\"#uTools-能做什么？\" class=\"headerlink\" title=\"#uTools 能做什么？\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#utools-%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88\">#</a>uTools 能做什么？</h2><p>最简单的，uTools 可以作为一个程序快速启动器，支持英文、英文驼峰、中文拼音、拼音首字母来打开你的本地程序。除程序外， win10+ 和 macOS 用户还可以快速搜索并打开「控制面板」内的细项。总之，你只要还记得一个大概的名字，直接输入基本都能找到。</p>\n<blockquote>\n<p>针对中文特别优化，例如可以通过搜索 <code>记事本</code> 或 <code>jsb</code> 打开记事本，而不是搜索 <code>notepad</code></p>\n</blockquote>\n<h2 id=\"一切皆插件！\"><a href=\"#一切皆插件！\" class=\"headerlink\" title=\"#一切皆插件！\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#%E4%B8%80%E5%88%87%E7%9A%86%E6%8F%92%E4%BB%B6\">#</a>一切皆插件！</h2><p>启动已安装的程序仅仅是最基础的功能，uTools 最大的特点就是拥有强大的插件系统。</p>\n<p>现在已有 400+ 的插件供你选择，每个插件解决一个具体场景的问题，简洁美观、即用即走。</p>\n<p>输入 <code>插件市场</code> 进入插件管理，你就可以根据自己的需求挑选安装，组合成自己最称手的工具集合，为各种日常操作提供便利，不断产生的新插件，也将为你带来无限可能。</p>\n<p><img src=\"https://res.u-tools.cn/website/plugin1.png\" alt=\"plugin\"></p>\n<h2 id=\"超级面板\"><a href=\"#超级面板\" class=\"headerlink\" title=\"#超级面板\"></a><a href=\"https://u.tools/docs/guide/about-uTools.html#%E8%B6%85%E7%BA%A7%E9%9D%A2%E6%9D%BF\">#</a>超级面板</h2><p>可以通过鼠标右键/中键（可配置），快速打开 uTools 超级面板，uTools 会根据当前选择的内容（文本、截图、文件、文件夹）自动匹配已安装的插件供你选择。与平时使用右键类似的习惯，uTools 超级面板却能为你带来完全不一样的内容及体验。</p>\n<blockquote>\n<p>针对英文，还提供单词词典和整句翻译功能。</p>\n</blockquote>\n<p><img src=\"https://res.u-tools.cn/website/translate.jpg\" alt=\"superPanel\"></p>\n<h1 id=\"使用技巧\"><a href=\"#使用技巧\" class=\"headerlink\" title=\"使用技巧\"></a>使用技巧</h1><h2 id=\"ESC-键-快速回到主输入框\"><a href=\"#ESC-键-快速回到主输入框\" class=\"headerlink\" title=\"#ESC 键 快速回到主输入框\"></a><a href=\"https://u.tools/docs/guide/skills.html#esc-%E9%94%AE-%E5%BF%AB%E9%80%9F%E5%9B%9E%E5%88%B0%E4%B8%BB%E8%BE%93%E5%85%A5%E6%A1%86\">#</a>ESC 键 快速回到主输入框</h2><p>在任何进入插件后，可以通过 <code>esc</code> 快速回到初始状态。</p>\n<h2 id=\"窗口分离\"><a href=\"#窗口分离\" class=\"headerlink\" title=\"#窗口分离\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E7%AA%97%E5%8F%A3%E5%88%86%E7%A6%BB\">#</a>窗口分离</h2><p>uTools 插件都自带图形界面，或许有些时候你希望长时间使用某个插件，或是希望同时开启多个相同的插件，这个时候，你只需按 <code>ctrl + d</code>（ mac 下 <code>command + d</code> ），即可以将插件脱离 uTools 主输入框，把插件当成一个独立的应用程序来使用。</p>\n<h2 id=\"自动识别\"><a href=\"#自动识别\" class=\"headerlink\" title=\"#自动识别\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB\">#</a>自动识别</h2><p>安装对应的插件后，uTools 可以自动识别文本格式，并列出能够处理此文本的插件供你选择。</p>\n<p>例如：</p>\n<ul>\n<li>通过超级面板划词翻译：<code>复制一段英文</code>-&gt;<code>通过长按右键或者中键唤出超级面板</code>-&gt;<code>选择「翻译」插件</code>-&gt;<code>松开鼠标按键得到结果</code>。</li>\n<li>通过输入框编辑 JSON ：<code>复制一段 json 字符串</code>-&gt;<code>呼出 uTools (会自动粘贴)</code>-&gt;<code>选择「 json 」插件</code>-&gt;<code>得到结果</code>。</li>\n</ul>\n<h2 id=\"全局快捷键\"><a href=\"#全局快捷键\" class=\"headerlink\" title=\"#全局快捷键\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E5%85%A8%E5%B1%80%E5%BF%AB%E6%8D%B7%E9%94%AE\">#</a>全局快捷键</h2><p>uTools 已经可以快速的辅助你解决一些小场景的问题，但是在使用很频繁的一些场景，合理的使用全局快捷键可以一键直达，快上加快。</p>\n<p>首先，你需要在「 setting 」中配置全局快捷键，事例如下图： <img src=\"https://res.u-tools.cn/website/shortcuts.png\" alt=\"setting.png\"></p>\n<ul>\n<li>设置 <code>F1 </code>为「百度」功能，按 <code>F1</code> 将打开插件，如果启用『自动复制』，将自动打开浏览器搜索当前选中的内容。</li>\n<li>设置 <code>F2</code> 为「翻译」功能，当复制一段文本后，在5秒内按 <code>F2</code> 直接翻译复制的文本。</li>\n<li>设置 <code>F3</code> 为「截图并自动识别」功能，将调用系统截图，完成截图后，进入插件自动识别图片中的文字。</li>\n<li>设置 <code>F4</code> 为「截图」功能，将调用系统截图。</li>\n</ul>\n<p>更多玩法等你探索</p>\n<h2 id=\"数据同步\"><a href=\"#数据同步\" class=\"headerlink\" title=\"#数据同步\"></a><a href=\"https://u.tools/docs/guide/skills.html#%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5\">#</a>数据同步</h2><p>uTools 是一个桌面应用程序，各插件所产生配置、内容都将保存在你本地数据库中。</p>\n<p>但是你可能需要在公司、家里不同的设备上面使用 uTools ，或者为了预防重装系统等原因造成数据丢失。我们特别准备了云端实时同步备份服务，你可以在成为 uTools 会员 之后进入「设置」自助开启。</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cldgzp0l400017kuuawu7e7hw","category_id":"cldgzp0l800037kuu39onhott","_id":"cldgzp0lf00087kuu03rv6lk7"},{"post_id":"cldgzp0l700027kuu8zm06wor","category_id":"cldgzp0l800037kuu39onhott","_id":"cldgzp0lf000a7kuuea8keitu"},{"post_id":"cldjztiw80001a5w0h7sy9dcf","category_id":"cldjztix60003a5w001cmc95o","_id":"cldjztixk0009a5w004v4bvyu"},{"post_id":"cldjztiwt0002a5w0fmn08qso","category_id":"cldjztix60003a5w001cmc95o","_id":"cldjztixl000ba5w05ntr5lmg"}],"PostTag":[{"post_id":"cldgzp0l400017kuuawu7e7hw","tag_id":"cldgzp0la00047kuu3iw7ankg","_id":"cldgzp0lf00077kuud7vn7git"},{"post_id":"cldgzp0l700027kuu8zm06wor","tag_id":"cldgzp0le00067kuu9lw49b9y","_id":"cldgzp0lf00097kuu6nhfdbnn"},{"post_id":"cldjztiw80001a5w0h7sy9dcf","tag_id":"cldjztix90004a5w0bieufpfh","_id":"cldjztixi0008a5w08zvghlb2"},{"post_id":"cldjztiwt0002a5w0fmn08qso","tag_id":"cldjztixf0007a5w0fqqqbe91","_id":"cldjztixk000aa5w07ohah56l"}],"Tag":[{"name":"Vue3","_id":"cldgzp0la00047kuu3iw7ankg"},{"name":"node","_id":"cldgzp0le00067kuu9lw49b9y"},{"name":"Typora","_id":"cldjztix90004a5w0bieufpfh"},{"name":"快捷效率工具","_id":"cldjztixf0007a5w0fqqqbe91"}]}}